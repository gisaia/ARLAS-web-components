<table [style.width.px]="tableWidth" class=" table-sm table-responsive table-hover resultlist">
  <thead *ngIf=displayThead>
    <tr class="resultlist__header">
      <ng-container *ngFor="let column of columns">
        <th *ngIf="column.isIdField"
            [style.max-width.px]="column.width"
            [style.min-width.px]="column.width"
            class="resultlist__header--columns" >

          <span  class="resultlist__header--columns--hidden"></span>
        </th>
        <th *ngIf="!column.isIdField && !column.isToggleField"
            [style.max-width.px]="column.width"
            [style.min-width.px]="column.width"
            class="resultlist__header--columns" >
          <span matTooltip="{{'Sort on'  | translate}} {{column.columnName | translate}}">
            <a (click) = "sort(column)">{{column.columnName | translate}}{{column.dataType}}</a>
          </span>
          <div *ngIf="column.sortDirection !== SortEnum.none" class="resultlist__header--columns__sort">
            <mat-icon matTooltip="{{SORT_DESCENDING | translate}}" *ngIf="column.sortDirection === SortEnum.asc" (click) = "sort(column)" class="resultlist__header--columns__sort--icon">expand_more</mat-icon>
            <mat-icon matTooltip="{{SORT_ASCENDING | translate}}" *ngIf="column.sortDirection === SortEnum.desc" (click) = "sort(column)" class="resultlist__header--columns__sort--icon">expand_less</mat-icon>
          </div>
        </th>
        <th *ngIf="column.isToggleField" class="resultlist__header--columns" [style.max-width.px]="column.width" [style.min-width.px]="column.width">
          <span class="resultlist__header--columns--hidden">
          </span>
        </th>
      </ng-container>
    </tr>
    <tr class="resultlist__filter" *ngIf="this.displayFilters">
      <ng-container *ngFor="let column of columns">
        <td [style.width.px]="column.width" *ngIf="column.isIdField">
          <span class="resultlist__header--columns--hidden"></span>
        </td>
        <td  arlas-result-filter class="resultlist__filter__{{column.columnName}}" *ngIf="!column.isIdField && !column.isToggleField"
                           matTooltip="{{FILTER_ON | translate}} {{column.columnName  | translate}}"
                           [style.width.px]="column.width"
                           [column]="column"
                           [dropdownValues]="dropDownMapValues?.get(column.fieldName)|async"
                           [filtersMap]="filtersMap"
                           (columnChanged) ="columnChanged($event)"
                           (setFiltersEvent)="setFilters($event)">
        </td>
        <td *ngIf="column.isToggleField" [style.width.px]="column.width">
          <span class="resultlist__header--columns--hidden"></span>
        </td>
      </ng-container>
    </tr>
    <tr class="resultlist__tools">
      <td [style.width.px]="tableWidth">
        <div class="resultlist__tools--select">
          <div class="resultlist__tools--select-all">
              <mat-icon *ngIf="allItemsChecked" (click)="selectAllItems()" class="primary selectAll__icon_check mat-icon material-icons">check_box</mat-icon>
              <mat-icon *ngIf="!allItemsChecked"(click)="selectAllItems()" class="primary selectAll__icon_check mat-icon material-icons">check_box_outline_blank</mat-icon>
          </div>
          <div class="resultgrid--checkbox__count">
            <span>{{selectedItems.size}}</span>
          </div>
          <div class="resultlist__tools--select-between">
              <mat-icon matTooltip="{{CHECK_INBETWEEN | translate}}"  (click)="selectInBetween()" class="primary selectBetween__icon mat-icon material-icons">vertical_align_center</mat-icon>
          </div>
          <div class="resultlist__tools--geosort">
          <button matTooltip="{{GEOSORT_ACTIONS | translate}}" mat-button [matMenuTriggerFor]="menugeo" class="resultlist__tools--geosort-action-button">
            <div *ngIf="isAutoGeoSortActived"  class="resultlist__tools--geosort--icon--active">{{GEOSORT_BUTTON | translate}}</div>
            <div *ngIf="!isAutoGeoSortActived" class="resultlist__tools--geosort--icon">{{GEOSORT_BUTTON | translate}}</div>
          </button>
        </div>
          <mat-menu #menugeo="matMenu">
            <button    mat-menu-item (click)="setGeoSortAction(geoSortActions[0])"  class="resultlist__header--columns__geosort-button">
              <span>{{geoSortActions[0].label | translate}}</span>
            </button>
            <button  *ngIf="!isAutoGeoSortActived"  mat-menu-item (click)="setGeoSortAction(geoSortActions[1])"   class="resultlist__header--columns__geosort-auto-button">
              <span>{{geoSortActions[1].label | translate}}</span>
            </button>
            <button *ngIf="isAutoGeoSortActived" mat-menu-item (click)="setGeoSortAction(geoSortActions[2])"  class="resultlist__header--columns__geosort-remove-button">
              <span>{{geoSortActions[2].label | translate}}</span>
            </button>
          </mat-menu>

        </div>
        <div class="resultlist__tools--actions">
          <button matTooltip="{{GLOBAL_ACTIONS | translate}}" mat-icon-button [matMenuTriggerFor]="menu" *ngIf="globalActionsList.length > 0">
            <mat-icon>menu</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button  *ngFor="let action of globalActionsList"  [disabled]="selectedItems.size===0" mat-menu-item (click)="setGlobalAction(action)">
              <span>{{action.label | translate}}</span>
            </button>
          </mat-menu>
        </div>

        <div *ngIf="hasGridMode" class="resultlist__tools--mode">
          <mat-button-toggle-group #group="matButtonToggleGroup" (change)="whichMode($event)">
            <mat-button-toggle matTooltip="{{LIST_MODE | translate}}" value="{{ModeEnum.list}}" [checked]="resultMode==ModeEnum.list">
              <mat-icon>list</mat-icon>
            </mat-button-toggle>
            <mat-button-toggle matTooltip="{{GRID_MODE | translate}}" value="{{ModeEnum.grid}}" [checked]="resultMode==ModeEnum.grid">
              <mat-icon>apps</mat-icon>
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>

      </td>
    </tr>
    <tr class="resultlist__grid-detail" *ngIf="selectedGridItem != null
    && resultMode==ModeEnum.grid && isDetailledGridOpen">
      <td class="resultlist__grid-detail--td" [colSpan]="columns?.length">
        <arlas-result-detailed-grid [gridTile]="selectedGridItem" [detailWidth]="tableWidth" [detailHeight]="detailedGridHeight"
          [idFieldName]="fieldsConfiguration.idFieldName" [isDetailShowed]="isDetailledGridOpen" (actionOnItemEvent)="triggerActionOnItem($event)"
          (closeDetail)=closeDetail($event)>
        </arlas-result-detailed-grid>
      </td>
    </tr>
  </thead>
  <tbody arlasResultScroll *ngIf="!isBodyHidden" [style.height.px]="tbodyHeight" [rowItemList]="rowItemList" [searchSize]="searchSize" [nbGridColumns]="nbGridColumns"
    [nLastLines]="nLastLines" [resultMode]="resultMode" (moreDataEvent)="askForMoreData($event)">
    <mat-grid-list cols="{{nbGridColumns}}" rowHeight="1:1" [style.display]="displayListGrid">
      <ng-container *ngFor="let rowItem of items; index as i">
        <ng-container *ngIf="resultMode==ModeEnum.list; else grid_mode">
          <tr arlas-result-item class="resultlist__body--item-hover-{{rowItem.ishighLight}}" (mouseenter)="setConsultedItem(rowItem.identifier)" (mouseleave)="setConsultedItem('leave-'+rowItem.identifier)"
            [rowItem]="rowItem" [useColorService]="useColorService" [cellBackgroundStyle]="cellBackgroundStyle" [keysToColors]="keysToColors" [colorsSaturationWeight]="colorsSaturationWeight" [detailedDataRetriever]="detailedDataRetriever" [selectedItems]="selectedItems" (selectedItemsEvent)="setSelectedItems($event)"
            (selectedItemPositionEvent)="setItemsPositionsList($event)" (borderStyleEvent)="setBorderStyle($event)" [style.border-bottom-style]="borderStyle">
          </tr>
          <tr arlas-result-detailed-item *ngIf="rowItem.isDetailToggled" class="resultlist__body--detailed-item" (mouseenter)="setConsultedItem(rowItem.identifier)"
            (mouseleave)="setConsultedItem('leave-'+rowItem.identifier)" [detailColspan]="rowItem.columns.length" [rowItem]="rowItem"
            [idFieldName]="fieldsConfiguration.idFieldName" (actionOnItemEvent)="triggerActionOnItem($event)">
          </tr>
        </ng-container>
        <ng-template #grid_mode>
          <mat-grid-tile *ngIf="resultMode==ModeEnum.grid" class="resultlist__md-grid-tile">
            <arlas-result-grid-tile class="resultlist__grid-tile" [gridTile]="rowItem" [selectedItems]="selectedItems" [detailedDataRetriever]="detailedDataRetriever"
              (selectedItemsEvent)="setSelectedItems($event)" (selectedItemPositionEvent)="setItemsPositionsList($event)" (clickedOnItemEvent)="setSelectedGridItem($event)"
              (mouseenter)="setConsultedItem(rowItem.identifier)" (mouseleave)="setConsultedItem('leave-'+rowItem.identifier)">
            </arlas-result-grid-tile>
          </mat-grid-tile>
        </ng-template>
      </ng-container>
    </mat-grid-list>
  </tbody>
</table>
<div *ngIf="isMoreDataRequested" class="resultlist__moredata" [style.width.px]="tableWidth">
  <ngx-loading [show]="isMoreDataRequested" [config]="{ animationType: ANIMATION_TYPES.threeBounce, backdropBackgroundColour: 'rgba(100,100,100,0.5)',
                    backdropBorderRadius: '0', primaryColour: '#ffffff', secondaryColour: '#ffffff', tertiaryColour: '#ffffff' }">
  </ngx-loading>
</div>
