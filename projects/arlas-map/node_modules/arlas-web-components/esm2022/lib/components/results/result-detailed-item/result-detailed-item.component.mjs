/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { Component, Input, Output } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { NUMBER_FORMAT_CHAR } from '../../componentsUtils';
import { Subject } from 'rxjs';
import { Item } from '../model/item';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
import * as i2 from "@angular/common";
import * as i3 from "@angular/material/icon";
import * as i4 from "@angular/material/tooltip";
import * as i5 from "../result-actions/result-actions.component";
import * as i6 from "../../../pipes/format-number/format-number.pipe";
import * as i7 from "../../../pipes/replace/replace.pipe";
import * as i8 from "../../../pipes/get-attachment-url/get-attachment-url.pipe";
export class ResultDetailedItemComponent {
    constructor(translate) {
        this.translate = translate;
        /**
         * @Input
         * @description Whether display group with no detail.
         */
        this.showEmptyGroup = false;
        /**
         * @Output
         * @description Emits the event of applying the specified action on the specified item.
         */
        this.actionOnItemEvent = new Subject();
        /**
         * @Input : Angular
         * @description List of active actions per item.
        */
        this.activatedActionsPerItem = new Map();
        this.NUMBER_FORMAT_CHAR = NUMBER_FORMAT_CHAR;
    }
    ngOnInit() { }
    // Emits the action on this ResultDetailedItem to the parent (ResultList)
    triggerActionOnItem(action) {
        this.actionOnItemEvent.next({ action: action, elementidentifier: { idFieldName: this.idFieldName, idValue: this.rowItem.identifier } });
    }
    getGroups() {
        return (this.showEmptyGroup) ? (this.rowItem?.itemDetailedData) : (this.rowItem?.itemDetailedData.filter(d => d.details.length > 0));
    }
    getAttachmentLabel(attachment, index) {
        if (attachment.label && attachment.label.length > 0) {
            return attachment.label;
        }
        else {
            return this.translate.instant('Link') + ' ' + index;
        }
    }
    getAttachmentDescription(attachment) {
        if (attachment.description && attachment.description.length > 0) {
            return attachment.description;
        }
        else {
            return attachment.url;
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ResultDetailedItemComponent, deps: [{ token: i1.TranslateService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: ResultDetailedItemComponent, selector: "[arlas-result-detailed-item]", inputs: { detailColspan: "detailColspan", idFieldName: "idFieldName", containerType: "containerType", rowItem: "rowItem", showEmptyGroup: "showEmptyGroup", detailedDataRetriever: "detailedDataRetriever", activatedActionsPerItem: "activatedActionsPerItem" }, outputs: { actionOnItemEvent: "actionOnItemEvent" }, ngImport: i0, template: "<td class=\"checkboxcell\" [colSpan]=\"1\">\n</td>\n<td [class.grid-container]=\"containerType === 'grid'\" [colSpan]=\"detailColspan - 1\">\n  <div class=\"details-title\" *ngIf=\"rowItem?.detailsTitleEnabled\">{{rowItem?.detailsTitle}}</div>\n  <div class=\"resultdetaileditem\">\n    <ng-container *ngFor=\"let group of rowItem?.itemDetailedData\">\n      <div class=\"resultdetaileditem--group\" *ngIf=\"showEmptyGroup || group.details.length > 0\">\n        <span class=\"resultdetaileditem--group-title {{group.group | replace:' ':'-' | lowercase}}-item-detail\">\n          {{group.group | translate}}\n        </span>\n        <span *ngFor=\"let detail of group.details\" class=\"resultdetaileditem--item {{detail.key}}-item-detail\">\n          <span class=\"resultdetaileditem--item--key\">{{detail.key | translate}}</span>\n          <span class=\"resultdetaileditem--item--value\">{{detail.value | formatNumber:NUMBER_FORMAT_CHAR}}</span>\n        </span>\n      </div>\n    </ng-container>\n    <arlas-result-actions\n          [activatedActionsPerItem]=\"activatedActionsPerItem\"\n          [detailedDataRetriever]=\"detailedDataRetriever\"\n          [item]=\"rowItem\"\n          [mode]=\"'text'\"\n          (actionOnItemEvent)=\"triggerActionOnItem($event)\" ></arlas-result-actions>\n    <span class=\"result-attachments\" *ngIf=\"rowItem?.attachments && rowItem?.attachments.length > 0\">\n      <div class=\"result-attachments--title\">{{'Attachments' | translate}}</div>\n      <span class=\"result-attachments--item\" *ngFor=\"let att of rowItem?.attachments; index as i\">\n        <a class=\"result-attachments--item--link\" href=\"{{att.url | getAttachmentUrl}}\"\n          matTooltip=\"{{getAttachmentDescription(att)}}\" [matTooltipPosition]=\"'after'\" target=\"_blank\">\n          <mat-icon *ngIf=\"att.icon\" class=\"result-attachments--item--link--icon\">{{att.icon}}</mat-icon>\n          <span class=\"result-attachments--item--link--label\"> {{getAttachmentLabel(att, i + 1)}}</span>\n        </a>\n      </span>\n    </span>\n  </div>\n\n</td>\n", styles: ["@charset \"UTF-8\";.grid-container{overflow-y:auto;display:block;height:100%;padding:0}.grid-container .details-title{background-color:#fff;position:sticky;top:0}.details-title{font-weight:500;font-size:1.1em;padding:5px}.resultdetaileditem{font-family:Roboto,Helvetica Neue,sans-serif;font-size:.7em;text-align:left;padding:0 5px}.resultdetaileditem--group{padding-bottom:10px}.resultdetaileditem--group-title{font-weight:700;font-size:12px;border-bottom:1px solid rgba(240,238,238,.8117647059);display:block}.resultdetaileditem--item{display:block;color:#000;padding:3px;border-bottom:1px solid rgba(240,238,238,.8117647059)}.resultdetaileditem--item--key{font-size:11px;font-weight:500;width:120px;display:inline-block;white-space:pre-wrap}.resultdetaileditem--item--value{margin-right:10px;font-weight:500;font-size:11px;overflow-wrap:anywhere}.resultdetaileditem .resultdetaileditem__actions{font-family:Roboto,Helvetica Neue,sans-serif;font-size:.9em;margin:3px;padding:5px 10px;height:25px;line-height:0;cursor:pointer;color:#000;background-color:#fff;border:1.5px solid black;border-radius:2px}.result-attachments{display:block;max-width:95%;padding-top:10px}.result-attachments--title{font-weight:700;color:#322d90;font-size:1.1em}.result-attachments--item{padding-right:5px}\n"], dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "directive", type: i4.MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "component", type: i5.ResultActionsComponent, selector: "arlas-result-actions", inputs: ["item", "width", "activatedActionsPerItem", "detailedDataRetriever", "stopPropagation", "mode"], outputs: ["actionOnItemEvent"] }, { kind: "pipe", type: i2.LowerCasePipe, name: "lowercase" }, { kind: "pipe", type: i1.TranslatePipe, name: "translate" }, { kind: "pipe", type: i6.FormatNumberPipe, name: "formatNumber" }, { kind: "pipe", type: i7.ReplacePipe, name: "replace" }, { kind: "pipe", type: i8.GetAttachmentUrlPipe, name: "getAttachmentUrl" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ResultDetailedItemComponent, decorators: [{
            type: Component,
            args: [{ selector: '[arlas-result-detailed-item]', template: "<td class=\"checkboxcell\" [colSpan]=\"1\">\n</td>\n<td [class.grid-container]=\"containerType === 'grid'\" [colSpan]=\"detailColspan - 1\">\n  <div class=\"details-title\" *ngIf=\"rowItem?.detailsTitleEnabled\">{{rowItem?.detailsTitle}}</div>\n  <div class=\"resultdetaileditem\">\n    <ng-container *ngFor=\"let group of rowItem?.itemDetailedData\">\n      <div class=\"resultdetaileditem--group\" *ngIf=\"showEmptyGroup || group.details.length > 0\">\n        <span class=\"resultdetaileditem--group-title {{group.group | replace:' ':'-' | lowercase}}-item-detail\">\n          {{group.group | translate}}\n        </span>\n        <span *ngFor=\"let detail of group.details\" class=\"resultdetaileditem--item {{detail.key}}-item-detail\">\n          <span class=\"resultdetaileditem--item--key\">{{detail.key | translate}}</span>\n          <span class=\"resultdetaileditem--item--value\">{{detail.value | formatNumber:NUMBER_FORMAT_CHAR}}</span>\n        </span>\n      </div>\n    </ng-container>\n    <arlas-result-actions\n          [activatedActionsPerItem]=\"activatedActionsPerItem\"\n          [detailedDataRetriever]=\"detailedDataRetriever\"\n          [item]=\"rowItem\"\n          [mode]=\"'text'\"\n          (actionOnItemEvent)=\"triggerActionOnItem($event)\" ></arlas-result-actions>\n    <span class=\"result-attachments\" *ngIf=\"rowItem?.attachments && rowItem?.attachments.length > 0\">\n      <div class=\"result-attachments--title\">{{'Attachments' | translate}}</div>\n      <span class=\"result-attachments--item\" *ngFor=\"let att of rowItem?.attachments; index as i\">\n        <a class=\"result-attachments--item--link\" href=\"{{att.url | getAttachmentUrl}}\"\n          matTooltip=\"{{getAttachmentDescription(att)}}\" [matTooltipPosition]=\"'after'\" target=\"_blank\">\n          <mat-icon *ngIf=\"att.icon\" class=\"result-attachments--item--link--icon\">{{att.icon}}</mat-icon>\n          <span class=\"result-attachments--item--link--label\"> {{getAttachmentLabel(att, i + 1)}}</span>\n        </a>\n      </span>\n    </span>\n  </div>\n\n</td>\n", styles: ["@charset \"UTF-8\";.grid-container{overflow-y:auto;display:block;height:100%;padding:0}.grid-container .details-title{background-color:#fff;position:sticky;top:0}.details-title{font-weight:500;font-size:1.1em;padding:5px}.resultdetaileditem{font-family:Roboto,Helvetica Neue,sans-serif;font-size:.7em;text-align:left;padding:0 5px}.resultdetaileditem--group{padding-bottom:10px}.resultdetaileditem--group-title{font-weight:700;font-size:12px;border-bottom:1px solid rgba(240,238,238,.8117647059);display:block}.resultdetaileditem--item{display:block;color:#000;padding:3px;border-bottom:1px solid rgba(240,238,238,.8117647059)}.resultdetaileditem--item--key{font-size:11px;font-weight:500;width:120px;display:inline-block;white-space:pre-wrap}.resultdetaileditem--item--value{margin-right:10px;font-weight:500;font-size:11px;overflow-wrap:anywhere}.resultdetaileditem .resultdetaileditem__actions{font-family:Roboto,Helvetica Neue,sans-serif;font-size:.9em;margin:3px;padding:5px 10px;height:25px;line-height:0;cursor:pointer;color:#000;background-color:#fff;border:1.5px solid black;border-radius:2px}.result-attachments{display:block;max-width:95%;padding-top:10px}.result-attachments--title{font-weight:700;color:#322d90;font-size:1.1em}.result-attachments--item{padding-right:5px}\n"] }]
        }], ctorParameters: () => [{ type: i1.TranslateService }], propDecorators: { detailColspan: [{
                type: Input
            }], idFieldName: [{
                type: Input
            }], containerType: [{
                type: Input
            }], rowItem: [{
                type: Input
            }], showEmptyGroup: [{
                type: Input
            }], actionOnItemEvent: [{
                type: Output
            }], detailedDataRetriever: [{
                type: Input
            }], activatedActionsPerItem: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LWRldGFpbGVkLWl0ZW0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvcmVzdWx0cy9yZXN1bHQtZGV0YWlsZWQtaXRlbS9yZXN1bHQtZGV0YWlsZWQtaXRlbS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9yZXN1bHRzL3Jlc3VsdC1kZXRhaWxlZC1pdGVtL3Jlc3VsdC1kZXRhaWxlZC1pdGVtLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7Ozs7QUFTckMsTUFBTSxPQUFPLDJCQUEyQjtJQWlEdEMsWUFBMEIsU0FBMkI7UUFBM0IsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUE1QnJEOzs7V0FHRztRQUNhLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBRXZDOzs7V0FHRztRQUNjLHNCQUFpQixHQUNoQyxJQUFJLE9BQU8sRUFBNkQsQ0FBQztRQVEzRTs7O1VBR0U7UUFDYyw0QkFBdUIsR0FBNkIsSUFBSSxHQUFHLEVBQXVCLENBQUM7UUFFNUYsdUJBQWtCLEdBQUcsa0JBQWtCLENBQUM7SUFHVSxDQUFDO0lBRW5ELFFBQVEsS0FBSSxDQUFDO0lBRXBCLHlFQUF5RTtJQUNsRSxtQkFBbUIsQ0FBQyxNQUFjO1FBQ3ZDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzFJLENBQUM7SUFFTSxTQUFTO1FBQ2QsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZJLENBQUM7SUFFTSxrQkFBa0IsQ0FBQyxVQUFzQixFQUFFLEtBQWE7UUFDN0QsSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3BELE9BQU8sVUFBVSxDQUFDLEtBQUssQ0FBQztRQUMxQixDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLEtBQUssQ0FBQztRQUN0RCxDQUFDO0lBQ0gsQ0FBQztJQUVNLHdCQUF3QixDQUFDLFVBQXNCO1FBQ3BELElBQUksVUFBVSxDQUFDLFdBQVcsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNoRSxPQUFPLFVBQVUsQ0FBQyxXQUFXLENBQUM7UUFDaEMsQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPLFVBQVUsQ0FBQyxHQUFHLENBQUM7UUFDeEIsQ0FBQztJQUNILENBQUM7K0dBNUVVLDJCQUEyQjttR0FBM0IsMkJBQTJCLDJYQ2hDeEMsc2lFQW1DQTs7NEZESGEsMkJBQTJCO2tCQUx2QyxTQUFTOytCQUNFLDhCQUE4QjtxRkFTeEIsYUFBYTtzQkFBNUIsS0FBSztnQkFLVSxXQUFXO3NCQUExQixLQUFLO2dCQUdVLGFBQWE7c0JBQTVCLEtBQUs7Z0JBTVUsT0FBTztzQkFBdEIsS0FBSztnQkFNVSxjQUFjO3NCQUE3QixLQUFLO2dCQU1XLGlCQUFpQjtzQkFBakMsTUFBTTtnQkFRUyxxQkFBcUI7c0JBQXBDLEtBQUs7Z0JBS1UsdUJBQXVCO3NCQUF0QyxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIEdpc2HDr2EgdW5kZXIgb25lIG9yIG1vcmUgY29udHJpYnV0b3JcbiAqIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UudHh0IGZpbGUgZGlzdHJpYnV0ZWQgd2l0aFxuICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHRcbiAqIG93bmVyc2hpcC4gR2lzYcOvYSBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyXG4gKiB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5XG4gKiBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBOVU1CRVJfRk9STUFUX0NIQVIgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzVXRpbHMnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSXRlbSB9IGZyb20gJy4uL21vZGVsL2l0ZW0nO1xuaW1wb3J0IHsgQWN0aW9uLCBBdHRhY2htZW50LCBFbGVtZW50SWRlbnRpZmllciB9IGZyb20gJy4uL3V0aWxzL3Jlc3VsdHMudXRpbHMnO1xuaW1wb3J0IHsgRGV0YWlsZWREYXRhUmV0cmlldmVyIH0gZnJvbSAnLi4vdXRpbHMvZGV0YWlsZWQtZGF0YS1yZXRyaWV2ZXInO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdbYXJsYXMtcmVzdWx0LWRldGFpbGVkLWl0ZW1dJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Jlc3VsdC1kZXRhaWxlZC1pdGVtLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcmVzdWx0LWRldGFpbGVkLWl0ZW0uY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBSZXN1bHREZXRhaWxlZEl0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAvKipcbiAgICogQElucHV0XG4gICAqIEBkZXNjcmlwdGlvbiBOdW1iZXIgb2YgY29sdW1ucyBpbiB0aGUgcGFyZW50IHRhYmxlIHNvIHRoYXQgdGhpcyBjb21wb25lbnQgb2NjdXBpZXMgdGhlIGVudGlyZSBsaW5lLlxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIGRldGFpbENvbHNwYW46IG51bWJlcjtcbiAgLyoqXG4gICAqIEBJbnB1dFxuICAgKiBAZGVzY3JpcHRpb24gTmFtZSBvZiB0aGUgaWQgZmllbGQuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgaWRGaWVsZE5hbWU6IHN0cmluZztcblxuXG4gIEBJbnB1dCgpIHB1YmxpYyBjb250YWluZXJUeXBlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBJbnB1dFxuICAgKiBAZGVzY3JpcHRpb24gQW4gb2JqZWN0IHJlcHJlc2VudGluZyBhbiBJdGVtIGFuZCB0aGF0IGNvbnRhaW5zIHRoZSBkZXRhaWxlZCBkYXRhLlxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIHJvd0l0ZW06IEl0ZW07XG5cbiAgLyoqXG4gICAqIEBJbnB1dFxuICAgKiBAZGVzY3JpcHRpb24gV2hldGhlciBkaXNwbGF5IGdyb3VwIHdpdGggbm8gZGV0YWlsLlxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIHNob3dFbXB0eUdyb3VwID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEBPdXRwdXRcbiAgICogQGRlc2NyaXB0aW9uIEVtaXRzIHRoZSBldmVudCBvZiBhcHBseWluZyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBvbiB0aGUgc3BlY2lmaWVkIGl0ZW0uXG4gICAqL1xuICBAT3V0cHV0KCkgcHVibGljIGFjdGlvbk9uSXRlbUV2ZW50OiBTdWJqZWN0PHsgYWN0aW9uOiBBY3Rpb247IGVsZW1lbnRpZGVudGlmaWVyOiBFbGVtZW50SWRlbnRpZmllcjsgfT4gPVxuICAgIG5ldyBTdWJqZWN0PHsgYWN0aW9uOiBBY3Rpb247IGVsZW1lbnRpZGVudGlmaWVyOiBFbGVtZW50SWRlbnRpZmllcjsgfT4oKTtcblxuICAgIC8qKlxuICAgKiBASW5wdXRcbiAgICogQGRlc2NyaXB0aW9uIEEgZGV0YWlsZWQtZGF0YS1yZXRyaWV2ZXIgb2JqZWN0IHRoYXQgaW1wbGVtZW50c1xuICAgKiBEZXRhaWxlZERhdGFSZXRyaWV2ZXIgaW50ZXJmYWNlLlxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIGRldGFpbGVkRGF0YVJldHJpZXZlcjogRGV0YWlsZWREYXRhUmV0cmlldmVyO1xuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gTGlzdCBvZiBhY3RpdmUgYWN0aW9ucyBwZXIgaXRlbS5cbiAgKi9cbiAgQElucHV0KCkgcHVibGljIGFjdGl2YXRlZEFjdGlvbnNQZXJJdGVtOiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj4gPSBuZXcgTWFwPHN0cmluZywgU2V0PHN0cmluZz4+KCk7XG5cbiAgcHVibGljIE5VTUJFUl9GT1JNQVRfQ0hBUiA9IE5VTUJFUl9GT1JNQVRfQ0hBUjtcblxuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihwdWJsaWMgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlKSB7IH1cblxuICBwdWJsaWMgbmdPbkluaXQoKSB7fVxuXG4gIC8vIEVtaXRzIHRoZSBhY3Rpb24gb24gdGhpcyBSZXN1bHREZXRhaWxlZEl0ZW0gdG8gdGhlIHBhcmVudCAoUmVzdWx0TGlzdClcbiAgcHVibGljIHRyaWdnZXJBY3Rpb25Pbkl0ZW0oYWN0aW9uOiBBY3Rpb24pIHtcbiAgICB0aGlzLmFjdGlvbk9uSXRlbUV2ZW50Lm5leHQoeyBhY3Rpb246IGFjdGlvbiwgZWxlbWVudGlkZW50aWZpZXI6IHsgaWRGaWVsZE5hbWU6IHRoaXMuaWRGaWVsZE5hbWUsIGlkVmFsdWU6IHRoaXMucm93SXRlbS5pZGVudGlmaWVyIH0gfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0R3JvdXBzKCkge1xuICAgIHJldHVybiAodGhpcy5zaG93RW1wdHlHcm91cCkgPyAodGhpcy5yb3dJdGVtPy5pdGVtRGV0YWlsZWREYXRhKSA6ICh0aGlzLnJvd0l0ZW0/Lml0ZW1EZXRhaWxlZERhdGEuZmlsdGVyKGQgPT4gZC5kZXRhaWxzLmxlbmd0aCA+IDApKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBdHRhY2htZW50TGFiZWwoYXR0YWNobWVudDogQXR0YWNobWVudCwgaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGF0dGFjaG1lbnQubGFiZWwgJiYgYXR0YWNobWVudC5sYWJlbC5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gYXR0YWNobWVudC5sYWJlbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0xpbmsnKSArICcgJyArIGluZGV4O1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRBdHRhY2htZW50RGVzY3JpcHRpb24oYXR0YWNobWVudDogQXR0YWNobWVudCk6IHN0cmluZyB7XG4gICAgaWYgKGF0dGFjaG1lbnQuZGVzY3JpcHRpb24gJiYgYXR0YWNobWVudC5kZXNjcmlwdGlvbi5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gYXR0YWNobWVudC5kZXNjcmlwdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGF0dGFjaG1lbnQudXJsO1xuICAgIH1cbiAgfVxufVxuIiwiPHRkIGNsYXNzPVwiY2hlY2tib3hjZWxsXCIgW2NvbFNwYW5dPVwiMVwiPlxuPC90ZD5cbjx0ZCBbY2xhc3MuZ3JpZC1jb250YWluZXJdPVwiY29udGFpbmVyVHlwZSA9PT0gJ2dyaWQnXCIgW2NvbFNwYW5dPVwiZGV0YWlsQ29sc3BhbiAtIDFcIj5cbiAgPGRpdiBjbGFzcz1cImRldGFpbHMtdGl0bGVcIiAqbmdJZj1cInJvd0l0ZW0/LmRldGFpbHNUaXRsZUVuYWJsZWRcIj57e3Jvd0l0ZW0/LmRldGFpbHNUaXRsZX19PC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJyZXN1bHRkZXRhaWxlZGl0ZW1cIj5cbiAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBncm91cCBvZiByb3dJdGVtPy5pdGVtRGV0YWlsZWREYXRhXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwicmVzdWx0ZGV0YWlsZWRpdGVtLS1ncm91cFwiICpuZ0lmPVwic2hvd0VtcHR5R3JvdXAgfHwgZ3JvdXAuZGV0YWlscy5sZW5ndGggPiAwXCI+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwicmVzdWx0ZGV0YWlsZWRpdGVtLS1ncm91cC10aXRsZSB7e2dyb3VwLmdyb3VwIHwgcmVwbGFjZTonICc6Jy0nIHwgbG93ZXJjYXNlfX0taXRlbS1kZXRhaWxcIj5cbiAgICAgICAgICB7e2dyb3VwLmdyb3VwIHwgdHJhbnNsYXRlfX1cbiAgICAgICAgPC9zcGFuPlxuICAgICAgICA8c3BhbiAqbmdGb3I9XCJsZXQgZGV0YWlsIG9mIGdyb3VwLmRldGFpbHNcIiBjbGFzcz1cInJlc3VsdGRldGFpbGVkaXRlbS0taXRlbSB7e2RldGFpbC5rZXl9fS1pdGVtLWRldGFpbFwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwicmVzdWx0ZGV0YWlsZWRpdGVtLS1pdGVtLS1rZXlcIj57e2RldGFpbC5rZXkgfCB0cmFuc2xhdGV9fTwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInJlc3VsdGRldGFpbGVkaXRlbS0taXRlbS0tdmFsdWVcIj57e2RldGFpbC52YWx1ZSB8IGZvcm1hdE51bWJlcjpOVU1CRVJfRk9STUFUX0NIQVJ9fTwvc3Bhbj5cbiAgICAgICAgPC9zcGFuPlxuICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPGFybGFzLXJlc3VsdC1hY3Rpb25zXG4gICAgICAgICAgW2FjdGl2YXRlZEFjdGlvbnNQZXJJdGVtXT1cImFjdGl2YXRlZEFjdGlvbnNQZXJJdGVtXCJcbiAgICAgICAgICBbZGV0YWlsZWREYXRhUmV0cmlldmVyXT1cImRldGFpbGVkRGF0YVJldHJpZXZlclwiXG4gICAgICAgICAgW2l0ZW1dPVwicm93SXRlbVwiXG4gICAgICAgICAgW21vZGVdPVwiJ3RleHQnXCJcbiAgICAgICAgICAoYWN0aW9uT25JdGVtRXZlbnQpPVwidHJpZ2dlckFjdGlvbk9uSXRlbSgkZXZlbnQpXCIgPjwvYXJsYXMtcmVzdWx0LWFjdGlvbnM+XG4gICAgPHNwYW4gY2xhc3M9XCJyZXN1bHQtYXR0YWNobWVudHNcIiAqbmdJZj1cInJvd0l0ZW0/LmF0dGFjaG1lbnRzICYmIHJvd0l0ZW0/LmF0dGFjaG1lbnRzLmxlbmd0aCA+IDBcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJyZXN1bHQtYXR0YWNobWVudHMtLXRpdGxlXCI+e3snQXR0YWNobWVudHMnIHwgdHJhbnNsYXRlfX08L2Rpdj5cbiAgICAgIDxzcGFuIGNsYXNzPVwicmVzdWx0LWF0dGFjaG1lbnRzLS1pdGVtXCIgKm5nRm9yPVwibGV0IGF0dCBvZiByb3dJdGVtPy5hdHRhY2htZW50czsgaW5kZXggYXMgaVwiPlxuICAgICAgICA8YSBjbGFzcz1cInJlc3VsdC1hdHRhY2htZW50cy0taXRlbS0tbGlua1wiIGhyZWY9XCJ7e2F0dC51cmwgfCBnZXRBdHRhY2htZW50VXJsfX1cIlxuICAgICAgICAgIG1hdFRvb2x0aXA9XCJ7e2dldEF0dGFjaG1lbnREZXNjcmlwdGlvbihhdHQpfX1cIiBbbWF0VG9vbHRpcFBvc2l0aW9uXT1cIidhZnRlcidcIiB0YXJnZXQ9XCJfYmxhbmtcIj5cbiAgICAgICAgICA8bWF0LWljb24gKm5nSWY9XCJhdHQuaWNvblwiIGNsYXNzPVwicmVzdWx0LWF0dGFjaG1lbnRzLS1pdGVtLS1saW5rLS1pY29uXCI+e3thdHQuaWNvbn19PC9tYXQtaWNvbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInJlc3VsdC1hdHRhY2htZW50cy0taXRlbS0tbGluay0tbGFiZWxcIj4ge3tnZXRBdHRhY2htZW50TGFiZWwoYXR0LCBpICsgMSl9fTwvc3Bhbj5cbiAgICAgICAgPC9hPlxuICAgICAgPC9zcGFuPlxuICAgIDwvc3Bhbj5cbiAgPC9kaXY+XG5cbjwvdGQ+XG4iXX0=