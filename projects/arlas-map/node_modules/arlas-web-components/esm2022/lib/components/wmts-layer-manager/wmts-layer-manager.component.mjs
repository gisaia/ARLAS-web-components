/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { HttpClient } from '@angular/common/http';
import { Component, Input, Output } from '@angular/core';
import { UntypedFormControl, UntypedFormGroup } from '@angular/forms';
import { MatDialog, MatDialogRef } from '@angular/material/dialog';
import moment from 'moment';
import { Subject } from 'rxjs';
import { retry, timeout } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "@angular/common/http";
import * as i3 from "@angular/common";
import * as i4 from "@angular/material/form-field";
import * as i5 from "@angular/material/input";
import * as i6 from "@angular/material/select";
import * as i7 from "@angular/material/core";
import * as i8 from "@angular/material/datepicker";
import * as i9 from "@angular/forms";
import * as i10 from "@angular/material/progress-spinner";
import * as i11 from "@angular/material/card";
import * as i12 from "@angular/material/list";
import * as i13 from "@ngx-translate/core";
export class WmtsLayerManagertDialogComponent {
    constructor(dialogRef, http) {
        this.dialogRef = dialogRef;
        this.http = http;
        this.isImageLoading = false;
        this.showError = false;
        this.previewLoading = false;
        this.launchPreview = false;
        this.clickTopreview = new Subject();
    }
    ngOnInit() {
        const l = new Array();
        this.data.forEach((value, key) => {
            l.push(key);
        });
        this.layers = l;
        this.formGroup = new UntypedFormGroup({
            layer: new UntypedFormControl(),
            style: new UntypedFormControl(),
        });
    }
    selectionChange(event) {
        this.style = undefined;
        this.styles = new Array();
        this.styles = this.data.get(event.value).styles;
        this.dimensions = this.data.get(event.value).dimensions;
        this.dimensions.forEach(d => {
            this.formGroup.addControl(d.identifier, new UntypedFormControl);
        });
    }
    clickOnPreview() {
        this.previewLoading = true;
        this.launchPreview = true;
        this.clickTopreview.next(this.formGroup.value);
    }
    previewUrl(url) {
        this.isImageLoading = true;
        this.getImage(url).subscribe(data => {
            this.createImageFromBlob(data);
            this.isImageLoading = false;
        }, error => {
            this.isImageLoading = false;
            this.showError = true;
        });
    }
    getImage(imageUrl) {
        return this.http.get(imageUrl, { responseType: 'blob' });
    }
    createImageFromBlob(image) {
        const reader = new FileReader();
        reader.addEventListener('load', () => {
            this.imageToShow = reader.result;
        }, false);
        if (image) {
            reader.readAsDataURL(image);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: WmtsLayerManagertDialogComponent, deps: [{ token: i1.MatDialogRef }, { token: i2.HttpClient }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: WmtsLayerManagertDialogComponent, selector: "arlas-wmts-layer-manager-dialog", inputs: { layers: "layers", styles: "styles", metadata: "metadata", dimensions: "dimensions", data: "data", isDimension: "isDimension" }, outputs: { clickTopreview: "clickTopreview" }, ngImport: i0, template: "<h2 mat-dialog-title class=\"wmts-layer-manager-title\">{{'Layers and style' | translate}}</h2>\n<mat-dialog-content class=\"wmts-layer-manager-content\">\n    <mat-card appearance=\"outlined\" class=\"wmts-layer-manager-metadata-card\" *ngIf=\"metadata\">\n        <div class=\"wmts-layer-manager-metadata\">\n            <mat-list>\n                <h3 mat-subheader>{{'Informations' | translate}}</h3>\n                <mat-list-item class=\"wmts-layer-manager-metadata-list\" *ngFor=\"let item of metadata | keyvalue\">\n                    <h4 mat-line class=\"wmts-layer-manager-metadata-title\">{{item.key}}</h4>\n                    <p mat-line class=\"wmts-layer-manager-metadata-value\"> {{item?.value}} </p>\n                </mat-list-item>\n            </mat-list>\n        </div>\n    </mat-card>\n    <form class=\"wmts-layer-manager-form\" [formGroup]=\"formGroup\">\n        <mat-form-field class=\"wmts-layer-manager-field\">\n            <mat-select [(value)]=\"layer\" placeholder=\"{{'Choose layer'| translate}}...\" (selectionChange)=\"selectionChange($event)\"\n                formControlName=\"layer\">\n                <mat-option *ngFor=\"let layer of layers\" [value]=\"layer\">\n                    {{layer}}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-form-field class=\"wmts-layer-manager-field\">\n            <mat-select placeholder=\"{{'Choose style'| translate}}...\" [(value)]=\"style\" formControlName=\"style\">\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style\">\n                    {{style}}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <div *ngFor=\"let dimension of dimensions\">\n            <div *ngIf=\"dimension.identifier==='time'\">\n                <mat-form-field class=\"wmts-layer-manager-field\">\n                    <input matInput autocomplete=\"off\" [matDatepicker]=\"picker\" placeholder=\"{{'Choose date'| translate}}\" formControlName={{dimension.identifier}}\n                        [max]=dimension.endDate [min]=dimension.startDate>\n                    <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                    <mat-datepicker #picker></mat-datepicker>\n                </mat-form-field>\n            </div>\n            <div *ngIf=\"dimension.identifier !=='time'\">\n                <mat-form-field class=\"wmts-layer-manager-field\">\n                    <mat-select formControlName={{dimension.identifier}} placeholder=\"{{'Choose' | translate}} {{dimension.identifier}}\">\n                        <mat-option *ngFor=\"let v of dimension.values\" [value]=\"v\">\n                            {{v}}\n                        </mat-option>\n                    </mat-select>\n                </mat-form-field>\n            </div>\n        </div>\n    </form>\n    <div *ngIf=\"launchPreview\" class=\"wmts-layer-manager-preview\" style=\"height: 256px;\">\n        <img class=\"wmts-layer-manager-image\" [src]=\"imageToShow\" alt=\"Preview of WMTS service\" *ngIf=\"imageToShow&&!isImageLoading&&!showError\">\n        <mat-progress-spinner class=\"wmts-layer-manager-spinner\" *ngIf=\"isImageLoading\" [diameter]=\"128\" [strokeWidth]=\"2\" mode=\"indeterminate\"></mat-progress-spinner>\n    </div>\n    <div class=\"wmts-layer-manager-error\" *ngIf=\"launchPreview && showError\">\n        <span>{{'Unable to preview this style for this layer'| translate}}</span>\n    </div>\n</mat-dialog-content>\n\n<div mat-dialog-actions>\n    <button mat-raised-button class=\"wmts-layer-manager-preview-button\" [disabled]=\"style==undefined||layer==undefined\" (click)=\"clickOnPreview()\">{{'Preview'| translate}}</button>\n    <button mat-raised-button class=\"wmts-layer-manager-view-button\" [disabled]=\"style==undefined||layer==undefined\" [mat-dialog-close]=\"formGroup.value\"\n        cdkFocusInitial>{{'View' | translate}}</button>\n</div>", styles: [".wmts-layer-manager-metadata-list{height:48px!important}.wmts-layer-manager-form{padding-top:16px!important;display:flex;flex-flow:wrap;max-width:440px}.wmts-layer-manager-preview,.wmts-layer-manager-image,.wmts-layer-manager-spinner{margin-left:auto!important;margin-right:auto!important;display:block!important}.wmts-layer-manager-content{max-height:80vh!important}.wmts-layer-manager-field{padding-right:5px;padding-left:5px}\n"], dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.MatDialogClose, selector: "[mat-dialog-close], [matDialogClose]", inputs: ["aria-label", "type", "mat-dialog-close", "matDialogClose"], exportAs: ["matDialogClose"] }, { kind: "directive", type: i1.MatDialogTitle, selector: "[mat-dialog-title], [matDialogTitle]", inputs: ["id"], exportAs: ["matDialogTitle"] }, { kind: "directive", type: i1.MatDialogActions, selector: "[mat-dialog-actions], mat-dialog-actions, [matDialogActions]", inputs: ["align"] }, { kind: "directive", type: i1.MatDialogContent, selector: "[mat-dialog-content], mat-dialog-content, [matDialogContent]" }, { kind: "component", type: i4.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i4.MatSuffix, selector: "[matSuffix], [matIconSuffix], [matTextSuffix]", inputs: ["matTextSuffix"] }, { kind: "directive", type: i5.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { kind: "component", type: i6.MatSelect, selector: "mat-select", inputs: ["aria-describedby", "panelClass", "disabled", "disableRipple", "tabIndex", "hideSingleSelectionIndicator", "placeholder", "required", "multiple", "disableOptionCentering", "compareWith", "value", "aria-label", "aria-labelledby", "errorStateMatcher", "typeaheadDebounceInterval", "sortComparator", "id", "panelWidth"], outputs: ["openedChange", "opened", "closed", "selectionChange", "valueChange"], exportAs: ["matSelect"] }, { kind: "component", type: i7.MatOption, selector: "mat-option", inputs: ["value", "id", "disabled"], outputs: ["onSelectionChange"], exportAs: ["matOption"] }, { kind: "component", type: i8.MatDatepicker, selector: "mat-datepicker", exportAs: ["matDatepicker"] }, { kind: "directive", type: i8.MatDatepickerInput, selector: "input[matDatepicker]", inputs: ["matDatepicker", "min", "max", "matDatepickerFilter"], exportAs: ["matDatepickerInput"] }, { kind: "component", type: i8.MatDatepickerToggle, selector: "mat-datepicker-toggle", inputs: ["for", "tabIndex", "aria-label", "disabled", "disableRipple"], exportAs: ["matDatepickerToggle"] }, { kind: "directive", type: i9.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i9.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i9.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i9.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i9.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i9.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "component", type: i10.MatProgressSpinner, selector: "mat-progress-spinner, mat-spinner", inputs: ["color", "mode", "value", "diameter", "strokeWidth"], exportAs: ["matProgressSpinner"] }, { kind: "component", type: i11.MatCard, selector: "mat-card", inputs: ["appearance"], exportAs: ["matCard"] }, { kind: "component", type: i12.MatList, selector: "mat-list", exportAs: ["matList"] }, { kind: "component", type: i12.MatListItem, selector: "mat-list-item, a[mat-list-item], button[mat-list-item]", inputs: ["activated"], exportAs: ["matListItem"] }, { kind: "directive", type: i12.MatListSubheaderCssMatStyler, selector: "[mat-subheader], [matSubheader]" }, { kind: "pipe", type: i3.KeyValuePipe, name: "keyvalue" }, { kind: "pipe", type: i13.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: WmtsLayerManagertDialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'arlas-wmts-layer-manager-dialog', template: "<h2 mat-dialog-title class=\"wmts-layer-manager-title\">{{'Layers and style' | translate}}</h2>\n<mat-dialog-content class=\"wmts-layer-manager-content\">\n    <mat-card appearance=\"outlined\" class=\"wmts-layer-manager-metadata-card\" *ngIf=\"metadata\">\n        <div class=\"wmts-layer-manager-metadata\">\n            <mat-list>\n                <h3 mat-subheader>{{'Informations' | translate}}</h3>\n                <mat-list-item class=\"wmts-layer-manager-metadata-list\" *ngFor=\"let item of metadata | keyvalue\">\n                    <h4 mat-line class=\"wmts-layer-manager-metadata-title\">{{item.key}}</h4>\n                    <p mat-line class=\"wmts-layer-manager-metadata-value\"> {{item?.value}} </p>\n                </mat-list-item>\n            </mat-list>\n        </div>\n    </mat-card>\n    <form class=\"wmts-layer-manager-form\" [formGroup]=\"formGroup\">\n        <mat-form-field class=\"wmts-layer-manager-field\">\n            <mat-select [(value)]=\"layer\" placeholder=\"{{'Choose layer'| translate}}...\" (selectionChange)=\"selectionChange($event)\"\n                formControlName=\"layer\">\n                <mat-option *ngFor=\"let layer of layers\" [value]=\"layer\">\n                    {{layer}}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-form-field class=\"wmts-layer-manager-field\">\n            <mat-select placeholder=\"{{'Choose style'| translate}}...\" [(value)]=\"style\" formControlName=\"style\">\n                <mat-option *ngFor=\"let style of styles\" [value]=\"style\">\n                    {{style}}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <div *ngFor=\"let dimension of dimensions\">\n            <div *ngIf=\"dimension.identifier==='time'\">\n                <mat-form-field class=\"wmts-layer-manager-field\">\n                    <input matInput autocomplete=\"off\" [matDatepicker]=\"picker\" placeholder=\"{{'Choose date'| translate}}\" formControlName={{dimension.identifier}}\n                        [max]=dimension.endDate [min]=dimension.startDate>\n                    <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                    <mat-datepicker #picker></mat-datepicker>\n                </mat-form-field>\n            </div>\n            <div *ngIf=\"dimension.identifier !=='time'\">\n                <mat-form-field class=\"wmts-layer-manager-field\">\n                    <mat-select formControlName={{dimension.identifier}} placeholder=\"{{'Choose' | translate}} {{dimension.identifier}}\">\n                        <mat-option *ngFor=\"let v of dimension.values\" [value]=\"v\">\n                            {{v}}\n                        </mat-option>\n                    </mat-select>\n                </mat-form-field>\n            </div>\n        </div>\n    </form>\n    <div *ngIf=\"launchPreview\" class=\"wmts-layer-manager-preview\" style=\"height: 256px;\">\n        <img class=\"wmts-layer-manager-image\" [src]=\"imageToShow\" alt=\"Preview of WMTS service\" *ngIf=\"imageToShow&&!isImageLoading&&!showError\">\n        <mat-progress-spinner class=\"wmts-layer-manager-spinner\" *ngIf=\"isImageLoading\" [diameter]=\"128\" [strokeWidth]=\"2\" mode=\"indeterminate\"></mat-progress-spinner>\n    </div>\n    <div class=\"wmts-layer-manager-error\" *ngIf=\"launchPreview && showError\">\n        <span>{{'Unable to preview this style for this layer'| translate}}</span>\n    </div>\n</mat-dialog-content>\n\n<div mat-dialog-actions>\n    <button mat-raised-button class=\"wmts-layer-manager-preview-button\" [disabled]=\"style==undefined||layer==undefined\" (click)=\"clickOnPreview()\">{{'Preview'| translate}}</button>\n    <button mat-raised-button class=\"wmts-layer-manager-view-button\" [disabled]=\"style==undefined||layer==undefined\" [mat-dialog-close]=\"formGroup.value\"\n        cdkFocusInitial>{{'View' | translate}}</button>\n</div>", styles: [".wmts-layer-manager-metadata-list{height:48px!important}.wmts-layer-manager-form{padding-top:16px!important;display:flex;flex-flow:wrap;max-width:440px}.wmts-layer-manager-preview,.wmts-layer-manager-image,.wmts-layer-manager-spinner{margin-left:auto!important;margin-right:auto!important;display:block!important}.wmts-layer-manager-content{max-height:80vh!important}.wmts-layer-manager-field{padding-right:5px;padding-left:5px}\n"] }]
        }], ctorParameters: () => [{ type: i1.MatDialogRef }, { type: i2.HttpClient }], propDecorators: { layers: [{
                type: Input
            }], styles: [{
                type: Input
            }], metadata: [{
                type: Input
            }], dimensions: [{
                type: Input
            }], data: [{
                type: Input
            }], isDimension: [{
                type: Input
            }], clickTopreview: [{
                type: Output
            }] } });
export class WmtsLayerManagerComponent {
    constructor(dialog, http) {
        this.dialog = dialog;
        this.http = http;
        /**
        * @Input : Angular
        * @description Supported CRS code of WMTS service
        */
        this.supportedCRSCode = new Array('3857', '900913');
        /**
      * @Input : Angular
      * @description String date Format for time input
      */
        this.dateFormat = 'YYYY-MM-DDT00:00:00';
        /**
         * @Output : Angular
         * @description Emit the information needed by a wmts client to view a product
         */
        this.getTilesInfoBus = new Subject();
        /**
         * @Output : Angular
         * @description Emit all errors of the component
         */
        this.onError = new Subject();
        this.errorInRun = false;
        this.isGetCapaLoading = false;
    }
    ngOnInit() {
    }
    ngOnChanges(changes) {
        if (changes['getCapaUrl'] !== undefined) {
            this.getCapaUrl = changes['getCapaUrl'].currentValue;
        }
    }
    run(header, md = {}, timeoutDuration = 100000, numberOfRetry = 0) {
        // Call the gatCapabilities services
        this.errorInRun = false;
        this.isGetCapaLoading = true;
        const httpCall = this.http.get(this.getCapaUrl, { headers: header, responseType: 'text' });
        httpCall
            .pipe(timeout(timeoutDuration), retry(numberOfRetry))
            .subscribe(response => {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(response, 'text/xml');
                const data = this.geLayerToData(xmlDoc);
                // if getCapa contains juste one layer and one style we just build the url and send it to the bus
                const mapSize = data.size;
                if (mapSize === 0) {
                    const nonDataError = new Error('NoStyle-NoLayer');
                    this.errorInRun = true;
                    this.onError.next(nonDataError);
                }
                if (mapSize === 1 && data.values().next().value.styles.length === 1) {
                    // update layer and style
                    this.getTilesInfoBus.next(this.buildGetTileInfo(xmlDoc, data.keys().next().value, data.values().next().value.styles[0], md));
                }
                else {
                    this.dialogRef = this.dialog.open(WmtsLayerManagertDialogComponent, { data: response });
                    this.isGetCapaLoading = false;
                    this.dialogRef.componentInstance.data = data;
                    this.dialogRef.componentInstance.metadata = this.metadata;
                    this.dialogRef.afterClosed().subscribe(formGroupValue => {
                        if (formGroupValue) {
                            const getTileInfo = this.buildGetTileInfo(xmlDoc, formGroupValue.layer, formGroupValue.style, md, this.getDimensionsFromGroupValues(formGroupValue));
                            if (!this.errorInRun) {
                                this.getTilesInfoBus.next(getTileInfo);
                            }
                        }
                    });
                    this.dialogRef.componentInstance.clickTopreview.subscribe(formGroupValue => {
                        const getTileInfo = this.buildGetTileInfo(xmlDoc, formGroupValue.layer, formGroupValue.style, md, this.getDimensionsFromGroupValues(formGroupValue));
                        if (!this.errorInRun) {
                            // bounds[[west,south][east,north]]
                            const bounds = getTileInfo.bbox;
                            const previewURL = getTileInfo.url
                                .replace('{x}', '0')
                                .replace('{y}', '0')
                                .replace('{z}', '0');
                            this.dialogRef.componentInstance.previewUrl(previewURL);
                        }
                    });
                }
            }
            catch (e) {
                this.onError.next(e);
                this.isGetCapaLoading = false;
            }
        }, error => {
            this.isGetCapaLoading = false;
            this.onError.next(error);
        });
    }
    geLayerToData(xmlDoc) {
        const layerToData = new Map();
        const layers = Array.from(xmlDoc.getElementsByTagName('Layer'));
        layers.forEach(l => {
            const identifier = l.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, '');
            const styles = Array.from(l.getElementsByTagName('Style'))
                .map(s => s.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, ''));
            const data = {
                styles: styles,
                dimensions: this.getDimension(l)
            };
            layerToData.set(identifier, data);
        });
        return layerToData;
    }
    getDimension(layerElement) {
        const dimensionElements = layerElement.getElementsByTagName('Dimension');
        const allDimension = Array.from(dimensionElements).map(e => {
            const abstracts = e.getElementsByTagName('ows:Abstract');
            let abstract;
            if (abstracts && abstracts.length > 0) {
                abstract = abstracts[0].textContent.replace(/\n/g, '');
            }
            return {
                identifier: e.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, ''),
                abstract: abstract,
                values: Array.from(e.getElementsByTagName('Value')).map(el => el.textContent.replace(/\n/g, ''))
            };
        });
        const timeDimension = allDimension.filter(r => r.identifier === 'time').map(r => {
            let startDate = null;
            let endDate = null;
            if (r.abstract && r.abstract.indexOf('/') > 0) {
                startDate = new Date(r.abstract.split('/')[0]);
                endDate = new Date(r.abstract.split('/')[1]);
                r.startDate = startDate;
                r.endDate = endDate;
            }
            return r;
        })[0];
        const result = allDimension.filter(r => r.identifier !== 'time').concat(timeDimension);
        return result.filter(data => data !== undefined);
    }
    getFormat(xmlDoc, layer) {
        const layerElement = Array.from(xmlDoc.getElementsByTagName('Layer'))
            .filter(l => l.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, '') === layer)[0];
        if (!this.format) {
            const format = Array.from(layerElement.getElementsByTagName('Format'))
                .map(e => e.textContent);
            return format[0];
        }
        else {
            const format = Array.from(layerElement.getElementsByTagName('Format'))
                .filter(f => f.textContent === this.format).map(e => e.textContent);
            if (new Set(format).has(this.format)) {
                return this.format;
            }
            else {
                const formatError = new Error(this.format.concat(' does not exist for layer ').concat(layer));
                this.errorInRun = true;
                this.onError.next(formatError);
            }
        }
    }
    getVersion(xmlDoc) {
        if (this.version === undefined) {
            try {
                return xmlDoc.getElementsByTagName('ows:ServiceTypeVersion')[0].textContent;
            }
            catch (e) {
                this.onError.next(new Error(e));
            }
        }
        else {
            return this.version;
        }
    }
    getKVPBaseUrl(xmlDoc) {
        if (this.getTilesBaseUrl === undefined) {
            try {
                const getCapaOperationNode = Array.from(xmlDoc
                    .getElementsByTagName('ows:OperationsMetadata')[0]
                    .getElementsByTagName('ows:Operation'))
                    .filter(element => element.getAttribute('name') === 'GetCapabilities')[0];
                const getKvpNode = Array.from(getCapaOperationNode.
                    getElementsByTagName('ows:Get'))
                    .filter(element => Array.from(element.getElementsByTagName('ows:Value'))
                    .filter(e => e.textContent === 'KVP').length > 0)[0];
                return getKvpNode.getAttribute('xlink:href');
            }
            catch (e) {
                this.onError.next(e);
            }
        }
        else {
            return this.getTilesBaseUrl;
        }
    }
    getTileMatrixSet(xmlDoc, layer) {
        if (this.tileMatrixSetIdenttifier === undefined) {
            const layerElement = Array.from(xmlDoc.getElementsByTagName('Layer'))
                .filter(l => l.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, '') === layer)[0];
            const tileMatrixSetForLayer = Array.from(layerElement
                .getElementsByTagName('TileMatrixSetLink'))
                .map(t => t.getElementsByTagName('TileMatrixSet'))
                .map(t => t[0].textContent);
            const tileMatrixSet = Array.from(xmlDoc.getElementsByTagName('TileMatrixSet'))
                .filter(l => l.children.length > 0)
                .filter(l => tileMatrixSetForLayer.indexOf(l.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, '')) >= 0)
                .filter(l => {
                const codeArray = [];
                this.supportedCRSCode.forEach(code => {
                    if (l.getElementsByTagName('ows:SupportedCRS')[0].textContent.replace(/\n/g, '').indexOf(code) >= 0) {
                        codeArray.push(code);
                    }
                });
                return codeArray.length > 0;
            }).map(l => l.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, ''));
            return tileMatrixSet[0];
        }
        else {
            return this.tileMatrixSetIdenttifier;
        }
    }
    getBbox(xmlDoc, layer) {
        const layerElement = Array.from(xmlDoc.getElementsByTagName('Layer'))
            .filter(l => l.getElementsByTagName('ows:Identifier')[0].textContent.replace(/\n/g, '') === layer)[0];
        const lowerCornerText = layerElement
            .getElementsByTagName('ows:WGS84BoundingBox')[0]
            .getElementsByTagName('ows:LowerCorner')[0]
            .textContent;
        const upperCornerText = layerElement
            .getElementsByTagName('ows:WGS84BoundingBox')[0]
            .getElementsByTagName('ows:UpperCorner')[0]
            .textContent;
        const bounds = new Array();
        // west
        bounds.push(parseFloat(lowerCornerText.split(' ')[0]));
        // south
        bounds.push(parseFloat(lowerCornerText.split(' ')[1]));
        // east
        bounds.push(parseFloat(upperCornerText.split(' ')[0]));
        // north
        bounds.push(parseFloat(upperCornerText.split(' ')[1]));
        return bounds;
    }
    getZoomMinMax(xmlDoc) {
        const numberOfTileMatrixSetTag = xmlDoc.getElementsByTagName('TileMatrixSet').length;
        const numberOfTileMatrixTag = xmlDoc
            .getElementsByTagName('TileMatrixSet')[numberOfTileMatrixSetTag - 1]
            .getElementsByTagName('TileMatrix').length;
        const maxZoom = xmlDoc
            .getElementsByTagName('TileMatrixSet')[numberOfTileMatrixSetTag - 1]
            .getElementsByTagName('TileMatrix')[numberOfTileMatrixTag - 1].children[0].textContent;
        const minZoom = parseInt(maxZoom, 10) - numberOfTileMatrixTag + 1;
        return [minZoom, parseInt(maxZoom, 10)];
    }
    buildGetTileUrl(xmlDoc, layer, style, dimensions) {
        let baseURL = this.getKVPBaseUrl(xmlDoc);
        if (baseURL[baseURL.length - 1] === '?') {
            baseURL = baseURL.substring(0, baseURL.length - 1);
        }
        const version = this.getVersion(xmlDoc);
        const tileMatrixSet = this.getTileMatrixSet(xmlDoc, layer);
        const format = this.getFormat(xmlDoc, layer);
        let url = '';
        url = url.concat(baseURL)
            .concat('?')
            .concat('SERVICE=WMTS&')
            .concat('REQUEST=GetTile&')
            .concat('VERSION=').concat(version).concat('&')
            .concat('LAYER=').concat(layer).concat('&')
            .concat('STYLE=').concat(style).concat('&')
            .concat('FORMAT=').concat(format).concat('&')
            .concat('TileMatrixSet=').concat(tileMatrixSet).concat('&')
            .concat('TileMatrix=').concat('{z}').concat('&')
            .concat('TileRow=').concat('{y}').concat('&')
            .concat('TileCol=').concat('{x}');
        if (dimensions) {
            Object
                .keys(dimensions)
                .forEach(e => url = url.concat('&').concat(e).concat('=').concat(dimensions[e]));
        }
        return url;
    }
    buildGetTileInfo(xmlDoc, layer, style, md, dimensions) {
        const getTilesInfo = {
            url: this.buildGetTileUrl(xmlDoc, layer, style, dimensions),
            zoomMax: this.getZoomMinMax(xmlDoc)[1],
            zoomMin: this.getZoomMinMax(xmlDoc)[0],
            bbox: this.getBbox(xmlDoc, layer),
            md: md
        };
        return getTilesInfo;
    }
    getDimensionsFromGroupValues(formGroup) {
        const dimensions = {};
        Object.keys(formGroup).filter(e => e !== 'style').filter(e => e !== 'layer')
            .forEach(e => dimensions[e] = formGroup[e]);
        if (dimensions['time']) {
            dimensions['time'] = moment(dimensions['time']).format(this.dateFormat);
        }
        return dimensions;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: WmtsLayerManagerComponent, deps: [{ token: i1.MatDialog }, { token: i2.HttpClient }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: WmtsLayerManagerComponent, selector: "arlas-wmts-layer-manager", inputs: { getCapaUrl: "getCapaUrl", metadata: "metadata", getTilesBaseUrl: "getTilesBaseUrl", version: "version", format: "format", supportedCRSCode: "supportedCRSCode", dateFormat: "dateFormat", tileMatrixSetIdenttifier: "tileMatrixSetIdenttifier" }, outputs: { getTilesInfoBus: "getTilesInfoBus", onError: "onError" }, usesOnChanges: true, ngImport: i0, template: "\n", styles: [""] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: WmtsLayerManagerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'arlas-wmts-layer-manager', template: "\n" }]
        }], ctorParameters: () => [{ type: i1.MatDialog }, { type: i2.HttpClient }], propDecorators: { getCapaUrl: [{
                type: Input
            }], metadata: [{
                type: Input
            }], getTilesBaseUrl: [{
                type: Input
            }], version: [{
                type: Input
            }], format: [{
                type: Input
            }], supportedCRSCode: [{
                type: Input
            }], dateFormat: [{
                type: Input
            }], tileMatrixSetIdenttifier: [{
                type: Input
            }], getTilesInfoBus: [{
                type: Output
            }], onError: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid210cy1sYXllci1tYW5hZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FybGFzLWNvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL3dtdHMtbGF5ZXItbWFuYWdlci93bXRzLWxheWVyLW1hbmFnZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvd210cy1sYXllci1tYW5hZ2VyL3dtdHMtbGF5ZXItbWFuYWdlci1kaWFsb2cuY29tcG9uZW50Lmh0bWwiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy93bXRzLWxheWVyLW1hbmFnZXIvd210cy1sYXllci1tYW5hZ2VyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUVILE9BQU8sRUFBRSxVQUFVLEVBQWUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUMzRixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ25FLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUM1QixPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7Ozs7OztBQTZCaEQsTUFBTSxPQUFPLGdDQUFnQztJQWlCM0MsWUFBMkIsU0FBeUQsRUFBVSxJQUFnQjtR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QU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDOytHQS9WVSx5QkFBeUI7bUdBQXpCLHlCQUF5QixzWkVwSXRDLElBQ0E7OzRGRm1JYSx5QkFBeUI7a0JBTHJDLFNBQVM7K0JBQ0UsMEJBQTBCO3VHQVVwQixVQUFVO3NCQUF6QixLQUFLO2dCQUtVLFFBQVE7c0JBQXZCLEtBQUs7Z0JBT1UsZUFBZTtzQkFBOUIsS0FBSztnQkFPVSxPQUFPO3NCQUF0QixLQUFLO2dCQU1VLE1BQU07c0JBQXJCLEtBQUs7Z0JBS1UsZ0JBQWdCO3NCQUEvQixLQUFLO2dCQUtVLFVBQVU7c0JBQXpCLEtBQUs7Z0JBTVUsd0JBQXdCO3NCQUF2QyxLQUFLO2dCQUtXLGVBQWU7c0JBQS9CLE1BQU07Z0JBS1UsT0FBTztzQkFBdkIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBMaWNlbnNlZCB0byBHaXNhw69hIHVuZGVyIG9uZSBvciBtb3JlIGNvbnRyaWJ1dG9yXG4gKiBsaWNlbnNlIGFncmVlbWVudHMuIFNlZSB0aGUgTk9USUNFLnR4dCBmaWxlIGRpc3RyaWJ1dGVkIHdpdGhcbiAqIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiByZWdhcmRpbmcgY29weXJpZ2h0XG4gKiBvd25lcnNoaXAuIEdpc2HDr2EgbGljZW5zZXMgdGhpcyBmaWxlIHRvIHlvdSB1bmRlclxuICogdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heVxuICogbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFVudHlwZWRGb3JtQ29udHJvbCwgVW50eXBlZEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE1hdERpYWxvZywgTWF0RGlhbG9nUmVmIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHJldHJ5LCB0aW1lb3V0IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdldFRpbGVzSW5mbyB7XG4gIHVybDogc3RyaW5nO1xuICB6b29tTWF4OiBudW1iZXI7XG4gIHpvb21NaW46IG51bWJlcjtcbiAgYmJveDogQXJyYXk8bnVtYmVyPjtcbiAgbWQ6IE9iamVjdDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEaW1lbnNpb24ge1xuICBpZGVudGlmaWVyOiBzdHJpbmc7XG4gIGFic3RyYWN0OiBzdHJpbmc7XG4gIHZhbHVlczogQXJyYXk8c3RyaW5nPjtcbiAgc3RhcnREYXRlPzogRGF0ZTtcbiAgZW5kRGF0ZT86IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGF5ZXJQYXJhbSB7XG4gIHN0eWxlczogQXJyYXk8c3RyaW5nPjtcbiAgZGltZW5zaW9ucz86IEFycmF5PERpbWVuc2lvbj47XG59XG5cblxuQENvbXBvbmVudCh7XG4gIHRlbXBsYXRlVXJsOiAnLi93bXRzLWxheWVyLW1hbmFnZXItZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcbiAgc2VsZWN0b3I6ICdhcmxhcy13bXRzLWxheWVyLW1hbmFnZXItZGlhbG9nJyxcbiAgc3R5bGVVcmxzOiBbJy4vd210cy1sYXllci1tYW5hZ2VyLWRpYWxvZy5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgV210c0xheWVyTWFuYWdlcnREaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBwdWJsaWMgbGF5ZXI6IHN0cmluZztcbiAgcHVibGljIHN0eWxlOiBzdHJpbmc7XG4gIHB1YmxpYyBmb3JtR3JvdXA6IFVudHlwZWRGb3JtR3JvdXA7XG4gIHB1YmxpYyBpbWFnZVRvU2hvdzogYW55O1xuICBwdWJsaWMgaXNJbWFnZUxvYWRpbmcgPSBmYWxzZTtcbiAgcHVibGljIHNob3dFcnJvciA9IGZhbHNlO1xuICBwdWJsaWMgcHJldmlld0xvYWRpbmcgPSBmYWxzZTtcbiAgcHVibGljIGxhdW5jaFByZXZpZXcgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGxheWVyczogQXJyYXk8c3RyaW5nPjtcbiAgQElucHV0KCkgcHVibGljIHN0eWxlczogQXJyYXk8c3RyaW5nPjtcbiAgQElucHV0KCkgcHVibGljIG1ldGFkYXRhOiBNYXA8c3RyaW5nLCBzdHJpbmc+O1xuICBASW5wdXQoKSBwdWJsaWMgZGltZW5zaW9uczogQXJyYXk8RGltZW5zaW9uPjtcbiAgQElucHV0KCkgcHVibGljIGRhdGE6IE1hcDxzdHJpbmcsIExheWVyUGFyYW0+O1xuICBASW5wdXQoKSBwdWJsaWMgaXNEaW1lbnNpb246IGJvb2xlYW47XG4gIEBPdXRwdXQoKSBwdWJsaWMgY2xpY2tUb3ByZXZpZXcgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8V210c0xheWVyTWFuYWdlcnREaWFsb2dDb21wb25lbnQ+LCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHsgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCBsID0gbmV3IEFycmF5KCk7XG4gICAgdGhpcy5kYXRhLmZvckVhY2goKHZhbHVlOiBMYXllclBhcmFtLCBrZXk6IHN0cmluZykgPT4ge1xuICAgICAgbC5wdXNoKGtleSk7XG4gICAgfSk7XG4gICAgdGhpcy5sYXllcnMgPSBsO1xuICAgIHRoaXMuZm9ybUdyb3VwID0gbmV3IFVudHlwZWRGb3JtR3JvdXAoe1xuICAgICAgbGF5ZXI6IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2woKSxcbiAgICAgIHN0eWxlOiBuZXcgVW50eXBlZEZvcm1Db250cm9sKCksXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0aW9uQ2hhbmdlKGV2ZW50KSB7XG4gICAgdGhpcy5zdHlsZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnN0eWxlcyA9IG5ldyBBcnJheSgpO1xuICAgIHRoaXMuc3R5bGVzID0gdGhpcy5kYXRhLmdldChldmVudC52YWx1ZSkuc3R5bGVzO1xuICAgIHRoaXMuZGltZW5zaW9ucyA9IHRoaXMuZGF0YS5nZXQoZXZlbnQudmFsdWUpLmRpbWVuc2lvbnM7XG4gICAgdGhpcy5kaW1lbnNpb25zLmZvckVhY2goZCA9PiB7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5hZGRDb250cm9sKGQuaWRlbnRpZmllciwgbmV3IFVudHlwZWRGb3JtQ29udHJvbCk7XG4gICAgfSk7XG4gIH1cbiAgcHVibGljIGNsaWNrT25QcmV2aWV3KCkge1xuICAgIHRoaXMucHJldmlld0xvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMubGF1bmNoUHJldmlldyA9IHRydWU7XG4gICAgdGhpcy5jbGlja1RvcHJldmlldy5uZXh0KHRoaXMuZm9ybUdyb3VwLnZhbHVlKTtcbiAgfVxuXG4gIHB1YmxpYyBwcmV2aWV3VXJsKHVybDogc3RyaW5nKSB7XG4gICAgdGhpcy5pc0ltYWdlTG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5nZXRJbWFnZSh1cmwpLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgIHRoaXMuY3JlYXRlSW1hZ2VGcm9tQmxvYihkYXRhKTtcbiAgICAgIHRoaXMuaXNJbWFnZUxvYWRpbmcgPSBmYWxzZTtcbiAgICB9LCBlcnJvciA9PiB7XG4gICAgICB0aGlzLmlzSW1hZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLnNob3dFcnJvciA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldEltYWdlKGltYWdlVXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJsb2I+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldChpbWFnZVVybCwgeyByZXNwb25zZVR5cGU6ICdibG9iJyB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSW1hZ2VGcm9tQmxvYihpbWFnZTogQmxvYikge1xuICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgcmVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgICB0aGlzLmltYWdlVG9TaG93ID0gcmVhZGVyLnJlc3VsdDtcbiAgICB9LCBmYWxzZSk7XG5cbiAgICBpZiAoaW1hZ2UpIHtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGltYWdlKTtcbiAgICB9XG4gIH1cbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXJsYXMtd210cy1sYXllci1tYW5hZ2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3dtdHMtbGF5ZXItbWFuYWdlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3dtdHMtbGF5ZXItbWFuYWdlci5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgV210c0xheWVyTWFuYWdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgcHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPFdtdHNMYXllck1hbmFnZXJ0RGlhbG9nQ29tcG9uZW50PjtcbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIFVybCB0byBhY2Nlc3MgIGdldENhcGFiaWxpdGllcyBlbmRwb2ludCBvZiBXTVRTIHNlcnZpY2VcbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBnZXRDYXBhVXJsOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBASW5wdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBNZXRhZGF0YSBvZiBwcm9kdWN0IHRvIGRpc3BsYXkgKG9wdGlvbmFsKVxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIG1ldGFkYXRhOiBNYXA8c3RyaW5nLCBzdHJpbmc+O1xuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gQmFzZSB1cmwgdG8gYWNjZXNzIGdldFRpbGVzIGVuZHBvaW50IG9mIFdNVFMgc2VydmljZVxuICAgKiBJZiB0aGlzIGlucHV0IGlzICBwcm92aWRlZCwgd2UgdXNlIGl0IHRvIGJ1aWxkIGdldFRpbGVzIGVuZHBvaW50XG4gICAqIElmIHRoaXMgaW5wdXQgaXMgbm90IHByb3ZpZGVkLCB3ZSB0cnkgdG8gZmluZCBpdCBpbiBnZXRDYXBhYmlsaXRpZXMgcmVzcG9uc2VcbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBnZXRUaWxlc0Jhc2VVcmw6IHN0cmluZztcbiAgLyoqXG4gICogQElucHV0IDogQW5ndWxhclxuICAqIEBkZXNjcmlwdGlvbiBWZXJzaW9uIG9mIFdNVFMgc2VydmljZVxuICAqIElmIHRoaXMgaW5wdXQgaXMgIHByb3ZpZGVkLCB3ZSB1c2UgaXQgdG8gYnVpbGQgZ2V0VGlsZXMgZW5kcG9pbnRcbiAgKiBJZiB0aGlzIGlucHV0IGlzIG5vdCBwcm92aWRlZCwgd2UgdHJ5IHRvIGZpbmQgaXQgaW4gZ2V0Q2FwYWJpbGl0aWVzIHJlc3BvbnNlXG4gICovXG4gIEBJbnB1dCgpIHB1YmxpYyB2ZXJzaW9uOiBzdHJpbmc7XG4gIC8qKlxuICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgKiBAZGVzY3JpcHRpb24gRm9ybWF0IG9mIGdldFRpbGUgcmVzcG9uc2VcbiAgKiBJZiBnZXRDYXBhYmlsaXRpZXMgZG9lcyBub3QgY29udGFpbnMgdGhpcyBmb3JtYXQsIHdlIHNlbmQgYW4gZXJyb3JcbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBmb3JtYXQ6IHN0cmluZztcbiAgLyoqXG4gICogQElucHV0IDogQW5ndWxhclxuICAqIEBkZXNjcmlwdGlvbiBTdXBwb3J0ZWQgQ1JTIGNvZGUgb2YgV01UUyBzZXJ2aWNlXG4gICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzdXBwb3J0ZWRDUlNDb2RlID0gbmV3IEFycmF5KCczODU3JywgJzkwMDkxMycpO1xuICAvKipcbiogQElucHV0IDogQW5ndWxhclxuKiBAZGVzY3JpcHRpb24gU3RyaW5nIGRhdGUgRm9ybWF0IGZvciB0aW1lIGlucHV0XG4qL1xuICBASW5wdXQoKSBwdWJsaWMgZGF0ZUZvcm1hdCA9ICdZWVlZLU1NLUREVDAwOjAwOjAwJztcbiAgLyoqXG4gICogQElucHV0IDogQW5ndWxhclxuICAqIEBkZXNjcmlwdGlvbiBWYWx1ZSB0byB1c2UgaW4gVGlsZU1hdHJpeFNldFxuICAqIElmIHRoaXMgaW5wdXQgaXMgIHByb3ZpZGVkLCB3ZSB1c2UgaXQgYW5kIHdlIGRvbnQgc2VhcmNoIFRpbGVNYXRyaXhTZXQgaW4gZ2V0Q2FwYWJpbGl0aWVzXG4gICovXG4gIEBJbnB1dCgpIHB1YmxpYyB0aWxlTWF0cml4U2V0SWRlbnR0aWZpZXI6IHN0cmluZztcbiAgLyoqXG4gICAqIEBPdXRwdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBFbWl0IHRoZSBpbmZvcm1hdGlvbiBuZWVkZWQgYnkgYSB3bXRzIGNsaWVudCB0byB2aWV3IGEgcHJvZHVjdFxuICAgKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBnZXRUaWxlc0luZm9CdXMgPSBuZXcgU3ViamVjdDxHZXRUaWxlc0luZm8+KCk7XG4gIC8qKlxuICAgKiBAT3V0cHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gRW1pdCBhbGwgZXJyb3JzIG9mIHRoZSBjb21wb25lbnRcbiAgICovXG4gIEBPdXRwdXQoKSBwdWJsaWMgb25FcnJvciA9IG5ldyBTdWJqZWN0PEVycm9yPigpO1xuXG4gIHB1YmxpYyBlcnJvckluUnVuID0gZmFsc2U7XG4gIHB1YmxpYyBpc0dldENhcGFMb2FkaW5nID0gZmFsc2U7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKHB1YmxpYyBkaWFsb2c6IE1hdERpYWxvZywgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7XG5cbiAgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpIHtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXNbJ2dldENhcGFVcmwnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmdldENhcGFVcmwgPSBjaGFuZ2VzWydnZXRDYXBhVXJsJ10uY3VycmVudFZhbHVlO1xuICAgIH1cbiAgfVxuXG5cbiAgcHVibGljIHJ1bihoZWFkZXI/OiBIdHRwSGVhZGVycywgbWQgPSB7fSwgdGltZW91dER1cmF0aW9uOiBudW1iZXIgPSAxMDAwMDAsIG51bWJlck9mUmV0cnk6IG51bWJlciA9IDApIHtcbiAgICAvLyBDYWxsIHRoZSBnYXRDYXBhYmlsaXRpZXMgc2VydmljZXNcbiAgICB0aGlzLmVycm9ySW5SdW4gPSBmYWxzZTtcbiAgICB0aGlzLmlzR2V0Q2FwYUxvYWRpbmcgPSB0cnVlO1xuICAgIGNvbnN0IGh0dHBDYWxsOiBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLmh0dHAuZ2V0KHRoaXMuZ2V0Q2FwYVVybCwgeyBoZWFkZXJzOiBoZWFkZXIsIHJlc3BvbnNlVHlwZTogJ3RleHQnIH0pO1xuICAgIGh0dHBDYWxsXG4gICAgICAucGlwZSh0aW1lb3V0KHRpbWVvdXREdXJhdGlvbiksXG4gICAgICAgIHJldHJ5KG51bWJlck9mUmV0cnkpKVxuICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgICAgICBjb25zdCB4bWxEb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHJlc3BvbnNlLCAndGV4dC94bWwnKTtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdlTGF5ZXJUb0RhdGEoeG1sRG9jKTtcbiAgICAgICAgICAgIC8vIGlmIGdldENhcGEgY29udGFpbnMganVzdGUgb25lIGxheWVyIGFuZCBvbmUgc3R5bGUgd2UganVzdCBidWlsZCB0aGUgdXJsIGFuZCBzZW5kIGl0IHRvIHRoZSBidXNcbiAgICAgICAgICAgIGNvbnN0IG1hcFNpemUgPSBkYXRhLnNpemU7XG4gICAgICAgICAgICBpZiAobWFwU2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgICBjb25zdCBub25EYXRhRXJyb3I6IEVycm9yID0gbmV3IEVycm9yKCdOb1N0eWxlLU5vTGF5ZXInKTtcbiAgICAgICAgICAgICAgdGhpcy5lcnJvckluUnVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yLm5leHQobm9uRGF0YUVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYXBTaXplID09PSAxICYmIGRhdGEudmFsdWVzKCkubmV4dCgpLnZhbHVlLnN0eWxlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgLy8gdXBkYXRlIGxheWVyIGFuZCBzdHlsZVxuICAgICAgICAgICAgICB0aGlzLmdldFRpbGVzSW5mb0J1cy5uZXh0KHRoaXMuYnVpbGRHZXRUaWxlSW5mbyh4bWxEb2MsIGRhdGEua2V5cygpLm5leHQoKS52YWx1ZSwgZGF0YS52YWx1ZXMoKS5uZXh0KCkudmFsdWUuc3R5bGVzWzBdLCBtZCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5kaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFdtdHNMYXllck1hbmFnZXJ0RGlhbG9nQ29tcG9uZW50LCB7IGRhdGE6IHJlc3BvbnNlIH0pO1xuICAgICAgICAgICAgICB0aGlzLmlzR2V0Q2FwYUxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLm1ldGFkYXRhID0gdGhpcy5tZXRhZGF0YTtcbiAgICAgICAgICAgICAgdGhpcy5kaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKS5zdWJzY3JpYmUoZm9ybUdyb3VwVmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmb3JtR3JvdXBWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgY29uc3QgZ2V0VGlsZUluZm8gPSB0aGlzLmJ1aWxkR2V0VGlsZUluZm8oeG1sRG9jLFxuICAgICAgICAgICAgICAgICAgICBmb3JtR3JvdXBWYWx1ZS5sYXllcixcbiAgICAgICAgICAgICAgICAgICAgZm9ybUdyb3VwVmFsdWUuc3R5bGUsIG1kLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldERpbWVuc2lvbnNGcm9tR3JvdXBWYWx1ZXMoZm9ybUdyb3VwVmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5lcnJvckluUnVuKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VGlsZXNJbmZvQnVzLm5leHQoZ2V0VGlsZUluZm8pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmNsaWNrVG9wcmV2aWV3LnN1YnNjcmliZShmb3JtR3JvdXBWYWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0VGlsZUluZm8gPSB0aGlzLmJ1aWxkR2V0VGlsZUluZm8oeG1sRG9jLFxuICAgICAgICAgICAgICAgICAgZm9ybUdyb3VwVmFsdWUubGF5ZXIsXG4gICAgICAgICAgICAgICAgICBmb3JtR3JvdXBWYWx1ZS5zdHlsZSwgbWQsXG4gICAgICAgICAgICAgICAgICB0aGlzLmdldERpbWVuc2lvbnNGcm9tR3JvdXBWYWx1ZXMoZm9ybUdyb3VwVmFsdWUpKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZXJyb3JJblJ1bikge1xuICAgICAgICAgICAgICAgICAgLy8gYm91bmRzW1t3ZXN0LHNvdXRoXVtlYXN0LG5vcnRoXV1cbiAgICAgICAgICAgICAgICAgIGNvbnN0IGJvdW5kcyA9IGdldFRpbGVJbmZvLmJib3g7XG4gICAgICAgICAgICAgICAgICBjb25zdCBwcmV2aWV3VVJMID0gZ2V0VGlsZUluZm8udXJsXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7eH0nLCAnMCcpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7eX0nLCAnMCcpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7en0nLCAnMCcpO1xuICAgICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UucHJldmlld1VybChwcmV2aWV3VVJMKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMub25FcnJvci5uZXh0KGUpO1xuICAgICAgICAgICAgdGhpcy5pc0dldENhcGFMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5pc0dldENhcGFMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5vbkVycm9yLm5leHQoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZUxheWVyVG9EYXRhKHhtbERvYzogRG9jdW1lbnQpOiBNYXA8c3RyaW5nLCBMYXllclBhcmFtPiB7XG4gICAgY29uc3QgbGF5ZXJUb0RhdGE6IE1hcDxzdHJpbmcsIExheWVyUGFyYW0+ID0gbmV3IE1hcDxzdHJpbmcsIExheWVyUGFyYW0+KCk7XG4gICAgY29uc3QgbGF5ZXJzID0gQXJyYXkuZnJvbSh4bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0xheWVyJykpO1xuICAgIGxheWVycy5mb3JFYWNoKGwgPT4ge1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IGwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpJZGVudGlmaWVyJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuL2csICcnKTtcbiAgICAgIGNvbnN0IHN0eWxlcyA9IEFycmF5LmZyb20obC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnU3R5bGUnKSlcbiAgICAgICAgLm1hcChzID0+IHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpJZGVudGlmaWVyJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuL2csICcnKSk7XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBzdHlsZXM6IHN0eWxlcyxcbiAgICAgICAgZGltZW5zaW9uczogdGhpcy5nZXREaW1lbnNpb24obClcbiAgICAgIH07XG4gICAgICBsYXllclRvRGF0YS5zZXQoaWRlbnRpZmllciwgZGF0YSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGxheWVyVG9EYXRhO1xuICB9XG5cbiAgcHVibGljIGdldERpbWVuc2lvbihsYXllckVsZW1lbnQ6IEVsZW1lbnQpOiBBcnJheTxEaW1lbnNpb24+IHtcbiAgICBjb25zdCBkaW1lbnNpb25FbGVtZW50cyA9IGxheWVyRWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnRGltZW5zaW9uJyk7XG4gICAgY29uc3QgYWxsRGltZW5zaW9uOiBBcnJheTxEaW1lbnNpb24+ID0gQXJyYXkuZnJvbShkaW1lbnNpb25FbGVtZW50cykubWFwKGUgPT4ge1xuICAgICAgY29uc3QgYWJzdHJhY3RzID0gZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3dzOkFic3RyYWN0Jyk7XG4gICAgICBsZXQgYWJzdHJhY3Q7XG4gICAgICBpZiAoYWJzdHJhY3RzICYmIGFic3RyYWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGFic3RyYWN0ID0gYWJzdHJhY3RzWzBdLnRleHRDb250ZW50LnJlcGxhY2UoL1xcbi9nLCAnJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZGVudGlmaWVyOiBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdvd3M6SWRlbnRpZmllcicpWzBdLnRleHRDb250ZW50LnJlcGxhY2UoL1xcbi9nLCAnJyksXG4gICAgICAgIGFic3RyYWN0OiBhYnN0cmFjdCxcbiAgICAgICAgdmFsdWVzOiBBcnJheS5mcm9tKGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ1ZhbHVlJykpLm1hcChlbCA9PiBlbC50ZXh0Q29udGVudC5yZXBsYWNlKC9cXG4vZywgJycpKVxuICAgICAgfTtcbiAgICB9KTtcbiAgICBjb25zdCB0aW1lRGltZW5zaW9uID0gYWxsRGltZW5zaW9uLmZpbHRlcihyID0+IHIuaWRlbnRpZmllciA9PT0gJ3RpbWUnKS5tYXAociA9PiB7XG4gICAgICBsZXQgc3RhcnREYXRlID0gbnVsbDtcbiAgICAgIGxldCBlbmREYXRlID0gbnVsbDtcbiAgICAgIGlmIChyLmFic3RyYWN0ICYmIHIuYWJzdHJhY3QuaW5kZXhPZignLycpID4gMCkge1xuICAgICAgICBzdGFydERhdGUgPSBuZXcgRGF0ZShyLmFic3RyYWN0LnNwbGl0KCcvJylbMF0pO1xuICAgICAgICBlbmREYXRlID0gbmV3IERhdGUoci5hYnN0cmFjdC5zcGxpdCgnLycpWzFdKTtcbiAgICAgICAgci5zdGFydERhdGUgPSBzdGFydERhdGU7XG4gICAgICAgIHIuZW5kRGF0ZSA9IGVuZERhdGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9KVswXTtcbiAgICBjb25zdCByZXN1bHQgPSBhbGxEaW1lbnNpb24uZmlsdGVyKHIgPT4gci5pZGVudGlmaWVyICE9PSAndGltZScpLmNvbmNhdCh0aW1lRGltZW5zaW9uKTtcbiAgICByZXR1cm4gcmVzdWx0LmZpbHRlcihkYXRhID0+IGRhdGEgIT09IHVuZGVmaW5lZCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Rm9ybWF0KHhtbERvYzogRG9jdW1lbnQsIGxheWVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxheWVyRWxlbWVudCA9IEFycmF5LmZyb20oeG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdMYXllcicpKVxuICAgICAgLmZpbHRlcihsID0+IGwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpJZGVudGlmaWVyJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuL2csICcnKSA9PT0gbGF5ZXIpWzBdO1xuICAgIGlmICghdGhpcy5mb3JtYXQpIHtcbiAgICAgIGNvbnN0IGZvcm1hdCA9IEFycmF5LmZyb20obGF5ZXJFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdGb3JtYXQnKSlcbiAgICAgICAgLm1hcChlID0+IGUudGV4dENvbnRlbnQpO1xuICAgICAgcmV0dXJuIGZvcm1hdFswXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZm9ybWF0ID0gQXJyYXkuZnJvbShsYXllckVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0Zvcm1hdCcpKVxuICAgICAgICAuZmlsdGVyKGYgPT4gZi50ZXh0Q29udGVudCA9PT0gdGhpcy5mb3JtYXQpLm1hcChlID0+IGUudGV4dENvbnRlbnQpO1xuICAgICAgaWYgKG5ldyBTZXQoZm9ybWF0KS5oYXModGhpcy5mb3JtYXQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1hdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGZvcm1hdEVycm9yID0gbmV3IEVycm9yKHRoaXMuZm9ybWF0LmNvbmNhdCgnIGRvZXMgbm90IGV4aXN0IGZvciBsYXllciAnKS5jb25jYXQobGF5ZXIpKTtcbiAgICAgICAgdGhpcy5lcnJvckluUnVuID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vbkVycm9yLm5leHQoZm9ybWF0RXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRWZXJzaW9uKHhtbERvYyk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMudmVyc2lvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4geG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdvd3M6U2VydmljZVR5cGVWZXJzaW9uJylbMF0udGV4dENvbnRlbnQ7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMub25FcnJvci5uZXh0KG5ldyBFcnJvcihlKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnZlcnNpb247XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldEtWUEJhc2VVcmwoeG1sRG9jOiBEb2N1bWVudCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuZ2V0VGlsZXNCYXNlVXJsID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGdldENhcGFPcGVyYXRpb25Ob2RlID0gQXJyYXkuZnJvbSh4bWxEb2NcbiAgICAgICAgICAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpPcGVyYXRpb25zTWV0YWRhdGEnKVswXVxuICAgICAgICAgIC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3dzOk9wZXJhdGlvbicpKVxuICAgICAgICAgIC5maWx0ZXIoZWxlbWVudCA9PiBlbGVtZW50LmdldEF0dHJpYnV0ZSgnbmFtZScpID09PSAnR2V0Q2FwYWJpbGl0aWVzJylbMF07XG5cbiAgICAgICAgY29uc3QgZ2V0S3ZwTm9kZSA9IEFycmF5LmZyb20oZ2V0Q2FwYU9wZXJhdGlvbk5vZGUuXG4gICAgICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpHZXQnKSlcbiAgICAgICAgICAuZmlsdGVyKGVsZW1lbnQgPT4gQXJyYXkuZnJvbShlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdvd3M6VmFsdWUnKSlcbiAgICAgICAgICAgIC5maWx0ZXIoZSA9PiBlLnRleHRDb250ZW50ID09PSAnS1ZQJykubGVuZ3RoID4gMClbMF07XG4gICAgICAgIHJldHVybiBnZXRLdnBOb2RlLmdldEF0dHJpYnV0ZSgneGxpbms6aHJlZicpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLm9uRXJyb3IubmV4dChlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0VGlsZXNCYXNlVXJsO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRUaWxlTWF0cml4U2V0KHhtbERvYzogRG9jdW1lbnQsIGxheWVyOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICh0aGlzLnRpbGVNYXRyaXhTZXRJZGVudHRpZmllciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCBsYXllckVsZW1lbnQgPSBBcnJheS5mcm9tKHhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnTGF5ZXInKSlcbiAgICAgICAgLmZpbHRlcihsID0+IGwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpJZGVudGlmaWVyJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuL2csICcnKSA9PT0gbGF5ZXIpWzBdO1xuICAgICAgY29uc3QgdGlsZU1hdHJpeFNldEZvckxheWVyID0gQXJyYXkuZnJvbShsYXllckVsZW1lbnRcbiAgICAgICAgLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdUaWxlTWF0cml4U2V0TGluaycpKVxuICAgICAgICAubWFwKHQgPT4gdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnVGlsZU1hdHJpeFNldCcpKVxuICAgICAgICAubWFwKHQgPT4gdFswXS50ZXh0Q29udGVudCk7XG4gICAgICBjb25zdCB0aWxlTWF0cml4U2V0ID0gQXJyYXkuZnJvbSh4bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ1RpbGVNYXRyaXhTZXQnKSlcbiAgICAgICAgLmZpbHRlcihsID0+IGwuY2hpbGRyZW4ubGVuZ3RoID4gMClcbiAgICAgICAgLmZpbHRlcihsID0+IHRpbGVNYXRyaXhTZXRGb3JMYXllci5pbmRleE9mKGwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpJZGVudGlmaWVyJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuL2csICcnKSkgPj0gMClcbiAgICAgICAgLmZpbHRlcihsID0+IHtcbiAgICAgICAgICBjb25zdCBjb2RlQXJyYXkgPSBbXTtcbiAgICAgICAgICB0aGlzLnN1cHBvcnRlZENSU0NvZGUuZm9yRWFjaChjb2RlID0+IHtcbiAgICAgICAgICAgIGlmIChsLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdvd3M6U3VwcG9ydGVkQ1JTJylbMF0udGV4dENvbnRlbnQucmVwbGFjZSgvXFxuL2csICcnKS5pbmRleE9mKGNvZGUpID49IDApIHtcbiAgICAgICAgICAgICAgY29kZUFycmF5LnB1c2goY29kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGNvZGVBcnJheS5sZW5ndGggPiAwO1xuICAgICAgICB9KS5tYXAobCA9PiBsLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdvd3M6SWRlbnRpZmllcicpWzBdLnRleHRDb250ZW50LnJlcGxhY2UoL1xcbi9nLCAnJykpO1xuICAgICAgcmV0dXJuIHRpbGVNYXRyaXhTZXRbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnRpbGVNYXRyaXhTZXRJZGVudHRpZmllcjtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0QmJveCh4bWxEb2M6IERvY3VtZW50LCBsYXllcjogc3RyaW5nKTogQXJyYXk8bnVtYmVyPiB7XG4gICAgY29uc3QgbGF5ZXJFbGVtZW50ID0gQXJyYXkuZnJvbSh4bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0xheWVyJykpXG4gICAgICAuZmlsdGVyKGwgPT4gbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3dzOklkZW50aWZpZXInKVswXS50ZXh0Q29udGVudC5yZXBsYWNlKC9cXG4vZywgJycpID09PSBsYXllcilbMF07XG4gICAgY29uc3QgbG93ZXJDb3JuZXJUZXh0ID0gbGF5ZXJFbGVtZW50XG4gICAgICAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ293czpXR1M4NEJvdW5kaW5nQm94JylbMF1cbiAgICAgIC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3dzOkxvd2VyQ29ybmVyJylbMF1cbiAgICAgIC50ZXh0Q29udGVudDtcbiAgICBjb25zdCB1cHBlckNvcm5lclRleHQgPSBsYXllckVsZW1lbnRcbiAgICAgIC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3dzOldHUzg0Qm91bmRpbmdCb3gnKVswXVxuICAgICAgLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdvd3M6VXBwZXJDb3JuZXInKVswXVxuICAgICAgLnRleHRDb250ZW50O1xuICAgIGNvbnN0IGJvdW5kcyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XG4gICAgLy8gd2VzdFxuICAgIGJvdW5kcy5wdXNoKHBhcnNlRmxvYXQobG93ZXJDb3JuZXJUZXh0LnNwbGl0KCcgJylbMF0pKTtcbiAgICAvLyBzb3V0aFxuICAgIGJvdW5kcy5wdXNoKHBhcnNlRmxvYXQobG93ZXJDb3JuZXJUZXh0LnNwbGl0KCcgJylbMV0pKTtcbiAgICAvLyBlYXN0XG4gICAgYm91bmRzLnB1c2gocGFyc2VGbG9hdCh1cHBlckNvcm5lclRleHQuc3BsaXQoJyAnKVswXSkpO1xuICAgIC8vIG5vcnRoXG4gICAgYm91bmRzLnB1c2gocGFyc2VGbG9hdCh1cHBlckNvcm5lclRleHQuc3BsaXQoJyAnKVsxXSkpO1xuICAgIHJldHVybiBib3VuZHM7XG4gIH1cblxuICBwdWJsaWMgZ2V0Wm9vbU1pbk1heCh4bWxEb2M6IERvY3VtZW50KTogQXJyYXk8bnVtYmVyPiB7XG4gICAgY29uc3QgbnVtYmVyT2ZUaWxlTWF0cml4U2V0VGFnID0geG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdUaWxlTWF0cml4U2V0JykubGVuZ3RoO1xuICAgIGNvbnN0IG51bWJlck9mVGlsZU1hdHJpeFRhZyA9IHhtbERvY1xuICAgICAgLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdUaWxlTWF0cml4U2V0JylbbnVtYmVyT2ZUaWxlTWF0cml4U2V0VGFnIC0gMV1cbiAgICAgIC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnVGlsZU1hdHJpeCcpLmxlbmd0aDtcbiAgICBjb25zdCBtYXhab29tID0geG1sRG9jXG4gICAgICAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ1RpbGVNYXRyaXhTZXQnKVtudW1iZXJPZlRpbGVNYXRyaXhTZXRUYWcgLSAxXVxuICAgICAgLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdUaWxlTWF0cml4JylbbnVtYmVyT2ZUaWxlTWF0cml4VGFnIC0gMV0uY2hpbGRyZW5bMF0udGV4dENvbnRlbnQ7XG4gICAgY29uc3QgbWluWm9vbSA9IHBhcnNlSW50KG1heFpvb20sIDEwKSAtIG51bWJlck9mVGlsZU1hdHJpeFRhZyArIDE7XG4gICAgcmV0dXJuIFttaW5ab29tLCBwYXJzZUludChtYXhab29tLCAxMCldO1xuICB9XG5cbiAgcHVibGljIGJ1aWxkR2V0VGlsZVVybCh4bWxEb2M6IERvY3VtZW50LCBsYXllcjogc3RyaW5nLCBzdHlsZTogc3RyaW5nLCBkaW1lbnNpb25zPzogT2JqZWN0KTogc3RyaW5nIHtcbiAgICBsZXQgYmFzZVVSTCA9IHRoaXMuZ2V0S1ZQQmFzZVVybCh4bWxEb2MpO1xuICAgIGlmIChiYXNlVVJMW2Jhc2VVUkwubGVuZ3RoIC0gMV0gPT09ICc/Jykge1xuICAgICAgYmFzZVVSTCA9IGJhc2VVUkwuc3Vic3RyaW5nKDAsIGJhc2VVUkwubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGNvbnN0IHZlcnNpb24gPSB0aGlzLmdldFZlcnNpb24oeG1sRG9jKTtcbiAgICBjb25zdCB0aWxlTWF0cml4U2V0ID0gdGhpcy5nZXRUaWxlTWF0cml4U2V0KHhtbERvYywgbGF5ZXIpO1xuICAgIGNvbnN0IGZvcm1hdCA9IHRoaXMuZ2V0Rm9ybWF0KHhtbERvYywgbGF5ZXIpO1xuICAgIGxldCB1cmwgPSAnJztcbiAgICB1cmwgPSB1cmwuY29uY2F0KGJhc2VVUkwpXG4gICAgICAuY29uY2F0KCc/JylcbiAgICAgIC5jb25jYXQoJ1NFUlZJQ0U9V01UUyYnKVxuICAgICAgLmNvbmNhdCgnUkVRVUVTVD1HZXRUaWxlJicpXG4gICAgICAuY29uY2F0KCdWRVJTSU9OPScpLmNvbmNhdCh2ZXJzaW9uKS5jb25jYXQoJyYnKVxuICAgICAgLmNvbmNhdCgnTEFZRVI9JykuY29uY2F0KGxheWVyKS5jb25jYXQoJyYnKVxuICAgICAgLmNvbmNhdCgnU1RZTEU9JykuY29uY2F0KHN0eWxlKS5jb25jYXQoJyYnKVxuICAgICAgLmNvbmNhdCgnRk9STUFUPScpLmNvbmNhdChmb3JtYXQpLmNvbmNhdCgnJicpXG4gICAgICAuY29uY2F0KCdUaWxlTWF0cml4U2V0PScpLmNvbmNhdCh0aWxlTWF0cml4U2V0KS5jb25jYXQoJyYnKVxuICAgICAgLmNvbmNhdCgnVGlsZU1hdHJpeD0nKS5jb25jYXQoJ3t6fScpLmNvbmNhdCgnJicpXG4gICAgICAuY29uY2F0KCdUaWxlUm93PScpLmNvbmNhdCgne3l9JykuY29uY2F0KCcmJylcbiAgICAgIC5jb25jYXQoJ1RpbGVDb2w9JykuY29uY2F0KCd7eH0nKTtcblxuICAgIGlmIChkaW1lbnNpb25zKSB7XG4gICAgICBPYmplY3RcbiAgICAgICAgLmtleXMoZGltZW5zaW9ucylcbiAgICAgICAgLmZvckVhY2goZSA9PiB1cmwgPSB1cmwuY29uY2F0KCcmJykuY29uY2F0KGUpLmNvbmNhdCgnPScpLmNvbmNhdChkaW1lbnNpb25zW2VdKSk7XG4gICAgfVxuICAgIHJldHVybiB1cmw7XG4gIH1cblxuICBwdWJsaWMgYnVpbGRHZXRUaWxlSW5mbyh4bWxEb2M6IERvY3VtZW50LCBsYXllcjogc3RyaW5nLCBzdHlsZTogc3RyaW5nLCBtZDogT2JqZWN0LCBkaW1lbnNpb25zPzogT2JqZWN0KTogR2V0VGlsZXNJbmZvIHtcbiAgICBjb25zdCBnZXRUaWxlc0luZm8gPSB7XG4gICAgICB1cmw6IHRoaXMuYnVpbGRHZXRUaWxlVXJsKHhtbERvYywgbGF5ZXIsIHN0eWxlLCBkaW1lbnNpb25zKSxcbiAgICAgIHpvb21NYXg6IHRoaXMuZ2V0Wm9vbU1pbk1heCh4bWxEb2MpWzFdLFxuICAgICAgem9vbU1pbjogdGhpcy5nZXRab29tTWluTWF4KHhtbERvYylbMF0sXG4gICAgICBiYm94OiB0aGlzLmdldEJib3goeG1sRG9jLCBsYXllciksXG4gICAgICBtZDogbWRcbiAgICB9O1xuICAgIHJldHVybiBnZXRUaWxlc0luZm87XG4gIH1cblxuICBwdWJsaWMgZ2V0RGltZW5zaW9uc0Zyb21Hcm91cFZhbHVlcyhmb3JtR3JvdXA6IGFueSk6IE9iamVjdCB7XG4gICAgY29uc3QgZGltZW5zaW9ucyA9IHt9O1xuICAgIE9iamVjdC5rZXlzKGZvcm1Hcm91cCkuZmlsdGVyKGUgPT4gZSAhPT0gJ3N0eWxlJykuZmlsdGVyKGUgPT4gZSAhPT0gJ2xheWVyJylcbiAgICAgIC5mb3JFYWNoKGUgPT4gZGltZW5zaW9uc1tlXSA9IGZvcm1Hcm91cFtlXSk7XG4gICAgaWYgKGRpbWVuc2lvbnNbJ3RpbWUnXSkge1xuICAgICAgZGltZW5zaW9uc1sndGltZSddID0gbW9tZW50KGRpbWVuc2lvbnNbJ3RpbWUnXSkuZm9ybWF0KHRoaXMuZGF0ZUZvcm1hdCk7XG4gICAgfVxuICAgIHJldHVybiBkaW1lbnNpb25zO1xuICB9XG59XG4iLCI8aDIgbWF0LWRpYWxvZy10aXRsZSBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci10aXRsZVwiPnt7J0xheWVycyBhbmQgc3R5bGUnIHwgdHJhbnNsYXRlfX08L2gyPlxuPG1hdC1kaWFsb2ctY29udGVudCBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci1jb250ZW50XCI+XG4gICAgPG1hdC1jYXJkIGFwcGVhcmFuY2U9XCJvdXRsaW5lZFwiIGNsYXNzPVwid210cy1sYXllci1tYW5hZ2VyLW1ldGFkYXRhLWNhcmRcIiAqbmdJZj1cIm1ldGFkYXRhXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJ3bXRzLWxheWVyLW1hbmFnZXItbWV0YWRhdGFcIj5cbiAgICAgICAgICAgIDxtYXQtbGlzdD5cbiAgICAgICAgICAgICAgICA8aDMgbWF0LXN1YmhlYWRlcj57eydJbmZvcm1hdGlvbnMnIHwgdHJhbnNsYXRlfX08L2gzPlxuICAgICAgICAgICAgICAgIDxtYXQtbGlzdC1pdGVtIGNsYXNzPVwid210cy1sYXllci1tYW5hZ2VyLW1ldGFkYXRhLWxpc3RcIiAqbmdGb3I9XCJsZXQgaXRlbSBvZiBtZXRhZGF0YSB8IGtleXZhbHVlXCI+XG4gICAgICAgICAgICAgICAgICAgIDxoNCBtYXQtbGluZSBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci1tZXRhZGF0YS10aXRsZVwiPnt7aXRlbS5rZXl9fTwvaDQ+XG4gICAgICAgICAgICAgICAgICAgIDxwIG1hdC1saW5lIGNsYXNzPVwid210cy1sYXllci1tYW5hZ2VyLW1ldGFkYXRhLXZhbHVlXCI+IHt7aXRlbT8udmFsdWV9fSA8L3A+XG4gICAgICAgICAgICAgICAgPC9tYXQtbGlzdC1pdGVtPlxuICAgICAgICAgICAgPC9tYXQtbGlzdD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9tYXQtY2FyZD5cbiAgICA8Zm9ybSBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci1mb3JtXCIgW2Zvcm1Hcm91cF09XCJmb3JtR3JvdXBcIj5cbiAgICAgICAgPG1hdC1mb3JtLWZpZWxkIGNsYXNzPVwid210cy1sYXllci1tYW5hZ2VyLWZpZWxkXCI+XG4gICAgICAgICAgICA8bWF0LXNlbGVjdCBbKHZhbHVlKV09XCJsYXllclwiIHBsYWNlaG9sZGVyPVwie3snQ2hvb3NlIGxheWVyJ3wgdHJhbnNsYXRlfX0uLi5cIiAoc2VsZWN0aW9uQ2hhbmdlKT1cInNlbGVjdGlvbkNoYW5nZSgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICBmb3JtQ29udHJvbE5hbWU9XCJsYXllclwiPlxuICAgICAgICAgICAgICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj1cImxldCBsYXllciBvZiBsYXllcnNcIiBbdmFsdWVdPVwibGF5ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAge3tsYXllcn19XG4gICAgICAgICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICAgICAgPC9tYXQtc2VsZWN0PlxuICAgICAgICA8L21hdC1mb3JtLWZpZWxkPlxuICAgICAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9XCJ3bXRzLWxheWVyLW1hbmFnZXItZmllbGRcIj5cbiAgICAgICAgICAgIDxtYXQtc2VsZWN0IHBsYWNlaG9sZGVyPVwie3snQ2hvb3NlIHN0eWxlJ3wgdHJhbnNsYXRlfX0uLi5cIiBbKHZhbHVlKV09XCJzdHlsZVwiIGZvcm1Db250cm9sTmFtZT1cInN0eWxlXCI+XG4gICAgICAgICAgICAgICAgPG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IHN0eWxlIG9mIHN0eWxlc1wiIFt2YWx1ZV09XCJzdHlsZVwiPlxuICAgICAgICAgICAgICAgICAgICB7e3N0eWxlfX1cbiAgICAgICAgICAgICAgICA8L21hdC1vcHRpb24+XG4gICAgICAgICAgICA8L21hdC1zZWxlY3Q+XG4gICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4gICAgICAgIDxkaXYgKm5nRm9yPVwibGV0IGRpbWVuc2lvbiBvZiBkaW1lbnNpb25zXCI+XG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiZGltZW5zaW9uLmlkZW50aWZpZXI9PT0ndGltZSdcIj5cbiAgICAgICAgICAgICAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9XCJ3bXRzLWxheWVyLW1hbmFnZXItZmllbGRcIj5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IG1hdElucHV0IGF1dG9jb21wbGV0ZT1cIm9mZlwiIFttYXREYXRlcGlja2VyXT1cInBpY2tlclwiIHBsYWNlaG9sZGVyPVwie3snQ2hvb3NlIGRhdGUnfCB0cmFuc2xhdGV9fVwiIGZvcm1Db250cm9sTmFtZT17e2RpbWVuc2lvbi5pZGVudGlmaWVyfX1cbiAgICAgICAgICAgICAgICAgICAgICAgIFttYXhdPWRpbWVuc2lvbi5lbmREYXRlIFttaW5dPWRpbWVuc2lvbi5zdGFydERhdGU+XG4gICAgICAgICAgICAgICAgICAgIDxtYXQtZGF0ZXBpY2tlci10b2dnbGUgbWF0U3VmZml4IFtmb3JdPVwicGlja2VyXCI+PC9tYXQtZGF0ZXBpY2tlci10b2dnbGU+XG4gICAgICAgICAgICAgICAgICAgIDxtYXQtZGF0ZXBpY2tlciAjcGlja2VyPjwvbWF0LWRhdGVwaWNrZXI+XG4gICAgICAgICAgICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiAqbmdJZj1cImRpbWVuc2lvbi5pZGVudGlmaWVyICE9PSd0aW1lJ1wiPlxuICAgICAgICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci1maWVsZFwiPlxuICAgICAgICAgICAgICAgICAgICA8bWF0LXNlbGVjdCBmb3JtQ29udHJvbE5hbWU9e3tkaW1lbnNpb24uaWRlbnRpZmllcn19IHBsYWNlaG9sZGVyPVwie3snQ2hvb3NlJyB8IHRyYW5zbGF0ZX19IHt7ZGltZW5zaW9uLmlkZW50aWZpZXJ9fVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IHYgb2YgZGltZW5zaW9uLnZhbHVlc1wiIFt2YWx1ZV09XCJ2XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3t2fX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbWF0LW9wdGlvbj5cbiAgICAgICAgICAgICAgICAgICAgPC9tYXQtc2VsZWN0PlxuICAgICAgICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9mb3JtPlxuICAgIDxkaXYgKm5nSWY9XCJsYXVuY2hQcmV2aWV3XCIgY2xhc3M9XCJ3bXRzLWxheWVyLW1hbmFnZXItcHJldmlld1wiIHN0eWxlPVwiaGVpZ2h0OiAyNTZweDtcIj5cbiAgICAgICAgPGltZyBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci1pbWFnZVwiIFtzcmNdPVwiaW1hZ2VUb1Nob3dcIiBhbHQ9XCJQcmV2aWV3IG9mIFdNVFMgc2VydmljZVwiICpuZ0lmPVwiaW1hZ2VUb1Nob3cmJiFpc0ltYWdlTG9hZGluZyYmIXNob3dFcnJvclwiPlxuICAgICAgICA8bWF0LXByb2dyZXNzLXNwaW5uZXIgY2xhc3M9XCJ3bXRzLWxheWVyLW1hbmFnZXItc3Bpbm5lclwiICpuZ0lmPVwiaXNJbWFnZUxvYWRpbmdcIiBbZGlhbWV0ZXJdPVwiMTI4XCIgW3N0cm9rZVdpZHRoXT1cIjJcIiBtb2RlPVwiaW5kZXRlcm1pbmF0ZVwiPjwvbWF0LXByb2dyZXNzLXNwaW5uZXI+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci1lcnJvclwiICpuZ0lmPVwibGF1bmNoUHJldmlldyAmJiBzaG93RXJyb3JcIj5cbiAgICAgICAgPHNwYW4+e3snVW5hYmxlIHRvIHByZXZpZXcgdGhpcyBzdHlsZSBmb3IgdGhpcyBsYXllcid8IHRyYW5zbGF0ZX19PC9zcGFuPlxuICAgIDwvZGl2PlxuPC9tYXQtZGlhbG9nLWNvbnRlbnQ+XG5cbjxkaXYgbWF0LWRpYWxvZy1hY3Rpb25zPlxuICAgIDxidXR0b24gbWF0LXJhaXNlZC1idXR0b24gY2xhc3M9XCJ3bXRzLWxheWVyLW1hbmFnZXItcHJldmlldy1idXR0b25cIiBbZGlzYWJsZWRdPVwic3R5bGU9PXVuZGVmaW5lZHx8bGF5ZXI9PXVuZGVmaW5lZFwiIChjbGljayk9XCJjbGlja09uUHJldmlldygpXCI+e3snUHJldmlldyd8IHRyYW5zbGF0ZX19PC9idXR0b24+XG4gICAgPGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiBjbGFzcz1cIndtdHMtbGF5ZXItbWFuYWdlci12aWV3LWJ1dHRvblwiIFtkaXNhYmxlZF09XCJzdHlsZT09dW5kZWZpbmVkfHxsYXllcj09dW5kZWZpbmVkXCIgW21hdC1kaWFsb2ctY2xvc2VdPVwiZm9ybUdyb3VwLnZhbHVlXCJcbiAgICAgICAgY2RrRm9jdXNJbml0aWFsPnt7J1ZpZXcnIHwgdHJhbnNsYXRlfX08L2J1dHRvbj5cbjwvZGl2PiIsIlxuIl19