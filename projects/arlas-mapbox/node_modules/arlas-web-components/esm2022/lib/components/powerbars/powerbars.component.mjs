/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { Subject, takeUntil } from 'rxjs';
import tinycolor from 'tinycolor2';
import { DEFAULT_SHORTENING_PRECISION } from '../../components/componentsUtils';
import { ArlasColorService } from '../../services/color.generator.service';
import { NUMBER_FORMAT_CHAR } from '../componentsUtils';
import { PowerBar } from './model/powerbar';
import * as powerbarsJsonSchema from './powerbars.schema.json';
import * as i0 from "@angular/core";
import * as i1 from "../../services/color.generator.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/material/input";
import * as i4 from "@angular/material/form-field";
import * as i5 from "./powerbar/powerbar.component";
import * as i6 from "@ngx-translate/core";
/**
 * Powerbars component transforms a [term, occurence_count] map to a descreasingly sorted list of multiselectable bars.
 * A bar progression represents the term's occurence count.
 */
export class PowerbarsComponent {
    constructor(colorService) {
        this.colorService = colorService;
        /**
         * @Input : Angular
         * @description Which level of the tree inputData to plot as powerbars
         */
        this.level = 1;
        /**
         * @Input : Angular
         * @description Powerbar title
         */
        this.powerbarTitle = '';
        /**
         * @Input : Angular
         * @description Unit the a powerbar represents
         */
        this.unit = '';
        /**
         * @Input : Angular
         * @description List of selected paths in `inputData` from which the powerbars to select
         * are determined
         */
        this.selectedPaths = new Array();
        /**
         * @Input : Angular
         * @description Whether text input, to filter powerbars, is displayed
         */
        this.displayFilterField = false;
        /**
         * @Input : Angular
         * @description Whether to allow colorizing the bar according to its term or not using keysToColors
         */
        this.useColorService = false;
        /**
         * @Input : Angular
         * @description Whether to allow colorizing the bar according to its term or not using a field of the data
         */
        this.useColorFromData = false;
        /**
         * @Input : Angular
         * @description Chart's width. If not specified, the chart takes the component's container width.
         */
        this.chartWidth = null;
        /**
           * @Input : Angular
           * @description Whether the powerbar is scrollable or fully displayed
           */
        this.scrollable = false;
        /**
           * @Input : Angular
           * @description Options about how to apply filters on powerbars
           * - value : The default value.
           *           if 'Eq', the selected powerbar is included in the ARLAS filter.
           *           if 'Neq', the selected powerbar is excluded in the ARLAS filter.
           * - display: Whether to display a switcher between 'Eq' and 'Neq' or keep the default operator all the time
           */
        this.filterOperator = {
            value: 'Eq',
            display: true
        };
        /**
         * @Input : Angular
         * @description Precision when rounding numbers (ie the count next to the progress bar).
         * Default is 2.
         */
        this.numberShorteningPrecision = DEFAULT_SHORTENING_PRECISION;
        /**
         * @Input : Angular
         * @description Whether to group the selected powerbars in a dedicated list or not.
         */
        this.groupSelections = true;
        /**
         * @Input : Angular
         * @description Whether to have the option to select the powerbar using checkboxes.
         */
        this.selectWithCheckbox = false;
        /**
         * @Output : Angular
         * @description Emits the filter operator
         */
        this.filterOperatorEvent = new EventEmitter();
        /**
         * @Output : Angular
         * @description Emits the list of selected paths in the tree inputData
         */
        this.selectedPowerBarEvent = new Subject();
        /**
         * @Output : Angular
         * @description Emits searched term
         */
        this.searchedTerm = new Subject();
        this.selectedPowerbarsSet = new Set();
        this.selectedPowerbarsTerms = new Set();
        /**
         * @constant
         */
        this.SELECTED_BAR = 'selected-bar';
        /**
         * @constant
         */
        this.UNSELECTED_BAR = 'unselected-bar';
        /**
         * @constant
         */
        this.NEUTRAL_STATE = 'neutral-state';
        /**
         * @constant
         */
        this.SELECTED_NO_MOUNTED_BAR = 'selected-no-mounted-bar';
        this.NUMBER_FORMAT_CHAR = NUMBER_FORMAT_CHAR;
        this._onDestroy$ = new Subject();
        this.colorService.changekeysToColors$
            .pipe(takeUntil(this._onDestroy$))
            .subscribe(() => {
            this.powerBarsList.forEach(p => {
                if (this.useColorService) {
                    const rgbaColor = tinycolor(this.colorService.getColor(p.term, this.keysToColors, this.colorsSaturationWeight)).toRgb();
                    p.color = this.getPowerbarColor(rgbaColor);
                }
            });
        });
    }
    static getPowerbarsJsonSchema() {
        return powerbarsJsonSchema;
    }
    ngOnInit() {
        if (this.missingLeafEvent) {
            this.missingLeafEvent
                .pipe(takeUntil(this._onDestroy$))
                .subscribe(data => {
                if (this.selectedPaths !== undefined && this.selectedPaths !== null) {
                    this.setSelectedPowerbars(this.selectedPaths);
                    data.filter(d => !!d.value).forEach(d => {
                        const value = d.value;
                        const key = d.key;
                        const missingLeaf = Array.from(this.selectedPowerbarsSet).filter(pw => pw.term === key)[0];
                        const missingLeafToUpdate = { ...missingLeaf };
                        missingLeafToUpdate.count = value;
                        missingLeafToUpdate.isSelected = true;
                        missingLeafToUpdate.classSuffix = this.SELECTED_BAR;
                        if (this.useColorService) {
                            const rgbaColor = tinycolor(this.colorService.getColor(missingLeafToUpdate.term, this.keysToColors, this.colorsSaturationWeight)).toRgb();
                            missingLeafToUpdate.color = this.getPowerbarColor(rgbaColor);
                        }
                        this.selectedPowerbarsSet.delete(missingLeaf);
                        this.selectedPowerbarsSet.add(missingLeafToUpdate);
                    });
                }
            });
        }
        if (this.level > 1) {
            throw new Error('Not implemented : Only level 1 is supported');
        }
        if (!this.unit) {
            this.unit = '';
        }
        if (this.groupSelections === undefined) {
            this.groupSelections = true;
        }
    }
    ngAfterViewInit() {
        if (!this.filterOperator) {
            this.filterOperator = {
                value: 'Eq',
                display: true
            };
        }
    }
    ngOnChanges(changes) {
        if (changes.inputData) {
            if (this.inputData !== undefined && this.inputData !== null) {
                this.populatePowerbars();
                this.populateSelectedPowerbars();
                this.calculateAllPowerBarsProgression();
            }
            else {
                this.inputData = { id: 'root', fieldName: 'root', fieldValue: 'root', isOther: false, children: [] };
                this.powerBarsList = [];
            }
        }
        if (changes.selectedPaths && this.selectedPaths !== undefined && this.selectedPaths !== null) {
            this.setSelectedPowerbars(this.selectedPaths);
        }
    }
    ngOnDestroy() {
        this._onDestroy$.next(true);
        this._onDestroy$.complete();
    }
    /**
     * @description Select or deselect a PowerBar and emits the terms list of selected bars
     */
    // Select or deselect a PowerBar from the view
    clickOnPowerbar(powerBar) {
        const selectedPaths = new Array();
        if (this.selectedPowerbarsTerms.has(powerBar.term)) {
            powerBar.isSelected = false;
            this.selectedPowerbarsTerms.delete(powerBar.term);
            this.selectedPowerbarsSet.delete(powerBar);
            if (this.selectedPowerbarsTerms.size === 0) {
                this.clearSelection();
            }
            else {
                powerBar.classSuffix = this.UNSELECTED_BAR;
            }
        }
        else {
            if (this.selectedPaths) {
                Object.assign(selectedPaths, this.selectedPaths);
            }
            powerBar.isSelected = true;
            powerBar.classSuffix = this.SELECTED_BAR;
            this.selectedPowerbarsTerms.add(powerBar.term);
            this.addSelectedPowerbarToList(powerBar, this.selectedPowerbarsSet);
            this.unselectAllButNotSelectedBars();
        }
        this.selectedPowerbarsSet.forEach(pb => {
            selectedPaths.push(pb.path);
        });
        this.selectedPowerbarsSet = this.sortSelectedPowerBars(this.selectedPowerbarsSet);
        this.selectedPowerBarEvent.next(selectedPaths);
    }
    /**
     * @description Set selected powerbars from outside of the component
     * @param selectedPaths selects the powerbars whose terms are in the selected paths
     */
    setSelectedPowerbars(selectedPaths) {
        const selectedPowerbarsTerms = new Set();
        const selectedPowerbarsList = new Set();
        selectedPaths.forEach(path => {
            const currentPath = path.length <= this.level ? path : path.slice(path.length - this.level);
            let powerBar = currentPath.length > 1 ? this.getPowerbar(currentPath[0].fieldValue, currentPath[1].fieldValue) :
                this.getPowerbar(currentPath[0].fieldValue, 'root');
            if (powerBar !== null) {
                powerBar.isSelected = true;
                powerBar.classSuffix = this.SELECTED_BAR;
                if (this.useColorService) {
                    const rgbaColor = tinycolor(this.colorService.getColor(powerBar.term, this.keysToColors, this.colorsSaturationWeight)).toRgb();
                    powerBar.color = this.getPowerbarColor(rgbaColor);
                }
            }
            else {
                powerBar = currentPath.length > 1 ? new PowerBar(currentPath[0].fieldValue, currentPath[1].fieldValue, 0) :
                    new PowerBar(currentPath[0].fieldValue, 'root', 0);
                powerBar.path = currentPath;
                powerBar.progression = 0;
                powerBar.isSelected = true;
                powerBar.classSuffix = this.SELECTED_NO_MOUNTED_BAR;
            }
            selectedPowerbarsTerms.add(powerBar.term);
            this.addSelectedPowerbarToList(powerBar, selectedPowerbarsList);
        });
        this.selectedPowerbarsTerms = selectedPowerbarsTerms;
        this.selectedPowerbarsSet = this.sortSelectedPowerBars(selectedPowerbarsList);
        this.unselectAllButNotSelectedBars();
    }
    onKeyUp(searchText) {
        this.searchedTerm.next(searchText);
    }
    setOperator(op) {
        if (this.filterOperator.value !== op) {
            this.filterOperator.value = op;
            this.filterOperatorEvent.next(op);
        }
    }
    clearSelection() {
        this.powerBarsList.forEach(powerBar => {
            powerBar.classSuffix = this.NEUTRAL_STATE;
            powerBar.isSelected = false;
        });
    }
    addSelectedPowerbarToList(powerBar, selectedPowerbarsList) {
        // add powerbar to selectedPowerbarsList
        this.removePowerbarFromSelectedOnes(powerBar, selectedPowerbarsList);
        selectedPowerbarsList.add(powerBar);
    }
    populatePowerbars() {
        this.powerBarsList = this.fetchPowerbarsList(this.level, this.inputData);
    }
    fetchPowerbarsList(level, data, powerBarsList, recursivityCount, path) {
        if (recursivityCount === undefined) {
            recursivityCount = 0;
        }
        if (!powerBarsList) {
            powerBarsList = new Array();
        }
        // Each powerbar has a path attribute to the parrent node
        if (!path) {
            path = new Array();
        }
        if (recursivityCount < level - 1) {
            data.children.forEach(child => {
                const currentPath = [];
                Object.assign(currentPath, path);
                currentPath.push({ fieldName: child.fieldName, fieldValue: child.fieldValue });
                this.fetchPowerbarsList(level, child, powerBarsList, ++recursivityCount, currentPath);
            });
        }
        else {
            data.children.forEach(child => {
                const currentPath = [];
                Object.assign(currentPath, path);
                currentPath.push({ fieldName: child.fieldName, fieldValue: child.fieldValue });
                if (!child.isOther) {
                    const powerBar = new PowerBar(child.fieldValue, data.fieldValue, child.metricValue);
                    currentPath.reverse();
                    powerBar.path = currentPath;
                    if (this.useColorService) {
                        const rgbaColor = tinycolor(this.colorService.getColor(powerBar.term, this.keysToColors, this.colorsSaturationWeight)).toRgb();
                        powerBar.color = this.getPowerbarColor(rgbaColor);
                    }
                    if (this.useColorFromData) {
                        powerBar.color = child.color.toString().startsWith('#') ? child.color.toString() : '#'.concat(child.color.toString());
                    }
                    powerBarsList.push(powerBar);
                }
            });
            return powerBarsList;
        }
    }
    populateSelectedPowerbars() {
        if (this.selectedPowerbarsTerms !== undefined && this.selectedPowerbarsTerms.size > 0) {
            this.setSelectedPowerbars(this.selectedPaths);
        }
    }
    calculateAllPowerBarsProgression() {
        // TODO : Manage correctly when count == NaN
        let sum = 0;
        // calculate the sum
        this.powerBarsList.forEach(powerBar => {
            if (powerBar.count.toString() === 'NaN') {
                powerBar.count = 0;
            }
            sum += powerBar.count;
        });
        this.selectedPowerbarsSet.forEach(selectedPowerBar => {
            if (selectedPowerBar.count.toString() === 'NaN') {
                selectedPowerBar.count = 0;
            }
            if (this.getPowerbar(selectedPowerBar.term, selectedPowerBar.parentTerm) === null) {
                sum += selectedPowerBar.count;
            }
        });
        // calculate progression
        this.powerBarsList.forEach(powerBar => {
            powerBar.progression = powerBar.count / sum * 100;
            if (powerBar.progression !== 0 && powerBar.progression !== 100) {
                powerBar.progression += 1;
            }
            powerBar.progression = Math.min(powerBar.progression, 100);
        });
        this.selectedPowerbarsSet.forEach(selectedPowerBar => {
            selectedPowerBar.progression = selectedPowerBar.count / sum * 100;
            if (selectedPowerBar.progression !== 0 && selectedPowerBar.progression !== 100) {
                selectedPowerBar.progression += 1;
            }
            selectedPowerBar.progression = Math.min(selectedPowerBar.progression, 100);
        });
    }
    unselectAllButNotSelectedBars() {
        if (this.selectedPowerbarsTerms.size === 0) {
            this.selectedPowerbarsSet = new Set();
            this.clearSelection();
        }
        else {
            this.powerBarsList.forEach(powerBar => {
                if (!this.selectedPowerbarsTerms.has(powerBar.term)) {
                    powerBar.classSuffix = this.UNSELECTED_BAR;
                    powerBar.isSelected = false;
                }
            });
        }
    }
    // Sort the selected PowerBars decreasingly. And recalculate the progression of the bars in this array.
    sortSelectedPowerBars(selectedPowerbarsList) {
        const selectedPowerbarsArray = Array.from(selectedPowerbarsList);
        const sortedSelectedPowerbarsList = new Set();
        selectedPowerbarsArray.forEach(powerBar => {
            sortedSelectedPowerbarsList.add(powerBar);
        });
        return sortedSelectedPowerbarsList;
    }
    // removes the powerbar that has the same term in selectedPowerbarsList but not the same instance
    removePowerbarFromSelectedOnes(powerBar, selectedPowerbarsList) {
        let powerbarToRemove;
        selectedPowerbarsList.forEach(selectedPowerbar => {
            if (selectedPowerbar.term === powerBar.term) {
                powerbarToRemove = selectedPowerbar;
            }
        });
        selectedPowerbarsList.delete(powerbarToRemove);
    }
    /**
     * @description Gets the powerbar by its term and the term of it's parent node
     *
     */
    getPowerbar(powerbarTerm, powerbarParentTerm) {
        let foundPowerbar = null;
        this.powerBarsList.forEach(powerbar => {
            if (powerbar.term === powerbarTerm && powerbar.parentTerm === powerbarParentTerm) {
                foundPowerbar = powerbar;
            }
        });
        return foundPowerbar;
    }
    getPowerbarColor(rgbaColor) {
        return 'rgba(' + [rgbaColor.r, rgbaColor.g, rgbaColor.b, 0.7].join(',') + ')';
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: PowerbarsComponent, deps: [{ token: i1.ArlasColorService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: PowerbarsComponent, selector: "arlas-powerbars", inputs: { inputData: "inputData", level: "level", powerbarTitle: "powerbarTitle", unit: "unit", customizedCssClass: "customizedCssClass", selectedPaths: "selectedPaths", displayFilterField: "displayFilterField", keysToColors: "keysToColors", colorsSaturationWeight: "colorsSaturationWeight", useColorService: "useColorService", useColorFromData: "useColorFromData", chartWidth: "chartWidth", scrollable: "scrollable", filterOperator: "filterOperator", missingLeafEvent: "missingLeafEvent", numberShorteningPrecision: "numberShorteningPrecision", groupSelections: "groupSelections", selectWithCheckbox: "selectWithCheckbox" }, outputs: { filterOperatorEvent: "filterOperatorEvent", selectedPowerBarEvent: "selectedPowerBarEvent", searchedTerm: "searchedTerm" }, usesOnChanges: true, ngImport: i0, template: "<div [style.width.px]=\"!!chartWidth ? chartWidth : 'unset'\">\n  <div class=\"tools\">\n    <div *ngIf=\"!displayFilterField\" class=\"powerbars--title\">{{powerbarTitle | translate}}</div>\n    <div class=\"powerbars--search\" *ngIf=\"displayFilterField\">\n      <form (keydown.enter)=\"$event.preventDefault()\">\n        <mat-form-field class=\"powerbars--search-field\">\n          <input #searchText type=\"text\" autocomplete=\"off\" placeholder=\"{{powerbarTitle | translate}}\" matInput\n            class=\"powerbars--search-input\" (keyup)=\"onKeyUp(searchText.value)\" name=\"search\">\n        </mat-form-field>\n      </form>\n    </div>\n    <ng-container *ngIf=\"filterOperator\">\n      <div *ngIf=\"filterOperator?.display\" class=\"include_exclude\">\n        <div class=\"operation\" [class.operation--selected]=\"filterOperator?.value === 'Eq'\" (click)=\"setOperator('Eq')\">{{'include' | translate}}</div> <!-- //NOSONAR -->\n        <div class=\"operation\" [class.operation--selected]=\"filterOperator?.value === 'Neq'\" (click)=\"setOperator('Neq')\">{{'exclude' | translate}}</div> <!-- //NOSONAR -->\n      </div>\n      <div *ngIf=\"!filterOperator?.display && filterOperator?.value === 'Neq'\" class=\"include_exclude\">\n        <div class=\"operation exclude\">{{'exclude' | translate}}</div>\n      </div>\n    </ng-container>\n  </div>\n\n  <div class=\"powerbars--container\" [class.powerbars--container__scrollable]=\"scrollable\" [ngClass]=\"customizedCssClass\">\n    <ng-container *ngIf=\"groupSelections\">\n      <div *ngIf=\"selectedPowerbarsSet.size !== 0\" [class.powerbar-selected-scrollable]=\"scrollable\"\n        [style.min-height.px]=\"selectedPowerbarsSet.size > 5 ? 131 : selectedPowerbarsSet.size * 26\">\n        <div *ngFor=\"let selectedPowerbar of selectedPowerbarsSet\">\n          <arlas-powerbar\n            [unit]=\"unit\"\n            [powerbar]=\"selectedPowerbar\"\n            [useColorFromData]=\"useColorFromData\"\n            [useColorService]=\"useColorService\"\n            [hideSelected]=\"false\"\n            [selectWithCheckbox]=\"selectWithCheckbox\"\n            [numberShorteningPrecision]=\"numberShorteningPrecision\"\n            (onCheckEvent)=\"clickOnPowerbar(selectedPowerbar)\"\n            (onClickEvent)=\"clickOnPowerbar(selectedPowerbar)\"\n          ></arlas-powerbar>\n        </div>\n      </div>\n    </ng-container>\n\n    <div [class.powerbar-list-scrollable]=\"scrollable\">\n      <div *ngFor=\"let powerbar of powerBarsList\">\n        <arlas-powerbar\n          [unit]=\"unit\"\n          [powerbar]=\"powerbar\"\n          [useColorFromData]=\"useColorFromData\"\n          [useColorService]=\"useColorService\"\n          [numberShorteningPrecision]=\"numberShorteningPrecision\"\n          [selectWithCheckbox]=\"selectWithCheckbox\"\n          [hideSelected]=\"groupSelections\"\n          (onCheckEvent)=\"clickOnPowerbar(powerbar)\"\n          (onClickEvent)=\"clickOnPowerbar(powerbar)\"\n        ></arlas-powerbar>\n      </div>\n    </div>\n  </div>\n</div>", styles: ["@charset \"UTF-8\";.tools .powerbars--search .mat-mdc-form-field{width:100%}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mdc-text-field--filled{background-color:unset}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mat-mdc-form-field-focus-overlay{opacity:0}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mdc-text-field{padding:unset}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mat-mdc-form-field-infix{font-size:14px;min-height:unset;padding-top:0!important;padding-bottom:0!important}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mat-mdc-form-field-subscript-wrapper{display:none}.tools .include_exclude{display:flex;align-items:baseline}.tools .include_exclude .operation{font-size:10px;color:#aaa;border-radius:3px;margin-right:5px;cursor:pointer;padding-bottom:5px}.tools .include_exclude .operation--selected{color:#555;font-weight:700}.tools .include_exclude .exclude{color:#555;cursor:unset}.powerbars--container{height:100%;overflow-y:auto;overflow-x:hidden;padding-bottom:8px}.powerbars--container__scrollable{display:flex;flex-direction:column;max-height:255px}.powerbars--container .powerbar-selected-scrollable{max-height:131px;border-bottom:1px solid rgb(209,209,209);overflow-y:auto;overflow-x:clip;padding-bottom:2px;padding-right:5px}.powerbars--container .powerbar-list-scrollable{overflow-y:auto;overflow-x:clip;padding-right:5px;padding-bottom:5px}::-webkit-scrollbar{width:6px;background-color:#f5f5f5}::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#f5f5f5}::-webkit-scrollbar-thumb{background-color:#555}\n"], dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { kind: "component", type: i4.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "component", type: i5.PowerbarComponent, selector: "arlas-powerbar", inputs: ["powerbar", "numberShorteningPrecision", "unit", "useColorService", "useColorFromData", "hideSelected", "selectWithCheckbox"], outputs: ["onCheckEvent", "onClickEvent"] }, { kind: "pipe", type: i6.TranslatePipe, name: "translate" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: PowerbarsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'arlas-powerbars', template: "<div [style.width.px]=\"!!chartWidth ? chartWidth : 'unset'\">\n  <div class=\"tools\">\n    <div *ngIf=\"!displayFilterField\" class=\"powerbars--title\">{{powerbarTitle | translate}}</div>\n    <div class=\"powerbars--search\" *ngIf=\"displayFilterField\">\n      <form (keydown.enter)=\"$event.preventDefault()\">\n        <mat-form-field class=\"powerbars--search-field\">\n          <input #searchText type=\"text\" autocomplete=\"off\" placeholder=\"{{powerbarTitle | translate}}\" matInput\n            class=\"powerbars--search-input\" (keyup)=\"onKeyUp(searchText.value)\" name=\"search\">\n        </mat-form-field>\n      </form>\n    </div>\n    <ng-container *ngIf=\"filterOperator\">\n      <div *ngIf=\"filterOperator?.display\" class=\"include_exclude\">\n        <div class=\"operation\" [class.operation--selected]=\"filterOperator?.value === 'Eq'\" (click)=\"setOperator('Eq')\">{{'include' | translate}}</div> <!-- //NOSONAR -->\n        <div class=\"operation\" [class.operation--selected]=\"filterOperator?.value === 'Neq'\" (click)=\"setOperator('Neq')\">{{'exclude' | translate}}</div> <!-- //NOSONAR -->\n      </div>\n      <div *ngIf=\"!filterOperator?.display && filterOperator?.value === 'Neq'\" class=\"include_exclude\">\n        <div class=\"operation exclude\">{{'exclude' | translate}}</div>\n      </div>\n    </ng-container>\n  </div>\n\n  <div class=\"powerbars--container\" [class.powerbars--container__scrollable]=\"scrollable\" [ngClass]=\"customizedCssClass\">\n    <ng-container *ngIf=\"groupSelections\">\n      <div *ngIf=\"selectedPowerbarsSet.size !== 0\" [class.powerbar-selected-scrollable]=\"scrollable\"\n        [style.min-height.px]=\"selectedPowerbarsSet.size > 5 ? 131 : selectedPowerbarsSet.size * 26\">\n        <div *ngFor=\"let selectedPowerbar of selectedPowerbarsSet\">\n          <arlas-powerbar\n            [unit]=\"unit\"\n            [powerbar]=\"selectedPowerbar\"\n            [useColorFromData]=\"useColorFromData\"\n            [useColorService]=\"useColorService\"\n            [hideSelected]=\"false\"\n            [selectWithCheckbox]=\"selectWithCheckbox\"\n            [numberShorteningPrecision]=\"numberShorteningPrecision\"\n            (onCheckEvent)=\"clickOnPowerbar(selectedPowerbar)\"\n            (onClickEvent)=\"clickOnPowerbar(selectedPowerbar)\"\n          ></arlas-powerbar>\n        </div>\n      </div>\n    </ng-container>\n\n    <div [class.powerbar-list-scrollable]=\"scrollable\">\n      <div *ngFor=\"let powerbar of powerBarsList\">\n        <arlas-powerbar\n          [unit]=\"unit\"\n          [powerbar]=\"powerbar\"\n          [useColorFromData]=\"useColorFromData\"\n          [useColorService]=\"useColorService\"\n          [numberShorteningPrecision]=\"numberShorteningPrecision\"\n          [selectWithCheckbox]=\"selectWithCheckbox\"\n          [hideSelected]=\"groupSelections\"\n          (onCheckEvent)=\"clickOnPowerbar(powerbar)\"\n          (onClickEvent)=\"clickOnPowerbar(powerbar)\"\n        ></arlas-powerbar>\n      </div>\n    </div>\n  </div>\n</div>", styles: ["@charset \"UTF-8\";.tools .powerbars--search .mat-mdc-form-field{width:100%}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mdc-text-field--filled{background-color:unset}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mat-mdc-form-field-focus-overlay{opacity:0}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mdc-text-field{padding:unset}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mat-mdc-form-field-infix{font-size:14px;min-height:unset;padding-top:0!important;padding-bottom:0!important}.tools .powerbars--search .mat-mdc-form-field ::ng-deep .mat-mdc-form-field-subscript-wrapper{display:none}.tools .include_exclude{display:flex;align-items:baseline}.tools .include_exclude .operation{font-size:10px;color:#aaa;border-radius:3px;margin-right:5px;cursor:pointer;padding-bottom:5px}.tools .include_exclude .operation--selected{color:#555;font-weight:700}.tools .include_exclude .exclude{color:#555;cursor:unset}.powerbars--container{height:100%;overflow-y:auto;overflow-x:hidden;padding-bottom:8px}.powerbars--container__scrollable{display:flex;flex-direction:column;max-height:255px}.powerbars--container .powerbar-selected-scrollable{max-height:131px;border-bottom:1px solid rgb(209,209,209);overflow-y:auto;overflow-x:clip;padding-bottom:2px;padding-right:5px}.powerbars--container .powerbar-list-scrollable{overflow-y:auto;overflow-x:clip;padding-right:5px;padding-bottom:5px}::-webkit-scrollbar{width:6px;background-color:#f5f5f5}::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#f5f5f5}::-webkit-scrollbar-thumb{background-color:#555}\n"] }]
        }], ctorParameters: () => [{ type: i1.ArlasColorService }], propDecorators: { inputData: [{
                type: Input
            }], level: [{
                type: Input
            }], powerbarTitle: [{
                type: Input
            }], unit: [{
                type: Input
            }], customizedCssClass: [{
                type: Input
            }], selectedPaths: [{
                type: Input
            }], displayFilterField: [{
                type: Input
            }], keysToColors: [{
                type: Input
            }], colorsSaturationWeight: [{
                type: Input
            }], useColorService: [{
                type: Input
            }], useColorFromData: [{
                type: Input
            }], chartWidth: [{
                type: Input
            }], scrollable: [{
                type: Input
            }], filterOperator: [{
                type: Input
            }], missingLeafEvent: [{
                type: Input
            }], numberShorteningPrecision: [{
                type: Input
            }], groupSelections: [{
                type: Input
            }], selectWithCheckbox: [{
                type: Input
            }], filterOperatorEvent: [{
                type: Output
            }], selectedPowerBarEvent: [{
                type: Output
            }], searchedTerm: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG93ZXJiYXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FybGFzLWNvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL3Bvd2VyYmFycy9wb3dlcmJhcnMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvcG93ZXJiYXJzL3Bvd2VyYmFycy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFFSCxPQUFPLEVBQWlCLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBRXhILE9BQU8sRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQztBQUNuQyxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNoRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUUzRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDNUMsT0FBTyxLQUFLLG1CQUFtQixNQUFNLHlCQUF5QixDQUFDOzs7Ozs7OztBQUUvRDs7O0dBR0c7QUFRSCxNQUFNLE9BQU8sa0JBQWtCO0lBNEo3QixZQUFvQyxZQUErQjtRQUEvQixpQkFBWSxHQUFaLFlBQVksQ0FBbUI7UUFySm5FOzs7V0FHRztRQUNhLFVBQUssR0FBRyxDQUFDLENBQUM7UUFFMUI7OztXQUdHO1FBQ2Esa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFFbkM7OztXQUdHO1FBQ2EsU0FBSSxHQUFHLEVBQUUsQ0FBQztR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TVUsZUFBZTtzQkFBOUIsS0FBSztnQkFNVSxrQkFBa0I7c0JBQWpDLEtBQUs7Z0JBT1csbUJBQW1CO3NCQUFuQyxNQUFNO2dCQU1VLHFCQUFxQjtzQkFBckMsTUFBTTtnQkFNVSxZQUFZO3NCQUE1QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIEdpc2HDr2EgdW5kZXIgb25lIG9yIG1vcmUgY29udHJpYnV0b3JcbiAqIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UudHh0IGZpbGUgZGlzdHJpYnV0ZWQgd2l0aFxuICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHRcbiAqIG93bmVyc2hpcC4gR2lzYcOvYSBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyXG4gKiB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5XG4gKiBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU2ltcGxlTm9kZSwgVHJlZU5vZGUgfSBmcm9tICdhcmxhcy1kMyc7XG5pbXBvcnQgeyBTdWJqZWN0LCB0YWtlVW50aWwgfSBmcm9tICdyeGpzJztcbmltcG9ydCB0aW55Y29sb3IgZnJvbSAndGlueWNvbG9yMic7XG5pbXBvcnQgeyBERUZBVUxUX1NIT1JURU5JTkdfUFJFQ0lTSU9OIH0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9jb21wb25lbnRzVXRpbHMnO1xuaW1wb3J0IHsgQXJsYXNDb2xvclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb2xvci5nZW5lcmF0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBGaWx0ZXJPcGVyYXRvciB9IGZyb20gJy4uLy4uL3Rvb2xzL21vZGVscy90ZXJtLWZpbHRlcnMnO1xuaW1wb3J0IHsgTlVNQkVSX0ZPUk1BVF9DSEFSIH0gZnJvbSAnLi4vY29tcG9uZW50c1V0aWxzJztcbmltcG9ydCB7IFBvd2VyQmFyIH0gZnJvbSAnLi9tb2RlbC9wb3dlcmJhcic7XG5pbXBvcnQgKiBhcyBwb3dlcmJhcnNKc29uU2NoZW1hIGZyb20gJy4vcG93ZXJiYXJzLnNjaGVtYS5qc29uJztcblxuLyoqXG4gKiBQb3dlcmJhcnMgY29tcG9uZW50IHRyYW5zZm9ybXMgYSBbdGVybSwgb2NjdXJlbmNlX2NvdW50XSBtYXAgdG8gYSBkZXNjcmVhc2luZ2x5IHNvcnRlZCBsaXN0IG9mIG11bHRpc2VsZWN0YWJsZSBiYXJzLlxuICogQSBiYXIgcHJvZ3Jlc3Npb24gcmVwcmVzZW50cyB0aGUgdGVybSdzIG9jY3VyZW5jZSBjb3VudC5cbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcmxhcy1wb3dlcmJhcnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG93ZXJiYXJzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcG93ZXJiYXJzLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5cbmV4cG9ydCBjbGFzcyBQb3dlcmJhcnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XG4gIC8qKlxuICAgKiBASW5wdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBEYXRhIGZvcm1hdGVkIGFzIGEgdHJlZSB0byBiZSBwbG90dGVkIGFzIHBvd2VyYmFyc1xuICAgKi9cbiAgQElucHV0KCkgcHVibGljIGlucHV0RGF0YTogVHJlZU5vZGU7XG5cbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIFdoaWNoIGxldmVsIG9mIHRoZSB0cmVlIGlucHV0RGF0YSB0byBwbG90IGFzIHBvd2VyYmFyc1xuICAgKi9cbiAgQElucHV0KCkgcHVibGljIGxldmVsID0gMTtcblxuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gUG93ZXJiYXIgdGl0bGVcbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBwb3dlcmJhclRpdGxlID0gJyc7XG5cbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIFVuaXQgdGhlIGEgcG93ZXJiYXIgcmVwcmVzZW50c1xuICAgKi9cbiAgQElucHV0KCkgcHVibGljIHVuaXQgPSAnJztcblxuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gQ3NzIGNsYXNzIG5hbWUgdG8gdXNlIHRvIGN1c3RvbWl6ZSBhIHNwZWNpZmljIHBvd2VyYmFyJ3Mgc3R5bGUuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgY3VzdG9taXplZENzc0NsYXNzOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBASW5wdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBMaXN0IG9mIHNlbGVjdGVkIHBhdGhzIGluIGBpbnB1dERhdGFgIGZyb20gd2hpY2ggdGhlIHBvd2VyYmFycyB0byBzZWxlY3RcbiAgICogYXJlIGRldGVybWluZWRcbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZWxlY3RlZFBhdGhzOiBBcnJheTxBcnJheTxTaW1wbGVOb2RlPj4gPSBuZXcgQXJyYXk8QXJyYXk8U2ltcGxlTm9kZT4+KCk7XG5cbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIFdoZXRoZXIgdGV4dCBpbnB1dCwgdG8gZmlsdGVyIHBvd2VyYmFycywgaXMgZGlzcGxheWVkXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgZGlzcGxheUZpbHRlckZpZWxkID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIExpc3Qgb2YgW2tleSwgY29sb3JdIGNvdXBsZXMgdGhhdCBhc3NvY2lhdGVzIGEgaGV4IGNvbG9yIHRvIGVhY2gga2V5XG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMga2V5c1RvQ29sb3JzOiBBcnJheTxbc3RyaW5nLCBzdHJpbmddPjtcblxuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gS25vd2luZyB0aGF0IHNhdHVyYXRpb24gc2NhbGUgaXMgWzAsIDFdLCBgY29sb3JzU2F0dXJhdGlvbldlaWdodGAgaXMgYVxuICAgKiBmYWN0b3IgKGJldHdlZW4gMCBhbmQgMSkgdGhhdCB0aWdodGVucyB0aGlzIHNjYWxlIHRvIFsoMS1jb2xvcnNTYXR1cmF0aW9uV2VpZ2h0KSwgMV0uXG4gICAqIFRoZXJlZm9yZSBzYXR1cmF0aW9uIG9mIGdlbmVyYXRlZCBjb2xvcnMgd2lsbCBiZSB3aXRoaW4gdGhpcyB0aWdodGVuZWQgc2NhbGUuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgY29sb3JzU2F0dXJhdGlvbldlaWdodDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBASW5wdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBXaGV0aGVyIHRvIGFsbG93IGNvbG9yaXppbmcgdGhlIGJhciBhY2NvcmRpbmcgdG8gaXRzIHRlcm0gb3Igbm90IHVzaW5nIGtleXNUb0NvbG9yc1xuICAgKi9cbiAgQElucHV0KCkgcHVibGljIHVzZUNvbG9yU2VydmljZSA9IGZhbHNlO1xuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gV2hldGhlciB0byBhbGxvdyBjb2xvcml6aW5nIHRoZSBiYXIgYWNjb3JkaW5nIHRvIGl0cyB0ZXJtIG9yIG5vdCB1c2luZyBhIGZpZWxkIG9mIHRoZSBkYXRhXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgdXNlQ29sb3JGcm9tRGF0YSA9IGZhbHNlO1xuICAvKipcbiAgICogQElucHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gQ2hhcnQncyB3aWR0aC4gSWYgbm90IHNwZWNpZmllZCwgdGhlIGNoYXJ0IHRha2VzIHRoZSBjb21wb25lbnQncyBjb250YWluZXIgd2lkdGguXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgY2hhcnRXaWR0aCA9IG51bGw7XG4gIC8qKlxuICAgICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICAgKiBAZGVzY3JpcHRpb24gV2hldGhlciB0aGUgcG93ZXJiYXIgaXMgc2Nyb2xsYWJsZSBvciBmdWxseSBkaXNwbGF5ZWRcbiAgICAgKi9cbiAgQElucHV0KCkgcHVibGljIHNjcm9sbGFibGUgPSBmYWxzZTtcblxuICAvKipcbiAgICAgKiBASW5wdXQgOiBBbmd1bGFyXG4gICAgICogQGRlc2NyaXB0aW9uIE9wdGlvbnMgYWJvdXQgaG93IHRvIGFwcGx5IGZpbHRlcnMgb24gcG93ZXJiYXJzXG4gICAgICogLSB2YWx1ZSA6IFRoZSBkZWZhdWx0IHZhbHVlLlxuICAgICAqICAgICAgICAgICBpZiAnRXEnLCB0aGUgc2VsZWN0ZWQgcG93ZXJiYXIgaXMgaW5jbHVkZWQgaW4gdGhlIEFSTEFTIGZpbHRlci5cbiAgICAgKiAgICAgICAgICAgaWYgJ05lcScsIHRoZSBzZWxlY3RlZCBwb3dlcmJhciBpcyBleGNsdWRlZCBpbiB0aGUgQVJMQVMgZmlsdGVyLlxuICAgICAqIC0gZGlzcGxheTogV2hldGhlciB0byBkaXNwbGF5IGEgc3dpdGNoZXIgYmV0d2VlbiAnRXEnIGFuZCAnTmVxJyBvciBrZWVwIHRoZSBkZWZhdWx0IG9wZXJhdG9yIGFsbCB0aGUgdGltZVxuICAgICAqL1xuICBASW5wdXQoKSBwdWJsaWMgZmlsdGVyT3BlcmF0b3I6IEZpbHRlck9wZXJhdG9yID0ge1xuICAgIHZhbHVlOiAnRXEnLFxuICAgIGRpc3BsYXk6IHRydWVcbiAgfTtcblxuICBASW5wdXQoKSBwdWJsaWMgbWlzc2luZ0xlYWZFdmVudDogU3ViamVjdDxhbnlbXT47XG5cbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIFByZWNpc2lvbiB3aGVuIHJvdW5kaW5nIG51bWJlcnMgKGllIHRoZSBjb3VudCBuZXh0IHRvIHRoZSBwcm9ncmVzcyBiYXIpLlxuICAgKiBEZWZhdWx0IGlzIDIuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgbnVtYmVyU2hvcnRlbmluZ1ByZWNpc2lvbiA9IERFRkFVTFRfU0hPUlRFTklOR19QUkVDSVNJT047XG5cbiAgLyoqXG4gICAqIEBJbnB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIFdoZXRoZXIgdG8gZ3JvdXAgdGhlIHNlbGVjdGVkIHBvd2VyYmFycyBpbiBhIGRlZGljYXRlZCBsaXN0IG9yIG5vdC5cbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBncm91cFNlbGVjdGlvbnMgPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBASW5wdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBXaGV0aGVyIHRvIGhhdmUgdGhlIG9wdGlvbiB0byBzZWxlY3QgdGhlIHBvd2VyYmFyIHVzaW5nIGNoZWNrYm94ZXMuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgc2VsZWN0V2l0aENoZWNrYm94ID0gZmFsc2U7XG5cblxuICAvKipcbiAgICogQE91dHB1dCA6IEFuZ3VsYXJcbiAgICogQGRlc2NyaXB0aW9uIEVtaXRzIHRoZSBmaWx0ZXIgb3BlcmF0b3JcbiAgICovXG4gIEBPdXRwdXQoKSBwdWJsaWMgZmlsdGVyT3BlcmF0b3JFdmVudDogRXZlbnRFbWl0dGVyPCdOZXEnIHwgJ0VxJz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqXG4gICAqIEBPdXRwdXQgOiBBbmd1bGFyXG4gICAqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgbGlzdCBvZiBzZWxlY3RlZCBwYXRocyBpbiB0aGUgdHJlZSBpbnB1dERhdGFcbiAgICovXG4gIEBPdXRwdXQoKSBwdWJsaWMgc2VsZWN0ZWRQb3dlckJhckV2ZW50ID0gbmV3IFN1YmplY3Q8QXJyYXk8QXJyYXk8U2ltcGxlTm9kZT4+PigpO1xuXG4gIC8qKlxuICAgKiBAT3V0cHV0IDogQW5ndWxhclxuICAgKiBAZGVzY3JpcHRpb24gRW1pdHMgc2VhcmNoZWQgdGVybVxuICAgKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBzZWFyY2hlZFRlcm0gPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG5cbiAgcHVibGljIHBvd2VyQmFyc0xpc3Q6IEFycmF5PFBvd2VyQmFyPjtcbiAgcHVibGljIHNlbGVjdGVkUG93ZXJiYXJzU2V0ID0gbmV3IFNldDxQb3dlckJhcj4oKTtcbiAgcHVibGljIHNlbGVjdGVkUG93ZXJiYXJzVGVybXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICAvKipcbiAgICogQGNvbnN0YW50XG4gICAqL1xuICBwdWJsaWMgU0VMRUNURURfQkFSID0gJ3NlbGVjdGVkLWJhcic7XG4gIC8qKlxuICAgKiBAY29uc3RhbnRcbiAgICovXG4gIHB1YmxpYyBVTlNFTEVDVEVEX0JBUiA9ICd1bnNlbGVjdGVkLWJhcic7XG4gIC8qKlxuICAgKiBAY29uc3RhbnRcbiAgICovXG4gIHB1YmxpYyBORVVUUkFMX1NUQVRFID0gJ25ldXRyYWwtc3RhdGUnO1xuICAvKipcbiAgICogQGNvbnN0YW50XG4gICAqL1xuICBwdWJsaWMgU0VMRUNURURfTk9fTU9VTlRFRF9CQVIgPSAnc2VsZWN0ZWQtbm8tbW91bnRlZC1iYXInO1xuXG4gIHB1YmxpYyBOVU1CRVJfRk9STUFUX0NIQVIgPSBOVU1CRVJfRk9STUFUX0NIQVI7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29sb3JTZXJ2aWNlOiBBcmxhc0NvbG9yU2VydmljZSkge1xuICAgIHRoaXMuY29sb3JTZXJ2aWNlLmNoYW5nZWtleXNUb0NvbG9ycyRcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9vbkRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnBvd2VyQmFyc0xpc3QuZm9yRWFjaChwID0+IHtcbiAgICAgICAgICBpZiAodGhpcy51c2VDb2xvclNlcnZpY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IHJnYmFDb2xvciA9IHRpbnljb2xvcih0aGlzLmNvbG9yU2VydmljZS5nZXRDb2xvcihwLnRlcm0sIHRoaXMua2V5c1RvQ29sb3JzLFxuICAgICAgICAgICAgICB0aGlzLmNvbG9yc1NhdHVyYXRpb25XZWlnaHQpKS50b1JnYigpO1xuICAgICAgICAgICAgcC5jb2xvciA9IHRoaXMuZ2V0UG93ZXJiYXJDb2xvcihyZ2JhQ29sb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldFBvd2VyYmFyc0pzb25TY2hlbWEoKTogT2JqZWN0IHtcbiAgICByZXR1cm4gcG93ZXJiYXJzSnNvblNjaGVtYTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy5taXNzaW5nTGVhZkV2ZW50KSB7XG4gICAgICB0aGlzLm1pc3NpbmdMZWFmRXZlbnRcbiAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuX29uRGVzdHJveSQpKVxuICAgICAgICAuc3Vic2NyaWJlKGRhdGEgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUGF0aHMgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnNlbGVjdGVkUGF0aHMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRQb3dlcmJhcnModGhpcy5zZWxlY3RlZFBhdGhzKTtcbiAgICAgICAgICAgIGRhdGEuZmlsdGVyKGQgPT4gISFkLnZhbHVlKS5mb3JFYWNoKGQgPT4ge1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGQudmFsdWU7XG4gICAgICAgICAgICAgIGNvbnN0IGtleSA9IGQua2V5O1xuICAgICAgICAgICAgICBjb25zdCBtaXNzaW5nTGVhZiA9IEFycmF5LmZyb20odGhpcy5zZWxlY3RlZFBvd2VyYmFyc1NldCkuZmlsdGVyKHB3ID0+IHB3LnRlcm0gPT09IGtleSlbMF07XG4gICAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdMZWFmVG9VcGRhdGUgPSB7Li4ubWlzc2luZ0xlYWZ9O1xuICAgICAgICAgICAgICBtaXNzaW5nTGVhZlRvVXBkYXRlLmNvdW50ID0gdmFsdWU7XG4gICAgICAgICAgICAgIG1pc3NpbmdMZWFmVG9VcGRhdGUuaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgIG1pc3NpbmdMZWFmVG9VcGRhdGUuY2xhc3NTdWZmaXggPSB0aGlzLlNFTEVDVEVEX0JBUjtcbiAgICAgICAgICAgICAgaWYgKHRoaXMudXNlQ29sb3JTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmdiYUNvbG9yID0gdGlueWNvbG9yKHRoaXMuY29sb3JTZXJ2aWNlLmdldENvbG9yKG1pc3NpbmdMZWFmVG9VcGRhdGUudGVybSwgdGhpcy5rZXlzVG9Db2xvcnMsXG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbG9yc1NhdHVyYXRpb25XZWlnaHQpKS50b1JnYigpO1xuICAgICAgICAgICAgICAgIG1pc3NpbmdMZWFmVG9VcGRhdGUuY29sb3IgPSB0aGlzLmdldFBvd2VyYmFyQ29sb3IocmdiYUNvbG9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzU2V0LmRlbGV0ZShtaXNzaW5nTGVhZik7XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQb3dlcmJhcnNTZXQuYWRkKG1pc3NpbmdMZWFmVG9VcGRhdGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sZXZlbCA+IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkIDogT25seSBsZXZlbCAxIGlzIHN1cHBvcnRlZCcpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMudW5pdCkge1xuICAgICAgdGhpcy51bml0ID0gJyc7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ3JvdXBTZWxlY3Rpb25zID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZ3JvdXBTZWxlY3Rpb25zID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5maWx0ZXJPcGVyYXRvcikge1xuICAgICAgdGhpcy5maWx0ZXJPcGVyYXRvciA9IHtcbiAgICAgICAgdmFsdWU6ICdFcScsXG4gICAgICAgIGRpc3BsYXk6IHRydWVcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy5pbnB1dERhdGEpIHtcbiAgICAgIGlmICh0aGlzLmlucHV0RGF0YSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuaW5wdXREYXRhICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMucG9wdWxhdGVQb3dlcmJhcnMoKTtcbiAgICAgICAgdGhpcy5wb3B1bGF0ZVNlbGVjdGVkUG93ZXJiYXJzKCk7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQWxsUG93ZXJCYXJzUHJvZ3Jlc3Npb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaW5wdXREYXRhID0geyBpZDogJ3Jvb3QnLCBmaWVsZE5hbWU6ICdyb290JywgZmllbGRWYWx1ZTogJ3Jvb3QnLCBpc090aGVyOiBmYWxzZSwgY2hpbGRyZW46IFtdIH07XG4gICAgICAgIHRoaXMucG93ZXJCYXJzTGlzdCA9IFtdO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkUGF0aHMgJiYgdGhpcy5zZWxlY3RlZFBhdGhzICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zZWxlY3RlZFBhdGhzICE9PSBudWxsKSB7XG4gICAgICB0aGlzLnNldFNlbGVjdGVkUG93ZXJiYXJzKHRoaXMuc2VsZWN0ZWRQYXRocyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuX29uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICB0aGlzLl9vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFNlbGVjdCBvciBkZXNlbGVjdCBhIFBvd2VyQmFyIGFuZCBlbWl0cyB0aGUgdGVybXMgbGlzdCBvZiBzZWxlY3RlZCBiYXJzXG4gICAqL1xuICAvLyBTZWxlY3Qgb3IgZGVzZWxlY3QgYSBQb3dlckJhciBmcm9tIHRoZSB2aWV3XG4gIHB1YmxpYyBjbGlja09uUG93ZXJiYXIocG93ZXJCYXI6IFBvd2VyQmFyKTogdm9pZCB7XG4gICAgY29uc3Qgc2VsZWN0ZWRQYXRocyA9IG5ldyBBcnJheSgpO1xuICAgIGlmICh0aGlzLnNlbGVjdGVkUG93ZXJiYXJzVGVybXMuaGFzKHBvd2VyQmFyLnRlcm0pKSB7XG4gICAgICBwb3dlckJhci5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzVGVybXMuZGVsZXRlKHBvd2VyQmFyLnRlcm0pO1xuICAgICAgdGhpcy5zZWxlY3RlZFBvd2VyYmFyc1NldC5kZWxldGUocG93ZXJCYXIpO1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRQb3dlcmJhcnNUZXJtcy5zaXplID09PSAwKSB7XG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBvd2VyQmFyLmNsYXNzU3VmZml4ID0gdGhpcy5VTlNFTEVDVEVEX0JBUjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRQYXRocykge1xuICAgICAgICBPYmplY3QuYXNzaWduKHNlbGVjdGVkUGF0aHMsIHRoaXMuc2VsZWN0ZWRQYXRocyk7XG4gICAgICB9XG4gICAgICBwb3dlckJhci5pc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgIHBvd2VyQmFyLmNsYXNzU3VmZml4ID0gdGhpcy5TRUxFQ1RFRF9CQVI7XG4gICAgICB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzVGVybXMuYWRkKHBvd2VyQmFyLnRlcm0pO1xuICAgICAgdGhpcy5hZGRTZWxlY3RlZFBvd2VyYmFyVG9MaXN0KHBvd2VyQmFyLCB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzU2V0KTtcbiAgICAgIHRoaXMudW5zZWxlY3RBbGxCdXROb3RTZWxlY3RlZEJhcnMoKTtcbiAgICB9XG4gICAgdGhpcy5zZWxlY3RlZFBvd2VyYmFyc1NldC5mb3JFYWNoKHBiID0+IHtcbiAgICAgIHNlbGVjdGVkUGF0aHMucHVzaChwYi5wYXRoKTtcbiAgICB9KTtcbiAgICB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzU2V0ID0gdGhpcy5zb3J0U2VsZWN0ZWRQb3dlckJhcnModGhpcy5zZWxlY3RlZFBvd2VyYmFyc1NldCk7XG4gICAgdGhpcy5zZWxlY3RlZFBvd2VyQmFyRXZlbnQubmV4dChzZWxlY3RlZFBhdGhzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gU2V0IHNlbGVjdGVkIHBvd2VyYmFycyBmcm9tIG91dHNpZGUgb2YgdGhlIGNvbXBvbmVudFxuICAgKiBAcGFyYW0gc2VsZWN0ZWRQYXRocyBzZWxlY3RzIHRoZSBwb3dlcmJhcnMgd2hvc2UgdGVybXMgYXJlIGluIHRoZSBzZWxlY3RlZCBwYXRoc1xuICAgKi9cbiAgcHVibGljIHNldFNlbGVjdGVkUG93ZXJiYXJzKHNlbGVjdGVkUGF0aHM6IEFycmF5PEFycmF5PHsgZmllbGROYW1lOiBzdHJpbmc7IGZpZWxkVmFsdWU6IHN0cmluZzsgfT4+KSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRQb3dlcmJhcnNUZXJtcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIGNvbnN0IHNlbGVjdGVkUG93ZXJiYXJzTGlzdCA9IG5ldyBTZXQ8UG93ZXJCYXI+KCk7XG4gICAgc2VsZWN0ZWRQYXRocy5mb3JFYWNoKHBhdGggPT4ge1xuICAgICAgY29uc3QgY3VycmVudFBhdGggPSBwYXRoLmxlbmd0aCA8PSB0aGlzLmxldmVsID8gcGF0aCA6IHBhdGguc2xpY2UocGF0aC5sZW5ndGggLSB0aGlzLmxldmVsKTtcbiAgICAgIGxldCBwb3dlckJhciA9IGN1cnJlbnRQYXRoLmxlbmd0aCA+IDEgPyB0aGlzLmdldFBvd2VyYmFyKGN1cnJlbnRQYXRoWzBdLmZpZWxkVmFsdWUsIGN1cnJlbnRQYXRoWzFdLmZpZWxkVmFsdWUpIDpcbiAgICAgICAgdGhpcy5nZXRQb3dlcmJhcihjdXJyZW50UGF0aFswXS5maWVsZFZhbHVlLCAncm9vdCcpO1xuICAgICAgaWYgKHBvd2VyQmFyICE9PSBudWxsKSB7XG4gICAgICAgIHBvd2VyQmFyLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICBwb3dlckJhci5jbGFzc1N1ZmZpeCA9IHRoaXMuU0VMRUNURURfQkFSO1xuICAgICAgICBpZiAodGhpcy51c2VDb2xvclNlcnZpY2UpIHtcbiAgICAgICAgICBjb25zdCByZ2JhQ29sb3IgPSB0aW55Y29sb3IodGhpcy5jb2xvclNlcnZpY2UuZ2V0Q29sb3IocG93ZXJCYXIudGVybSwgdGhpcy5rZXlzVG9Db2xvcnMsXG4gICAgICAgICAgICB0aGlzLmNvbG9yc1NhdHVyYXRpb25XZWlnaHQpKS50b1JnYigpO1xuICAgICAgICAgIHBvd2VyQmFyLmNvbG9yID0gdGhpcy5nZXRQb3dlcmJhckNvbG9yKHJnYmFDb2xvcik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBvd2VyQmFyID0gY3VycmVudFBhdGgubGVuZ3RoID4gMSA/IG5ldyBQb3dlckJhcihjdXJyZW50UGF0aFswXS5maWVsZFZhbHVlLCBjdXJyZW50UGF0aFsxXS5maWVsZFZhbHVlLCAwKSA6XG4gICAgICAgICAgbmV3IFBvd2VyQmFyKGN1cnJlbnRQYXRoWzBdLmZpZWxkVmFsdWUsICdyb290JywgMCk7XG4gICAgICAgIHBvd2VyQmFyLnBhdGggPSBjdXJyZW50UGF0aDtcbiAgICAgICAgcG93ZXJCYXIucHJvZ3Jlc3Npb24gPSAwO1xuICAgICAgICBwb3dlckJhci5pc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgcG93ZXJCYXIuY2xhc3NTdWZmaXggPSB0aGlzLlNFTEVDVEVEX05PX01PVU5URURfQkFSO1xuICAgICAgfVxuICAgICAgc2VsZWN0ZWRQb3dlcmJhcnNUZXJtcy5hZGQocG93ZXJCYXIudGVybSk7XG4gICAgICB0aGlzLmFkZFNlbGVjdGVkUG93ZXJiYXJUb0xpc3QocG93ZXJCYXIsIHNlbGVjdGVkUG93ZXJiYXJzTGlzdCk7XG4gICAgfSk7XG4gICAgdGhpcy5zZWxlY3RlZFBvd2VyYmFyc1Rlcm1zID0gc2VsZWN0ZWRQb3dlcmJhcnNUZXJtcztcbiAgICB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzU2V0ID0gdGhpcy5zb3J0U2VsZWN0ZWRQb3dlckJhcnMoc2VsZWN0ZWRQb3dlcmJhcnNMaXN0KTtcbiAgICB0aGlzLnVuc2VsZWN0QWxsQnV0Tm90U2VsZWN0ZWRCYXJzKCk7XG4gIH1cblxuICBwdWJsaWMgb25LZXlVcChzZWFyY2hUZXh0OiBhbnkpIHtcbiAgICB0aGlzLnNlYXJjaGVkVGVybS5uZXh0KHNlYXJjaFRleHQpO1xuICB9XG5cbiAgcHVibGljIHNldE9wZXJhdG9yKG9wOiAnRXEnIHwgJ05lcScpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5maWx0ZXJPcGVyYXRvci52YWx1ZSAhPT0gb3ApIHtcbiAgICAgIHRoaXMuZmlsdGVyT3BlcmF0b3IudmFsdWUgPSBvcDtcbiAgICAgIHRoaXMuZmlsdGVyT3BlcmF0b3JFdmVudC5uZXh0KG9wKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNsZWFyU2VsZWN0aW9uKCk6IHZvaWQge1xuICAgIHRoaXMucG93ZXJCYXJzTGlzdC5mb3JFYWNoKHBvd2VyQmFyID0+IHtcbiAgICAgIHBvd2VyQmFyLmNsYXNzU3VmZml4ID0gdGhpcy5ORVVUUkFMX1NUQVRFO1xuICAgICAgcG93ZXJCYXIuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRTZWxlY3RlZFBvd2VyYmFyVG9MaXN0KHBvd2VyQmFyOiBQb3dlckJhciwgc2VsZWN0ZWRQb3dlcmJhcnNMaXN0OiBTZXQ8UG93ZXJCYXI+KTogdm9pZCB7XG4gICAgLy8gYWRkIHBvd2VyYmFyIHRvIHNlbGVjdGVkUG93ZXJiYXJzTGlzdFxuICAgIHRoaXMucmVtb3ZlUG93ZXJiYXJGcm9tU2VsZWN0ZWRPbmVzKHBvd2VyQmFyLCBzZWxlY3RlZFBvd2VyYmFyc0xpc3QpO1xuICAgIHNlbGVjdGVkUG93ZXJiYXJzTGlzdC5hZGQocG93ZXJCYXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBwb3B1bGF0ZVBvd2VyYmFycygpOiB2b2lkIHtcbiAgICB0aGlzLnBvd2VyQmFyc0xpc3QgPSB0aGlzLmZldGNoUG93ZXJiYXJzTGlzdCh0aGlzLmxldmVsLCB0aGlzLmlucHV0RGF0YSk7XG4gIH1cblxuICBwcml2YXRlIGZldGNoUG93ZXJiYXJzTGlzdChsZXZlbDogbnVtYmVyLCBkYXRhOiBUcmVlTm9kZSwgcG93ZXJCYXJzTGlzdD86IEFycmF5PFBvd2VyQmFyPiwgcmVjdXJzaXZpdHlDb3VudD86IG51bWJlciwgcGF0aD86IGFueSkge1xuICAgIGlmIChyZWN1cnNpdml0eUNvdW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJlY3Vyc2l2aXR5Q291bnQgPSAwO1xuICAgIH1cbiAgICBpZiAoIXBvd2VyQmFyc0xpc3QpIHtcbiAgICAgIHBvd2VyQmFyc0xpc3QgPSBuZXcgQXJyYXk8UG93ZXJCYXI+KCk7XG4gICAgfVxuICAgIC8vIEVhY2ggcG93ZXJiYXIgaGFzIGEgcGF0aCBhdHRyaWJ1dGUgdG8gdGhlIHBhcnJlbnQgbm9kZVxuICAgIGlmICghcGF0aCkge1xuICAgICAgcGF0aCA9IG5ldyBBcnJheSgpO1xuICAgIH1cbiAgICBpZiAocmVjdXJzaXZpdHlDb3VudCA8IGxldmVsIC0gMSkge1xuICAgICAgZGF0YS5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudFBhdGggPSBbXTtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihjdXJyZW50UGF0aCwgcGF0aCk7XG4gICAgICAgIGN1cnJlbnRQYXRoLnB1c2goeyBmaWVsZE5hbWU6IGNoaWxkLmZpZWxkTmFtZSwgZmllbGRWYWx1ZTogY2hpbGQuZmllbGRWYWx1ZSB9KTtcbiAgICAgICAgdGhpcy5mZXRjaFBvd2VyYmFyc0xpc3QobGV2ZWwsIGNoaWxkLCBwb3dlckJhcnNMaXN0LCArK3JlY3Vyc2l2aXR5Q291bnQsIGN1cnJlbnRQYXRoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhLmNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4ge1xuICAgICAgICBjb25zdCBjdXJyZW50UGF0aCA9IFtdO1xuICAgICAgICBPYmplY3QuYXNzaWduKGN1cnJlbnRQYXRoLCBwYXRoKTtcbiAgICAgICAgY3VycmVudFBhdGgucHVzaCh7IGZpZWxkTmFtZTogY2hpbGQuZmllbGROYW1lLCBmaWVsZFZhbHVlOiBjaGlsZC5maWVsZFZhbHVlIH0pO1xuICAgICAgICBpZiAoIWNoaWxkLmlzT3RoZXIpIHtcbiAgICAgICAgICBjb25zdCBwb3dlckJhciA9IG5ldyBQb3dlckJhcihjaGlsZC5maWVsZFZhbHVlLCBkYXRhLmZpZWxkVmFsdWUsIGNoaWxkLm1ldHJpY1ZhbHVlKTtcbiAgICAgICAgICBjdXJyZW50UGF0aC5yZXZlcnNlKCk7XG4gICAgICAgICAgcG93ZXJCYXIucGF0aCA9IGN1cnJlbnRQYXRoO1xuICAgICAgICAgIGlmICh0aGlzLnVzZUNvbG9yU2VydmljZSkge1xuICAgICAgICAgICAgY29uc3QgcmdiYUNvbG9yID0gdGlueWNvbG9yKHRoaXMuY29sb3JTZXJ2aWNlLmdldENvbG9yKHBvd2VyQmFyLnRlcm0sIHRoaXMua2V5c1RvQ29sb3JzLFxuICAgICAgICAgICAgICB0aGlzLmNvbG9yc1NhdHVyYXRpb25XZWlnaHQpKS50b1JnYigpO1xuICAgICAgICAgICAgcG93ZXJCYXIuY29sb3IgPSB0aGlzLmdldFBvd2VyYmFyQ29sb3IocmdiYUNvbG9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMudXNlQ29sb3JGcm9tRGF0YSkge1xuICAgICAgICAgICAgcG93ZXJCYXIuY29sb3IgPSBjaGlsZC5jb2xvci50b1N0cmluZygpLnN0YXJ0c1dpdGgoJyMnKSA/IGNoaWxkLmNvbG9yLnRvU3RyaW5nKCkgOiAnIycuY29uY2F0KGNoaWxkLmNvbG9yLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwb3dlckJhcnNMaXN0LnB1c2gocG93ZXJCYXIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwb3dlckJhcnNMaXN0O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcG9wdWxhdGVTZWxlY3RlZFBvd2VyYmFycygpIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZFBvd2VyYmFyc1Rlcm1zICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zZWxlY3RlZFBvd2VyYmFyc1Rlcm1zLnNpemUgPiAwKSB7XG4gICAgICB0aGlzLnNldFNlbGVjdGVkUG93ZXJiYXJzKHRoaXMuc2VsZWN0ZWRQYXRocyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBbGxQb3dlckJhcnNQcm9ncmVzc2lvbigpIHtcbiAgICAvLyBUT0RPIDogTWFuYWdlIGNvcnJlY3RseSB3aGVuIGNvdW50ID09IE5hTlxuICAgIGxldCBzdW0gPSAwO1xuICAgIC8vIGNhbGN1bGF0ZSB0aGUgc3VtXG4gICAgdGhpcy5wb3dlckJhcnNMaXN0LmZvckVhY2gocG93ZXJCYXIgPT4ge1xuICAgICAgaWYgKHBvd2VyQmFyLmNvdW50LnRvU3RyaW5nKCkgPT09ICdOYU4nKSB7XG4gICAgICAgIHBvd2VyQmFyLmNvdW50ID0gMDtcbiAgICAgIH1cbiAgICAgIHN1bSArPSBwb3dlckJhci5jb3VudDtcbiAgICB9KTtcbiAgICB0aGlzLnNlbGVjdGVkUG93ZXJiYXJzU2V0LmZvckVhY2goc2VsZWN0ZWRQb3dlckJhciA9PiB7XG4gICAgICBpZiAoc2VsZWN0ZWRQb3dlckJhci5jb3VudC50b1N0cmluZygpID09PSAnTmFOJykge1xuICAgICAgICBzZWxlY3RlZFBvd2VyQmFyLmNvdW50ID0gMDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmdldFBvd2VyYmFyKHNlbGVjdGVkUG93ZXJCYXIudGVybSwgc2VsZWN0ZWRQb3dlckJhci5wYXJlbnRUZXJtKSA9PT0gbnVsbCkge1xuICAgICAgICBzdW0gKz0gc2VsZWN0ZWRQb3dlckJhci5jb3VudDtcbiAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgLy8gY2FsY3VsYXRlIHByb2dyZXNzaW9uXG4gICAgdGhpcy5wb3dlckJhcnNMaXN0LmZvckVhY2gocG93ZXJCYXIgPT4ge1xuICAgICAgcG93ZXJCYXIucHJvZ3Jlc3Npb24gPSBwb3dlckJhci5jb3VudCAvIHN1bSAqIDEwMDtcbiAgICAgIGlmIChwb3dlckJhci5wcm9ncmVzc2lvbiAhPT0gMCAmJiBwb3dlckJhci5wcm9ncmVzc2lvbiAhPT0gMTAwKSB7XG4gICAgICAgIHBvd2VyQmFyLnByb2dyZXNzaW9uICs9IDE7XG4gICAgICB9XG4gICAgICBwb3dlckJhci5wcm9ncmVzc2lvbiA9IE1hdGgubWluKHBvd2VyQmFyLnByb2dyZXNzaW9uLCAxMDApO1xuICAgIH0pO1xuICAgIHRoaXMuc2VsZWN0ZWRQb3dlcmJhcnNTZXQuZm9yRWFjaChzZWxlY3RlZFBvd2VyQmFyID0+IHtcbiAgICAgIHNlbGVjdGVkUG93ZXJCYXIucHJvZ3Jlc3Npb24gPSBzZWxlY3RlZFBvd2VyQmFyLmNvdW50IC8gc3VtICogMTAwO1xuICAgICAgaWYgKHNlbGVjdGVkUG93ZXJCYXIucHJvZ3Jlc3Npb24gIT09IDAgJiYgc2VsZWN0ZWRQb3dlckJhci5wcm9ncmVzc2lvbiAhPT0gMTAwKSB7XG4gICAgICAgIHNlbGVjdGVkUG93ZXJCYXIucHJvZ3Jlc3Npb24gKz0gMTtcbiAgICAgIH1cbiAgICAgIHNlbGVjdGVkUG93ZXJCYXIucHJvZ3Jlc3Npb24gPSBNYXRoLm1pbihzZWxlY3RlZFBvd2VyQmFyLnByb2dyZXNzaW9uLCAxMDApO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSB1bnNlbGVjdEFsbEJ1dE5vdFNlbGVjdGVkQmFycygpIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZFBvd2VyYmFyc1Rlcm1zLnNpemUgPT09IDApIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRQb3dlcmJhcnNTZXQgPSBuZXcgU2V0PFBvd2VyQmFyPigpO1xuICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBvd2VyQmFyc0xpc3QuZm9yRWFjaChwb3dlckJhciA9PiB7XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZFBvd2VyYmFyc1Rlcm1zLmhhcyhwb3dlckJhci50ZXJtKSkge1xuICAgICAgICAgIHBvd2VyQmFyLmNsYXNzU3VmZml4ID0gdGhpcy5VTlNFTEVDVEVEX0JBUjtcbiAgICAgICAgICBwb3dlckJhci5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNvcnQgdGhlIHNlbGVjdGVkIFBvd2VyQmFycyBkZWNyZWFzaW5nbHkuIEFuZCByZWNhbGN1bGF0ZSB0aGUgcHJvZ3Jlc3Npb24gb2YgdGhlIGJhcnMgaW4gdGhpcyBhcnJheS5cbiAgcHJpdmF0ZSBzb3J0U2VsZWN0ZWRQb3dlckJhcnMoc2VsZWN0ZWRQb3dlcmJhcnNMaXN0OiBTZXQ8UG93ZXJCYXI+KTogU2V0PFBvd2VyQmFyPiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRQb3dlcmJhcnNBcnJheSA9IEFycmF5LmZyb20oc2VsZWN0ZWRQb3dlcmJhcnNMaXN0KTtcbiAgICBjb25zdCBzb3J0ZWRTZWxlY3RlZFBvd2VyYmFyc0xpc3QgPSBuZXcgU2V0PFBvd2VyQmFyPigpO1xuICAgIHNlbGVjdGVkUG93ZXJiYXJzQXJyYXkuZm9yRWFjaChwb3dlckJhciA9PiB7XG4gICAgICBzb3J0ZWRTZWxlY3RlZFBvd2VyYmFyc0xpc3QuYWRkKHBvd2VyQmFyKTtcbiAgICB9KTtcbiAgICByZXR1cm4gc29ydGVkU2VsZWN0ZWRQb3dlcmJhcnNMaXN0O1xuICB9XG5cbiAgLy8gcmVtb3ZlcyB0aGUgcG93ZXJiYXIgdGhhdCBoYXMgdGhlIHNhbWUgdGVybSBpbiBzZWxlY3RlZFBvd2VyYmFyc0xpc3QgYnV0IG5vdCB0aGUgc2FtZSBpbnN0YW5jZVxuICBwcml2YXRlIHJlbW92ZVBvd2VyYmFyRnJvbVNlbGVjdGVkT25lcyhwb3dlckJhcjogUG93ZXJCYXIsIHNlbGVjdGVkUG93ZXJiYXJzTGlzdDogU2V0PFBvd2VyQmFyPikge1xuICAgIGxldCBwb3dlcmJhclRvUmVtb3ZlO1xuICAgIHNlbGVjdGVkUG93ZXJiYXJzTGlzdC5mb3JFYWNoKHNlbGVjdGVkUG93ZXJiYXIgPT4ge1xuICAgICAgaWYgKHNlbGVjdGVkUG93ZXJiYXIudGVybSA9PT0gcG93ZXJCYXIudGVybSkge1xuICAgICAgICBwb3dlcmJhclRvUmVtb3ZlID0gc2VsZWN0ZWRQb3dlcmJhcjtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxlY3RlZFBvd2VyYmFyc0xpc3QuZGVsZXRlKHBvd2VyYmFyVG9SZW1vdmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBHZXRzIHRoZSBwb3dlcmJhciBieSBpdHMgdGVybSBhbmQgdGhlIHRlcm0gb2YgaXQncyBwYXJlbnQgbm9kZVxuICAgKlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRQb3dlcmJhcihwb3dlcmJhclRlcm06IHN0cmluZywgcG93ZXJiYXJQYXJlbnRUZXJtOiBzdHJpbmcpOiBQb3dlckJhciB7XG4gICAgbGV0IGZvdW5kUG93ZXJiYXIgPSBudWxsO1xuICAgIHRoaXMucG93ZXJCYXJzTGlzdC5mb3JFYWNoKHBvd2VyYmFyID0+IHtcbiAgICAgIGlmIChwb3dlcmJhci50ZXJtID09PSBwb3dlcmJhclRlcm0gJiYgcG93ZXJiYXIucGFyZW50VGVybSA9PT0gcG93ZXJiYXJQYXJlbnRUZXJtKSB7XG4gICAgICAgIGZvdW5kUG93ZXJiYXIgPSBwb3dlcmJhcjtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZm91bmRQb3dlcmJhcjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UG93ZXJiYXJDb2xvcihyZ2JhQ29sb3I6IHRpbnljb2xvci5Db2xvckZvcm1hdHMuUkdCQSk6IHN0cmluZ3tcbiAgICByZXR1cm4gJ3JnYmEoJyArIFtyZ2JhQ29sb3IuciwgcmdiYUNvbG9yLmcsIHJnYmFDb2xvci5iLCAwLjddLmpvaW4oJywnKSArICcpJztcbiAgfVxufVxuIiwiPGRpdiBbc3R5bGUud2lkdGgucHhdPVwiISFjaGFydFdpZHRoID8gY2hhcnRXaWR0aCA6ICd1bnNldCdcIj5cbiAgPGRpdiBjbGFzcz1cInRvb2xzXCI+XG4gICAgPGRpdiAqbmdJZj1cIiFkaXNwbGF5RmlsdGVyRmllbGRcIiBjbGFzcz1cInBvd2VyYmFycy0tdGl0bGVcIj57e3Bvd2VyYmFyVGl0bGUgfCB0cmFuc2xhdGV9fTwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJwb3dlcmJhcnMtLXNlYXJjaFwiICpuZ0lmPVwiZGlzcGxheUZpbHRlckZpZWxkXCI+XG4gICAgICA8Zm9ybSAoa2V5ZG93bi5lbnRlcik9XCIkZXZlbnQucHJldmVudERlZmF1bHQoKVwiPlxuICAgICAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9XCJwb3dlcmJhcnMtLXNlYXJjaC1maWVsZFwiPlxuICAgICAgICAgIDxpbnB1dCAjc2VhcmNoVGV4dCB0eXBlPVwidGV4dFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIHBsYWNlaG9sZGVyPVwie3twb3dlcmJhclRpdGxlIHwgdHJhbnNsYXRlfX1cIiBtYXRJbnB1dFxuICAgICAgICAgICAgY2xhc3M9XCJwb3dlcmJhcnMtLXNlYXJjaC1pbnB1dFwiIChrZXl1cCk9XCJvbktleVVwKHNlYXJjaFRleHQudmFsdWUpXCIgbmFtZT1cInNlYXJjaFwiPlxuICAgICAgICA8L21hdC1mb3JtLWZpZWxkPlxuICAgICAgPC9mb3JtPlxuICAgIDwvZGl2PlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJmaWx0ZXJPcGVyYXRvclwiPlxuICAgICAgPGRpdiAqbmdJZj1cImZpbHRlck9wZXJhdG9yPy5kaXNwbGF5XCIgY2xhc3M9XCJpbmNsdWRlX2V4Y2x1ZGVcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm9wZXJhdGlvblwiIFtjbGFzcy5vcGVyYXRpb24tLXNlbGVjdGVkXT1cImZpbHRlck9wZXJhdG9yPy52YWx1ZSA9PT0gJ0VxJ1wiIChjbGljayk9XCJzZXRPcGVyYXRvcignRXEnKVwiPnt7J2luY2x1ZGUnIHwgdHJhbnNsYXRlfX08L2Rpdj4gPCEtLSAvL05PU09OQVIgLS0+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJvcGVyYXRpb25cIiBbY2xhc3Mub3BlcmF0aW9uLS1zZWxlY3RlZF09XCJmaWx0ZXJPcGVyYXRvcj8udmFsdWUgPT09ICdOZXEnXCIgKGNsaWNrKT1cInNldE9wZXJhdG9yKCdOZXEnKVwiPnt7J2V4Y2x1ZGUnIHwgdHJhbnNsYXRlfX08L2Rpdj4gPCEtLSAvL05PU09OQVIgLS0+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgKm5nSWY9XCIhZmlsdGVyT3BlcmF0b3I/LmRpc3BsYXkgJiYgZmlsdGVyT3BlcmF0b3I/LnZhbHVlID09PSAnTmVxJ1wiIGNsYXNzPVwiaW5jbHVkZV9leGNsdWRlXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJvcGVyYXRpb24gZXhjbHVkZVwiPnt7J2V4Y2x1ZGUnIHwgdHJhbnNsYXRlfX08L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPVwicG93ZXJiYXJzLS1jb250YWluZXJcIiBbY2xhc3MucG93ZXJiYXJzLS1jb250YWluZXJfX3Njcm9sbGFibGVdPVwic2Nyb2xsYWJsZVwiIFtuZ0NsYXNzXT1cImN1c3RvbWl6ZWRDc3NDbGFzc1wiPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncm91cFNlbGVjdGlvbnNcIj5cbiAgICAgIDxkaXYgKm5nSWY9XCJzZWxlY3RlZFBvd2VyYmFyc1NldC5zaXplICE9PSAwXCIgW2NsYXNzLnBvd2VyYmFyLXNlbGVjdGVkLXNjcm9sbGFibGVdPVwic2Nyb2xsYWJsZVwiXG4gICAgICAgIFtzdHlsZS5taW4taGVpZ2h0LnB4XT1cInNlbGVjdGVkUG93ZXJiYXJzU2V0LnNpemUgPiA1ID8gMTMxIDogc2VsZWN0ZWRQb3dlcmJhcnNTZXQuc2l6ZSAqIDI2XCI+XG4gICAgICAgIDxkaXYgKm5nRm9yPVwibGV0IHNlbGVjdGVkUG93ZXJiYXIgb2Ygc2VsZWN0ZWRQb3dlcmJhcnNTZXRcIj5cbiAgICAgICAgICA8YXJsYXMtcG93ZXJiYXJcbiAgICAgICAgICAgIFt1bml0XT1cInVuaXRcIlxuICAgICAgICAgICAgW3Bvd2VyYmFyXT1cInNlbGVjdGVkUG93ZXJiYXJcIlxuICAgICAgICAgICAgW3VzZUNvbG9yRnJvbURhdGFdPVwidXNlQ29sb3JGcm9tRGF0YVwiXG4gICAgICAgICAgICBbdXNlQ29sb3JTZXJ2aWNlXT1cInVzZUNvbG9yU2VydmljZVwiXG4gICAgICAgICAgICBbaGlkZVNlbGVjdGVkXT1cImZhbHNlXCJcbiAgICAgICAgICAgIFtzZWxlY3RXaXRoQ2hlY2tib3hdPVwic2VsZWN0V2l0aENoZWNrYm94XCJcbiAgICAgICAgICAgIFtudW1iZXJTaG9ydGVuaW5nUHJlY2lzaW9uXT1cIm51bWJlclNob3J0ZW5pbmdQcmVjaXNpb25cIlxuICAgICAgICAgICAgKG9uQ2hlY2tFdmVudCk9XCJjbGlja09uUG93ZXJiYXIoc2VsZWN0ZWRQb3dlcmJhcilcIlxuICAgICAgICAgICAgKG9uQ2xpY2tFdmVudCk9XCJjbGlja09uUG93ZXJiYXIoc2VsZWN0ZWRQb3dlcmJhcilcIlxuICAgICAgICAgID48L2FybGFzLXBvd2VyYmFyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPGRpdiBbY2xhc3MucG93ZXJiYXItbGlzdC1zY3JvbGxhYmxlXT1cInNjcm9sbGFibGVcIj5cbiAgICAgIDxkaXYgKm5nRm9yPVwibGV0IHBvd2VyYmFyIG9mIHBvd2VyQmFyc0xpc3RcIj5cbiAgICAgICAgPGFybGFzLXBvd2VyYmFyXG4gICAgICAgICAgW3VuaXRdPVwidW5pdFwiXG4gICAgICAgICAgW3Bvd2VyYmFyXT1cInBvd2VyYmFyXCJcbiAgICAgICAgICBbdXNlQ29sb3JGcm9tRGF0YV09XCJ1c2VDb2xvckZyb21EYXRhXCJcbiAgICAgICAgICBbdXNlQ29sb3JTZXJ2aWNlXT1cInVzZUNvbG9yU2VydmljZVwiXG4gICAgICAgICAgW251bWJlclNob3J0ZW5pbmdQcmVjaXNpb25dPVwibnVtYmVyU2hvcnRlbmluZ1ByZWNpc2lvblwiXG4gICAgICAgICAgW3NlbGVjdFdpdGhDaGVja2JveF09XCJzZWxlY3RXaXRoQ2hlY2tib3hcIlxuICAgICAgICAgIFtoaWRlU2VsZWN0ZWRdPVwiZ3JvdXBTZWxlY3Rpb25zXCJcbiAgICAgICAgICAob25DaGVja0V2ZW50KT1cImNsaWNrT25Qb3dlcmJhcihwb3dlcmJhcilcIlxuICAgICAgICAgIChvbkNsaWNrRXZlbnQpPVwiY2xpY2tPblBvd2VyYmFyKHBvd2VyYmFyKVwiXG4gICAgICAgID48L2FybGFzLXBvd2VyYmFyPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+Il19