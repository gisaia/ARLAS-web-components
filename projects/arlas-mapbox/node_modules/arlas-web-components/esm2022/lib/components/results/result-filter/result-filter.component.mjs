/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { Component, Input, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { Column } from '../model/column';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@angular/material/form-field";
import * as i3 from "@angular/material/select";
import * as i4 from "@angular/material/core";
import * as i5 from "@angular/forms";
export class ResultFilterComponent {
    constructor() {
        /**
         * @Input
         * @description A map of columns to filter : key = column (or field) name & value = field value.
         * This components sets directly this map.
         */
        this.filtersMap = new Map();
        /**
         * @Input
         * @description The values of dropdown list.
         */
        this.dropdownValues = new Array();
        /**
         * @Output
         * @description Emits the map of filtered columns and the filters values (fieldName-fieldValue map).
         */
        this.setFiltersEvent = new Subject();
        /**
         * @Output
         * @description Emits the column on change to notify the main component.
         */
        this.columnChanged = new Subject();
        this.selected = new Array();
    }
    ngOnInit() {
    }
    ngOnChanges(changes) {
        if (changes['filtersMap'] !== undefined) {
            if (changes['filtersMap'].currentValue !== undefined) {
                if (changes['filtersMap'].currentValue !== changes['filtersMap'].previousValue) {
                    if (changes['filtersMap'].currentValue.get(this.column.fieldName) !== undefined) {
                        if (this.inputValue !== changes['filtersMap'].currentValue.get(this.column.fieldName)) {
                            this.inputValue = changes['filtersMap'].currentValue.get(this.column.fieldName);
                            this.selected = new Array();
                            this.inputValue.split(',').forEach(v => this.selected.push(v));
                        }
                    }
                    else {
                        this.inputValue = '';
                        this.selected = new Array();
                    }
                }
            }
        }
    }
    setFilterOnKeyEnter(event) {
        event.target.blur();
    }
    // Update the map of the filtered fields. If a filter is empty, the correspondant field is removed from the map
    setFilter() {
        if (this.inputValue === undefined || this.inputValue === '' || this.inputValue === null) {
            if (this.filtersMap.has(this.column.fieldName)) {
                this.filtersMap.delete(this.column.fieldName);
                this.setFiltersEvent.next(this.filtersMap);
                this.columnChanged.next(this.column);
            }
        }
        else {
            this.filtersMap.set(this.column.fieldName, this.inputValue);
            this.setFiltersEvent.next(this.filtersMap);
            this.columnChanged.next(this.column);
        }
    }
    selectionChange(event) {
        if (event.value.length > 0) {
            this.filtersMap.set(event.source.id, event.value.join(','));
            this.setFiltersEvent.next(this.filtersMap);
            this.columnChanged.next(this.column);
        }
        else {
            if (this.filtersMap.has(event.source.id)) {
                this.filtersMap.delete(event.source.id);
                this.setFiltersEvent.next(this.filtersMap);
                this.columnChanged.next(this.column);
            }
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ResultFilterComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: ResultFilterComponent, selector: "[arlas-result-filter]", inputs: { column: "column", filtersMap: "filtersMap", inputValue: "inputValue", dropdownValues: "dropdownValues" }, outputs: { setFiltersEvent: "setFiltersEvent", columnChanged: "columnChanged" }, usesOnChanges: true, ngImport: i0, template: "<input *ngIf=\"!column?.isIdField&&(dropdownValues?.length==0||dropdownValues==null)\" type=\"text\" class=\"form-control resultlist__header--filters resultlist__header--filters__{{column?.fieldName}}\" (blur)=\"setFilter()\" (keyup.enter)=\"setFilterOnKeyEnter($event)\"\n    [(ngModel)]=\"inputValue\">\n\n<mat-form-field *ngIf=\"!column?.isIdField&&dropdownValues?.length>0\" \n    class=\"form-control resultlist__header--filters resultlist__header--filters--dropdown resultlist__header--filters__{{column?.fieldName}}\" \n    [style.width.px]=\"column?.width-10\">\n    <mat-select [id]=\"column?.fieldName\" placeholder=\"\"  multiple class=\"resultlist__dropdown-select\" [style.width.px]=\"column?.width-20\" (selectionChange)=\"selectionChange($event)\" [value]=\"selected\">\n        <mat-option  class=\"resultlist__dropdown-option\" *ngFor=\"let value of dropdownValues\"  [value]=\"value\">{{value}}</mat-option>\n    </mat-select>\n</mat-form-field>\n", styles: [".resultlist__header--filters{margin:0}\n"], dependencies: [{ kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "component", type: i3.MatSelect, selector: "mat-select", inputs: ["aria-describedby", "panelClass", "disabled", "disableRipple", "tabIndex", "hideSingleSelectionIndicator", "placeholder", "required", "multiple", "disableOptionCentering", "compareWith", "value", "aria-label", "aria-labelledby", "errorStateMatcher", "typeaheadDebounceInterval", "sortComparator", "id", "panelWidth"], outputs: ["openedChange", "opened", "closed", "selectionChange", "valueChange"], exportAs: ["matSelect"] }, { kind: "component", type: i4.MatOption, selector: "mat-option", inputs: ["value", "id", "disabled"], outputs: ["onSelectionChange"], exportAs: ["matOption"] }, { kind: "directive", type: i5.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ResultFilterComponent, decorators: [{
            type: Component,
            args: [{ selector: '[arlas-result-filter]', template: "<input *ngIf=\"!column?.isIdField&&(dropdownValues?.length==0||dropdownValues==null)\" type=\"text\" class=\"form-control resultlist__header--filters resultlist__header--filters__{{column?.fieldName}}\" (blur)=\"setFilter()\" (keyup.enter)=\"setFilterOnKeyEnter($event)\"\n    [(ngModel)]=\"inputValue\">\n\n<mat-form-field *ngIf=\"!column?.isIdField&&dropdownValues?.length>0\" \n    class=\"form-control resultlist__header--filters resultlist__header--filters--dropdown resultlist__header--filters__{{column?.fieldName}}\" \n    [style.width.px]=\"column?.width-10\">\n    <mat-select [id]=\"column?.fieldName\" placeholder=\"\"  multiple class=\"resultlist__dropdown-select\" [style.width.px]=\"column?.width-20\" (selectionChange)=\"selectionChange($event)\" [value]=\"selected\">\n        <mat-option  class=\"resultlist__dropdown-option\" *ngFor=\"let value of dropdownValues\"  [value]=\"value\">{{value}}</mat-option>\n    </mat-select>\n</mat-form-field>\n", styles: [".resultlist__header--filters{margin:0}\n"] }]
        }], ctorParameters: () => [], propDecorators: { column: [{
                type: Input
            }], filtersMap: [{
                type: Input
            }], inputValue: [{
                type: Input
            }], dropdownValues: [{
                type: Input
            }], setFiltersEvent: [{
                type: Output
            }], columnChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9yZXN1bHRzL3Jlc3VsdC1maWx0ZXIvcmVzdWx0LWZpbHRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9yZXN1bHRzL3Jlc3VsdC1maWx0ZXIvcmVzdWx0LWZpbHRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFFSCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUUzRixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7OztBQVF6QyxNQUFNLE9BQU8scUJBQXFCO0lBcUNoQztRQTlCQTs7OztXQUlHO1FBQ2EsZUFBVSxHQUE4QixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBTWxFOzs7V0FHRztRQUNhLG1CQUFjLEdBQWtCLElBQUksS0FBSyxFQUFVLENBQUM7UUFDcEU7OztXQUdHO1FBQ2Msb0JBQWUsR0FBdUMsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUVyRjs7O1dBR0c7UUFDYyxrQkFBYSxHQUFvQixJQUFJLE9BQU8sRUFBVSxDQUFDO1FBRWpFLGFBQVEsR0FBZSxJQUFJLEtBQUssRUFBTyxDQUFDO0lBRXhCLENBQUM7SUFFakIsUUFBUTtJQUNmLENBQUM7SUFDTSxXQUFXLENBQUMsT0FBc0I7UUFDdkMsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDeEMsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsWUFBWSxLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUNyRCxJQUFJLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUMvRSxJQUFJLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQUssU0FBUyxFQUFFLENBQUM7d0JBQ2hGLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7NEJBQ3RGLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQzs0QkFDaEYsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLEtBQUssRUFBTyxDQUFDOzRCQUNqQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNqRSxDQUFDO29CQUNILENBQUM7eUJBQU0sQ0FBQzt3QkFDTixJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQzt3QkFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLEtBQUssRUFBTyxDQUFDO29CQUNuQyxDQUFDO2dCQUNILENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFTSxtQkFBbUIsQ0FBQyxLQUFLO1FBQzlCLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUlELCtHQUErRztJQUN4RyxTQUFTO1FBQ2QsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLEVBQUUsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ3hGLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUMvQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUM5QyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN2QyxDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzNDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2QyxDQUFDO0lBQ0gsQ0FBQztJQUVNLGVBQWUsQ0FBQyxLQUFzQjtRQUMzQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzNDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2QyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO2dCQUN6QyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN4QyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN2QyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7K0dBN0ZVLHFCQUFxQjttR0FBckIscUJBQXFCLHVSQzlCbEMsdThCQVVBOzs0RkRvQmEscUJBQXFCO2tCQUxqQyxTQUFTOytCQUNFLHVCQUF1Qjt3REFVakIsTUFBTTtzQkFBckIsS0FBSztnQkFNVSxVQUFVO3NCQUF6QixLQUFLO2dCQUtVLFVBQVU7c0JBQXpCLEtBQUs7Z0JBS1UsY0FBYztzQkFBN0IsS0FBSztnQkFLVyxlQUFlO3NCQUEvQixNQUFNO2dCQU1VLGFBQWE7c0JBQTdCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gR2lzYcOvYSB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvclxuICogbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRS50eHQgZmlsZSBkaXN0cmlidXRlZCB3aXRoXG4gKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodFxuICogb3duZXJzaGlwLiBHaXNhw69hIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byB5b3UgdW5kZXJcbiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXlcbiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0U2VsZWN0Q2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc2VsZWN0JztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IENvbHVtbiB9IGZyb20gJy4uL21vZGVsL2NvbHVtbic7XG5pbXBvcnQgeyBJdGVtRGF0YVR5cGUgfSBmcm9tICcuLi91dGlscy9yZXN1bHRzLnV0aWxzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnW2FybGFzLXJlc3VsdC1maWx0ZXJdJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Jlc3VsdC1maWx0ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9yZXN1bHQtZmlsdGVyLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBSZXN1bHRGaWx0ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgLyoqXG4gICAqIEBJbnB1dFxuICAgKiBAZGVzY3JpcHRpb24gVGhlIGNvbHVtbiB0byB3aGljaCB0aGUgZmlsdGVyIGlzIGFwcGxpZWQuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgY29sdW1uOiBDb2x1bW47XG4gIC8qKlxuICAgKiBASW5wdXRcbiAgICogQGRlc2NyaXB0aW9uIEEgbWFwIG9mIGNvbHVtbnMgdG8gZmlsdGVyIDoga2V5ID0gY29sdW1uIChvciBmaWVsZCkgbmFtZSAmIHZhbHVlID0gZmllbGQgdmFsdWUuXG4gICAqIFRoaXMgY29tcG9uZW50cyBzZXRzIGRpcmVjdGx5IHRoaXMgbWFwLlxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIGZpbHRlcnNNYXA6IE1hcDxzdHJpbmcsIEl0ZW1EYXRhVHlwZT4gPSBuZXcgTWFwKCk7XG4gIC8qKlxuICAgKiBASW5wdXRcbiAgICogQGRlc2NyaXB0aW9uIFRoZSBmaWx0ZXIgdmFsdWUuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgaW5wdXRWYWx1ZTogc3RyaW5nO1xuICAvKipcbiAgICogQElucHV0XG4gICAqIEBkZXNjcmlwdGlvbiBUaGUgdmFsdWVzIG9mIGRyb3Bkb3duIGxpc3QuXG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgZHJvcGRvd25WYWx1ZXM6IEFycmF5PHN0cmluZz4gPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xuICAvKipcbiAgICogQE91dHB1dFxuICAgKiBAZGVzY3JpcHRpb24gRW1pdHMgdGhlIG1hcCBvZiBmaWx0ZXJlZCBjb2x1bW5zIGFuZCB0aGUgZmlsdGVycyB2YWx1ZXMgKGZpZWxkTmFtZS1maWVsZFZhbHVlIG1hcCkuXG4gICAqL1xuICBAT3V0cHV0KCkgcHVibGljIHNldEZpbHRlcnNFdmVudDogU3ViamVjdDxNYXA8c3RyaW5nLCBJdGVtRGF0YVR5cGU+PiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgLyoqXG4gICAqIEBPdXRwdXRcbiAgICogQGRlc2NyaXB0aW9uIEVtaXRzIHRoZSBjb2x1bW4gb24gY2hhbmdlIHRvIG5vdGlmeSB0aGUgbWFpbiBjb21wb25lbnQuXG4gICAqL1xuICBAT3V0cHV0KCkgcHVibGljIGNvbHVtbkNoYW5nZWQ6IFN1YmplY3Q8Q29sdW1uPiA9IG5ldyBTdWJqZWN0PENvbHVtbj4oKTtcblxuICBwdWJsaWMgc2VsZWN0ZWQ6IEFycmF5PGFueT4gPSBuZXcgQXJyYXk8YW55PigpO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpIHtcbiAgfVxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzWydmaWx0ZXJzTWFwJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKGNoYW5nZXNbJ2ZpbHRlcnNNYXAnXS5jdXJyZW50VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY2hhbmdlc1snZmlsdGVyc01hcCddLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlc1snZmlsdGVyc01hcCddLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICBpZiAoY2hhbmdlc1snZmlsdGVyc01hcCddLmN1cnJlbnRWYWx1ZS5nZXQodGhpcy5jb2x1bW4uZmllbGROYW1lKSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pbnB1dFZhbHVlICE9PSBjaGFuZ2VzWydmaWx0ZXJzTWFwJ10uY3VycmVudFZhbHVlLmdldCh0aGlzLmNvbHVtbi5maWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IGNoYW5nZXNbJ2ZpbHRlcnNNYXAnXS5jdXJyZW50VmFsdWUuZ2V0KHRoaXMuY29sdW1uLmZpZWxkTmFtZSk7XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBuZXcgQXJyYXk8YW55PigpO1xuICAgICAgICAgICAgICB0aGlzLmlucHV0VmFsdWUuc3BsaXQoJywnKS5mb3JFYWNoKHYgPT4gdGhpcy5zZWxlY3RlZC5wdXNoKHYpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gJyc7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gbmV3IEFycmF5PGFueT4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2V0RmlsdGVyT25LZXlFbnRlcihldmVudCkge1xuICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gIH1cblxuXG5cbiAgLy8gVXBkYXRlIHRoZSBtYXAgb2YgdGhlIGZpbHRlcmVkIGZpZWxkcy4gSWYgYSBmaWx0ZXIgaXMgZW1wdHksIHRoZSBjb3JyZXNwb25kYW50IGZpZWxkIGlzIHJlbW92ZWQgZnJvbSB0aGUgbWFwXG4gIHB1YmxpYyBzZXRGaWx0ZXIoKSB7XG4gICAgaWYgKHRoaXMuaW5wdXRWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuaW5wdXRWYWx1ZSA9PT0gJycgfHwgdGhpcy5pbnB1dFZhbHVlID09PSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5maWx0ZXJzTWFwLmhhcyh0aGlzLmNvbHVtbi5maWVsZE5hbWUpKSB7XG4gICAgICAgIHRoaXMuZmlsdGVyc01hcC5kZWxldGUodGhpcy5jb2x1bW4uZmllbGROYW1lKTtcbiAgICAgICAgdGhpcy5zZXRGaWx0ZXJzRXZlbnQubmV4dCh0aGlzLmZpbHRlcnNNYXApO1xuICAgICAgICB0aGlzLmNvbHVtbkNoYW5nZWQubmV4dCh0aGlzLmNvbHVtbik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmlsdGVyc01hcC5zZXQodGhpcy5jb2x1bW4uZmllbGROYW1lLCB0aGlzLmlucHV0VmFsdWUpO1xuICAgICAgdGhpcy5zZXRGaWx0ZXJzRXZlbnQubmV4dCh0aGlzLmZpbHRlcnNNYXApO1xuICAgICAgdGhpcy5jb2x1bW5DaGFuZ2VkLm5leHQodGhpcy5jb2x1bW4pO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZWxlY3Rpb25DaGFuZ2UoZXZlbnQ6IE1hdFNlbGVjdENoYW5nZSkge1xuICAgIGlmIChldmVudC52YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmZpbHRlcnNNYXAuc2V0KGV2ZW50LnNvdXJjZS5pZCwgZXZlbnQudmFsdWUuam9pbignLCcpKTtcbiAgICAgIHRoaXMuc2V0RmlsdGVyc0V2ZW50Lm5leHQodGhpcy5maWx0ZXJzTWFwKTtcbiAgICAgIHRoaXMuY29sdW1uQ2hhbmdlZC5uZXh0KHRoaXMuY29sdW1uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuZmlsdGVyc01hcC5oYXMoZXZlbnQuc291cmNlLmlkKSkge1xuICAgICAgICB0aGlzLmZpbHRlcnNNYXAuZGVsZXRlKGV2ZW50LnNvdXJjZS5pZCk7XG4gICAgICAgIHRoaXMuc2V0RmlsdGVyc0V2ZW50Lm5leHQodGhpcy5maWx0ZXJzTWFwKTtcbiAgICAgICAgdGhpcy5jb2x1bW5DaGFuZ2VkLm5leHQodGhpcy5jb2x1bW4pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIiwiPGlucHV0ICpuZ0lmPVwiIWNvbHVtbj8uaXNJZEZpZWxkJiYoZHJvcGRvd25WYWx1ZXM/Lmxlbmd0aD09MHx8ZHJvcGRvd25WYWx1ZXM9PW51bGwpXCIgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbCByZXN1bHRsaXN0X19oZWFkZXItLWZpbHRlcnMgcmVzdWx0bGlzdF9faGVhZGVyLS1maWx0ZXJzX197e2NvbHVtbj8uZmllbGROYW1lfX1cIiAoYmx1cik9XCJzZXRGaWx0ZXIoKVwiIChrZXl1cC5lbnRlcik9XCJzZXRGaWx0ZXJPbktleUVudGVyKCRldmVudClcIlxuICAgIFsobmdNb2RlbCldPVwiaW5wdXRWYWx1ZVwiPlxuXG48bWF0LWZvcm0tZmllbGQgKm5nSWY9XCIhY29sdW1uPy5pc0lkRmllbGQmJmRyb3Bkb3duVmFsdWVzPy5sZW5ndGg+MFwiIFxuICAgIGNsYXNzPVwiZm9ybS1jb250cm9sIHJlc3VsdGxpc3RfX2hlYWRlci0tZmlsdGVycyByZXN1bHRsaXN0X19oZWFkZXItLWZpbHRlcnMtLWRyb3Bkb3duIHJlc3VsdGxpc3RfX2hlYWRlci0tZmlsdGVyc19fe3tjb2x1bW4/LmZpZWxkTmFtZX19XCIgXG4gICAgW3N0eWxlLndpZHRoLnB4XT1cImNvbHVtbj8ud2lkdGgtMTBcIj5cbiAgICA8bWF0LXNlbGVjdCBbaWRdPVwiY29sdW1uPy5maWVsZE5hbWVcIiBwbGFjZWhvbGRlcj1cIlwiICBtdWx0aXBsZSBjbGFzcz1cInJlc3VsdGxpc3RfX2Ryb3Bkb3duLXNlbGVjdFwiIFtzdHlsZS53aWR0aC5weF09XCJjb2x1bW4/LndpZHRoLTIwXCIgKHNlbGVjdGlvbkNoYW5nZSk9XCJzZWxlY3Rpb25DaGFuZ2UoJGV2ZW50KVwiIFt2YWx1ZV09XCJzZWxlY3RlZFwiPlxuICAgICAgICA8bWF0LW9wdGlvbiAgY2xhc3M9XCJyZXN1bHRsaXN0X19kcm9wZG93bi1vcHRpb25cIiAqbmdGb3I9XCJsZXQgdmFsdWUgb2YgZHJvcGRvd25WYWx1ZXNcIiAgW3ZhbHVlXT1cInZhbHVlXCI+e3t2YWx1ZX19PC9tYXQtb3B0aW9uPlxuICAgIDwvbWF0LXNlbGVjdD5cbjwvbWF0LWZvcm0tZmllbGQ+XG4iXX0=