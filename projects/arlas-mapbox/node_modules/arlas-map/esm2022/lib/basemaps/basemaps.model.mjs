/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
export class ArlasBasemaps {
    constructor(defaultBasemapStyle, basemapStyles) {
        this.LOCAL_STORAGE_BASEMAPS = 'arlas_last_base_map';
        if (defaultBasemapStyle && basemapStyles) {
            this.defaultBasemapStyle = defaultBasemapStyle;
            this.basemapStyles = basemapStyles;
        }
        else {
            // todo throw error ?
        }
    }
    styles() {
        if (!this._styles) {
            this._styles = this.getAllBasemapStyles(this.defaultBasemapStyle, this.basemapStyles);
        }
        return this._styles.filter(b => !b.errored);
    }
    setSelected(style) {
        this._selectedStyle = style;
        return this;
    }
    getStyle(b) {
        return this.styles().find(s => s.name === b?.name);
    }
    getSelected() {
        if (!this._selectedStyle) {
            const styles = this.styles();
            const localStorageBasemapStyle = JSON.parse(localStorage.getItem(this.LOCAL_STORAGE_BASEMAPS));
            const sameNameBasemaps = localStorageBasemapStyle ? styles.filter(b => b.name === localStorageBasemapStyle.name) : [];
            if (sameNameBasemaps.length > 0) {
                this._selectedStyle = sameNameBasemaps[0];
            }
            else if (!!this.getStyle(this.defaultBasemapStyle)) {
                this._selectedStyle = this.getStyle(this.defaultBasemapStyle);
            }
            else if (styles && styles.length > 0) {
                this._selectedStyle = styles[0];
            }
            else {
                this._selectedStyle = {
                    name: 'Background',
                    styleFile: {
                        version: 8,
                        sources: {},
                        layers: [
                            {
                                id: 'backgrounds',
                                type: 'background',
                                paint: {
                                    'background-color': 'rgba(0,0,0,0)'
                                }
                            }
                        ]
                    }
                };
            }
        }
        return this._selectedStyle;
    }
    getAllBasemapStyles(defaultBasemapTheme, basemapStyles) {
        const allBasemapStyles = new Array();
        if (basemapStyles) {
            basemapStyles.forEach(b => allBasemapStyles.push(b));
            if (defaultBasemapTheme) {
                if (basemapStyles.map(b => b.name).filter(n => n === defaultBasemapTheme.name).length === 0) {
                    allBasemapStyles.push(defaultBasemapTheme);
                }
            }
        }
        else if (defaultBasemapTheme) {
            allBasemapStyles.push(defaultBasemapTheme);
        }
        return allBasemapStyles;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZW1hcHMubW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1tYXAvc3JjL2xpYi9iYXNlbWFwcy9iYXNlbWFwcy5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFJSCxNQUFNLE9BQU8sYUFBYTtJQU94QixZQUFtQixtQkFBa0MsRUFBRSxhQUE4QjtRQU43RSwyQkFBc0IsR0FBRyxxQkFBcUIsQ0FBQztRQU9yRCxJQUFJLG1CQUFtQixJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQ3pDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxtQkFBbUIsQ0FBQztZQUMvQyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNyQyxDQUFDO2FBQU0sQ0FBQztZQUNOLHFCQUFxQjtRQUN2QixDQUFDO0lBQ0gsQ0FBQztJQUVNLE1BQU07UUFDWCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDeEYsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRU0sV0FBVyxDQUFDLEtBQW1CO1FBQ3BDLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO1FBQzVCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVNLFFBQVEsQ0FBQyxDQUFlO1FBQzdCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFTSxXQUFXO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDekIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzdCLE1BQU0sd0JBQXdCLEdBQWlCLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO1lBQzdHLE1BQU0sZ0JBQWdCLEdBQUcsd0JBQXdCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLHdCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdEgsSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ2hDLElBQUksQ0FBQyxjQUFjLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUMsQ0FBQztpQkFBTSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLENBQUM7Z0JBQ3JELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUNoRSxDQUFDO2lCQUFNLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3ZDLElBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLENBQUM7aUJBQU0sQ0FBQztnQkFDTixJQUFJLENBQUMsY0FBYyxHQUFHO29CQUNwQixJQUFJLEVBQUUsWUFBWTtvQkFDbEIsU0FBUyxFQUFFO3dCQUNULE9BQU8sRUFBRSxDQUFDO3dCQUNWLE9BQU8sRUFBRSxFQUFFO3dCQUNYLE1BQU0sRUFBRTs0QkFDTjtnQ0FDRSxFQUFFLEVBQUUsYUFBYTtnQ0FDakIsSUFBSSxFQUFFLFlBQVk7Z0NBQ2xCLEtBQUssRUFBRTtvQ0FDTCxrQkFBa0IsRUFBRSxlQUFlO2lDQUNwQzs2QkFDRjt5QkFDRjtxQkFDRjtpQkFDRixDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUdPLG1CQUFtQixDQUFDLG1CQUFpQyxFQUFFLGFBQTZCO1FBQzFGLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxLQUFLLEVBQWdCLENBQUM7UUFDbkQsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUNsQixhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckQsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO2dCQUN4QixJQUFJLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztvQkFDNUYsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQzdDLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQzthQUFNLElBQUksbUJBQW1CLEVBQUUsQ0FBQztZQUMvQixnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUM3QyxDQUFDO1FBQ0QsT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gR2lzYcOvYSB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvclxuICogbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRS50eHQgZmlsZSBkaXN0cmlidXRlZCB3aXRoXG4gKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodFxuICogb3duZXJzaGlwLiBHaXNhw69hIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byB5b3UgdW5kZXJcbiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXlcbiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQmFzZW1hcFN0eWxlIH0gZnJvbSAnLi9iYXNlbWFwLmNvbmZpZyc7XG5cbmV4cG9ydCBjbGFzcyBBcmxhc0Jhc2VtYXBzIHtcbiAgcHJpdmF0ZSBMT0NBTF9TVE9SQUdFX0JBU0VNQVBTID0gJ2FybGFzX2xhc3RfYmFzZV9tYXAnO1xuICBwdWJsaWMgX3NlbGVjdGVkU3R5bGU6IEJhc2VtYXBTdHlsZTtcbiAgcHVibGljIF9zdHlsZXM6IEJhc2VtYXBTdHlsZVtdO1xuICBwcml2YXRlIGRlZmF1bHRCYXNlbWFwU3R5bGU6IEJhc2VtYXBTdHlsZTtcbiAgcHJpdmF0ZSBiYXNlbWFwU3R5bGVzPzogQmFzZW1hcFN0eWxlW107XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKGRlZmF1bHRCYXNlbWFwU3R5bGU/OiBCYXNlbWFwU3R5bGUsIGJhc2VtYXBTdHlsZXM/OiBCYXNlbWFwU3R5bGVbXSkge1xuICAgIGlmIChkZWZhdWx0QmFzZW1hcFN0eWxlICYmIGJhc2VtYXBTdHlsZXMpIHtcbiAgICAgIHRoaXMuZGVmYXVsdEJhc2VtYXBTdHlsZSA9IGRlZmF1bHRCYXNlbWFwU3R5bGU7XG4gICAgICB0aGlzLmJhc2VtYXBTdHlsZXMgPSBiYXNlbWFwU3R5bGVzO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0b2RvIHRocm93IGVycm9yID9cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3R5bGVzKCk6IEJhc2VtYXBTdHlsZVtdIHtcbiAgICBpZiAoIXRoaXMuX3N0eWxlcykge1xuICAgICAgdGhpcy5fc3R5bGVzID0gdGhpcy5nZXRBbGxCYXNlbWFwU3R5bGVzKHRoaXMuZGVmYXVsdEJhc2VtYXBTdHlsZSwgdGhpcy5iYXNlbWFwU3R5bGVzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3N0eWxlcy5maWx0ZXIoYiA9PiAhYi5lcnJvcmVkKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRTZWxlY3RlZChzdHlsZTogQmFzZW1hcFN0eWxlKSB7XG4gICAgdGhpcy5fc2VsZWN0ZWRTdHlsZSA9IHN0eWxlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHVibGljIGdldFN0eWxlKGI6IEJhc2VtYXBTdHlsZSkge1xuICAgIHJldHVybiB0aGlzLnN0eWxlcygpLmZpbmQocyA9PiBzLm5hbWUgPT09IGI/Lm5hbWUpO1xuICB9XG5cbiAgcHVibGljIGdldFNlbGVjdGVkKCk6IEJhc2VtYXBTdHlsZSB7XG4gICAgaWYgKCF0aGlzLl9zZWxlY3RlZFN0eWxlKSB7XG4gICAgICBjb25zdCBzdHlsZXMgPSB0aGlzLnN0eWxlcygpO1xuICAgICAgY29uc3QgbG9jYWxTdG9yYWdlQmFzZW1hcFN0eWxlOiBCYXNlbWFwU3R5bGUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuTE9DQUxfU1RPUkFHRV9CQVNFTUFQUykpO1xuICAgICAgY29uc3Qgc2FtZU5hbWVCYXNlbWFwcyA9IGxvY2FsU3RvcmFnZUJhc2VtYXBTdHlsZSA/IHN0eWxlcy5maWx0ZXIoYiA9PiBiLm5hbWUgPT09IGxvY2FsU3RvcmFnZUJhc2VtYXBTdHlsZS5uYW1lKSA6IFtdO1xuICAgICAgaWYgKHNhbWVOYW1lQmFzZW1hcHMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLl9zZWxlY3RlZFN0eWxlID0gc2FtZU5hbWVCYXNlbWFwc1swXTtcbiAgICAgIH0gZWxzZSBpZiAoISF0aGlzLmdldFN0eWxlKHRoaXMuZGVmYXVsdEJhc2VtYXBTdHlsZSkpIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0ZWRTdHlsZSA9IHRoaXMuZ2V0U3R5bGUodGhpcy5kZWZhdWx0QmFzZW1hcFN0eWxlKTtcbiAgICAgIH0gZWxzZSBpZiAoc3R5bGVzICYmIHN0eWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuX3NlbGVjdGVkU3R5bGUgPSBzdHlsZXNbMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9zZWxlY3RlZFN0eWxlID0ge1xuICAgICAgICAgIG5hbWU6ICdCYWNrZ3JvdW5kJyxcbiAgICAgICAgICBzdHlsZUZpbGU6IHtcbiAgICAgICAgICAgIHZlcnNpb246IDgsXG4gICAgICAgICAgICBzb3VyY2VzOiB7fSxcbiAgICAgICAgICAgIGxheWVyczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6ICdiYWNrZ3JvdW5kcycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2JhY2tncm91bmQnLFxuICAgICAgICAgICAgICAgIHBhaW50OiB7XG4gICAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6ICdyZ2JhKDAsMCwwLDApJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkU3R5bGU7XG4gIH1cblxuXG4gIHByaXZhdGUgZ2V0QWxsQmFzZW1hcFN0eWxlcyhkZWZhdWx0QmFzZW1hcFRoZW1lOiBCYXNlbWFwU3R5bGUsIGJhc2VtYXBTdHlsZXM6IEJhc2VtYXBTdHlsZVtdKTogQXJyYXk8QmFzZW1hcFN0eWxlPiB7XG4gICAgY29uc3QgYWxsQmFzZW1hcFN0eWxlcyA9IG5ldyBBcnJheTxCYXNlbWFwU3R5bGU+KCk7XG4gICAgaWYgKGJhc2VtYXBTdHlsZXMpIHtcbiAgICAgIGJhc2VtYXBTdHlsZXMuZm9yRWFjaChiID0+IGFsbEJhc2VtYXBTdHlsZXMucHVzaChiKSk7XG4gICAgICBpZiAoZGVmYXVsdEJhc2VtYXBUaGVtZSkge1xuICAgICAgICBpZiAoYmFzZW1hcFN0eWxlcy5tYXAoYiA9PiBiLm5hbWUpLmZpbHRlcihuID0+IG4gPT09IGRlZmF1bHRCYXNlbWFwVGhlbWUubmFtZSkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgYWxsQmFzZW1hcFN0eWxlcy5wdXNoKGRlZmF1bHRCYXNlbWFwVGhlbWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkZWZhdWx0QmFzZW1hcFRoZW1lKSB7XG4gICAgICBhbGxCYXNlbWFwU3R5bGVzLnB1c2goZGVmYXVsdEJhc2VtYXBUaGVtZSk7XG4gICAgfVxuICAgIHJldHVybiBhbGxCYXNlbWFwU3R5bGVzO1xuICB9XG59XG5cblxuXG4iXX0=