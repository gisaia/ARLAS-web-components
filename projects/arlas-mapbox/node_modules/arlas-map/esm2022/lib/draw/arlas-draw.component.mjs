/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { Component, EventEmitter, HostListener, Input, Output, signal, ViewEncapsulation } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { MatSnackBar } from '@angular/material/snack-bar';
import { marker } from '@colsen1991/ngx-translate-extract-marker';
import StaticMode from '@mapbox/mapbox-gl-draw-static-mode';
import { TranslateService } from '@ngx-translate/core';
import centroid from '@turf/centroid';
import cleanCoords from '@turf/clean-coords';
import { polygon } from '@turf/helpers';
import { ArlasMapFrameworkService } from '../arlas-map-framework.service';
import { AbstractArlasMapService } from '../arlas-map.service';
import { AbstractArlasMapGL } from '../map/AbstractArlasMapGL';
import { latLngToWKT } from '../map/tools';
import { MapboxAoiDrawService } from './draw.service';
import { limitVertexDirectSelectMode } from './modes/LimitVertexDirectSelectMode';
import { validGeomDrawPolygonMode } from './modes/ValidGeomDrawPolygonMode';
import { circleMode } from './modes/circles/circle.mode';
import { radiusCircleMode } from './modes/circles/radius.circle.mode';
import { directModeOverride } from './modes/directSelectOverride';
import { rectangleMode } from './modes/rectangleMode';
import { simpleSelectModeOverride } from './modes/simpleSelectOverride';
import { stripDirectSelectMode } from './modes/strip/strip.direct.mode';
import { stripMode } from './modes/strip/strip.mode';
import * as styles from './themes/default-theme';
import * as i0 from "@angular/core";
import * as i1 from "./draw.service";
import * as i2 from "@angular/material/snack-bar";
import * as i3 from "@ngx-translate/core";
import * as i4 from "../arlas-map-framework.service";
import * as i5 from "../arlas-map.service";
/** L: a layer class/interface.
 *  S: a source class/interface.
 *  M: a Map configuration class/interface.
 */
export class ArlasDrawComponent {
    constructor(drawService, _snackBar, translate, mapFrameworkService, mapService) {
        this.drawService = drawService;
        this._snackBar = _snackBar;
        this.translate = translate;
        this.mapFrameworkService = mapFrameworkService;
        this.mapService = mapService;
        this.emptyData = {
            'type': 'FeatureCollection',
            'features': []
        };
        /**  @description Options object for draw tools : https://github.com/mapbox/mapbox-gl-draw/blob/master/docs/API.md#options */
        this.drawOption = {};
        /** @description Features drawn at component start */
        this.drawData = ({ ...this.emptyData });
        /** @description Whether the draw tools are activated. */
        this.drawButtonEnabled = false;
        /** @description Whether the drawing buffer is activated */
        /** If true, the map's canvas can be exported to a PNG using map.getCanvas().toDataURL(). Default: false */
        this.preserveDrawingBuffer = false;
        /** @description Emits the geojson of an aoi added to the map. */
        this.onAoiChanged = new EventEmitter();
        /** @description Emits the the dimensions of the polygon/bbox that is being drawn. */
        this.onAoiEdit = new EventEmitter();
        /** Number of drawn vertices (incremented in draw mode). Reset to 0 when the drawing is finished. */
        this.nbPolygonVertices = 0;
        /** Number of clicks while drawing a geometry. */
        this.drawClickCounter = 0;
        /** List of drawn polygons centroid */
        this.polygonlabeldata = ({ ...this.emptyData });
        /** Drawn geometry's state when editing/updating. */
        this.savedEditFeature = null;
        /** Message shown to explain how to draw. */
        this.drawTooltipMessage = signal('');
        this.mouseMoveForDraw = (e) => {
            const x = e.clientX;
            const y = e.clientY;
            this.drawTooltipElement.style.top = (y + 20) + 'px';
            this.drawTooltipElement.style.left = (x + 20) + 'px';
        };
        this.drawService.editAoi$.pipe(takeUntilDestroyed()).subscribe(ae => this.onAoiEdit.emit(ae));
        this.drawService.drawBbox$.pipe(takeUntilDestroyed()).subscribe({
            next: (bboxDC) => {
                this.drawBbox(bboxDC.east, bboxDC.south, bboxDC.west, bboxDC.north);
            }
        });
    }
    /**
     * @description Stops the drawing mode by changing to static mode.
     */
    stopDrawingAtVerticeLimit() {
        if (this.nbPolygonVertices === this.drawPolygonVerticesLimit) {
            this.draw.changeMode('static');
            this.drawService.isDrawingPolygon = false;
            this.nbPolygonVertices = 0;
            this.drawClickCounter = 0;
        }
    }
    listenToDrawOnCreate() {
        this.draw.on('draw.create', (e) => {
            this.onAoiChanged.next({
                'type': 'FeatureCollection',
                'features': this.draw.getAllFeatures().filter(fc => this.drawService.isValidPolygon(fc) ||
                    this.drawService.isValidCircle(fc)).map(f => cleanCoords(f))
            });
        });
    }
    listenToDrawUpdate() {
        this.draw.on('draw.update', (e) => {
            if (e) {
                const features = e.features;
                if (features && features.length > 0) {
                    this.savedEditFeature = { ...features[0] };
                    this.savedEditFeature.coordinates = [[]];
                    features[0].geometry.coordinates[0].forEach(f => this.savedEditFeature.coordinates[0].push(f));
                }
            }
        });
    }
    listenToDrawDelete() {
        this.draw.on('draw.delete', (e) => {
            this.onAoiChanged.next({
                'type': 'FeatureCollection',
                'features': this.draw.getAllFeatures().filter(fc => this.drawService.isPolygon(fc) ||
                    this.drawService.isCircle(fc)).map(f => cleanCoords(f))
            });
        });
    }
    listenToDrawInvalidGeometry() {
        this.draw.onDrawInvalidGeometry((e) => {
            if (this.savedEditFeature) {
                const featureCoords = this.savedEditFeature.coordinates[0].slice();
                if (featureCoords[0][0] !== featureCoords[featureCoords.length - 1][0] ||
                    featureCoords[0][1] !== featureCoords[featureCoords.length - 1][1]) {
                    featureCoords.push(featureCoords[0]);
                }
                const currentFeature = {
                    id: '',
                    type: 'Feature',
                    geometry: {
                        'type': 'Polygon',
                        'coordinates': [featureCoords]
                    },
                    properties: {}
                };
                currentFeature.id = this.savedEditFeature.id;
                currentFeature.properties = this.savedEditFeature.properties;
                this.draw.add(currentFeature);
            }
            this.openInvalidGeometrySnackBar();
            this.mapFrameworkService.setMapCursor(this.map, '');
        });
    }
    listenToDrawSelectionChange() {
        this.draw.onDrawSelectionchange((e) => {
            if (e.features.length > 0) {
                this.drawService.isDrawSelected = true;
            }
            else {
                this.savedEditFeature = null;
                this.drawService.isDrawSelected = false;
                this.onAoiChanged.next({
                    'type': 'FeatureCollection',
                    'features': this.draw.getAllFeatures().filter(fc => this.drawService.isValidPolygon(fc) ||
                        this.drawService.isValidCircle(fc)).map(f => cleanCoords(f))
                });
                this.switchToStaticMode();
                this.mapFrameworkService.setMapCursor(this.map, '');
            }
        });
    }
    listenToDrawModeChange() {
        this.draw.onDrawModeChange((e) => {
            this.updateTooltipMessage();
            this.drawService.isDrawingPolygon = e.mode === this.draw.getMode('DRAW_POLYGON');
            this.drawService.isDrawingStrip = e.mode === this.draw.getMode('DRAW_STRIP') || e.mode === this.draw.getMode('DIRECT_STRIP');
            this.drawService.isDrawingCircle = e.mode === this.draw.getMode('DRAW_CIRCLE') || e.mode === this.draw.getMode('DRAW_RADIUS_CIRCLE');
            this.drawService.isDrawingBbox = e.mode === this.draw.getMode('DRAW_RECTANGLE');
            if (this.drawService.isDrawingPolygon || this.drawService.isDrawingCircle || this.drawService.isDrawingStrip || e.mode === 'static') {
                this.drawService.isInSimpleDrawMode = false;
            }
            if (e.mode === 'simple_select') {
                this.drawService.isInSimpleDrawMode = true;
            }
            else if (e.mode === 'static') {
                this.mapFrameworkService.setMapCursor(this.map, '');
            }
            else if (e.mode === 'direct_select') {
                const selectedFeatures = this.draw.getSelectedFeatures();
                const selectedIds = this.draw.getSelectedIds();
                if (selectedFeatures && selectedIds && selectedIds.length > 0) {
                    if (selectedFeatures[0].properties.source === 'bbox') {
                        this.draw.changeMode('simple_select', {
                            featureIds: [selectedIds[0]]
                        });
                        this.drawService.isInSimpleDrawMode = true;
                    }
                    else if (this.drawPolygonVerticesLimit && selectedFeatures[0].properties.meta !== 'strip') {
                        this.draw.changeMode('limit_vertex', {
                            featureId: selectedIds[0],
                            maxVertexByPolygon: this.drawPolygonVerticesLimit,
                            selectedCoordPaths: selectedFeatures[0].geometry.coordinates
                        });
                        this.drawService.isInSimpleDrawMode = false;
                    }
                    else if (this.drawPolygonVerticesLimit && selectedFeatures[0].properties.meta === 'strip') {
                        this.draw.changeMode('direct_strip', {
                            featureId: selectedIds[0],
                            maxLength: selectedFeatures[0].properties.maxLength,
                            halfSwath: selectedFeatures[0].properties.halfSwath,
                        });
                        this.drawService.isInSimpleDrawMode = false;
                    }
                }
                else {
                    this.drawService.isInSimpleDrawMode = false;
                    this.mapFrameworkService.setMapCursor(this.map, '');
                }
            }
        });
    }
    ngOnInit() {
        this.drawTooltipElement = document.getElementById('arlas-draw-tooltip');
        const drawStyles = styles.default;
        const drawOptions = {
            ...this.drawOption,
            ...{
                styles: drawStyles,
                modes: {
                    static: StaticMode,
                    limit_vertex: limitVertexDirectSelectMode,
                    draw_polygon: validGeomDrawPolygonMode,
                    draw_circle: circleMode,
                    draw_radius_circle: radiusCircleMode,
                    draw_strip: stripMode,
                    direct_strip: stripDirectSelectMode,
                    draw_rectangle: rectangleMode,
                    direct_select: directModeOverride,
                    simple_select: simpleSelectModeOverride
                },
                suppressAPIEvents: true
            }
        };
        this.draw = this.mapFrameworkService.createDraw(drawOptions, this.drawButtonEnabled, this.map);
        this.draw.setMode('DRAW_CIRCLE', 'draw_circle');
        this.draw.setMode('DRAW_RADIUS_CIRCLE', 'draw_radius_circle');
        this.draw.setMode('DRAW_STRIP', 'draw_strip');
        this.draw.setMode('STATIC', 'static');
        this.draw.setMode('DIRECT_STRIP', 'direct_strip');
        this.draw.setMode('DRAW_RECTANGLE', 'draw_rectangle');
        const drawControlConfig = {
            draw: { control: this.draw },
            addGeoBox: {
                enable: true,
                overrideEvent: {
                    event: 'click',
                    fn: this.addGeoBox
                }
            },
            removeAois: {
                enable: true,
                overrideEvent: { event: 'click', fn: this.removeAois }
            }
        };
        this.map.initDrawControls(drawControlConfig);
        this.drawService.setDraw(this.draw);
        this.mapFrameworkService.onMapEvent('load', this.map, () => {
            this.mapService.declareLabelSources('', this.polygonlabeldata, this.map);
            this.switchToStaticMode();
            this.canvas = this.map.getCanvasContainer();
            this.listenToDrawOnCreate();
            this.listenToDrawUpdate();
            this.listenToDrawDelete();
            this.canvas.addEventListener('mousemove', this.mouseMoveForDraw, true);
            this.draw.onDrawOnStart((e) => {
                this.drawClickCounter = 0;
                this.mapFrameworkService.setMapCursor(this.map, '');
            });
            this.draw.onDrawOnStop((e) => {
                this.drawClickCounter = 0;
                this.mapFrameworkService.setMapCursor(this.map, '');
            });
            this.listenToDrawInvalidGeometry();
            this.draw.onDrawEditSaveInitialFeature((edition) => {
                this.savedEditFeature = { ...edition.feature };
                this.savedEditFeature.coordinates = [[]];
                edition.feature.coordinates[0].forEach(c => this.savedEditFeature.coordinates[0].push(c));
            });
            this.listenToDrawSelectionChange();
            this.listenToDrawModeChange();
            this.mapFrameworkService.onMapEvent('click', this.map, (e) => {
                if (this.drawService.isDrawing()) {
                    this.drawClickCounter++;
                    this.updateTooltipMessage();
                }
                if (this.drawService.isDrawingCircle) {
                    return;
                }
                if (this.drawService.isDrawingPolygon) {
                    this.nbPolygonVertices++;
                    this.stopDrawingAtVerticeLimit();
                }
                else {
                    this.nbPolygonVertices = 0;
                    const features = this.map.queryRenderedFeatures(e.point);
                    // edit polygon condition : no arlas feature && mapbox-gl-draw source present
                    const editCondition = features.filter(f => f.layer.id?.indexOf('arlas') >= 0).length === 0 &&
                        features.filter(f => f.source.startsWith('mapbox-gl-draw')).length > 0;
                    if (editCondition) {
                        const candidates = features.filter(f => f.source.startsWith('mapbox-gl-draw'));
                        // edit only on click on the border of the polygon
                        const candidatesProperties = candidates.filter(f => f.layer.id?.indexOf('stroke') >= 0)[0]?.properties;
                        if (candidatesProperties?.id) {
                            if (candidatesProperties.user_meta === 'strip') {
                                this.draw.changeMode('direct_strip', {
                                    featureId: candidatesProperties.id,
                                    maxLength: candidatesProperties.user_maxLength,
                                    halfSwath: candidatesProperties.user_halfSwath
                                });
                                this.drawService.isInSimpleDrawMode = false;
                            }
                            else {
                                this.draw.changeMode('simple_select', {
                                    featureIds: [candidatesProperties.id]
                                });
                                this.drawService.isInSimpleDrawMode = true;
                            }
                        }
                    }
                }
            });
        });
        this.mapFrameworkService.onMapEvent('mousemove', this.map, (e) => {
            if (this.drawService.isDrawingBbox || this.drawService.isDrawingPolygon) {
                this.mapFrameworkService.setMapCursor(this.map, 'crosshair');
                this.map.moveLngLat = e.lngLat;
            }
        });
    }
    ngOnChanges(changes) {
        if (this.map && this.map.getMapProvider() !== undefined) {
            if (changes['drawData'] !== undefined && this.drawService.isReady) {
                const centroides = new Array();
                this.drawData.features.forEach(feature => {
                    const poly = polygon(feature.geometry.coordinates);
                    const cent = centroid(poly);
                    cent.properties.arlas_id = feature.properties.arlas_id;
                    centroides.push(cent);
                });
                this.polygonlabeldata = {
                    type: 'FeatureCollection',
                    features: centroides
                };
                this.drawService.addFeatures(this.drawData, /** deleteOld */ true);
                this.mapService.updateLabelSources(this.map.POLYGON_LABEL_SOURCE, this.polygonlabeldata, this.map);
            }
        }
    }
    /**
     * Update the tooltip message when drawing to reflect drawing mode and state
     */
    updateTooltipMessage() {
        let tooltipMessage;
        switch (this.draw.getCurrentMode().toLocaleUpperCase()) {
            case 'DRAW_RADIUS_CIRCLE':
                if (this.drawClickCounter === 0) {
                    tooltipMessage = marker('Click to set the center of the circle');
                }
                else {
                    tooltipMessage = marker('Click again to set the radius of the circle');
                }
                break;
            case 'DRAW_POLYGON':
                if (this.drawClickCounter < 2) {
                    tooltipMessage = marker('Click to set a corner of the polygon');
                }
                else {
                    tooltipMessage = marker('Double click to finish drawing');
                }
                break;
            case 'DRAW_CIRCLE':
                tooltipMessage = marker('Click to create a circle centered on this point');
                break;
            case 'DRAW_STRIP':
                if (this.drawClickCounter === 0) {
                    tooltipMessage = marker('Click to set the origin of the strip');
                }
                else {
                    tooltipMessage = marker('Click again to set the length and bearing of the strip');
                }
                break;
            case 'DRAW_RECTANGLE':
                if (this.drawClickCounter === 0) {
                    tooltipMessage = marker('Click to set the first corner of the rectangle');
                }
                else {
                    tooltipMessage = marker('Click again to complete the rectangle');
                }
                break;
            case 'STATIC':
            case 'SIMPLE_SELECT':
                this.drawClickCounter = 0;
                break;
            default:
                break;
        }
        this.drawTooltipMessage.set(tooltipMessage);
    }
    /**
     * @description Emits the bbox drawn by the BboxGenerator component
     * @param east
     * @param south
     * @param west
     * @param north
     */
    drawBbox(east, south, west, north) {
        const coordinates = [[
                [east, south],
                [east, north],
                [west, north],
                [west, south],
                [east, south],
            ]];
        const polygonGeojson = {
            type: 'Feature',
            properties: {
                source: 'bbox'
            },
            geometry: {
                type: 'Polygon',
                coordinates: coordinates
            }
        };
        const geoboxdata = { ...this.emptyData };
        geoboxdata.features = [];
        if (this.drawData?.features && this.drawData.features.length > 0) {
            this.drawData.features.forEach(df => geoboxdata.features.push(df));
        }
        geoboxdata.features.push(polygonGeojson);
        /** This allows to keep the drawn box on the map. It will be overriden in ngOnChanges `changes['drawData']` */
        this.drawService.addFeatures(geoboxdata, /** deleteOld */ true);
        this.onAoiChanged.next(geoboxdata);
        this.drawService.isDrawingBbox = false;
        this.drawService.endDimensionsEmission();
    }
    /** @description Enables bbox drawing mode.*/
    addGeoBox() {
        this.mapFrameworkService.setMapCursor(this.map, 'crosshair');
        this.switchToDrawMode('draw_rectangle');
    }
    /**
     * @description Removes all the aois if none of them is selected. Otherwise it removes the selected one only
     */
    removeAois() {
        this.mapFrameworkService.setMapCursor(this.map, '');
        this.drawService.isDrawingBbox = false;
        this.deleteSelectedItem();
    }
    /** @description Deletes the selected drawn geometry. If no drawn geometry is selected, all geometries are deteleted */
    deleteSelectedItem() {
        if (this.drawService.isDrawSelected) {
            this.draw.trash();
        }
        else {
            this.drawService.deleteAll();
        }
        this.drawService.isDrawSelected = false;
        this.onAoiChanged.next(this.draw.getAll());
    }
    /**
     * @description Shows an invalid-geometry error on a snack bar.
     */
    openInvalidGeometrySnackBar() {
        this._snackBar.open(this.translate.instant('Invalid geometry'), this.translate.instant('Ok'), {
            duration: 3 * 1000,
            verticalPosition: 'top',
            panelClass: 'invalid-geo-toast'
        });
    }
    /**
     * @description Switches to a drawing mode of a polygon, circle, radius circle or strip.
     * @param mode Draw mode (DRAW_POLYGON, DRAW_CIRCLE, DRAW_RADIUS_CIRCLE or DRAW_STRIP). Default to DRAW_POLYGON
     * @param option Mapboxdraw option.
     */
    switchToDrawMode(mode, option) {
        const selectedMode = mode ?? this.draw.getMode('DRAW_POLYGON');
        this.drawService.isDrawingCircle = selectedMode === this.draw.getMode('DRAW_CIRCLE')
            || selectedMode === this.draw.getMode('DRAW_RADIUS_CIRCLE');
        this.drawService.isDrawingPolygon = selectedMode === this.draw.getMode('DRAW_POLYGON');
        this.drawService.isDrawingStrip = selectedMode === this.draw.getMode('DRAW_STRIP');
        this.drawService.isDrawingBbox = selectedMode === this.draw.getMode('DRAW_RECTANGLE');
        this.drawService.isInSimpleDrawMode = false;
        this.mapFrameworkService.setMapCursor(this.map, 'crosshair');
        this.draw.changeMode(selectedMode, option ?? {});
        this.updateTooltipMessage();
    }
    /**
     * @description Switches to direct_select mode.
     * @param option Mapboxdraw option.
     */
    switchToDirectSelectMode(option) {
        this.draw.changeMode('direct_select', option);
        this.drawService.isInSimpleDrawMode = false;
        this.drawService.isDrawingCircle = false;
        this.drawService.isDrawingStrip = false;
        this.drawService.isDrawingPolygon = false;
        this.drawService.isDrawingBbox = false;
    }
    /**
     * @description Switches to simple_select mode.
     */
    switchToEditMode() {
        this.draw.changeMode('simple_select', {
            featureIds: this.draw.getAll().features.map(f => f.id)
        });
        this.drawService.isInSimpleDrawMode = true;
        this.drawService.isDrawingCircle = false;
        this.drawService.isDrawingStrip = false;
        this.drawService.isDrawingPolygon = false;
        this.drawService.isDrawingBbox = false;
    }
    /**
     * @description Switches to static mode.
     */
    switchToStaticMode() {
        this.draw.changeMode('static');
        this.drawService.isInSimpleDrawMode = false;
        this.drawService.isDrawingBbox = false;
        this.drawService.isDrawingCircle = false;
        this.drawService.isDrawingStrip = false;
        this.drawService.isDrawingPolygon = false;
        this.updateTooltipMessage();
    }
    /**
     * @description Returns all the drawn polygons as wkt or geojson.
     * @param mode 'wkt' | 'geojson'
     * @returns
     */
    getAllPolygon(mode) {
        let polygon;
        if (mode === 'wkt') {
            polygon = latLngToWKT(this.draw.getAll().features.filter(f => this.drawService.isPolygon(f) ||
                this.drawService.isCircle(f)).map(f => cleanCoords(f)));
        }
        else {
            polygon = {
                'type': 'FeatureCollection',
                'features': this.draw.getAll().features.filter(f => this.drawService.isPolygon(f) ||
                    this.drawService.isCircle(f)).map(f => cleanCoords(f))
            };
        }
        return polygon;
    }
    /**
     * @returns the selected polygon geometry in WKT or GeoJson given the mode
     * @param mode : 'wkt' | 'geojson'
     * @returns Wkt string or Geojson object.
     */
    getSelectedPolygon(mode) {
        let polygon;
        if (mode === 'wkt') {
            polygon = latLngToWKT(this.draw.getSelected().features.filter(f => this.drawService.isPolygon(f) ||
                this.drawService.isCircle(f)));
        }
        else {
            polygon = {
                'type': 'FeatureCollection',
                'features': this.draw.getSelected().features.filter(f => this.drawService.isPolygon(f) ||
                    this.drawService.isCircle(f))
            };
        }
        return polygon;
    }
    handleKeyboardEvent(event) {
        if (event.key === 'Escape') {
            if (this.drawService.isDrawing()) {
                this.drawService.deleteUnregisteredFeatures();
                this.mapFrameworkService.setMapCursor(this.map, '');
                this.switchToStaticMode();
                this.drawService.endDimensionsEmission();
            }
            else if (this.drawService.isInSimpleDrawMode) {
                this.drawService.isInSimpleDrawMode = false;
                this.draw.changeMode('simple_select', { featureIds: [] });
                this.updateTooltipMessage();
            }
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ArlasDrawComponent, deps: [{ token: i1.MapboxAoiDrawService }, { token: i2.MatSnackBar }, { token: i3.TranslateService }, { token: i4.ArlasMapFrameworkService }, { token: i5.AbstractArlasMapService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: ArlasDrawComponent, selector: "arlas-draw", inputs: { map: "map", emptyData: "emptyData", drawOption: "drawOption", drawData: "drawData", drawButtonEnabled: "drawButtonEnabled", drawPolygonVerticesLimit: "drawPolygonVerticesLimit", preserveDrawingBuffer: "preserveDrawingBuffer" }, outputs: { onAoiChanged: "onAoiChanged", onAoiEdit: "onAoiEdit" }, host: { listeners: { "document:keydown": "handleKeyboardEvent($event)" } }, usesOnChanges: true, ngImport: i0, template: "<div id=\"arlas-draw-tooltip\" class=\"draw-tooltip--hide\" [class.draw-tooltip--show]=\"drawTooltipMessage()\">\n    {{drawTooltipMessage() | translate}}</div>", styles: ["@charset \"UTF-8\";\n"], dependencies: [{ kind: "pipe", type: i3.TranslatePipe, name: "translate" }], encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ArlasDrawComponent, decorators: [{
            type: Component,
            args: [{ selector: 'arlas-draw', encapsulation: ViewEncapsulation.None, template: "<div id=\"arlas-draw-tooltip\" class=\"draw-tooltip--hide\" [class.draw-tooltip--show]=\"drawTooltipMessage()\">\n    {{drawTooltipMessage() | translate}}</div>", styles: ["@charset \"UTF-8\";\n"] }]
        }], ctorParameters: () => [{ type: i1.MapboxAoiDrawService }, { type: i2.MatSnackBar }, { type: i3.TranslateService }, { type: i4.ArlasMapFrameworkService }, { type: i5.AbstractArlasMapService }], propDecorators: { map: [{
                type: Input
            }], emptyData: [{
                type: Input
            }], drawOption: [{
                type: Input
            }], drawData: [{
                type: Input
            }], drawButtonEnabled: [{
                type: Input
            }], drawPolygonVerticesLimit: [{
                type: Input
            }], preserveDrawingBuffer: [{
                type: Input
            }], onAoiChanged: [{
                type: Output
            }], onAoiEdit: [{
                type: Output
            }], handleKeyboardEvent: [{
                type: HostListener,
                args: ['document:keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJsYXMtZHJhdy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1tYXAvc3JjL2xpYi9kcmF3L2FybGFzLWRyYXcuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtbWFwL3NyYy9saWIvZHJhdy9hcmxhcy1kcmF3LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFFLE1BQU0sRUFBaUIsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkksT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNsRSxPQUFPLFVBQVUsTUFBTSxvQ0FBb0MsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLFFBQVEsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0QyxPQUFPLFdBQVcsTUFBTSxvQkFBb0IsQ0FBQztBQUM3QyxPQUFPLEVBQWlELE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUcvRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRzNDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFN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QkEsbUJBQW1CO3NCQUR6QixZQUFZO3VCQUFDLGtCQUFrQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIEdpc2HDr2EgdW5kZXIgb25lIG9yIG1vcmUgY29udHJpYnV0b3JcbiAqIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UudHh0IGZpbGUgZGlzdHJpYnV0ZWQgd2l0aFxuICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHRcbiAqIG93bmVyc2hpcC4gR2lzYcOvYSBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyXG4gKiB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5XG4gKiBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgc2lnbmFsLCBTaW1wbGVDaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsRGVzdHJveWVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuaW1wb3J0IHsgTWF0U25hY2tCYXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9zbmFjay1iYXInO1xuaW1wb3J0IHsgbWFya2VyIH0gZnJvbSAnQGNvbHNlbjE5OTEvbmd4LXRyYW5zbGF0ZS1leHRyYWN0LW1hcmtlcic7XG5pbXBvcnQgU3RhdGljTW9kZSBmcm9tICdAbWFwYm94L21hcGJveC1nbC1kcmF3LXN0YXRpYy1tb2RlJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCBjZW50cm9pZCBmcm9tICdAdHVyZi9jZW50cm9pZCc7XG5pbXBvcnQgY2xlYW5Db29yZHMgZnJvbSAnQHR1cmYvY2xlYW4tY29vcmRzJztcbmltcG9ydCB7IEZlYXR1cmUsIEZlYXR1cmVDb2xsZWN0aW9uLCBHZW9tZXRyeSwgUG9seWdvbiwgcG9seWdvbiB9IGZyb20gJ0B0dXJmL2hlbHBlcnMnO1xuaW1wb3J0IHsgQXJsYXNNYXBGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnLi4vYXJsYXMtbWFwLWZyYW1ld29yay5zZXJ2aWNlJztcbmltcG9ydCB7IEFic3RyYWN0QXJsYXNNYXBTZXJ2aWNlIH0gZnJvbSAnLi4vYXJsYXMtbWFwLnNlcnZpY2UnO1xuaW1wb3J0IHsgQWJzdHJhY3RBcmxhc01hcEdMIH0gZnJvbSAnLi4vbWFwL0Fic3RyYWN0QXJsYXNNYXBHTCc7XG5pbXBvcnQgeyBEcmF3Q29udHJvbHNPcHRpb24gfSBmcm9tICcuLi9tYXAvbW9kZWwvY29udHJvbHMnO1xuaW1wb3J0IHsgTWFwTW91c2VFdmVudCB9IGZyb20gJy4uL21hcC9tb2RlbC9ldmVudHMnO1xuaW1wb3J0IHsgbGF0TG5nVG9XS1QgfSBmcm9tICcuLi9tYXAvdG9vbHMnO1xuaW1wb3J0IHsgQWJzdHJhY3REcmF3LCBEcmF3TW9kZXMgfSBmcm9tICcuL0Fic3RyYWN0RHJhdyc7XG5pbXBvcnQgeyBBb2lEaW1lbnNpb25zLCBCYm94RHJhd0NvbW1hbmQgfSBmcm9tICcuL2RyYXcubW9kZWxzJztcbmltcG9ydCB7IE1hcGJveEFvaURyYXdTZXJ2aWNlIH0gZnJvbSAnLi9kcmF3LnNlcnZpY2UnO1xuaW1wb3J0IHsgbGltaXRWZXJ0ZXhEaXJlY3RTZWxlY3RNb2RlIH0gZnJvbSAnLi9tb2Rlcy9MaW1pdFZlcnRleERpcmVjdFNlbGVjdE1vZGUnO1xuaW1wb3J0IHsgdmFsaWRHZW9tRHJhd1BvbHlnb25Nb2RlIH0gZnJvbSAnLi9tb2Rlcy9WYWxpZEdlb21EcmF3UG9seWdvbk1vZGUnO1xuaW1wb3J0IHsgY2lyY2xlTW9kZSB9IGZyb20gJy4vbW9kZXMvY2lyY2xlcy9jaXJjbGUubW9kZSc7XG5pbXBvcnQgeyByYWRpdXNDaXJjbGVNb2RlIH0gZnJvbSAnLi9tb2Rlcy9jaXJjbGVzL3JhZGl1cy5jaXJjbGUubW9kZSc7XG5pbXBvcnQgeyBkaXJlY3RNb2RlT3ZlcnJpZGUgfSBmcm9tICcuL21vZGVzL2RpcmVjdFNlbGVjdE92ZXJyaWRlJztcbmltcG9ydCB7IHJlY3RhbmdsZU1vZGUgfSBmcm9tICcuL21vZGVzL3JlY3RhbmdsZU1vZGUnO1xuaW1wb3J0IHsgc2ltcGxlU2VsZWN0TW9kZU92ZXJyaWRlIH0gZnJvbSAnLi9tb2Rlcy9zaW1wbGVTZWxlY3RPdmVycmlkZSc7XG5pbXBvcnQgeyBzdHJpcERpcmVjdFNlbGVjdE1vZGUgfSBmcm9tICcuL21vZGVzL3N0cmlwL3N0cmlwLmRpcmVjdC5tb2RlJztcbmltcG9ydCB7IHN0cmlwTW9kZSB9IGZyb20gJy4vbW9kZXMvc3RyaXAvc3RyaXAubW9kZSc7XG5pbXBvcnQgKiBhcyBzdHlsZXMgZnJvbSAnLi90aGVtZXMvZGVmYXVsdC10aGVtZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FybGFzLWRyYXcnLFxuICB0ZW1wbGF0ZVVybDogJy4vYXJsYXMtZHJhdy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2FybGFzLWRyYXcuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbi8qKiBMOiBhIGxheWVyIGNsYXNzL2ludGVyZmFjZS5cbiAqICBTOiBhIHNvdXJjZSBjbGFzcy9pbnRlcmZhY2UuXG4gKiAgTTogYSBNYXAgY29uZmlndXJhdGlvbiBjbGFzcy9pbnRlcmZhY2UuXG4gKi9cbmV4cG9ydCBjbGFzcyBBcmxhc0RyYXdDb21wb25lbnQ8TCwgUywgTT4gaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIHB1YmxpYyBtYXA6IEFic3RyYWN0QXJsYXNNYXBHTDtcblxuICBASW5wdXQoKSBwcml2YXRlIGVtcHR5RGF0YTogRmVhdHVyZUNvbGxlY3Rpb248R2VvSlNPTi5HZW9tZXRyeT4gPSB7XG4gICAgJ3R5cGUnOiAnRmVhdHVyZUNvbGxlY3Rpb24nLFxuICAgICdmZWF0dXJlcyc6IFtdXG4gIH07XG4gIC8qKiAgQGRlc2NyaXB0aW9uIE9wdGlvbnMgb2JqZWN0IGZvciBkcmF3IHRvb2xzIDogaHR0cHM6Ly9naXRodWIuY29tL21hcGJveC9tYXBib3gtZ2wtZHJhdy9ibG9iL21hc3Rlci9kb2NzL0FQSS5tZCNvcHRpb25zICovXG4gIEBJbnB1dCgpIHB1YmxpYyBkcmF3T3B0aW9uOiBhbnkgPSB7fTtcbiAgLyoqIERyYXcgaW5zdGFuY2UuICovXG4gIHB1YmxpYyBkcmF3OiBBYnN0cmFjdERyYXc7XG4gIC8qKiBAZGVzY3JpcHRpb24gRmVhdHVyZXMgZHJhd24gYXQgY29tcG9uZW50IHN0YXJ0ICovXG4gIEBJbnB1dCgpIHB1YmxpYyBkcmF3RGF0YTogRmVhdHVyZUNvbGxlY3Rpb248R2VvSlNPTi5HZW9tZXRyeT4gPSAoeyAuLi50aGlzLmVtcHR5RGF0YSB9KTtcbiAgLyoqIEBkZXNjcmlwdGlvbiBXaGV0aGVyIHRoZSBkcmF3IHRvb2xzIGFyZSBhY3RpdmF0ZWQuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBkcmF3QnV0dG9uRW5hYmxlZCA9IGZhbHNlO1xuICAvKiogQGRlc2NyaXB0aW9uIE1heGltdW0gbnVtYmVyIG9mIHZlcnRpY2VzIGFsbG93ZWQgZm9yIGEgcG9seWdvbi4gKi9cbiAgQElucHV0KCkgcHVibGljIGRyYXdQb2x5Z29uVmVydGljZXNMaW1pdDogbnVtYmVyO1xuICAvKiogQGRlc2NyaXB0aW9uIFdoZXRoZXIgdGhlIGRyYXdpbmcgYnVmZmVyIGlzIGFjdGl2YXRlZCAqL1xuICAvKiogSWYgdHJ1ZSwgdGhlIG1hcCdzIGNhbnZhcyBjYW4gYmUgZXhwb3J0ZWQgdG8gYSBQTkcgdXNpbmcgbWFwLmdldENhbnZhcygpLnRvRGF0YVVSTCgpLiBEZWZhdWx0OiBmYWxzZSAqL1xuICBASW5wdXQoKSBwdWJsaWMgcHJlc2VydmVEcmF3aW5nQnVmZmVyID0gZmFsc2U7XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgZ2VvanNvbiBvZiBhbiBhb2kgYWRkZWQgdG8gdGhlIG1hcC4gKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBvbkFvaUNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxGZWF0dXJlQ29sbGVjdGlvbjxHZW9KU09OLkdlb21ldHJ5Pj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIHBvbHlnb24vYmJveCB0aGF0IGlzIGJlaW5nIGRyYXduLiAqL1xuICBAT3V0cHV0KCkgcHVibGljIG9uQW9pRWRpdDogRXZlbnRFbWl0dGVyPEFvaURpbWVuc2lvbnM+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5cbiAgLyoqIE51bWJlciBvZiBkcmF3biB2ZXJ0aWNlcyAoaW5jcmVtZW50ZWQgaW4gZHJhdyBtb2RlKS4gUmVzZXQgdG8gMCB3aGVuIHRoZSBkcmF3aW5nIGlzIGZpbmlzaGVkLiAqL1xuICBwdWJsaWMgbmJQb2x5Z29uVmVydGljZXMgPSAwO1xuICAvKiogTnVtYmVyIG9mIGNsaWNrcyB3aGlsZSBkcmF3aW5nIGEgZ2VvbWV0cnkuICovXG4gIHB1YmxpYyBkcmF3Q2xpY2tDb3VudGVyID0gMDtcblxuICAvKiogTGlzdCBvZiBkcmF3biBwb2x5Z29ucyBjZW50cm9pZCAqL1xuICBwdWJsaWMgcG9seWdvbmxhYmVsZGF0YTogRmVhdHVyZUNvbGxlY3Rpb248R2VvSlNPTi5HZW9tZXRyeT4gPSAoeyAuLi50aGlzLmVtcHR5RGF0YSB9KTtcblxuXG4gIC8qKiBEcmF3biBnZW9tZXRyeSdzIHN0YXRlIHdoZW4gZWRpdGluZy91cGRhdGluZy4gKi9cbiAgcHJvdGVjdGVkIHNhdmVkRWRpdEZlYXR1cmUgPSBudWxsO1xuICAvKiogTWFwIGNvbnRhaW5lciBIdG1sIGVsZW1lbnQgKi9cbiAgcHJvdGVjdGVkIGNhbnZhczogSFRNTEVsZW1lbnQ7XG4gIC8qKiBIdG1sIGVsZW1lbnQgdGhhdCBob2xkcyB0aGUgZHJhd2luZyBtZXNzYWdlLiAqL1xuICBwcm90ZWN0ZWQgZHJhd1Rvb2x0aXBFbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgLyoqIE1lc3NhZ2Ugc2hvd24gdG8gZXhwbGFpbiBob3cgdG8gZHJhdy4gKi9cbiAgcHVibGljIGRyYXdUb29sdGlwTWVzc2FnZSA9IHNpZ25hbDxzdHJpbmc+KCcnKTtcblxuICBwdWJsaWMgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBkcmF3U2VydmljZTogTWFwYm94QW9pRHJhd1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBfc25hY2tCYXI6IE1hdFNuYWNrQmFyLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBtYXBGcmFtZXdvcmtTZXJ2aWNlOiBBcmxhc01hcEZyYW1ld29ya1NlcnZpY2U8TCwgUywgTT4sXG4gICAgcHJvdGVjdGVkIG1hcFNlcnZpY2U6IEFic3RyYWN0QXJsYXNNYXBTZXJ2aWNlPEwsIFMsIE0+XG4gICkge1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuZWRpdEFvaSQucGlwZSh0YWtlVW50aWxEZXN0cm95ZWQoKSkuc3Vic2NyaWJlKGFlID0+IHRoaXMub25Bb2lFZGl0LmVtaXQoYWUpKTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmRyYXdCYm94JC5waXBlKHRha2VVbnRpbERlc3Ryb3llZCgpKS5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKGJib3hEQzogQmJveERyYXdDb21tYW5kKSA9PiB7XG4gICAgICAgIHRoaXMuZHJhd0Jib3goYmJveERDLmVhc3QsIGJib3hEQy5zb3V0aCwgYmJveERDLndlc3QsIGJib3hEQy5ub3J0aCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFN0b3BzIHRoZSBkcmF3aW5nIG1vZGUgYnkgY2hhbmdpbmcgdG8gc3RhdGljIG1vZGUuXG4gICAqL1xuICBwcml2YXRlIHN0b3BEcmF3aW5nQXRWZXJ0aWNlTGltaXQoKSB7XG4gICAgaWYgKHRoaXMubmJQb2x5Z29uVmVydGljZXMgPT09IHRoaXMuZHJhd1BvbHlnb25WZXJ0aWNlc0xpbWl0KSB7XG4gICAgICB0aGlzLmRyYXcuY2hhbmdlTW9kZSgnc3RhdGljJyk7XG4gICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ1BvbHlnb24gPSBmYWxzZTtcbiAgICAgIHRoaXMubmJQb2x5Z29uVmVydGljZXMgPSAwO1xuICAgICAgdGhpcy5kcmF3Q2xpY2tDb3VudGVyID0gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGxpc3RlblRvRHJhd09uQ3JlYXRlKCkge1xuICAgIHRoaXMuZHJhdy5vbignZHJhdy5jcmVhdGUnLCAoZSkgPT4ge1xuICAgICAgdGhpcy5vbkFvaUNoYW5nZWQubmV4dChcbiAgICAgICAge1xuICAgICAgICAgICd0eXBlJzogJ0ZlYXR1cmVDb2xsZWN0aW9uJyxcbiAgICAgICAgICAnZmVhdHVyZXMnOiB0aGlzLmRyYXcuZ2V0QWxsRmVhdHVyZXMoKS5maWx0ZXIoZmMgPT5cbiAgICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNWYWxpZFBvbHlnb24oZmMpIHx8XG4gICAgICAgICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzVmFsaWRDaXJjbGUoZmMpXG4gICAgICAgICAgKS5tYXAoZiA9PiBjbGVhbkNvb3JkcyhmKSlcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxpc3RlblRvRHJhd1VwZGF0ZSgpIHtcbiAgICB0aGlzLmRyYXcub24oJ2RyYXcudXBkYXRlJywgKGUpID0+IHtcbiAgICAgIGlmIChlKSB7XG4gICAgICAgIGNvbnN0IGZlYXR1cmVzID0gZS5mZWF0dXJlcztcbiAgICAgICAgaWYgKGZlYXR1cmVzICYmIGZlYXR1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnNhdmVkRWRpdEZlYXR1cmUgPSB7IC4uLmZlYXR1cmVzWzBdIH07XG4gICAgICAgICAgdGhpcy5zYXZlZEVkaXRGZWF0dXJlLmNvb3JkaW5hdGVzID0gW1tdXTtcbiAgICAgICAgICBmZWF0dXJlc1swXS5nZW9tZXRyeS5jb29yZGluYXRlc1swXS5mb3JFYWNoKGYgPT4gdGhpcy5zYXZlZEVkaXRGZWF0dXJlLmNvb3JkaW5hdGVzWzBdLnB1c2goZikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxpc3RlblRvRHJhd0RlbGV0ZSgpIHtcbiAgICB0aGlzLmRyYXcub24oJ2RyYXcuZGVsZXRlJywgKGUpID0+IHtcbiAgICAgIHRoaXMub25Bb2lDaGFuZ2VkLm5leHQoXG4gICAgICAgIHtcbiAgICAgICAgICAndHlwZSc6ICdGZWF0dXJlQ29sbGVjdGlvbicsXG4gICAgICAgICAgJ2ZlYXR1cmVzJzogdGhpcy5kcmF3LmdldEFsbEZlYXR1cmVzKCkuZmlsdGVyKGZjID0+XG4gICAgICAgICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzUG9seWdvbihmYykgfHxcbiAgICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNDaXJjbGUoZmMpXG4gICAgICAgICAgKS5tYXAoZiA9PiBjbGVhbkNvb3JkcyhmKSlcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxpc3RlblRvRHJhd0ludmFsaWRHZW9tZXRyeSgpIHtcbiAgICB0aGlzLmRyYXcub25EcmF3SW52YWxpZEdlb21ldHJ5KChlKSA9PiB7XG4gICAgICBpZiAodGhpcy5zYXZlZEVkaXRGZWF0dXJlKSB7XG4gICAgICAgIGNvbnN0IGZlYXR1cmVDb29yZHMgPSB0aGlzLnNhdmVkRWRpdEZlYXR1cmUuY29vcmRpbmF0ZXNbMF0uc2xpY2UoKTtcbiAgICAgICAgaWYgKGZlYXR1cmVDb29yZHNbMF1bMF0gIT09IGZlYXR1cmVDb29yZHNbZmVhdHVyZUNvb3Jkcy5sZW5ndGggLSAxXVswXSB8fFxuICAgICAgICAgIGZlYXR1cmVDb29yZHNbMF1bMV0gIT09IGZlYXR1cmVDb29yZHNbZmVhdHVyZUNvb3Jkcy5sZW5ndGggLSAxXVsxXSkge1xuICAgICAgICAgIGZlYXR1cmVDb29yZHMucHVzaChmZWF0dXJlQ29vcmRzWzBdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50RmVhdHVyZSA9IHtcbiAgICAgICAgICBpZDogJycsXG4gICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLFxuICAgICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgICAndHlwZSc6ICdQb2x5Z29uJyxcbiAgICAgICAgICAgICdjb29yZGluYXRlcyc6IFtmZWF0dXJlQ29vcmRzXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvcGVydGllczoge31cbiAgICAgICAgfTtcbiAgICAgICAgY3VycmVudEZlYXR1cmUuaWQgPSB0aGlzLnNhdmVkRWRpdEZlYXR1cmUuaWQ7XG4gICAgICAgIGN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMgPSB0aGlzLnNhdmVkRWRpdEZlYXR1cmUucHJvcGVydGllcztcbiAgICAgICAgdGhpcy5kcmF3LmFkZChjdXJyZW50RmVhdHVyZSBhcyBGZWF0dXJlPFBvbHlnb24+KTtcbiAgICAgIH1cbiAgICAgIHRoaXMub3BlbkludmFsaWRHZW9tZXRyeVNuYWNrQmFyKCk7XG4gICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0TWFwQ3Vyc29yKHRoaXMubWFwLCAnJyk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxpc3RlblRvRHJhd1NlbGVjdGlvbkNoYW5nZSgpIHtcbiAgICB0aGlzLmRyYXcub25EcmF3U2VsZWN0aW9uY2hhbmdlKChlKSA9PiB7XG4gICAgICBpZiAoZS5mZWF0dXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3U2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zYXZlZEVkaXRGZWF0dXJlID0gbnVsbDtcbiAgICAgICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9uQW9pQ2hhbmdlZC5uZXh0KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgICd0eXBlJzogJ0ZlYXR1cmVDb2xsZWN0aW9uJyxcbiAgICAgICAgICAgICdmZWF0dXJlcyc6IHRoaXMuZHJhdy5nZXRBbGxGZWF0dXJlcygpLmZpbHRlcihmYyA9PlxuICAgICAgICAgICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzVmFsaWRQb2x5Z29uKGZjKSB8fFxuICAgICAgICAgICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzVmFsaWRDaXJjbGUoZmMpXG4gICAgICAgICAgICApLm1hcChmID0+IGNsZWFuQ29vcmRzKGYpKVxuICAgICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN3aXRjaFRvU3RhdGljTW9kZSgpO1xuICAgICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0TWFwQ3Vyc29yKHRoaXMubWFwLCAnJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGxpc3RlblRvRHJhd01vZGVDaGFuZ2UoKSB7XG4gICAgdGhpcy5kcmF3Lm9uRHJhd01vZGVDaGFuZ2UoKGUpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlVG9vbHRpcE1lc3NhZ2UoKTtcbiAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nUG9seWdvbiA9IGUubW9kZSA9PT0gdGhpcy5kcmF3LmdldE1vZGUoJ0RSQVdfUE9MWUdPTicpO1xuICAgICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdTdHJpcCA9IGUubW9kZSA9PT0gdGhpcy5kcmF3LmdldE1vZGUoJ0RSQVdfU1RSSVAnKSB8fCBlLm1vZGUgPT09IHRoaXMuZHJhdy5nZXRNb2RlKCdESVJFQ1RfU1RSSVAnKTtcbiAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQ2lyY2xlID0gZS5tb2RlID09PSB0aGlzLmRyYXcuZ2V0TW9kZSgnRFJBV19DSVJDTEUnKSB8fCBlLm1vZGUgPT09IHRoaXMuZHJhdy5nZXRNb2RlKCdEUkFXX1JBRElVU19DSVJDTEUnKTtcbiAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQmJveCA9IGUubW9kZSA9PT0gdGhpcy5kcmF3LmdldE1vZGUoJ0RSQVdfUkVDVEFOR0xFJyk7XG4gICAgICBpZiAodGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdQb2x5Z29uIHx8IHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQ2lyY2xlIHx8IHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nU3RyaXAgfHwgZS5tb2RlID09PSAnc3RhdGljJykge1xuICAgICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzSW5TaW1wbGVEcmF3TW9kZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKGUubW9kZSA9PT0gJ3NpbXBsZV9zZWxlY3QnKSB7XG4gICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoZS5tb2RlID09PSAnc3RhdGljJykge1xuICAgICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0TWFwQ3Vyc29yKHRoaXMubWFwLCAnJyk7XG4gICAgICB9IGVsc2UgaWYgKGUubW9kZSA9PT0gJ2RpcmVjdF9zZWxlY3QnKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmVhdHVyZXMgPSB0aGlzLmRyYXcuZ2V0U2VsZWN0ZWRGZWF0dXJlcygpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZElkcyA9IHRoaXMuZHJhdy5nZXRTZWxlY3RlZElkcygpO1xuICAgICAgICBpZiAoc2VsZWN0ZWRGZWF0dXJlcyAmJiBzZWxlY3RlZElkcyAmJiBzZWxlY3RlZElkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgaWYgKHNlbGVjdGVkRmVhdHVyZXNbMF0ucHJvcGVydGllcy5zb3VyY2UgPT09ICdiYm94Jykge1xuICAgICAgICAgICAgdGhpcy5kcmF3LmNoYW5nZU1vZGUoJ3NpbXBsZV9zZWxlY3QnLCB7XG4gICAgICAgICAgICAgIGZlYXR1cmVJZHM6IFtzZWxlY3RlZElkc1swXV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5kcmF3U2VydmljZS5pc0luU2ltcGxlRHJhd01vZGUgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5kcmF3UG9seWdvblZlcnRpY2VzTGltaXQgJiYgc2VsZWN0ZWRGZWF0dXJlc1swXS5wcm9wZXJ0aWVzLm1ldGEgIT09ICdzdHJpcCcpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhdy5jaGFuZ2VNb2RlKCdsaW1pdF92ZXJ0ZXgnLCB7XG4gICAgICAgICAgICAgIGZlYXR1cmVJZDogc2VsZWN0ZWRJZHNbMF0sXG4gICAgICAgICAgICAgIG1heFZlcnRleEJ5UG9seWdvbjogdGhpcy5kcmF3UG9seWdvblZlcnRpY2VzTGltaXQsXG4gICAgICAgICAgICAgIHNlbGVjdGVkQ29vcmRQYXRoczogKHNlbGVjdGVkRmVhdHVyZXNbMF0gYXMgRmVhdHVyZTxHZW9tZXRyeT4pLmdlb21ldHJ5LmNvb3JkaW5hdGVzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmRyYXdQb2x5Z29uVmVydGljZXNMaW1pdCAmJiBzZWxlY3RlZEZlYXR1cmVzWzBdLnByb3BlcnRpZXMubWV0YSA9PT0gJ3N0cmlwJykge1xuICAgICAgICAgICAgdGhpcy5kcmF3LmNoYW5nZU1vZGUoJ2RpcmVjdF9zdHJpcCcsIHtcbiAgICAgICAgICAgICAgZmVhdHVyZUlkOiBzZWxlY3RlZElkc1swXSxcbiAgICAgICAgICAgICAgbWF4TGVuZ3RoOiBzZWxlY3RlZEZlYXR1cmVzWzBdLnByb3BlcnRpZXMubWF4TGVuZ3RoLFxuICAgICAgICAgICAgICBoYWxmU3dhdGg6IHNlbGVjdGVkRmVhdHVyZXNbMF0ucHJvcGVydGllcy5oYWxmU3dhdGgsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLnNldE1hcEN1cnNvcih0aGlzLm1hcCwgJycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmRyYXdUb29sdGlwRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcmxhcy1kcmF3LXRvb2x0aXAnKTtcbiAgICBjb25zdCBkcmF3U3R5bGVzID0gc3R5bGVzLmRlZmF1bHQ7XG4gICAgY29uc3QgZHJhd09wdGlvbnMgPSB7XG4gICAgICAuLi50aGlzLmRyYXdPcHRpb24sXG4gICAgICAuLi57XG4gICAgICAgIHN0eWxlczogZHJhd1N0eWxlcyxcbiAgICAgICAgbW9kZXM6IHtcbiAgICAgICAgICBzdGF0aWM6IFN0YXRpY01vZGUsXG4gICAgICAgICAgbGltaXRfdmVydGV4OiBsaW1pdFZlcnRleERpcmVjdFNlbGVjdE1vZGUsXG4gICAgICAgICAgZHJhd19wb2x5Z29uOiB2YWxpZEdlb21EcmF3UG9seWdvbk1vZGUsXG4gICAgICAgICAgZHJhd19jaXJjbGU6IGNpcmNsZU1vZGUsXG4gICAgICAgICAgZHJhd19yYWRpdXNfY2lyY2xlOiByYWRpdXNDaXJjbGVNb2RlLFxuICAgICAgICAgIGRyYXdfc3RyaXA6IHN0cmlwTW9kZSxcbiAgICAgICAgICBkaXJlY3Rfc3RyaXA6IHN0cmlwRGlyZWN0U2VsZWN0TW9kZSxcbiAgICAgICAgICBkcmF3X3JlY3RhbmdsZTogcmVjdGFuZ2xlTW9kZSxcbiAgICAgICAgICBkaXJlY3Rfc2VsZWN0OiBkaXJlY3RNb2RlT3ZlcnJpZGUsXG4gICAgICAgICAgc2ltcGxlX3NlbGVjdDogc2ltcGxlU2VsZWN0TW9kZU92ZXJyaWRlXG4gICAgICAgIH0sXG4gICAgICAgIHN1cHByZXNzQVBJRXZlbnRzOiB0cnVlXG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmRyYXcgPSB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UuY3JlYXRlRHJhdyhkcmF3T3B0aW9ucywgdGhpcy5kcmF3QnV0dG9uRW5hYmxlZCwgdGhpcy5tYXApO1xuICAgIHRoaXMuZHJhdy5zZXRNb2RlKCdEUkFXX0NJUkNMRScsICdkcmF3X2NpcmNsZScpO1xuICAgIHRoaXMuZHJhdy5zZXRNb2RlKCdEUkFXX1JBRElVU19DSVJDTEUnLCAnZHJhd19yYWRpdXNfY2lyY2xlJyk7XG4gICAgdGhpcy5kcmF3LnNldE1vZGUoJ0RSQVdfU1RSSVAnLCAnZHJhd19zdHJpcCcpO1xuICAgIHRoaXMuZHJhdy5zZXRNb2RlKCdTVEFUSUMnLCAnc3RhdGljJyk7XG4gICAgdGhpcy5kcmF3LnNldE1vZGUoJ0RJUkVDVF9TVFJJUCcsICdkaXJlY3Rfc3RyaXAnKTtcbiAgICB0aGlzLmRyYXcuc2V0TW9kZSgnRFJBV19SRUNUQU5HTEUnLCAnZHJhd19yZWN0YW5nbGUnKTtcbiAgICBjb25zdCBkcmF3Q29udHJvbENvbmZpZzogRHJhd0NvbnRyb2xzT3B0aW9uID0ge1xuICAgICAgZHJhdzogeyBjb250cm9sOiB0aGlzLmRyYXcgfSxcbiAgICAgIGFkZEdlb0JveDoge1xuICAgICAgICBlbmFibGU6IHRydWUsXG4gICAgICAgIG92ZXJyaWRlRXZlbnQ6XG4gICAgICAgIHtcbiAgICAgICAgICBldmVudDogJ2NsaWNrJyxcbiAgICAgICAgICBmbjogdGhpcy5hZGRHZW9Cb3hcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlbW92ZUFvaXM6IHtcbiAgICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgICBvdmVycmlkZUV2ZW50OiB7IGV2ZW50OiAnY2xpY2snLCBmbjogdGhpcy5yZW1vdmVBb2lzIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMubWFwLmluaXREcmF3Q29udHJvbHMoZHJhd0NvbnRyb2xDb25maWcpO1xuICAgIHRoaXMuZHJhd1NlcnZpY2Uuc2V0RHJhdyh0aGlzLmRyYXcpO1xuICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5vbk1hcEV2ZW50KCdsb2FkJywgdGhpcy5tYXAsICgpID0+IHtcbiAgICAgIHRoaXMubWFwU2VydmljZS5kZWNsYXJlTGFiZWxTb3VyY2VzKCcnLCB0aGlzLnBvbHlnb25sYWJlbGRhdGEsIHRoaXMubWFwKTtcbiAgICAgIHRoaXMuc3dpdGNoVG9TdGF0aWNNb2RlKCk7XG4gICAgICB0aGlzLmNhbnZhcyA9IHRoaXMubWFwLmdldENhbnZhc0NvbnRhaW5lcigpO1xuICAgICAgdGhpcy5saXN0ZW5Ub0RyYXdPbkNyZWF0ZSgpO1xuICAgICAgdGhpcy5saXN0ZW5Ub0RyYXdVcGRhdGUoKTtcbiAgICAgIHRoaXMubGlzdGVuVG9EcmF3RGVsZXRlKCk7XG4gICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm1vdXNlTW92ZUZvckRyYXcsIHRydWUpO1xuXG4gICAgICB0aGlzLmRyYXcub25EcmF3T25TdGFydCgoZSkgPT4ge1xuICAgICAgICB0aGlzLmRyYXdDbGlja0NvdW50ZXIgPSAwO1xuICAgICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0TWFwQ3Vyc29yKHRoaXMubWFwLCAnJyk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZHJhdy5vbkRyYXdPblN0b3AoKGUpID0+IHtcbiAgICAgICAgdGhpcy5kcmF3Q2xpY2tDb3VudGVyID0gMDtcbiAgICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLnNldE1hcEN1cnNvcih0aGlzLm1hcCwgJycpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubGlzdGVuVG9EcmF3SW52YWxpZEdlb21ldHJ5KCk7XG5cbiAgICAgIHRoaXMuZHJhdy5vbkRyYXdFZGl0U2F2ZUluaXRpYWxGZWF0dXJlKChlZGl0aW9uKSA9PiB7XG4gICAgICAgIHRoaXMuc2F2ZWRFZGl0RmVhdHVyZSA9IHsgLi4uZWRpdGlvbi5mZWF0dXJlIH07XG4gICAgICAgIHRoaXMuc2F2ZWRFZGl0RmVhdHVyZS5jb29yZGluYXRlcyA9IFtbXV07XG4gICAgICAgIGVkaXRpb24uZmVhdHVyZS5jb29yZGluYXRlc1swXS5mb3JFYWNoKGMgPT4gdGhpcy5zYXZlZEVkaXRGZWF0dXJlLmNvb3JkaW5hdGVzWzBdLnB1c2goYykpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubGlzdGVuVG9EcmF3U2VsZWN0aW9uQ2hhbmdlKCk7XG4gICAgICB0aGlzLmxpc3RlblRvRHJhd01vZGVDaGFuZ2UoKTtcbiAgICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5vbk1hcEV2ZW50KCdjbGljaycsIHRoaXMubWFwLCAoZSkgPT4ge1xuICAgICAgICBpZiAodGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmcoKSkge1xuICAgICAgICAgIHRoaXMuZHJhd0NsaWNrQ291bnRlcisrO1xuICAgICAgICAgIHRoaXMudXBkYXRlVG9vbHRpcE1lc3NhZ2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ0NpcmNsZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdQb2x5Z29uKSB7XG4gICAgICAgICAgdGhpcy5uYlBvbHlnb25WZXJ0aWNlcysrO1xuICAgICAgICAgIHRoaXMuc3RvcERyYXdpbmdBdFZlcnRpY2VMaW1pdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubmJQb2x5Z29uVmVydGljZXMgPSAwO1xuICAgICAgICAgIGNvbnN0IGZlYXR1cmVzID0gdGhpcy5tYXAucXVlcnlSZW5kZXJlZEZlYXR1cmVzKGUucG9pbnQpO1xuICAgICAgICAgIC8vIGVkaXQgcG9seWdvbiBjb25kaXRpb24gOiBubyBhcmxhcyBmZWF0dXJlICYmIG1hcGJveC1nbC1kcmF3IHNvdXJjZSBwcmVzZW50XG4gICAgICAgICAgY29uc3QgZWRpdENvbmRpdGlvbiA9IGZlYXR1cmVzLmZpbHRlcihmID0+IGYubGF5ZXIuaWQ/LmluZGV4T2YoJ2FybGFzJykgPj0gMCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICBmZWF0dXJlcy5maWx0ZXIoZiA9PiBmLnNvdXJjZS5zdGFydHNXaXRoKCdtYXBib3gtZ2wtZHJhdycpKS5sZW5ndGggPiAwO1xuICAgICAgICAgIGlmIChlZGl0Q29uZGl0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBjYW5kaWRhdGVzID0gZmVhdHVyZXMuZmlsdGVyKGYgPT4gZi5zb3VyY2Uuc3RhcnRzV2l0aCgnbWFwYm94LWdsLWRyYXcnKSk7XG4gICAgICAgICAgICAvLyBlZGl0IG9ubHkgb24gY2xpY2sgb24gdGhlIGJvcmRlciBvZiB0aGUgcG9seWdvblxuICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlc1Byb3BlcnRpZXMgPSBjYW5kaWRhdGVzLmZpbHRlcihmID0+IGYubGF5ZXIuaWQ/LmluZGV4T2YoJ3N0cm9rZScpID49IDApWzBdPy5wcm9wZXJ0aWVzO1xuICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZXNQcm9wZXJ0aWVzPy5pZCkge1xuICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlc1Byb3BlcnRpZXMudXNlcl9tZXRhID09PSAnc3RyaXAnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3LmNoYW5nZU1vZGUoJ2RpcmVjdF9zdHJpcCcsIHtcbiAgICAgICAgICAgICAgICAgIGZlYXR1cmVJZDogY2FuZGlkYXRlc1Byb3BlcnRpZXMuaWQsXG4gICAgICAgICAgICAgICAgICBtYXhMZW5ndGg6IGNhbmRpZGF0ZXNQcm9wZXJ0aWVzLnVzZXJfbWF4TGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgaGFsZlN3YXRoOiBjYW5kaWRhdGVzUHJvcGVydGllcy51c2VyX2hhbGZTd2F0aFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3LmNoYW5nZU1vZGUoJ3NpbXBsZV9zZWxlY3QnLCB7XG4gICAgICAgICAgICAgICAgICBmZWF0dXJlSWRzOiBbY2FuZGlkYXRlc1Byb3BlcnRpZXMuaWRdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3U2VydmljZS5pc0luU2ltcGxlRHJhd01vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5vbk1hcEV2ZW50KCdtb3VzZW1vdmUnLCB0aGlzLm1hcCwgKGU6IE1hcE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmICh0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ0Jib3ggfHwgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdQb2x5Z29uKSB7XG4gICAgICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5zZXRNYXBDdXJzb3IodGhpcy5tYXAsICdjcm9zc2hhaXInKTtcbiAgICAgICAgdGhpcy5tYXAubW92ZUxuZ0xhdCA9IGUubG5nTGF0O1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICh0aGlzLm1hcCAmJiB0aGlzLm1hcC5nZXRNYXBQcm92aWRlcigpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChjaGFuZ2VzWydkcmF3RGF0YSddICE9PSB1bmRlZmluZWQgJiYgdGhpcy5kcmF3U2VydmljZS5pc1JlYWR5KSB7XG4gICAgICAgIGNvbnN0IGNlbnRyb2lkZXMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgdGhpcy5kcmF3RGF0YS5mZWF0dXJlcy5mb3JFYWNoKGZlYXR1cmUgPT4ge1xuICAgICAgICAgIGNvbnN0IHBvbHkgPSBwb2x5Z29uKChmZWF0dXJlLmdlb21ldHJ5IGFzIFBvbHlnb24pLmNvb3JkaW5hdGVzKTtcbiAgICAgICAgICBjb25zdCBjZW50ID0gY2VudHJvaWQocG9seSk7XG4gICAgICAgICAgY2VudC5wcm9wZXJ0aWVzLmFybGFzX2lkID0gZmVhdHVyZS5wcm9wZXJ0aWVzLmFybGFzX2lkO1xuICAgICAgICAgIGNlbnRyb2lkZXMucHVzaChjZW50KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9seWdvbmxhYmVsZGF0YSA9IHtcbiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLFxuICAgICAgICAgIGZlYXR1cmVzOiBjZW50cm9pZGVzXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5kcmF3U2VydmljZS5hZGRGZWF0dXJlcyh0aGlzLmRyYXdEYXRhLCAvKiogZGVsZXRlT2xkICovIHRydWUpO1xuICAgICAgICB0aGlzLm1hcFNlcnZpY2UudXBkYXRlTGFiZWxTb3VyY2VzKHRoaXMubWFwLlBPTFlHT05fTEFCRUxfU09VUkNFLCB0aGlzLnBvbHlnb25sYWJlbGRhdGEsIHRoaXMubWFwKTtcbiAgICAgIH1cblxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHRvb2x0aXAgbWVzc2FnZSB3aGVuIGRyYXdpbmcgdG8gcmVmbGVjdCBkcmF3aW5nIG1vZGUgYW5kIHN0YXRlXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlVG9vbHRpcE1lc3NhZ2UoKSB7XG4gICAgbGV0IHRvb2x0aXBNZXNzYWdlO1xuICAgIHN3aXRjaCAodGhpcy5kcmF3LmdldEN1cnJlbnRNb2RlKCkudG9Mb2NhbGVVcHBlckNhc2UoKSBhcyBEcmF3TW9kZXMpIHtcbiAgICAgIGNhc2UgJ0RSQVdfUkFESVVTX0NJUkNMRSc6XG4gICAgICAgIGlmICh0aGlzLmRyYXdDbGlja0NvdW50ZXIgPT09IDApIHtcbiAgICAgICAgICB0b29sdGlwTWVzc2FnZSA9IG1hcmtlcignQ2xpY2sgdG8gc2V0IHRoZSBjZW50ZXIgb2YgdGhlIGNpcmNsZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRvb2x0aXBNZXNzYWdlID0gbWFya2VyKCdDbGljayBhZ2FpbiB0byBzZXQgdGhlIHJhZGl1cyBvZiB0aGUgY2lyY2xlJyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdEUkFXX1BPTFlHT04nOlxuICAgICAgICBpZiAodGhpcy5kcmF3Q2xpY2tDb3VudGVyIDwgMikge1xuICAgICAgICAgIHRvb2x0aXBNZXNzYWdlID0gbWFya2VyKCdDbGljayB0byBzZXQgYSBjb3JuZXIgb2YgdGhlIHBvbHlnb24nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0b29sdGlwTWVzc2FnZSA9IG1hcmtlcignRG91YmxlIGNsaWNrIHRvIGZpbmlzaCBkcmF3aW5nJyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdEUkFXX0NJUkNMRSc6XG4gICAgICAgIHRvb2x0aXBNZXNzYWdlID0gbWFya2VyKCdDbGljayB0byBjcmVhdGUgYSBjaXJjbGUgY2VudGVyZWQgb24gdGhpcyBwb2ludCcpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0RSQVdfU1RSSVAnOlxuICAgICAgICBpZiAodGhpcy5kcmF3Q2xpY2tDb3VudGVyID09PSAwKSB7XG4gICAgICAgICAgdG9vbHRpcE1lc3NhZ2UgPSBtYXJrZXIoJ0NsaWNrIHRvIHNldCB0aGUgb3JpZ2luIG9mIHRoZSBzdHJpcCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRvb2x0aXBNZXNzYWdlID0gbWFya2VyKCdDbGljayBhZ2FpbiB0byBzZXQgdGhlIGxlbmd0aCBhbmQgYmVhcmluZyBvZiB0aGUgc3RyaXAnKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0RSQVdfUkVDVEFOR0xFJzpcbiAgICAgICAgaWYgKHRoaXMuZHJhd0NsaWNrQ291bnRlciA9PT0gMCkge1xuICAgICAgICAgIHRvb2x0aXBNZXNzYWdlID0gbWFya2VyKCdDbGljayB0byBzZXQgdGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG9vbHRpcE1lc3NhZ2UgPSBtYXJrZXIoJ0NsaWNrIGFnYWluIHRvIGNvbXBsZXRlIHRoZSByZWN0YW5nbGUnKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1NUQVRJQyc6XG4gICAgICBjYXNlICdTSU1QTEVfU0VMRUNUJzpcbiAgICAgICAgdGhpcy5kcmF3Q2xpY2tDb3VudGVyID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLmRyYXdUb29sdGlwTWVzc2FnZS5zZXQodG9vbHRpcE1lc3NhZ2UpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWFkb25seSBtb3VzZU1vdmVGb3JEcmF3ID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICBjb25zdCB4ID0gZS5jbGllbnRYO1xuICAgIGNvbnN0IHkgPSBlLmNsaWVudFk7XG4gICAgdGhpcy5kcmF3VG9vbHRpcEVsZW1lbnQuc3R5bGUudG9wID0gKHkgKyAyMCkgKyAncHgnO1xuICAgIHRoaXMuZHJhd1Rvb2x0aXBFbGVtZW50LnN0eWxlLmxlZnQgPSAoeCArIDIwKSArICdweCc7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgYmJveCBkcmF3biBieSB0aGUgQmJveEdlbmVyYXRvciBjb21wb25lbnRcbiAgICogQHBhcmFtIGVhc3RcbiAgICogQHBhcmFtIHNvdXRoXG4gICAqIEBwYXJhbSB3ZXN0XG4gICAqIEBwYXJhbSBub3J0aFxuICAgKi9cbiAgcHJvdGVjdGVkIGRyYXdCYm94KGVhc3Q6IG51bWJlciwgc291dGg6IG51bWJlciwgd2VzdDogbnVtYmVyLCBub3J0aDogbnVtYmVyKSB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbW1xuICAgICAgW2Vhc3QsIHNvdXRoXSxcbiAgICAgIFtlYXN0LCBub3J0aF0sXG4gICAgICBbd2VzdCwgbm9ydGhdLFxuICAgICAgW3dlc3QsIHNvdXRoXSxcbiAgICAgIFtlYXN0LCBzb3V0aF0sXG4gICAgXV07XG4gICAgY29uc3QgcG9seWdvbkdlb2pzb246IEZlYXR1cmU8R2VvSlNPTi5HZW9tZXRyeT4gPSB7XG4gICAgICB0eXBlOiAnRmVhdHVyZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHNvdXJjZTogJ2Jib3gnXG4gICAgICB9LFxuICAgICAgZ2VvbWV0cnk6IHtcbiAgICAgICAgdHlwZTogJ1BvbHlnb24nLFxuICAgICAgICBjb29yZGluYXRlczogY29vcmRpbmF0ZXNcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGdlb2JveGRhdGEgPSB7IC4uLnRoaXMuZW1wdHlEYXRhfTtcbiAgICBnZW9ib3hkYXRhLmZlYXR1cmVzID0gW107XG4gICAgaWYgKHRoaXMuZHJhd0RhdGE/LmZlYXR1cmVzICYmIHRoaXMuZHJhd0RhdGEuZmVhdHVyZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5kcmF3RGF0YS5mZWF0dXJlcy5mb3JFYWNoKGRmID0+IGdlb2JveGRhdGEuZmVhdHVyZXMucHVzaChkZikpO1xuICAgIH1cbiAgICBnZW9ib3hkYXRhLmZlYXR1cmVzLnB1c2gocG9seWdvbkdlb2pzb24pO1xuICAgIC8qKiBUaGlzIGFsbG93cyB0byBrZWVwIHRoZSBkcmF3biBib3ggb24gdGhlIG1hcC4gSXQgd2lsbCBiZSBvdmVycmlkZW4gaW4gbmdPbkNoYW5nZXMgYGNoYW5nZXNbJ2RyYXdEYXRhJ11gICovXG4gICAgdGhpcy5kcmF3U2VydmljZS5hZGRGZWF0dXJlcyhnZW9ib3hkYXRhLCAvKiogZGVsZXRlT2xkICovIHRydWUpO1xuICAgIHRoaXMub25Bb2lDaGFuZ2VkLm5leHQoZ2VvYm94ZGF0YSk7XG4gICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdCYm94ID0gZmFsc2U7XG4gICAgdGhpcy5kcmF3U2VydmljZS5lbmREaW1lbnNpb25zRW1pc3Npb24oKTtcbiAgfVxuXG4gIC8qKiBAZGVzY3JpcHRpb24gRW5hYmxlcyBiYm94IGRyYXdpbmcgbW9kZS4qL1xuICBwdWJsaWMgYWRkR2VvQm94KCkge1xuICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5zZXRNYXBDdXJzb3IodGhpcy5tYXAsICdjcm9zc2hhaXInKTtcbiAgICB0aGlzLnN3aXRjaFRvRHJhd01vZGUoJ2RyYXdfcmVjdGFuZ2xlJyk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFJlbW92ZXMgYWxsIHRoZSBhb2lzIGlmIG5vbmUgb2YgdGhlbSBpcyBzZWxlY3RlZC4gT3RoZXJ3aXNlIGl0IHJlbW92ZXMgdGhlIHNlbGVjdGVkIG9uZSBvbmx5XG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlQW9pcygpIHtcbiAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0TWFwQ3Vyc29yKHRoaXMubWFwLCAnJyk7XG4gICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdCYm94ID0gZmFsc2U7XG4gICAgdGhpcy5kZWxldGVTZWxlY3RlZEl0ZW0oKTtcbiAgfVxuXG4gIC8qKiBAZGVzY3JpcHRpb24gRGVsZXRlcyB0aGUgc2VsZWN0ZWQgZHJhd24gZ2VvbWV0cnkuIElmIG5vIGRyYXduIGdlb21ldHJ5IGlzIHNlbGVjdGVkLCBhbGwgZ2VvbWV0cmllcyBhcmUgZGV0ZWxldGVkICovXG4gIHB1YmxpYyBkZWxldGVTZWxlY3RlZEl0ZW0oKSB7XG4gICAgaWYgKHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3U2VsZWN0ZWQpIHtcbiAgICAgIHRoaXMuZHJhdy50cmFzaCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRyYXdTZXJ2aWNlLmRlbGV0ZUFsbCgpO1xuICAgIH1cbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd1NlbGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5vbkFvaUNoYW5nZWQubmV4dCh0aGlzLmRyYXcuZ2V0QWxsKCkgYXMgRmVhdHVyZUNvbGxlY3Rpb248R2VvSlNPTi5HZW9tZXRyeT4pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBTaG93cyBhbiBpbnZhbGlkLWdlb21ldHJ5IGVycm9yIG9uIGEgc25hY2sgYmFyLlxuICAgKi9cbiAgcHVibGljIG9wZW5JbnZhbGlkR2VvbWV0cnlTbmFja0JhcigpIHtcbiAgICB0aGlzLl9zbmFja0Jhci5vcGVuKHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0ludmFsaWQgZ2VvbWV0cnknKSwgdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnT2snKSwge1xuICAgICAgZHVyYXRpb246IDMgKiAxMDAwLFxuICAgICAgdmVydGljYWxQb3NpdGlvbjogJ3RvcCcsXG4gICAgICBwYW5lbENsYXNzOiAnaW52YWxpZC1nZW8tdG9hc3QnXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFN3aXRjaGVzIHRvIGEgZHJhd2luZyBtb2RlIG9mIGEgcG9seWdvbiwgY2lyY2xlLCByYWRpdXMgY2lyY2xlIG9yIHN0cmlwLlxuICAgKiBAcGFyYW0gbW9kZSBEcmF3IG1vZGUgKERSQVdfUE9MWUdPTiwgRFJBV19DSVJDTEUsIERSQVdfUkFESVVTX0NJUkNMRSBvciBEUkFXX1NUUklQKS4gRGVmYXVsdCB0byBEUkFXX1BPTFlHT05cbiAgICogQHBhcmFtIG9wdGlvbiBNYXBib3hkcmF3IG9wdGlvbi5cbiAgICovXG4gIHB1YmxpYyBzd2l0Y2hUb0RyYXdNb2RlKG1vZGU/OiBzdHJpbmcsIG9wdGlvbj86IGFueSkge1xuICAgIGNvbnN0IHNlbGVjdGVkTW9kZSA9IG1vZGUgPz8gdGhpcy5kcmF3LmdldE1vZGUoJ0RSQVdfUE9MWUdPTicpO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQ2lyY2xlID0gc2VsZWN0ZWRNb2RlID09PSB0aGlzLmRyYXcuZ2V0TW9kZSgnRFJBV19DSVJDTEUnKVxuICAgICAgfHwgc2VsZWN0ZWRNb2RlID09PSB0aGlzLmRyYXcuZ2V0TW9kZSgnRFJBV19SQURJVVNfQ0lSQ0xFJyk7XG4gICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdQb2x5Z29uID0gc2VsZWN0ZWRNb2RlID09PSB0aGlzLmRyYXcuZ2V0TW9kZSgnRFJBV19QT0xZR09OJyk7XG4gICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdTdHJpcCA9IHNlbGVjdGVkTW9kZSA9PT0gdGhpcy5kcmF3LmdldE1vZGUoJ0RSQVdfU1RSSVAnKTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ0Jib3ggPSBzZWxlY3RlZE1vZGUgPT09IHRoaXMuZHJhdy5nZXRNb2RlKCdEUkFXX1JFQ1RBTkdMRScpO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gZmFsc2U7XG5cbiAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0TWFwQ3Vyc29yKHRoaXMubWFwLCAnY3Jvc3NoYWlyJyk7XG4gICAgdGhpcy5kcmF3LmNoYW5nZU1vZGUoc2VsZWN0ZWRNb2RlLCBvcHRpb24gPz8ge30pO1xuICAgIHRoaXMudXBkYXRlVG9vbHRpcE1lc3NhZ2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gU3dpdGNoZXMgdG8gZGlyZWN0X3NlbGVjdCBtb2RlLlxuICAgKiBAcGFyYW0gb3B0aW9uIE1hcGJveGRyYXcgb3B0aW9uLlxuICAgKi9cbiAgcHVibGljIHN3aXRjaFRvRGlyZWN0U2VsZWN0TW9kZShvcHRpb24/OiB7IGZlYXR1cmVJZHM6IEFycmF5PHN0cmluZz47IGFsbG93Q2lyY2xlUmVzaXplOiBib29sZWFuOyB9XG4gICAgfCB7IGZlYXR1cmVJZDogc3RyaW5nOyBhbGxvd0NpcmNsZVJlc2l6ZTogYm9vbGVhbjsgfSkge1xuICAgIHRoaXMuZHJhdy5jaGFuZ2VNb2RlKCdkaXJlY3Rfc2VsZWN0Jywgb3B0aW9uKTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzSW5TaW1wbGVEcmF3TW9kZSA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQ2lyY2xlID0gZmFsc2U7XG4gICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdTdHJpcCA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nUG9seWdvbiA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQmJveCA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBTd2l0Y2hlcyB0byBzaW1wbGVfc2VsZWN0IG1vZGUuXG4gICAqL1xuICBwdWJsaWMgc3dpdGNoVG9FZGl0TW9kZSgpIHtcbiAgICB0aGlzLmRyYXcuY2hhbmdlTW9kZSgnc2ltcGxlX3NlbGVjdCcsIHtcbiAgICAgIGZlYXR1cmVJZHM6IHRoaXMuZHJhdy5nZXRBbGwoKS5mZWF0dXJlcy5tYXAoZiA9PiBmLmlkKVxuICAgIH0pO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gdHJ1ZTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ0NpcmNsZSA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nU3RyaXAgPSBmYWxzZTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ1BvbHlnb24gPSBmYWxzZTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ0Jib3ggPSBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gU3dpdGNoZXMgdG8gc3RhdGljIG1vZGUuXG4gICAqL1xuICBwdWJsaWMgc3dpdGNoVG9TdGF0aWNNb2RlKCkge1xuICAgIHRoaXMuZHJhdy5jaGFuZ2VNb2RlKCdzdGF0aWMnKTtcbiAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzSW5TaW1wbGVEcmF3TW9kZSA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQmJveCA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nQ2lyY2xlID0gZmFsc2U7XG4gICAgdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdTdHJpcCA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNEcmF3aW5nUG9seWdvbiA9IGZhbHNlO1xuICAgIHRoaXMudXBkYXRlVG9vbHRpcE1lc3NhZ2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gUmV0dXJucyBhbGwgdGhlIGRyYXduIHBvbHlnb25zIGFzIHdrdCBvciBnZW9qc29uLlxuICAgKiBAcGFyYW0gbW9kZSAnd2t0JyB8ICdnZW9qc29uJ1xuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgcHVibGljIGdldEFsbFBvbHlnb24obW9kZTogJ3drdCcgfCAnZ2VvanNvbicpOiBzdHJpbmcgfCBPYmplY3Qge1xuICAgIGxldCBwb2x5Z29uO1xuICAgIGlmIChtb2RlID09PSAnd2t0Jykge1xuICAgICAgcG9seWdvbiA9IGxhdExuZ1RvV0tUKHRoaXMuZHJhdy5nZXRBbGwoKS5mZWF0dXJlcy5maWx0ZXIoZiA9PiB0aGlzLmRyYXdTZXJ2aWNlLmlzUG9seWdvbihmKSB8fFxuICAgICAgICB0aGlzLmRyYXdTZXJ2aWNlLmlzQ2lyY2xlKGYpKS5tYXAoZiA9PiBjbGVhbkNvb3JkcyhmKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb2x5Z29uID0ge1xuICAgICAgICAndHlwZSc6ICdGZWF0dXJlQ29sbGVjdGlvbicsXG4gICAgICAgICdmZWF0dXJlcyc6IHRoaXMuZHJhdy5nZXRBbGwoKS5mZWF0dXJlcy5maWx0ZXIoZiA9PiB0aGlzLmRyYXdTZXJ2aWNlLmlzUG9seWdvbihmKSB8fFxuICAgICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNDaXJjbGUoZikpLm1hcChmID0+IGNsZWFuQ29vcmRzKGYpKVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHBvbHlnb247XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgdGhlIHNlbGVjdGVkIHBvbHlnb24gZ2VvbWV0cnkgaW4gV0tUIG9yIEdlb0pzb24gZ2l2ZW4gdGhlIG1vZGVcbiAgICogQHBhcmFtIG1vZGUgOiAnd2t0JyB8ICdnZW9qc29uJ1xuICAgKiBAcmV0dXJucyBXa3Qgc3RyaW5nIG9yIEdlb2pzb24gb2JqZWN0LlxuICAgKi9cbiAgcHVibGljIGdldFNlbGVjdGVkUG9seWdvbihtb2RlOiAnd2t0JyB8ICdnZW9qc29uJyk6IHN0cmluZyB8IE9iamVjdCB7XG4gICAgbGV0IHBvbHlnb247XG4gICAgaWYgKG1vZGUgPT09ICd3a3QnKSB7XG4gICAgICBwb2x5Z29uID0gbGF0TG5nVG9XS1QodGhpcy5kcmF3LmdldFNlbGVjdGVkKCkuZmVhdHVyZXMuZmlsdGVyKGYgPT4gdGhpcy5kcmF3U2VydmljZS5pc1BvbHlnb24oZikgfHxcbiAgICAgICAgdGhpcy5kcmF3U2VydmljZS5pc0NpcmNsZShmKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb2x5Z29uID0ge1xuICAgICAgICAndHlwZSc6ICdGZWF0dXJlQ29sbGVjdGlvbicsXG4gICAgICAgICdmZWF0dXJlcyc6IHRoaXMuZHJhdy5nZXRTZWxlY3RlZCgpLmZlYXR1cmVzLmZpbHRlcihmID0+IHRoaXMuZHJhd1NlcnZpY2UuaXNQb2x5Z29uKGYpIHx8XG4gICAgICAgICAgdGhpcy5kcmF3U2VydmljZS5pc0NpcmNsZShmKSlcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBwb2x5Z29uO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6a2V5ZG93bicsIFsnJGV2ZW50J10pXG4gIHB1YmxpYyBoYW5kbGVLZXlib2FyZEV2ZW50KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgIGlmICh0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZygpKSB7XG4gICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuZGVsZXRlVW5yZWdpc3RlcmVkRmVhdHVyZXMoKTtcbiAgICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLnNldE1hcEN1cnNvcih0aGlzLm1hcCwgJycpO1xuXG4gICAgICAgIHRoaXMuc3dpdGNoVG9TdGF0aWNNb2RlKCk7XG4gICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuZW5kRGltZW5zaW9uc0VtaXNzaW9uKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlKSB7XG4gICAgICAgIHRoaXMuZHJhd1NlcnZpY2UuaXNJblNpbXBsZURyYXdNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZHJhdy5jaGFuZ2VNb2RlKCdzaW1wbGVfc2VsZWN0JywgeyBmZWF0dXJlSWRzOiBbXSB9KTtcbiAgICAgICAgdGhpcy51cGRhdGVUb29sdGlwTWVzc2FnZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG59XG5cbiIsIjxkaXYgaWQ9XCJhcmxhcy1kcmF3LXRvb2x0aXBcIiBjbGFzcz1cImRyYXctdG9vbHRpcC0taGlkZVwiIFtjbGFzcy5kcmF3LXRvb2x0aXAtLXNob3ddPVwiZHJhd1Rvb2x0aXBNZXNzYWdlKClcIj5cbiAgICB7e2RyYXdUb29sdGlwTWVzc2FnZSgpIHwgdHJhbnNsYXRlfX08L2Rpdj4iXX0=