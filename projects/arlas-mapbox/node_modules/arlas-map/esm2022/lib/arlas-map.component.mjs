/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { TranslateService } from '@ngx-translate/core';
import { finalize, fromEvent, Subject, takeUntil } from 'rxjs';
import { ArlasMapFrameworkService } from './arlas-map-framework.service';
import * as mapJsonSchema from './arlas-map.schema.json';
import { AbstractArlasMapService } from './arlas-map.service';
import { BasemapService } from './basemaps/basemap.service';
import { ArlasBasemaps } from './basemaps/basemaps.model';
import { ArlasDrawComponent } from './draw/arlas-draw.component';
import { MapboxAoiDrawService } from './draw/draw.service';
import { CROSS_LAYER_PREFIX, RESET_BEARING, ZOOM_IN, ZOOM_OUT } from './map/AbstractArlasMapGL';
import { ARLAS_VSET, getLayerName } from './map/model/layers';
import * as i0 from "@angular/core";
import * as i1 from "./draw/draw.service";
import * as i2 from "./basemaps/basemap.service";
import * as i3 from "@ngx-translate/core";
import * as i4 from "./arlas-map-framework.service";
import * as i5 from "./arlas-map.service";
import * as i6 from "@angular/material/icon";
import * as i7 from "@angular/material/slide-toggle";
import * as i8 from "@angular/material/tooltip";
import * as i9 from "@angular/cdk/drag-drop";
import * as i10 from "@angular/common";
import * as i11 from "./coordinates/coordinates.component";
import * as i12 from "./basemaps/basemap.component";
import * as i13 from "./legend/legend.component";
import * as i14 from "./draw/arlas-draw.component";
import * as i15 from "arlas-web-components";
import * as i16 from "./arlas-map.pipe";
/** L: a layer class/interface.
 *  S: a source class/interface.
 *  M: a Map configuration class/interface.
 */
export class ArlasMapComponent {
    constructor(drawService, basemapService, translate, mapFrameworkService, mapService) {
        this.drawService = drawService;
        this.basemapService = basemapService;
        this.translate = translate;
        this.mapFrameworkService = mapFrameworkService;
        this.mapService = mapService;
        /** Whether the legend is visible (open) or not.*/
        this.legendOpen = true;
        /** Used to clear geojson sources. */
        this.emptyData = {
            'type': 'FeatureCollection',
            'features': []
        };
        /** Whether the list of basemaps is shown. */
        this.showBasemapList = false;
        /** Visibility status of each visualisation set*. */
        this.visibilityStatus = new Map();
        this._onDestroy$ = new Subject();
        /** ANGULAR INPUTS */
        /** @description Html identifier given to the map container (it's a div ;))*/
        this.id = 'mapgl';
        /** @description An object with north,east,south,west properies which represent an offset in pixels */
        /** Origin is top-left and x-axis is west to east and y-axis north to south.*/
        this.offset = { north: 0, east: 0, south: 0, west: 0 };
        /** --- SCALE & COORDINATES */
        /** @description Whether the map scale is displayed. */
        this.displayScale = true;
        /** @description Maximim width in pixels that the map scale could take. */
        this.maxWidthScale = 100;
        /** @description Unit display for the map scale. */
        this.unitScale = 'metric';
        /** @description Whether to display the coordinates of the mouse while moving. */
        this.displayCurrentCoordinates = false;
        /** @description If true, the coordinates values are wrapped between -180 and 180. */
        this.wrapLatLng = true;
        /** @description List of available basemaps. */
        this.basemapStyles = new Array();
        /** --- INITIAL MAP VIEW : ZOOMs, CENTER, BOUNDS */
        /** @description Zoom of the map when it's initialized. */
        this.initZoom = 2;
        /** @description Max zoom of the map. */
        this.maxZoom = 22;
        /** @description Min zoom of the map. */
        this.minZoom = 0;
        /** @description Coordinates of the map's center when it's first loaded. */
        this.initCenter = [2.1972656250000004, 45.706179285330855];
        /** @description The padding added in the top-left and bottom-right corners of a map container that shouldn't be accounted */
        /** for when setting the view to fit bounds.*/
        this.fitBoundsOffSet = [0, 0];
        /**  @description Padding value applied around a fitBounds to fully show the area targeted. */
        this.fitBoundsPadding = 10;
        /** @description The maximum zoom level so that the bounds fit the map view. */
        this.fitBoundsMaxZoom = 22;
        /** @description Subject to which the component subscribes to redraw on the map the `data` of the given `source`. */
        this.redrawSource = new Subject();
        /** --- DRAW */
        /**  @description Options object for draw tools : https://github.com/mapbox/mapbox-gl-draw/blob/master/docs/API.md#options */
        this.drawOption = {};
        /** @description Features drawn at component start */
        this.drawData = ({ ...this.emptyData });
        /** @description Whether the draw tools are activated. */
        this.drawButtonEnabled = false;
        /** @description Whether the drawing buffer is activated */
        /** If true, the map's canvas can be exported to a PNG using map.getCanvas().toDataURL(). Default: false */
        this.preserveDrawingBuffer = false;
        /** --- ATTRIBUTION */
        /** @description Position of the map attribution. */
        this.mapAttributionPosition = 'bottom-right';
        /** --- LEGEND AND VISUALISATIONS */
        /** @description Subject of [collection, [field, legendData]] map. The map subscribes to it to keep */
        /** the legend updated with the data displayed on the map. */
        this.legendUpdater = new Subject();
        /** @description Subject of [layerId, boolean] map. The map subscribes to it to keep */
        /** the legend updated with the visibility of the layer.*/
        this.visibilityUpdater = new Subject();
        /** ANGULAR OUTPUTS */
        /** @description Emits true after the map is loaded and all sources & layers are added. */
        this.onMapLoaded = new Subject();
        /** @description Emits the map extent when the browser tab is closed/refreshed. */
        this.onMapClosed = new EventEmitter();
        /**
         * @deprecated
         * @description  Emits the event of moving the map. */
        this.onMove = new EventEmitter();
        /** @description Emits the visible visualisation sets' names */
        this.visualisations = new EventEmitter();
        /** @description Emits the features that were clicked on. */
        this.onFeatureClick = new EventEmitter();
        /** @description Emits the features that were hovered. */
        this.onFeatureHover = new EventEmitter();
        /** @description Emits the geojson of all aois added to the map. */
        this.onAoiChanged = new EventEmitter();
        /** @description Emits the the dimensions of the polygon/bbox that is being drawn. */
        this.onAoiEdit = new EventEmitter();
        /** @description Emits an event when the basemap has been changed by the user. */
        this.onBasemapChanged = new Subject();
        /** @description Emits which layers are displayed on the map. */
        this.legendVisibiltyStatus = new Subject();
        /** @description  Notifies that the user wants to download the selected layer */
        this.downloadSourceEmitter = new Subject();
        this.ICONS_BASE_PATH = 'assets/icons/';
        this.basemapService.protomapBasemapAdded$.pipe(takeUntilDestroyed())
            .subscribe(() => this.reorderLayers());
    }
    ngAfterViewInit() {
        /** init values */
        if (!this.initCenter) {
            this.initCenter = [0, 0];
        }
        if (this.initZoom === undefined || this.initZoom === null) {
            this.initZoom = 3;
        }
        if (this.maxZoom === undefined || this.maxZoom === null) {
            this.maxZoom = 23;
        }
        this.minZoom = this.minZoom ?? 0;
        /** BASEMAPS */
        if (this.defaultBasemapStyle && typeof this.defaultBasemapStyle.styleFile === 'string') {
            this.defaultBasemapStyle.url = this.defaultBasemapStyle.styleFile;
        }
        this.basemapStyles.forEach(bm => {
            if (typeof bm.styleFile === 'string') {
                bm.url = (bm.styleFile);
            }
        });
        this.basemapService.setBasemaps(new ArlasBasemaps(this.defaultBasemapStyle, this.basemapStyles));
        this.basemapService.fetchSources$()
            .pipe(finalize(() => this.declareMap()))
            .subscribe();
    }
    ngOnChanges(changes) {
        if (this.map && this.map.getMapProvider() !== undefined) {
            if (changes['boundsToFit'] !== undefined) {
                const newBoundsToFit = changes['boundsToFit'].currentValue;
                this.map.fitBounds(newBoundsToFit, {
                    maxZoom: this.fitBoundsMaxZoom,
                    offset: this.fitBoundsOffSet
                });
            }
            if (changes['featureToHightLight'] !== undefined
                && changes['featureToHightLight'].currentValue !== changes['featureToHightLight'].previousValue) {
                const featureToHightLight = changes['featureToHightLight'].currentValue;
                this.highlightFeature(featureToHightLight);
            }
            if (changes['featuresToSelect'] !== undefined
                && changes['featuresToSelect'].currentValue !== changes['featuresToSelect'].previousValue) {
                const featuresToSelect = changes['featuresToSelect'].currentValue;
                this.selectFeatures(featuresToSelect);
            }
        }
    }
    /** If transformRequest' @Input was not set, set a default value : a function that maintains the same url */
    initTransformRequest() {
        if (!this.transformRequest) {
            this.transformRequest = this.mapFrameworkService.getInitTransformRequest();
        }
    }
    /** Zooms on clicked feature from map mouse event e.
     * @param mouseEvent Map mouse event provided by the map instance.
     */
    zoomOnClick(mouseEvent) {
        const zoom = this.map.getZoom();
        let newZoom;
        if (zoom >= 0 && zoom < 3) {
            newZoom = 4;
        }
        else if (zoom >= 3 && zoom < 5) {
            newZoom = 5;
        }
        else if (zoom >= 5 && zoom < 7) {
            newZoom = 7;
        }
        else if (zoom >= 7 && zoom < 10) {
            newZoom = 10;
        }
        else if (zoom >= 10 && zoom < 11) {
            newZoom = 11;
        }
        else {
            newZoom = 12;
        }
        this.mapFrameworkService.flyTo(mouseEvent.lngLat.lat, mouseEvent.lngLat.lng, newZoom, this.map);
    }
    /**
     * Queries all rendered features on the position that was clicked on, on a layer; and emits those features.
     * @param mapLayerMouseEvent Map mouse event provided by a layer instance.
     */
    queryRender(mapLayerMouseEvent) {
        const hasCrossOrDrawLayer = this.mapFrameworkService.queryFeatures(mapLayerMouseEvent, this.map, CROSS_LAYER_PREFIX);
        if (!this.drawService.isDrawingBbox && !this.drawService.isDrawingPolygon
            && !this.drawService.isDrawingCircle && !this.drawService.isInSimpleDrawMode && !hasCrossOrDrawLayer) {
            this.onFeatureClick.next({ features: mapLayerMouseEvent.features, point: [mapLayerMouseEvent.lngLat.lng, mapLayerMouseEvent.lngLat.lat] });
        }
    }
    /** @description Adds the custom icons given in the component's input */
    addIcons() {
        if (this.icons) {
            this.icons.forEach(icon => {
                const iconName = icon.path.split('.')[0];
                const iconPath = this.ICONS_BASE_PATH + icon.path;
                const iconErrorMessage = 'The icon "' + this.ICONS_BASE_PATH + icon.path + '" is not found';
                this.mapFrameworkService.addImage(iconName, iconPath, this.map, iconErrorMessage, { 'sdf': icon.recolorable });
            });
        }
        this.mapFrameworkService.addImage('rotate', this.ICONS_BASE_PATH + 'rotate/01.png', this.map, 'Rotate not found');
        this.mapFrameworkService.addImage('resize', this.ICONS_BASE_PATH + 'resize/01.png', this.map, 'Resize not found');
    }
    /**
     * @description Creates the map instance and adds the basemap, arlas data
     * and starts listening to arlas data changes and layers visibility updates.
     * It also starts emiting map moveend event.
     */
    declareMap() {
        this.initTransformRequest();
        const arlasMapOption = {
            container: this.id,
            style: this.basemapService.getInitStyle(this.basemapService.basemaps.getSelected()),
            center: this.initCenter,
            zoom: this.initZoom,
            maxZoom: this.maxZoom,
            minZoom: this.minZoom,
            renderWorldCopies: true,
            preserveDrawingBuffer: this.preserveDrawingBuffer,
            locale: {
                'NavigationControl.ZoomIn': this.translate.instant(ZOOM_IN),
                'NavigationControl.ZoomOut': this.translate.instant(ZOOM_OUT),
                'NavigationControl.ResetBearing': this.translate.instant(RESET_BEARING)
            },
            pitchWithRotate: false,
            transformRequest: this.transformRequest,
            attributionControl: false,
        };
        const mapProviderOptions = this.mapFrameworkService.buildMapProviderOption(arlasMapOption);
        const config = {
            displayCurrentCoordinates: this.displayCurrentCoordinates,
            fitBoundsPadding: this.fitBoundsPadding,
            margePanForLoad: this.margePanForLoad,
            margePanForTest: this.margePanForTest,
            offset: this.offset,
            wrapLatLng: this.wrapLatLng,
            maxWidthScale: this.maxWidthScale,
            unitScale: this.unitScale,
            mapProviderOptions,
            controls: {
                mapAttribution: {
                    enable: true,
                    position: this.mapAttributionPosition,
                    config: {
                        compact: false
                    }
                },
                scale: {
                    enable: this.displayScale
                },
                navigationControl: {
                    enable: true
                },
                pitchToggle: {
                    enable: true,
                    config: { bearing: -20, pitch: 70, minpitchzoom: 11 }
                }
            }
        };
        this.map = this.mapFrameworkService.createMap(config);
        fromEvent(window, 'beforeunload').subscribe(() => {
            this.onMapClosed.next(this.map.getMapExtend());
        });
        this.map.onCustomEvent('beforeOnLoadInit', () => {
            this.basemapService.declareProtomapProtocol(this.map);
            this.basemapService.addProtomapBasemap(this.map);
            this.addIcons();
            this.mapService.declareArlasDataSources(this.dataSources, this.emptyData, this.map);
            this.mapService.declareBasemapSources(this.mapSources, this.map);
            this.mapService.addArlasDataLayers(this.visualisationSetsConfig, this.mapLayers, this.map);
            this.listenToLayersEvents();
        });
        this.mapFrameworkService.onMapEvent('load', this.map, () => {
            if (this.mapLayers !== null) {
                this.visibilityUpdater.subscribe(visibilityStatus => {
                    this.mapService.updateVisibility(visibilityStatus, this.visualisationSetsConfig, this.map);
                });
            }
            this.onMapLoaded.next(true);
        });
        this.map.onMoveEnd(this.mapService.visualisationsSets).subscribe((moveResult => {
            this.onMove.next(moveResult);
        }));
        if (this.redrawSource) {
            this.redrawSource.pipe(takeUntil(this._onDestroy$)).subscribe(sd => {
                this.mapFrameworkService.setDataToGeojsonSource(this.mapFrameworkService.getSource(sd.source, this.map), {
                    'type': 'FeatureCollection',
                    'features': sd.data
                });
            });
        }
    }
    /**
     * @description Listens to events on mapLayers input (configured layers).
     */
    listenToLayersEvents() {
        /** Zooms on the clicked feature of the given layers. */
        this.mapLayers.events.zoomOnClick.forEach(layerId => {
            this.mapFrameworkService.onLayerEvent('click', this.map, layerId, (e) => this.zoomOnClick(e));
        });
        this.mapLayers.events.onHover.forEach(layerId => {
            /** Emits the hovered feature on mousemove. */
            this.mapFrameworkService.onLayerEvent('mousemove', this.map, layerId, (e) => this.onFeatureHover.next({ features: e.features, point: [e.lngLat.lng, e.lngLat.lat] }));
            /** Emits an empty object on mouse leaving a feature. */
            this.mapFrameworkService.onLayerEvent('mouseleave', this.map, layerId, (e) => this.onFeatureHover.next({}));
        });
        /** Emits the clicked on feature. */
        this.mapLayers.events.emitOnClick.forEach(layerId => {
            this.mapFrameworkService.onLayerEvent('click', this.map, layerId, (e) => this.queryRender(e));
        });
        const drawPolygonLayers = [
            'gl-draw-polygon-stroke-inactive',
            'gl-draw-polygon-stroke-active',
            'gl-draw-polygon-stroke-static'
        ].map(layer => ['.cold', '.hot']
            .map(id => layer.concat(id)))
            .reduce((p, ac) => ac.concat(p), []);
        /** Sets mouse cursor on drawn features */
        drawPolygonLayers.forEach(layerId => {
            this.mapFrameworkService.onLayerEvent('mousemove', this.map, layerId, (e) => this.mapFrameworkService.setMapCursor(this.map, 'pointer'));
            this.mapFrameworkService.onLayerEvent('mouseleave', this.map, layerId, (e) => {
                if (this.drawService.isDrawing()) {
                    this.mapFrameworkService.setMapCursor(this.map, 'crosshair');
                }
                else {
                    this.mapFrameworkService.setMapCursor(this.map, '');
                }
            });
        });
    }
    /** Sets the layers order according to the current order of `visualisationSetsConfig` list*/
    reorderLayers() {
        this.mapService.reorderLayers(this.visualisationSetsConfig, this.map);
    }
    /** @description Display the basemapswitcher */
    showBasemapSwitcher() {
        this.showBasemapList = true;
    }
    /** @description Emits event notifiying that the basemap has been changed */
    onChangeBasemapStyle() {
        this.onBasemapChanged.next(true);
    }
    /**
     * Updates the visibility status of the layer and emits that update.
     * @param visualisation visualisation set name
     * @param l layer id
     * @param visible whether the layer is enabled and visible in the visualisation set
     */
    emitLegendVisibility(visualisation, l, visible) {
        // Copy the map so the pipe updates the values
        this.visibilityStatus = new Map(this.visibilityStatus);
        this.visibilityStatus.set(visualisation + ARLAS_VSET + l, visible);
        this.legendVisibiltyStatus.next(this.visibilityStatus);
    }
    /**
     * @description Emits the visible visualisation set
     * @param visualisationName Name of the visualisation.
     */
    emitVisualisations(visualisationName) {
        const layers = this.mapService.updateLayoutVisibility(visualisationName, this.visualisationSetsConfig, this.map);
        this.visualisations.emit(layers);
        this.reorderLayers();
    }
    downloadLayerSource(downaload) {
        const downlodedSource = {
            layerId: downaload.layer.id,
            layerName: getLayerName(downaload.layer.id),
            collection: downaload.layer.metadata.collection,
            sourceName: downaload.layer.source,
            downloadType: downaload.downloadType
        };
        this.downloadSourceEmitter.next(downlodedSource);
    }
    /** puts the visualisation set list in the new order after dropping */
    drop(event) {
        moveItemInArray(this.visualisationSetsConfig, event.previousIndex, event.currentIndex);
        this.reorderLayers();
    }
    /** puts the layers list in the new order after dropping */
    dropLayer(event, visuName) {
        const layers = Array.from(this.mapService.findVisualisationSetLayer(visuName, this.visualisationSetsConfig));
        moveItemInArray(layers, event.previousIndex, event.currentIndex);
        this.mapService.setVisualisationSetLayers(visuName, layers, this.visualisationSetsConfig);
        this.reorderLayers();
    }
    hideBasemapSwitcher() {
        this.showBasemapList = false;
    }
    /**
     * Fit to given bounds. Options are for padding.
     * @param bounds Bounds of the map to fit to.
     */
    fitToPaddedBounds(bounds) {
        this.map.fitToPaddedBounds(bounds);
    }
    /**
     * Centers the map to the given latitude/longitude coordinates.
     * @param lngLat Latitude/longitude coordinates.
     */
    moveToCoordinates(lngLat) {
        this.map.setCenter(lngLat);
    }
    /** Highlights, in all data sources,the feature(s) having the given elementIdentifier */
    highlightFeature(featureToHightLight) {
        this.mapService.highlightFeature(this.mapLayers, this.map, featureToHightLight);
    }
    /** Selects, in all data sources,the feature(s) having the given elementIdentifier */
    selectFeatures(elementToSelect) {
        this.mapService.selectFeatures(this.mapLayers, this.map, elementToSelect);
    }
    /** Selects, in all data sources, all the features having the given elementIdentifiers and under the given collection.
     * @param features list of features identifiers.
     * @param collection data collection (metadata of the data source).
    */
    selectFeaturesByCollection(features, collection) {
        this.mapService.selectFeaturesByCollection(this.mapLayers, this.map, features, collection);
    }
    static getMapJsonSchema() {
        return mapJsonSchema;
    }
    /** Destroys all the components subscriptions. */
    ngOnDestroy() {
        if (this.map) {
            this.map.unsubscribeEvents();
        }
        this._onDestroy$.next(true);
        this._onDestroy$.complete();
    }
    /** @description Enables bbox drawing mode.*/
    addGeoBox() {
        this.drawComponent.addGeoBox();
    }
    /**
     * @description Removes all the aois if none of them is selected. Otherwise it removes the selected one only
     */
    removeAois() {
        this.drawComponent.removeAois();
    }
    /** @description Deletes the selected drawn geometry. If no drawn geometry is selected, all geometries are deteleted */
    deleteSelectedItem() {
        this.drawComponent.deleteSelectedItem();
    }
    /**
     * @description Switches to a drawing mode of a DRAW_POLYGON, DRAW_CIRCLE or DRAW_RADIUS_CIRCLE.
     * @param mode Draw mode (DRAW_POLYGON, DRAW_CIRCLE or DRAW_RADIUS_CIRCLE). Default to DRAW_POLYGON
     * @param option Mapboxdraw option.
     */
    switchToDrawMode(mode, option) {
        this.drawComponent.switchToDrawMode(mode, option);
    }
    /**
     * @description Switches to direct_select mode.
     * @param option Mapboxdraw option.
     */
    switchToDirectSelectMode(option) {
        this.drawComponent.switchToDirectSelectMode(option);
    }
    /**
     * @description Switches to simple_select mode.
     * @param option Mapboxdraw option.
     */
    switchToEditMode() {
        this.drawComponent.switchToEditMode();
    }
    /**
     * @description Returns all the drawn polygons as wkt or geojson.
     * @param mode 'wkt' | 'geojson'
     * @returns Wkt string or Geojson object.
     */
    getAllPolygon(mode) {
        return this.drawComponent.getAllPolygon(mode);
    }
    /**
     * @description returns the selected polygon geometry in WKT or GeoJson given the mode
     * @param mode : 'wkt' | 'geojson'
     * @returns Wkt string or Geojson object.
     */
    getSelectedPolygon(mode) {
        return this.drawComponent.getSelectedPolygon(mode);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ArlasMapComponent, deps: [{ token: i1.MapboxAoiDrawService }, { token: i2.BasemapService }, { token: i3.TranslateService }, { token: i4.ArlasMapFrameworkService }, { token: i5.AbstractArlasMapService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.2.13", type: ArlasMapComponent, selector: "arlas-map", inputs: { id: "id", offset: "offset", mapLayers: "mapLayers", displayScale: "displayScale", maxWidthScale: "maxWidthScale", unitScale: "unitScale", displayCurrentCoordinates: "displayCurrentCoordinates", wrapLatLng: "wrapLatLng", defaultBasemapStyle: "defaultBasemapStyle", basemapStyles: "basemapStyles", initZoom: "initZoom", maxZoom: "maxZoom", minZoom: "minZoom", initCenter: "initCenter", boundsToFit: "boundsToFit", fitBoundsOffSet: "fitBoundsOffSet", fitBoundsPadding: "fitBoundsPadding", fitBoundsMaxZoom: "fitBoundsMaxZoom", margePanForLoad: "margePanForLoad", margePanForTest: "margePanForTest", transformRequest: "transformRequest", featureToHightLight: "featureToHightLight", featuresToSelect: "featuresToSelect", mapSources: "mapSources", redrawSource: "redrawSource", dataSources: "dataSources", drawOption: "drawOption", drawData: "drawData", drawButtonEnabled: "drawButtonEnabled", drawPolygonVerticesLimit: "drawPolygonVerticesLimit", preserveDrawingBuffer: "preserveDrawingBuffer", mapAttributionPosition: "mapAttributionPosition", icons: "icons", legendUpdater: "legendUpdater", visibilityUpdater: "visibilityUpdater", visualisationSetsConfig: "visualisationSetsConfig" }, outputs: { onMapLoaded: "onMapLoaded", onMapClosed: "onMapClosed", onMove: "onMove", visualisations: "visualisations", onFeatureClick: "onFeatureClick", onFeatureHover: "onFeatureHover", onAoiChanged: "onAoiChanged", onAoiEdit: "onAoiEdit", onBasemapChanged: "onBasemapChanged", legendVisibiltyStatus: "legendVisibiltyStatus", downloadSourceEmitter: "downloadSourceEmitter" }, viewQueries: [{ propertyName: "drawComponent", first: true, predicate: ["drawComponent"], descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div id=\"{{id}}\" class=\"map__container\">\n  <div class=\"map__visu-list\" *ngIf=\"visualisationSetsConfig?.length > 0\">\n    <div class=\"map__legend-button\" [matTooltipPosition]=\"'left'\" matTooltip=\"{{'Manage layers' | translate}}\">\n      <mat-icon (click)=\"legendOpen=!legendOpen\" (keyDown)=\"legendOpen=!legendOpen\">layers</mat-icon>\n    </div>\n    <div [hidden]=\"!legendOpen\" class=\"map__visu-list--container\" cdkDropList\n      (cdkDropListDropped)=\"drop($event)\">\n      <div cdkDrag class=\"map__visu-item\" *ngFor=\"let visu of visualisationSetsConfig\">\n        <div cdkDragHandle class=\"map__visu-title\">\n          <span class=\"map__visu-title-text\" [class.map__visu-title-text--disabled]=\"!visu.enabled\">\n            {{visu.name | translate}}</span>\n          <mat-slide-toggle [checked]=\"visu.enabled\" (change)=\"emitVisualisations(visu.name)\"\n            [matTooltip]=\"'show_layers' | translate\" [hideIcon]=\"true\"></mat-slide-toggle>\n        </div>\n        <div class=\"map__visu-content\" cdkDropList (cdkDropListDropped)=\"dropLayer($event, visu.name)\">\n          <div cdkDrag *ngFor=\"let l of visu.layers\" class=\"map__visu-layer\"\n            [class.cdk-visually-hidden]=\"((visu.name + ':arlas_vset:' + l) | getValue:visibilityStatus) !== true\">\n            <div cdkDragHandle class=\"map__visu-layer-drag\">\n              <mat-icon>drag_indicator</mat-icon>\n            </div>\n            <arlas-legend [collection]=\"l | getCollection: mapService.layersMap \" [enabled]=\"visu.enabled\"\n              [layer]=\"l | getValue: mapService.layersMap \" [zoom]=\"map?.zoom\"\n              (visibilityStatus)=\"emitLegendVisibility(visu.name, l, $event)\" [legendUpdater]=\"legendUpdater\"\n              [visibilityUpdater]=\"visibilityUpdater\"\n              (downloadSourceEmitter)=\"downloadLayerSource($event)\"></arlas-legend>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<arlas-coordinates *ngIf=\"displayCurrentCoordinates\" [currentLat]=\"map?.currentLat\" [currentLng]=\"map?.currentLng\"\n  (moveToCoordinates$)=\"moveToCoordinates($event)\"></arlas-coordinates>\n\n<arlas-basemap *ngIf=\"showBasemapList\" [mapSources]=\"mapSources\" [map]=\"map\" (mouseleave)=\"hideBasemapSwitcher()\"\n  (basemapChanged)=\"onChangeBasemapStyle()\"></arlas-basemap>\n\n\n<arlas-draw #drawComponent *ngIf=\"map\" [map]=\"map\" [emptyData]=\"emptyData\" [drawData]=\"drawData\"\n  [drawButtonEnabled]=\"drawButtonEnabled\" [drawOption]=\"drawOption\"\n  [drawPolygonVerticesLimit]=\"drawPolygonVerticesLimit\" [preserveDrawingBuffer]=\"preserveDrawingBuffer\"\n  (onAoiChanged)=\"onAoiChanged.emit($event)\"\n  (onAoiEdit)=\"onAoiEdit.emit($event)\"></arlas-draw>", styles: ["@charset \"UTF-8\";.map__container{width:100%;height:100%;position:absolute!important}.map__visu-list{position:absolute;display:flex;flex-direction:column;top:220px;right:7px;z-index:1;background:transparent;flex-wrap:wrap-reverse}.map__legend-button{cursor:pointer;margin-bottom:4px;border-radius:3px;background-color:#fff;width:30px;height:30px;padding:3px}.map__legend-button:hover{background-color:#f5f5f5}.map__visu-list--container{padding:1px 1px 3px;border-radius:2px;max-height:calc(100vh - 415px);overflow-y:auto;overflow-x:hidden}.map__visu-item{margin:1px;padding:unset;padding-right:3px;width:225px;border:.8px solid #ddd;background:#fff;border-radius:3px}.map__visu-title{display:flex;justify-content:space-between;padding:1px 5px 1px 0;font-weight:550;font-size:14px;cursor:grab;--mdc-switch-track-width: 24px;--mdc-switch-track-height: 5px;--mdc-switch-handle-width: 12px;--mdc-switch-state-layer-size: 0;--mat-switch-selected-handle-horizontal-margin: 0 1px}.map__visu-title:hover .map__visu-toggle .map__visu-drag{visibility:visible}.map__visu-title .mdc-switch__handle{--mat-switch-unselected-handle-size: 12px;--mat-switch-selected-handle-size: 12px;--mat-switch-pressed-handle-size: 12px;--mdc-switch-unselected-handle-color: lightgrey;--mdc-switch-unselected-focus-handle-color: lightgrey;--mdc-switch-unselected-hover-handle-color: lightgrey;--mdc-switch-unselected-pressed-handle-color: lightgrey}.map__visu-title-text{color:#333;padding:3px}.map__visu-title-text--disabled{color:#bbb}.map__visu-content{max-height:300px;overflow-y:auto;overflow-x:hidden}.map__visu-layer{background-color:#fff;position:relative;overflow:hidden}.map__visu-layer-drag{position:absolute;top:5px;left:0;display:flex;padding-left:3px}.map__visu-layer-drag mat-icon{font-size:18px;width:18px;height:18px;color:#999}.map__visu-layer:hover .map__visu-layer-drag{cursor:grab;z-index:2}.map__visu-layer:hover .map__visu-layer-drag mat-icon{color:#444}.draw-tooltip--hide{display:none}.draw-tooltip--show{display:block;position:fixed;overflow:hidden;font-size:.8em;background-color:#fff;border-radius:2px;padding:2px;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}::-webkit-scrollbar{width:3px!important;height:4px!important;background-color:#f5f5f5}::-webkit-scrollbar-track{box-shadow:inset 0 0 6px #0000004d;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#f5f5f5}::-webkit-scrollbar-thumb{background-color:#555}.cdk-drag-preview{box-sizing:border-box;font-size:.75em;border-radius:3px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-preview .map__visu-layer .map__visu-layer-drag mat-icon{color:#444}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.draw-control-disabled{display:none}\n"], dependencies: [{ kind: "component", type: i6.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i7.MatSlideToggle, selector: "mat-slide-toggle", inputs: ["name", "id", "labelPosition", "aria-label", "aria-labelledby", "aria-describedby", "required", "color", "disabled", "disableRipple", "tabIndex", "checked", "hideIcon", "disabledInteractive"], outputs: ["change", "toggleChange"], exportAs: ["matSlideToggle"] }, { kind: "directive", type: i8.MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "directive", type: i9.CdkDropList, selector: "[cdkDropList], cdk-drop-list", inputs: ["cdkDropListConnectedTo", "cdkDropListData", "cdkDropListOrientation", "id", "cdkDropListLockAxis", "cdkDropListDisabled", "cdkDropListSortingDisabled", "cdkDropListEnterPredicate", "cdkDropListSortPredicate", "cdkDropListAutoScrollDisabled", "cdkDropListAutoScrollStep", "cdkDropListElementContainer"], outputs: ["cdkDropListDropped", "cdkDropListEntered", "cdkDropListExited", "cdkDropListSorted"], exportAs: ["cdkDropList"] }, { kind: "directive", type: i9.CdkDrag, selector: "[cdkDrag]", inputs: ["cdkDragData", "cdkDragLockAxis", "cdkDragRootElement", "cdkDragBoundary", "cdkDragStartDelay", "cdkDragFreeDragPosition", "cdkDragDisabled", "cdkDragConstrainPosition", "cdkDragPreviewClass", "cdkDragPreviewContainer", "cdkDragScale"], outputs: ["cdkDragStarted", "cdkDragReleased", "cdkDragEnded", "cdkDragEntered", "cdkDragExited", "cdkDragDropped", "cdkDragMoved"], exportAs: ["cdkDrag"] }, { kind: "directive", type: i9.CdkDragHandle, selector: "[cdkDragHandle]", inputs: ["cdkDragHandleDisabled"] }, { kind: "directive", type: i10.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i10.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i11.CoordinatesComponent, selector: "arlas-coordinates", inputs: ["currentLat", "currentLng"], outputs: ["moveToCoordinates$"] }, { kind: "component", type: i12.BasemapComponent, selector: "arlas-basemap", inputs: ["map", "mapSources"], outputs: ["basemapChanged", "blur"] }, { kind: "component", type: i13.LegendComponent, selector: "arlas-legend", inputs: ["layer", "collection", "zoom", "enabled", "legendUpdater", "visibilityUpdater"], outputs: ["visibilityStatus", "downloadSourceEmitter"] }, { kind: "component", type: i14.ArlasDrawComponent, selector: "arlas-draw", inputs: ["map", "emptyData", "drawOption", "drawData", "drawButtonEnabled", "drawPolygonVerticesLimit", "preserveDrawingBuffer"], outputs: ["onAoiChanged", "onAoiEdit"] }, { kind: "pipe", type: i3.TranslatePipe, name: "translate" }, { kind: "pipe", type: i15.GetValuePipe, name: "getValue" }, { kind: "pipe", type: i16.GetCollectionPipe, name: "getCollection" }], encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ArlasMapComponent, decorators: [{
            type: Component,
            args: [{ selector: 'arlas-map', encapsulation: ViewEncapsulation.None, template: "<div id=\"{{id}}\" class=\"map__container\">\n  <div class=\"map__visu-list\" *ngIf=\"visualisationSetsConfig?.length > 0\">\n    <div class=\"map__legend-button\" [matTooltipPosition]=\"'left'\" matTooltip=\"{{'Manage layers' | translate}}\">\n      <mat-icon (click)=\"legendOpen=!legendOpen\" (keyDown)=\"legendOpen=!legendOpen\">layers</mat-icon>\n    </div>\n    <div [hidden]=\"!legendOpen\" class=\"map__visu-list--container\" cdkDropList\n      (cdkDropListDropped)=\"drop($event)\">\n      <div cdkDrag class=\"map__visu-item\" *ngFor=\"let visu of visualisationSetsConfig\">\n        <div cdkDragHandle class=\"map__visu-title\">\n          <span class=\"map__visu-title-text\" [class.map__visu-title-text--disabled]=\"!visu.enabled\">\n            {{visu.name | translate}}</span>\n          <mat-slide-toggle [checked]=\"visu.enabled\" (change)=\"emitVisualisations(visu.name)\"\n            [matTooltip]=\"'show_layers' | translate\" [hideIcon]=\"true\"></mat-slide-toggle>\n        </div>\n        <div class=\"map__visu-content\" cdkDropList (cdkDropListDropped)=\"dropLayer($event, visu.name)\">\n          <div cdkDrag *ngFor=\"let l of visu.layers\" class=\"map__visu-layer\"\n            [class.cdk-visually-hidden]=\"((visu.name + ':arlas_vset:' + l) | getValue:visibilityStatus) !== true\">\n            <div cdkDragHandle class=\"map__visu-layer-drag\">\n              <mat-icon>drag_indicator</mat-icon>\n            </div>\n            <arlas-legend [collection]=\"l | getCollection: mapService.layersMap \" [enabled]=\"visu.enabled\"\n              [layer]=\"l | getValue: mapService.layersMap \" [zoom]=\"map?.zoom\"\n              (visibilityStatus)=\"emitLegendVisibility(visu.name, l, $event)\" [legendUpdater]=\"legendUpdater\"\n              [visibilityUpdater]=\"visibilityUpdater\"\n              (downloadSourceEmitter)=\"downloadLayerSource($event)\"></arlas-legend>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<arlas-coordinates *ngIf=\"displayCurrentCoordinates\" [currentLat]=\"map?.currentLat\" [currentLng]=\"map?.currentLng\"\n  (moveToCoordinates$)=\"moveToCoordinates($event)\"></arlas-coordinates>\n\n<arlas-basemap *ngIf=\"showBasemapList\" [mapSources]=\"mapSources\" [map]=\"map\" (mouseleave)=\"hideBasemapSwitcher()\"\n  (basemapChanged)=\"onChangeBasemapStyle()\"></arlas-basemap>\n\n\n<arlas-draw #drawComponent *ngIf=\"map\" [map]=\"map\" [emptyData]=\"emptyData\" [drawData]=\"drawData\"\n  [drawButtonEnabled]=\"drawButtonEnabled\" [drawOption]=\"drawOption\"\n  [drawPolygonVerticesLimit]=\"drawPolygonVerticesLimit\" [preserveDrawingBuffer]=\"preserveDrawingBuffer\"\n  (onAoiChanged)=\"onAoiChanged.emit($event)\"\n  (onAoiEdit)=\"onAoiEdit.emit($event)\"></arlas-draw>", styles: ["@charset \"UTF-8\";.map__container{width:100%;height:100%;position:absolute!important}.map__visu-list{position:absolute;display:flex;flex-direction:column;top:220px;right:7px;z-index:1;background:transparent;flex-wrap:wrap-reverse}.map__legend-button{cursor:pointer;margin-bottom:4px;border-radius:3px;background-color:#fff;width:30px;height:30px;padding:3px}.map__legend-button:hover{background-color:#f5f5f5}.map__visu-list--container{padding:1px 1px 3px;border-radius:2px;max-height:calc(100vh - 415px);overflow-y:auto;overflow-x:hidden}.map__visu-item{margin:1px;padding:unset;padding-right:3px;width:225px;border:.8px solid #ddd;background:#fff;border-radius:3px}.map__visu-title{display:flex;justify-content:space-between;padding:1px 5px 1px 0;font-weight:550;font-size:14px;cursor:grab;--mdc-switch-track-width: 24px;--mdc-switch-track-height: 5px;--mdc-switch-handle-width: 12px;--mdc-switch-state-layer-size: 0;--mat-switch-selected-handle-horizontal-margin: 0 1px}.map__visu-title:hover .map__visu-toggle .map__visu-drag{visibility:visible}.map__visu-title .mdc-switch__handle{--mat-switch-unselected-handle-size: 12px;--mat-switch-selected-handle-size: 12px;--mat-switch-pressed-handle-size: 12px;--mdc-switch-unselected-handle-color: lightgrey;--mdc-switch-unselected-focus-handle-color: lightgrey;--mdc-switch-unselected-hover-handle-color: lightgrey;--mdc-switch-unselected-pressed-handle-color: lightgrey}.map__visu-title-text{color:#333;padding:3px}.map__visu-title-text--disabled{color:#bbb}.map__visu-content{max-height:300px;overflow-y:auto;overflow-x:hidden}.map__visu-layer{background-color:#fff;position:relative;overflow:hidden}.map__visu-layer-drag{position:absolute;top:5px;left:0;display:flex;padding-left:3px}.map__visu-layer-drag mat-icon{font-size:18px;width:18px;height:18px;color:#999}.map__visu-layer:hover .map__visu-layer-drag{cursor:grab;z-index:2}.map__visu-layer:hover .map__visu-layer-drag mat-icon{color:#444}.draw-tooltip--hide{display:none}.draw-tooltip--show{display:block;position:fixed;overflow:hidden;font-size:.8em;background-color:#fff;border-radius:2px;padding:2px;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}::-webkit-scrollbar{width:3px!important;height:4px!important;background-color:#f5f5f5}::-webkit-scrollbar-track{box-shadow:inset 0 0 6px #0000004d;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#f5f5f5}::-webkit-scrollbar-thumb{background-color:#555}.cdk-drag-preview{box-sizing:border-box;font-size:.75em;border-radius:3px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-preview .map__visu-layer .map__visu-layer-drag mat-icon{color:#444}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.draw-control-disabled{display:none}\n"] }]
        }], ctorParameters: () => [{ type: i1.MapboxAoiDrawService }, { type: i2.BasemapService }, { type: i3.TranslateService }, { type: i4.ArlasMapFrameworkService }, { type: i5.AbstractArlasMapService }], propDecorators: { drawComponent: [{
                type: ViewChild,
                args: ['drawComponent', { static: false }]
            }], id: [{
                type: Input
            }], offset: [{
                type: Input
            }], mapLayers: [{
                type: Input
            }], displayScale: [{
                type: Input
            }], maxWidthScale: [{
                type: Input
            }], unitScale: [{
                type: Input
            }], displayCurrentCoordinates: [{
                type: Input
            }], wrapLatLng: [{
                type: Input
            }], defaultBasemapStyle: [{
                type: Input
            }], basemapStyles: [{
                type: Input
            }], initZoom: [{
                type: Input
            }], maxZoom: [{
                type: Input
            }], minZoom: [{
                type: Input
            }], initCenter: [{
                type: Input
            }], boundsToFit: [{
                type: Input
            }], fitBoundsOffSet: [{
                type: Input
            }], fitBoundsPadding: [{
                type: Input
            }], fitBoundsMaxZoom: [{
                type: Input
            }], margePanForLoad: [{
                type: Input
            }], margePanForTest: [{
                type: Input
            }], transformRequest: [{
                type: Input
            }], featureToHightLight: [{
                type: Input
            }], featuresToSelect: [{
                type: Input
            }], mapSources: [{
                type: Input
            }], redrawSource: [{
                type: Input
            }], dataSources: [{
                type: Input
            }], drawOption: [{
                type: Input
            }], drawData: [{
                type: Input
            }], drawButtonEnabled: [{
                type: Input
            }], drawPolygonVerticesLimit: [{
                type: Input
            }], preserveDrawingBuffer: [{
                type: Input
            }], mapAttributionPosition: [{
                type: Input
            }], icons: [{
                type: Input
            }], legendUpdater: [{
                type: Input
            }], visibilityUpdater: [{
                type: Input
            }], visualisationSetsConfig: [{
                type: Input
            }], onMapLoaded: [{
                type: Output
            }], onMapClosed: [{
                type: Output
            }], onMove: [{
                type: Output
            }], visualisations: [{
                type: Output
            }], onFeatureClick: [{
                type: Output
            }], onFeatureHover: [{
                type: Output
            }], onAoiChanged: [{
                type: Output
            }], onAoiEdit: [{
                type: Output
            }], onBasemapChanged: [{
                type: Output
            }], legendVisibiltyStatus: [{
                type: Output
            }], downloadSourceEmitter: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJsYXMtbWFwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2FybGFzLW1hcC9zcmMvbGliL2FybGFzLW1hcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmxhcy1tYXAvc3JjL2xpYi9hcmxhcy1tYXAuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBRUgsT0FBTyxFQUFlLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQWlCLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwSCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUd2RCxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9ELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3pFLE9BQU8sS0FBSyxhQUFhLE1BQU0seUJBQXlCLENBQUM7QUFDekQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFOUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzVELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUVqRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUUzRCxPQUFPLEVBR0wsa0JBQWtCLEVBRWxCLGFBQWEsRUFDYixPQUFPLEVB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S1UsTUFBTTtzQkFBdEIsTUFBTTtnQkFHVSxjQUFjO3NCQUE5QixNQUFNO2dCQUdVLGNBQWM7c0JBQTlCLE1BQU07Z0JBR1UsY0FBYztzQkFBOUIsTUFBTTtnQkFHVSxZQUFZO3NCQUE1QixNQUFNO2dCQUdVLFNBQVM7c0JBQXpCLE1BQU07Z0JBR1UsZ0JBQWdCO3NCQUFoQyxNQUFNO2dCQUdVLHFCQUFxQjtzQkFBckMsTUFBTTtnQkFHVSxxQkFBcUI7c0JBQXJDLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gR2lzYcOvYSB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvclxuICogbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRS50eHQgZmlsZSBkaXN0cmlidXRlZCB3aXRoXG4gKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodFxuICogb3duZXJzaGlwLiBHaXNhw69hIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byB5b3UgdW5kZXJcbiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXlcbiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ2RrRHJhZ0Ryb3AsIG1vdmVJdGVtSW5BcnJheSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9kcmFnLWRyb3AnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRha2VVbnRpbERlc3Ryb3llZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IEZlYXR1cmUsIEZlYXR1cmVDb2xsZWN0aW9uIH0gZnJvbSAnQHR1cmYvaGVscGVycyc7XG5pbXBvcnQgeyBFbGVtZW50SWRlbnRpZmllciB9IGZyb20gJ2FybGFzLXdlYi1jb21wb25lbnRzJztcbmltcG9ydCB7IGZpbmFsaXplLCBmcm9tRXZlbnQsIFN1YmplY3QsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQXJsYXNNYXBGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnLi9hcmxhcy1tYXAtZnJhbWV3b3JrLnNlcnZpY2UnO1xuaW1wb3J0ICogYXMgbWFwSnNvblNjaGVtYSBmcm9tICcuL2FybGFzLW1hcC5zY2hlbWEuanNvbic7XG5pbXBvcnQgeyBBYnN0cmFjdEFybGFzTWFwU2VydmljZSB9IGZyb20gJy4vYXJsYXMtbWFwLnNlcnZpY2UnO1xuaW1wb3J0IHsgQmFzZW1hcFN0eWxlIH0gZnJvbSAnLi9iYXNlbWFwcy9iYXNlbWFwLmNvbmZpZyc7XG5pbXBvcnQgeyBCYXNlbWFwU2VydmljZSB9IGZyb20gJy4vYmFzZW1hcHMvYmFzZW1hcC5zZXJ2aWNlJztcbmltcG9ydCB7IEFybGFzQmFzZW1hcHMgfSBmcm9tICcuL2Jhc2VtYXBzL2Jhc2VtYXBzLm1vZGVsJztcbmltcG9ydCB7IEFybGFzRHJhd0NvbXBvbmVudCB9IGZyb20gJy4vZHJhdy9hcmxhcy1kcmF3LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBBb2lEaW1lbnNpb25zIH0gZnJvbSAnLi9kcmF3L2RyYXcubW9kZWxzJztcbmltcG9ydCB7IE1hcGJveEFvaURyYXdTZXJ2aWNlIH0gZnJvbSAnLi9kcmF3L2RyYXcuc2VydmljZSc7XG5pbXBvcnQgeyBMZWdlbmREYXRhIH0gZnJvbSAnLi9sZWdlbmQvbGVnZW5kLmNvbmZpZyc7XG5pbXBvcnQge1xuICBBYnN0cmFjdEFybGFzTWFwR0wsXG4gIEFybGFzTWFwT2Zmc2V0LCBBcmxhc01hcE9wdGlvbixcbiAgQ1JPU1NfTEFZRVJfUFJFRklYLFxuICBNYXBDb25maWcsXG4gIFJFU0VUX0JFQVJJTkcsXG4gIFpPT01fSU4sIFpPT01fT1VUXG59IGZyb20gJy4vbWFwL0Fic3RyYWN0QXJsYXNNYXBHTCc7XG5pbXBvcnQgeyBDb250cm9sUG9zaXRpb24sIEljb25Db25maWcgfSBmcm9tICcuL21hcC9tb2RlbC9jb250cm9scyc7XG5pbXBvcnQgeyBNYXBMYXllck1vdXNlRXZlbnQsIE1hcE1vdXNlRXZlbnQgfSBmcm9tICcuL21hcC9tb2RlbC9ldmVudHMnO1xuaW1wb3J0IHsgTWFwRXh0ZW50IH0gZnJvbSAnLi9tYXAvbW9kZWwvZXh0ZW50JztcbmltcG9ydCB7IEFSTEFTX1ZTRVQsIEFybGFzRGF0YUxheWVyLCBnZXRMYXllck5hbWUsIE1hcExheWVycyB9IGZyb20gJy4vbWFwL21vZGVsL2xheWVycyc7XG5pbXBvcnQgeyBBcmxhc0xuZ0xhdEJvdW5kcywgT25Nb3ZlUmVzdWx0IH0gZnJvbSAnLi9tYXAvbW9kZWwvbWFwJztcbmltcG9ydCB7IEFybGFzTWFwU291cmNlIH0gZnJvbSAnLi9tYXAvbW9kZWwvc291cmNlcyc7XG5pbXBvcnQgeyBWaXN1YWxpc2F0aW9uU2V0Q29uZmlnIH0gZnJvbSAnLi9tYXAvbW9kZWwvdmlzdWFsaXNhdGlvbnNldHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcmxhcy1tYXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vYXJsYXMtbWFwLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYXJsYXMtbWFwLmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG4vKiogTDogYSBsYXllciBjbGFzcy9pbnRlcmZhY2UuXG4gKiAgUzogYSBzb3VyY2UgY2xhc3MvaW50ZXJmYWNlLlxuICogIE06IGEgTWFwIGNvbmZpZ3VyYXRpb24gY2xhc3MvaW50ZXJmYWNlLlxuICovXG5leHBvcnQgY2xhc3MgQXJsYXNNYXBDb21wb25lbnQ8TCwgUywgTT4ge1xuXG4gIC8qKiBNYXAgaW5zdGFuY2UuICovXG4gIHB1YmxpYyBtYXA6IEFic3RyYWN0QXJsYXNNYXBHTDtcbiAgLyoqIFdoZXRoZXIgdGhlIGxlZ2VuZCBpcyB2aXNpYmxlIChvcGVuKSBvciBub3QuKi9cbiAgcHVibGljIGxlZ2VuZE9wZW4gPSB0cnVlO1xuICAvKiogVXNlZCB0byBjbGVhciBnZW9qc29uIHNvdXJjZXMuICovXG4gIHB1YmxpYyBlbXB0eURhdGE6IEZlYXR1cmVDb2xsZWN0aW9uPEdlb0pTT04uR2VvbWV0cnk+ID0ge1xuICAgICd0eXBlJzogJ0ZlYXR1cmVDb2xsZWN0aW9uJyxcbiAgICAnZmVhdHVyZXMnOiBbXVxuICB9O1xuXG4gIC8qKiBXaGV0aGVyIHRoZSBsaXN0IG9mIGJhc2VtYXBzIGlzIHNob3duLiAqL1xuICBwdWJsaWMgc2hvd0Jhc2VtYXBMaXN0ID0gZmFsc2U7XG5cbiAgLyoqIFZpc2liaWxpdHkgc3RhdHVzIG9mIGVhY2ggdmlzdWFsaXNhdGlvbiBzZXQqLiAqL1xuICBwdWJsaWMgdmlzaWJpbGl0eVN0YXR1cyA9IG5ldyBNYXA8c3RyaW5nLCBib29sZWFuPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IF9vbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuXG4gIEBWaWV3Q2hpbGQoJ2RyYXdDb21wb25lbnQnLCB7IHN0YXRpYzogZmFsc2UgfSkgcHVibGljIGRyYXdDb21wb25lbnQ6IEFybGFzRHJhd0NvbXBvbmVudDxBcmxhc0RhdGFMYXllciwgUywgTT47XG5cblxuICAvKiogQU5HVUxBUiBJTlBVVFMgKi9cblxuICAvKiogQGRlc2NyaXB0aW9uIEh0bWwgaWRlbnRpZmllciBnaXZlbiB0byB0aGUgbWFwIGNvbnRhaW5lciAoaXQncyBhIGRpdiA7KSkqL1xuICBASW5wdXQoKSBwdWJsaWMgaWQgPSAnbWFwZ2wnO1xuICAvKiogQGRlc2NyaXB0aW9uIEFuIG9iamVjdCB3aXRoIG5vcnRoLGVhc3Qsc291dGgsd2VzdCBwcm9wZXJpZXMgd2hpY2ggcmVwcmVzZW50IGFuIG9mZnNldCBpbiBwaXhlbHMgKi9cbiAgLyoqIE9yaWdpbiBpcyB0b3AtbGVmdCBhbmQgeC1heGlzIGlzIHdlc3QgdG8gZWFzdCBhbmQgeS1heGlzIG5vcnRoIHRvIHNvdXRoLiovXG4gIEBJbnB1dCgpIHB1YmxpYyBvZmZzZXQ6IEFybGFzTWFwT2Zmc2V0ID0geyBub3J0aDogMCwgZWFzdDogMCwgc291dGg6IDAsIHdlc3Q6IDAgfTtcblxuICAvKiogLS0tIExBWUVSUyAqL1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gTGlzdCBvZiBjb25maWd1cmVkIChieSB0aGUgYnVpbGRlcikgbGF5ZXJzLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgbWFwTGF5ZXJzOiBNYXBMYXllcnM8QXJsYXNEYXRhTGF5ZXI+O1xuXG4gIC8qKiAtLS0gU0NBTEUgJiBDT09SRElOQVRFUyAqL1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gV2hldGhlciB0aGUgbWFwIHNjYWxlIGlzIGRpc3BsYXllZC4gKi9cbiAgQElucHV0KCkgcHVibGljIGRpc3BsYXlTY2FsZSA9IHRydWU7XG4gIC8qKiBAZGVzY3JpcHRpb24gTWF4aW1pbSB3aWR0aCBpbiBwaXhlbHMgdGhhdCB0aGUgbWFwIHNjYWxlIGNvdWxkIHRha2UuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBtYXhXaWR0aFNjYWxlID0gMTAwO1xuICAvKiogQGRlc2NyaXB0aW9uIFVuaXQgZGlzcGxheSBmb3IgdGhlIG1hcCBzY2FsZS4gKi9cbiAgQElucHV0KCkgcHVibGljIHVuaXRTY2FsZSA9ICdtZXRyaWMnO1xuICAvKiogQGRlc2NyaXB0aW9uIFdoZXRoZXIgdG8gZGlzcGxheSB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIG1vdXNlIHdoaWxlIG1vdmluZy4gKi9cbiAgQElucHV0KCkgcHVibGljIGRpc3BsYXlDdXJyZW50Q29vcmRpbmF0ZXMgPSBmYWxzZTtcbiAgLyoqIEBkZXNjcmlwdGlvbiBJZiB0cnVlLCB0aGUgY29vcmRpbmF0ZXMgdmFsdWVzIGFyZSB3cmFwcGVkIGJldHdlZW4gLTE4MCBhbmQgMTgwLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgd3JhcExhdExuZyA9IHRydWU7XG5cbiAgLyoqIC0tLSBCQVNFTUFQUyAqL1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gRGVmYXVsdCBiYXNlbWFwIHRvIGRpc3BsYXkuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBkZWZhdWx0QmFzZW1hcFN0eWxlOiBCYXNlbWFwU3R5bGU7XG4gIC8qKiBAZGVzY3JpcHRpb24gTGlzdCBvZiBhdmFpbGFibGUgYmFzZW1hcHMuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBiYXNlbWFwU3R5bGVzID0gbmV3IEFycmF5PEJhc2VtYXBTdHlsZT4oKTtcblxuICAvKiogLS0tIElOSVRJQUwgTUFQIFZJRVcgOiBaT09NcywgQ0VOVEVSLCBCT1VORFMgKi9cblxuICAvKiogQGRlc2NyaXB0aW9uIFpvb20gb2YgdGhlIG1hcCB3aGVuIGl0J3MgaW5pdGlhbGl6ZWQuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBpbml0Wm9vbSA9IDI7XG4gIC8qKiBAZGVzY3JpcHRpb24gTWF4IHpvb20gb2YgdGhlIG1hcC4gKi9cbiAgQElucHV0KCkgcHVibGljIG1heFpvb20gPSAyMjtcbiAgLyoqIEBkZXNjcmlwdGlvbiBNaW4gem9vbSBvZiB0aGUgbWFwLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgbWluWm9vbSA9IDA7XG4gIC8qKiBAZGVzY3JpcHRpb24gQ29vcmRpbmF0ZXMgb2YgdGhlIG1hcCdzIGNlbnRlciB3aGVuIGl0J3MgZmlyc3QgbG9hZGVkLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgaW5pdENlbnRlcjogW251bWJlciwgbnVtYmVyXSA9IFsyLjE5NzI2NTYyNTAwMDAwMDQsIDQ1LjcwNjE3OTI4NTMzMDg1NV07XG5cbiAgLyoqIC0tLSBCT1VORFMgVE8gRklUIFNUUkFURUdZICovXG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBCb3VuZHMgdGhhdCB0aGUgdmlldyBtYXAgZml0cy4gSXQncyBhbiBhcnJheSBvZiB0d28gY29ybmVycy4gKi9cbiAgLyoqIEVhY2ggY29ybmVyIGlzIGFuIGxhdC1sb25nIHBvc2l0aW9uLiBGb3IgZXhhbXBsZTogYm91bmRzVG9GaXQgPSBbWzMwLjUxLCAtNTQuM10sWzMwLjU3LCAtNTQuMl1dICovXG4gIEBJbnB1dCgpIHB1YmxpYyBib3VuZHNUb0ZpdDogQXJyYXk8QXJyYXk8bnVtYmVyPj47XG4gIC8qKiBAZGVzY3JpcHRpb24gVGhlIHBhZGRpbmcgYWRkZWQgaW4gdGhlIHRvcC1sZWZ0IGFuZCBib3R0b20tcmlnaHQgY29ybmVycyBvZiBhIG1hcCBjb250YWluZXIgdGhhdCBzaG91bGRuJ3QgYmUgYWNjb3VudGVkICovXG4gIC8qKiBmb3Igd2hlbiBzZXR0aW5nIHRoZSB2aWV3IHRvIGZpdCBib3VuZHMuKi9cbiAgQElucHV0KCkgcHVibGljIGZpdEJvdW5kc09mZlNldDogW251bWJlciwgbnVtYmVyXSA9IFswLCAwXTtcbiAgLyoqICBAZGVzY3JpcHRpb24gUGFkZGluZyB2YWx1ZSBhcHBsaWVkIGFyb3VuZCBhIGZpdEJvdW5kcyB0byBmdWxseSBzaG93IHRoZSBhcmVhIHRhcmdldGVkLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgZml0Qm91bmRzUGFkZGluZyA9IDEwO1xuICAvKiogQGRlc2NyaXB0aW9uIFRoZSBtYXhpbXVtIHpvb20gbGV2ZWwgc28gdGhhdCB0aGUgYm91bmRzIGZpdCB0aGUgbWFwIHZpZXcuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBmaXRCb3VuZHNNYXhab29tID0gMjI7XG5cbiAgLyoqIC0tLSBEQVRBIExPQURJTkcgU1RSQVRFR0lFUyAqL1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gTWFyZ2luIGFwcGxpZWQgdG8gdGhlIG1hcCBleHRlbnQuIERhdGEgd2lsbCBiZSBmZXRjaGVkIGluIGFsbCB0aGlzIGV4dGVudC4gKi9cbiAgQElucHV0KCkgcHVibGljIG1hcmdlUGFuRm9yTG9hZDogbnVtYmVyO1xuICAvKiogQGRlc2NyaXB0aW9uIE1hcmdpbiBhcHBsaWVkIHRvIHRoZSBtYXAgZXh0ZW50LiBCZWZvcmUgbG9hZGluZyBkYXRhLFxuICAgKiB0aGUgY29tcG9uZW50cyBjaGVja3MgZmlyc3QgaWYgdGhlcmUgYXJlIGZlYXR1cmVzIGFscmVhZHkgbG9hZGVkIGluIHRoaXMgZXh0ZW50LiAqL1xuICBASW5wdXQoKSBwdWJsaWMgbWFyZ2VQYW5Gb3JUZXN0OiBudW1iZXI7XG4gIC8qKiBAZGVzY3JpcHRpb24gQSBjYWxsYmFjayBydW4gYmVmb3JlIHRoZSBNYXAgbWFrZXMgYSByZXF1ZXN0IGZvciBhbiBleHRlcm5hbCBVUkwvICovXG4gIEBJbnB1dCgpIHB1YmxpYyB0cmFuc2Zvcm1SZXF1ZXN0OiB1bmtub3duIC8qKiBUcmFuc2Zvcm1SZXF1ZXN0RnVuY3Rpb24gb3IgUmVxdWVzdFRyYW5zZm9ybVJlcXVlc3QgKi87XG5cbiAgLyoqIC0tLSBNQVAgSU5URVJBQ1RJT04gKi9cblxuICAvKiogQGRlc2NyaXB0aW9uIEZlYXR1cmUgdG8gaGlnaGxpZ2h0LiAqL1xuICBASW5wdXQoKSBwdWJsaWMgZmVhdHVyZVRvSGlnaHRMaWdodDogeyBpc2xlYXZpbmc6IGJvb2xlYW47IGVsZW1lbnRpZGVudGlmaWVyOiBFbGVtZW50SWRlbnRpZmllcjsgfTtcbiAgLyoqIEBkZXNjcmlwdGlvbiBMaXN0IG9mIGZlYXR1cmVzIHRvIHNlbGVjdC4gKi9cbiAgQElucHV0KCkgcHVibGljIGZlYXR1cmVzVG9TZWxlY3Q6IEFycmF5PEVsZW1lbnRJZGVudGlmaWVyPjtcblxuICAvKiogLS0tIFNPVVJDRVMgKi9cblxuICAvKiogQGRlc2NyaXB0aW9uIExpc3Qgb2Ygc291cmNlcyB0byBhZGQgdG8gdGhlIG1hcC4gKi9cbiAgQElucHV0KCkgcHVibGljIG1hcFNvdXJjZXM6IEFycmF5PEFybGFzTWFwU291cmNlPFM+PjtcbiAgLyoqIEBkZXNjcmlwdGlvbiBTdWJqZWN0IHRvIHdoaWNoIHRoZSBjb21wb25lbnQgc3Vic2NyaWJlcyB0byByZWRyYXcgb24gdGhlIG1hcCB0aGUgYGRhdGFgIG9mIHRoZSBnaXZlbiBgc291cmNlYC4gKi9cbiAgQElucHV0KCkgcHVibGljIHJlZHJhd1NvdXJjZSA9IG5ldyBTdWJqZWN0PHsgc291cmNlOiBzdHJpbmc7IGRhdGE6IEZlYXR1cmU8R2VvSlNPTi5HZW9tZXRyeT5bXTsgfT4oKTtcbiAgLyoqIEBkZXNjcmlwdGlvbiBMaXN0IG9mIGRhdGEgc291cmNlcyBuYW1lcyB0aGF0IHNob3VsZCBiZSBhZGRlZCB0byB0aGUgbWFwLiBTb3VyY2VzIHNob3VsZCBiZSBvZiB0eXBlIGBnZW9qc29uYC4gKi9cbiAgQElucHV0KCkgcHVibGljIGRhdGFTb3VyY2VzOiBTZXQ8c3RyaW5nPjtcblxuICAvKiogLS0tIERSQVcgKi9cblxuICAvKiogIEBkZXNjcmlwdGlvbiBPcHRpb25zIG9iamVjdCBmb3IgZHJhdyB0b29scyA6IGh0dHBzOi8vZ2l0aHViLmNvbS9tYXBib3gvbWFwYm94LWdsLWRyYXcvYmxvYi9tYXN0ZXIvZG9jcy9BUEkubWQjb3B0aW9ucyAqL1xuICBASW5wdXQoKSBwdWJsaWMgZHJhd09wdGlvbjogYW55ID0ge307XG4gIC8qKiBAZGVzY3JpcHRpb24gRmVhdHVyZXMgZHJhd24gYXQgY29tcG9uZW50IHN0YXJ0ICovXG4gIEBJbnB1dCgpIHB1YmxpYyBkcmF3RGF0YTogRmVhdHVyZUNvbGxlY3Rpb248R2VvSlNPTi5HZW9tZXRyeT4gPSAoeyAuLi50aGlzLmVtcHR5RGF0YX0pO1xuICAvKiogQGRlc2NyaXB0aW9uIFdoZXRoZXIgdGhlIGRyYXcgdG9vbHMgYXJlIGFjdGl2YXRlZC4gKi9cbiAgQElucHV0KCkgcHVibGljIGRyYXdCdXR0b25FbmFibGVkID0gZmFsc2U7XG4gIC8qKiBAZGVzY3JpcHRpb24gTWF4aW11bSBudW1iZXIgb2YgdmVydGljZXMgYWxsb3dlZCBmb3IgYSBwb2x5Z29uLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgZHJhd1BvbHlnb25WZXJ0aWNlc0xpbWl0OiBudW1iZXI7XG4gIC8qKiBAZGVzY3JpcHRpb24gV2hldGhlciB0aGUgZHJhd2luZyBidWZmZXIgaXMgYWN0aXZhdGVkICovXG4gIC8qKiBJZiB0cnVlLCB0aGUgbWFwJ3MgY2FudmFzIGNhbiBiZSBleHBvcnRlZCB0byBhIFBORyB1c2luZyBtYXAuZ2V0Q2FudmFzKCkudG9EYXRhVVJMKCkuIERlZmF1bHQ6IGZhbHNlICovXG4gIEBJbnB1dCgpIHB1YmxpYyBwcmVzZXJ2ZURyYXdpbmdCdWZmZXIgPSBmYWxzZTtcblxuICAvKiogLS0tIEFUVFJJQlVUSU9OICovXG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBQb3NpdGlvbiBvZiB0aGUgbWFwIGF0dHJpYnV0aW9uLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgbWFwQXR0cmlidXRpb25Qb3NpdGlvbjogQ29udHJvbFBvc2l0aW9uID0gJ2JvdHRvbS1yaWdodCc7XG5cbiAgLyoqIC0tLSBNQVAgSUNPTlMgKi9cblxuICAvKiogQGRlc2NyaXB0aW9uIExpc3Qgb2YgaWNvbnMgdG8gYWRkIHRvIHRoZSBtYXAgYW5kIHRoYXQgY2FuIGJlIHVzZWQgaW4gbGF5ZXJzLiAqL1xuICBASW5wdXQoKSBwdWJsaWMgaWNvbnM6IEFycmF5PEljb25Db25maWc+O1xuXG4gIC8qKiAtLS0gTEVHRU5EIEFORCBWSVNVQUxJU0FUSU9OUyAqL1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gU3ViamVjdCBvZiBbY29sbGVjdGlvbiwgW2ZpZWxkLCBsZWdlbmREYXRhXV0gbWFwLiBUaGUgbWFwIHN1YnNjcmliZXMgdG8gaXQgdG8ga2VlcCAqL1xuICAvKiogdGhlIGxlZ2VuZCB1cGRhdGVkIHdpdGggdGhlIGRhdGEgZGlzcGxheWVkIG9uIHRoZSBtYXAuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBsZWdlbmRVcGRhdGVyOiBTdWJqZWN0PE1hcDxzdHJpbmcsIE1hcDxzdHJpbmcsIExlZ2VuZERhdGE+Pj4gPSBuZXcgU3ViamVjdCgpO1xuICAvKiogQGRlc2NyaXB0aW9uIFN1YmplY3Qgb2YgW2xheWVySWQsIGJvb2xlYW5dIG1hcC4gVGhlIG1hcCBzdWJzY3JpYmVzIHRvIGl0IHRvIGtlZXAgKi9cbiAgLyoqIHRoZSBsZWdlbmQgdXBkYXRlZCB3aXRoIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBsYXllci4qL1xuICBASW5wdXQoKSBwdWJsaWMgdmlzaWJpbGl0eVVwZGF0ZXI6IFN1YmplY3Q8TWFwPHN0cmluZywgYm9vbGVhbj4+ID0gbmV3IFN1YmplY3QoKTtcbiAgLyoqIEBkZXNjcmlwdGlvbiBMaXN0IG9mIHZpc3VhbGlzYXRpb24gc2V0cy4gQSBWaXN1YWxpc2F0aW9uIHNldCBpcyBhbiBlbnRpdHkgd2hlcmUgbGF5ZXJzIGFyZSBncm91cGVkIHRvZ2V0aGVyLiAqL1xuICAvKiogSWYgYSB2aXN1YWxpc2F0aW9uIHNldCBpcyBlbmFibGVkLCBhbGwgdGhlIGxheWVycyBpbiBpdCBjYW4gYmUgZGlzcGxheWVkIG9uIHRoZSBtYXAsIG90aGVyd2lzZSB0aGUgbGF5ZXJzIGFyZSByZW1vdmVkIGZyb20gdGhlIG1hcC4gKi9cbiAgQElucHV0KCkgcHVibGljIHZpc3VhbGlzYXRpb25TZXRzQ29uZmlnOiBBcnJheTxWaXN1YWxpc2F0aW9uU2V0Q29uZmlnPjtcblxuXG4gIC8qKiBBTkdVTEFSIE9VVFBVVFMgKi9cblxuICAvKiogQGRlc2NyaXB0aW9uIEVtaXRzIHRydWUgYWZ0ZXIgdGhlIG1hcCBpcyBsb2FkZWQgYW5kIGFsbCBzb3VyY2VzICYgbGF5ZXJzIGFyZSBhZGRlZC4gKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBvbk1hcExvYWRlZDogU3ViamVjdDxib29sZWFuPiA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgbWFwIGV4dGVudCB3aGVuIHRoZSBicm93c2VyIHRhYiBpcyBjbG9zZWQvcmVmcmVzaGVkLiAqL1xuICBAT3V0cHV0KCkgcHVibGljIG9uTWFwQ2xvc2VkOiBFdmVudEVtaXR0ZXI8TWFwRXh0ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwRXh0ZW50PigpO1xuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiBAZGVzY3JpcHRpb24gIEVtaXRzIHRoZSBldmVudCBvZiBtb3ZpbmcgdGhlIG1hcC4gKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBvbk1vdmU6IEV2ZW50RW1pdHRlcjxPbk1vdmVSZXN1bHQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxPbk1vdmVSZXN1bHQ+KCk7XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgdmlzaWJsZSB2aXN1YWxpc2F0aW9uIHNldHMnIG5hbWVzICovXG4gIEBPdXRwdXQoKSBwdWJsaWMgdmlzdWFsaXNhdGlvbnM6IEV2ZW50RW1pdHRlcjxTZXQ8c3RyaW5nPj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgZmVhdHVyZXMgdGhhdCB3ZXJlIGNsaWNrZWQgb24uICovXG4gIEBPdXRwdXQoKSBwdWJsaWMgb25GZWF0dXJlQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZmVhdHVyZXM6IEFycmF5PEdlb0pTT04uRmVhdHVyZTxHZW9KU09OLkdlb21ldHJ5Pj47IHBvaW50OiBbbnVtYmVyLCBudW1iZXJdOyB9PigpO1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gRW1pdHMgdGhlIGZlYXR1cmVzIHRoYXQgd2VyZSBob3ZlcmVkLiAqL1xuICBAT3V0cHV0KCkgcHVibGljIG9uRmVhdHVyZUhvdmVyID0gbmV3IEV2ZW50RW1pdHRlcjx7IGZlYXR1cmVzOiBBcnJheTxHZW9KU09OLkZlYXR1cmU8R2VvSlNPTi5HZW9tZXRyeT4+OyBwb2ludDogW251bWJlciwgbnVtYmVyXTsgfSB8IHt9PigpO1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gRW1pdHMgdGhlIGdlb2pzb24gb2YgYWxsIGFvaXMgYWRkZWQgdG8gdGhlIG1hcC4gKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBvbkFvaUNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxGZWF0dXJlQ29sbGVjdGlvbjxHZW9KU09OLkdlb21ldHJ5Pj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbWl0cyB0aGUgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIHBvbHlnb24vYmJveCB0aGF0IGlzIGJlaW5nIGRyYXduLiAqL1xuICBAT3V0cHV0KCkgcHVibGljIG9uQW9pRWRpdDogRXZlbnRFbWl0dGVyPEFvaURpbWVuc2lvbnM+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gRW1pdHMgYW4gZXZlbnQgd2hlbiB0aGUgYmFzZW1hcCBoYXMgYmVlbiBjaGFuZ2VkIGJ5IHRoZSB1c2VyLiAqL1xuICBAT3V0cHV0KCkgcHVibGljIG9uQmFzZW1hcENoYW5nZWQ6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIC8qKiBAZGVzY3JpcHRpb24gRW1pdHMgd2hpY2ggbGF5ZXJzIGFyZSBkaXNwbGF5ZWQgb24gdGhlIG1hcC4gKi9cbiAgQE91dHB1dCgpIHB1YmxpYyBsZWdlbmRWaXNpYmlsdHlTdGF0dXM6IFN1YmplY3Q8TWFwPHN0cmluZywgYm9vbGVhbj4+ID0gbmV3IFN1YmplY3QoKTtcblxuICAvKiogQGRlc2NyaXB0aW9uICBOb3RpZmllcyB0aGF0IHRoZSB1c2VyIHdhbnRzIHRvIGRvd25sb2FkIHRoZSBzZWxlY3RlZCBsYXllciAqL1xuICBAT3V0cHV0KCkgcHVibGljIGRvd25sb2FkU291cmNlRW1pdHRlcjogU3ViamVjdDx7XG4gICAgbGF5ZXJJZDogc3RyaW5nO1xuICAgIGxheWVyTmFtZTogc3RyaW5nO1xuICAgIGNvbGxlY3Rpb246IHN0cmluZztcbiAgICBzb3VyY2VOYW1lOiBzdHJpbmc7XG4gICAgZG93bmxvYWRUeXBlOiBzdHJpbmc7XG4gIH0+ID0gbmV3IFN1YmplY3QoKTtcblxuICBwcm90ZWN0ZWQgSUNPTlNfQkFTRV9QQVRIID0gJ2Fzc2V0cy9pY29ucy8nO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGRyYXdTZXJ2aWNlOiBNYXBib3hBb2lEcmF3U2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGJhc2VtYXBTZXJ2aWNlOiBCYXNlbWFwU2VydmljZTxMLCBTLCBNPiwgcHJpdmF0ZSByZWFkb25seSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIG1hcEZyYW1ld29ya1NlcnZpY2U6IEFybGFzTWFwRnJhbWV3b3JrU2VydmljZTxMLCBTLCBNPixcbiAgICBwcm90ZWN0ZWQgbWFwU2VydmljZTogQWJzdHJhY3RBcmxhc01hcFNlcnZpY2U8TCwgUywgTT4pIHtcbiAgICAgIHRoaXMuYmFzZW1hcFNlcnZpY2UucHJvdG9tYXBCYXNlbWFwQWRkZWQkLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKCkpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMucmVvcmRlckxheWVycygpKTtcbiAgfVxuXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLyoqIGluaXQgdmFsdWVzICovXG4gICAgaWYgKCF0aGlzLmluaXRDZW50ZXIpIHtcbiAgICAgIHRoaXMuaW5pdENlbnRlciA9IFswLCAwXTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaW5pdFpvb20gPT09IHVuZGVmaW5lZCB8fCB0aGlzLmluaXRab29tID09PSBudWxsKSB7XG4gICAgICB0aGlzLmluaXRab29tID0gMztcbiAgICB9XG4gICAgaWYgKHRoaXMubWF4Wm9vbSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMubWF4Wm9vbSA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5tYXhab29tID0gMjM7XG4gICAgfVxuICAgIHRoaXMubWluWm9vbSA9IHRoaXMubWluWm9vbSA/PyAwO1xuXG4gICAgLyoqIEJBU0VNQVBTICovXG4gICAgaWYgKHRoaXMuZGVmYXVsdEJhc2VtYXBTdHlsZSAmJiB0eXBlb2YgdGhpcy5kZWZhdWx0QmFzZW1hcFN0eWxlLnN0eWxlRmlsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRoaXMuZGVmYXVsdEJhc2VtYXBTdHlsZS51cmwgPSB0aGlzLmRlZmF1bHRCYXNlbWFwU3R5bGUuc3R5bGVGaWxlO1xuICAgIH1cbiAgICB0aGlzLmJhc2VtYXBTdHlsZXMuZm9yRWFjaChibSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGJtLnN0eWxlRmlsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgYm0udXJsID0gKGJtLnN0eWxlRmlsZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5iYXNlbWFwU2VydmljZS5zZXRCYXNlbWFwcyhuZXcgQXJsYXNCYXNlbWFwcyh0aGlzLmRlZmF1bHRCYXNlbWFwU3R5bGUsIHRoaXMuYmFzZW1hcFN0eWxlcykpO1xuICAgIHRoaXMuYmFzZW1hcFNlcnZpY2UuZmV0Y2hTb3VyY2VzJCgpXG4gICAgICAucGlwZShmaW5hbGl6ZSgoKSA9PiB0aGlzLmRlY2xhcmVNYXAoKSkpXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICh0aGlzLm1hcCAmJiB0aGlzLm1hcC5nZXRNYXBQcm92aWRlcigpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChjaGFuZ2VzWydib3VuZHNUb0ZpdCddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3QgbmV3Qm91bmRzVG9GaXQgPSBjaGFuZ2VzWydib3VuZHNUb0ZpdCddLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgdGhpcy5tYXAuZml0Qm91bmRzKG5ld0JvdW5kc1RvRml0LCB7XG4gICAgICAgICAgbWF4Wm9vbTogdGhpcy5maXRCb3VuZHNNYXhab29tLFxuICAgICAgICAgIG9mZnNldDogdGhpcy5maXRCb3VuZHNPZmZTZXRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoY2hhbmdlc1snZmVhdHVyZVRvSGlnaHRMaWdodCddICE9PSB1bmRlZmluZWRcbiAgICAgICAgJiYgY2hhbmdlc1snZmVhdHVyZVRvSGlnaHRMaWdodCddLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlc1snZmVhdHVyZVRvSGlnaHRMaWdodCddLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgY29uc3QgZmVhdHVyZVRvSGlnaHRMaWdodCA9IGNoYW5nZXNbJ2ZlYXR1cmVUb0hpZ2h0TGlnaHQnXS5jdXJyZW50VmFsdWU7XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0RmVhdHVyZShmZWF0dXJlVG9IaWdodExpZ2h0KTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGFuZ2VzWydmZWF0dXJlc1RvU2VsZWN0J10gIT09IHVuZGVmaW5lZFxuICAgICAgICAmJiBjaGFuZ2VzWydmZWF0dXJlc1RvU2VsZWN0J10uY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzWydmZWF0dXJlc1RvU2VsZWN0J10ucHJldmlvdXNWYWx1ZSkge1xuICAgICAgICBjb25zdCBmZWF0dXJlc1RvU2VsZWN0ID0gY2hhbmdlc1snZmVhdHVyZXNUb1NlbGVjdCddLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgdGhpcy5zZWxlY3RGZWF0dXJlcyhmZWF0dXJlc1RvU2VsZWN0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKiogSWYgdHJhbnNmb3JtUmVxdWVzdCcgQElucHV0IHdhcyBub3Qgc2V0LCBzZXQgYSBkZWZhdWx0IHZhbHVlIDogYSBmdW5jdGlvbiB0aGF0IG1haW50YWlucyB0aGUgc2FtZSB1cmwgKi9cbiAgcHVibGljIGluaXRUcmFuc2Zvcm1SZXF1ZXN0KCkge1xuICAgIGlmICghdGhpcy50cmFuc2Zvcm1SZXF1ZXN0KSB7XG4gICAgICB0aGlzLnRyYW5zZm9ybVJlcXVlc3QgPSB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UuZ2V0SW5pdFRyYW5zZm9ybVJlcXVlc3QoKTtcbiAgICB9XG4gIH1cblxuICAvKiogWm9vbXMgb24gY2xpY2tlZCBmZWF0dXJlIGZyb20gbWFwIG1vdXNlIGV2ZW50IGUuXG4gICAqIEBwYXJhbSBtb3VzZUV2ZW50IE1hcCBtb3VzZSBldmVudCBwcm92aWRlZCBieSB0aGUgbWFwIGluc3RhbmNlLlxuICAgKi9cbiAgcHVibGljIHpvb21PbkNsaWNrKG1vdXNlRXZlbnQ6IE1hcE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCB6b29tID0gdGhpcy5tYXAuZ2V0Wm9vbSgpO1xuICAgICAgbGV0IG5ld1pvb206IG51bWJlcjtcbiAgICAgIGlmICh6b29tID49IDAgJiYgem9vbSA8IDMpIHtcbiAgICAgICAgbmV3Wm9vbSA9IDQ7XG4gICAgICB9IGVsc2UgaWYgKHpvb20gPj0gMyAmJiB6b29tIDwgNSkge1xuICAgICAgICBuZXdab29tID0gNTtcbiAgICAgIH0gZWxzZSBpZiAoem9vbSA+PSA1ICYmIHpvb20gPCA3KSB7XG4gICAgICAgIG5ld1pvb20gPSA3O1xuICAgICAgfSBlbHNlIGlmICh6b29tID49IDcgJiYgem9vbSA8IDEwKSB7XG4gICAgICAgIG5ld1pvb20gPSAxMDtcbiAgICAgIH0gZWxzZSBpZiAoem9vbSA+PSAxMCAmJiB6b29tIDwgMTEpIHtcbiAgICAgICAgbmV3Wm9vbSA9IDExO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3Wm9vbSA9IDEyO1xuICAgICAgfVxuICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLmZseVRvKG1vdXNlRXZlbnQubG5nTGF0LmxhdCwgbW91c2VFdmVudC5sbmdMYXQubG5nLCBuZXdab29tLCB0aGlzLm1hcCk7XG4gIH1cblxuICAvKipcbiAgICogUXVlcmllcyBhbGwgcmVuZGVyZWQgZmVhdHVyZXMgb24gdGhlIHBvc2l0aW9uIHRoYXQgd2FzIGNsaWNrZWQgb24sIG9uIGEgbGF5ZXI7IGFuZCBlbWl0cyB0aG9zZSBmZWF0dXJlcy5cbiAgICogQHBhcmFtIG1hcExheWVyTW91c2VFdmVudCBNYXAgbW91c2UgZXZlbnQgcHJvdmlkZWQgYnkgYSBsYXllciBpbnN0YW5jZS5cbiAgICovXG4gIHByb3RlY3RlZCBxdWVyeVJlbmRlcihtYXBMYXllck1vdXNlRXZlbnQ6IE1hcExheWVyTW91c2VFdmVudCkge1xuICAgIGNvbnN0IGhhc0Nyb3NzT3JEcmF3TGF5ZXIgPSB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UucXVlcnlGZWF0dXJlcyhtYXBMYXllck1vdXNlRXZlbnQsIHRoaXMubWFwLCBDUk9TU19MQVlFUl9QUkVGSVgpO1xuICAgIGlmICghdGhpcy5kcmF3U2VydmljZS5pc0RyYXdpbmdCYm94ICYmICF0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ1BvbHlnb25cbiAgICAgICYmICF0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZ0NpcmNsZSAmJiAhdGhpcy5kcmF3U2VydmljZS5pc0luU2ltcGxlRHJhd01vZGUgJiYgIWhhc0Nyb3NzT3JEcmF3TGF5ZXIpIHtcbiAgICAgIHRoaXMub25GZWF0dXJlQ2xpY2submV4dCh7IGZlYXR1cmVzOiBtYXBMYXllck1vdXNlRXZlbnQuZmVhdHVyZXMsIHBvaW50OiBbbWFwTGF5ZXJNb3VzZUV2ZW50LmxuZ0xhdC5sbmcsIG1hcExheWVyTW91c2VFdmVudC5sbmdMYXQubGF0XSB9KTtcbiAgICB9XG4gIH1cblxuICAvKiogQGRlc2NyaXB0aW9uIEFkZHMgdGhlIGN1c3RvbSBpY29ucyBnaXZlbiBpbiB0aGUgY29tcG9uZW50J3MgaW5wdXQgKi9cbiAgcHVibGljIGFkZEljb25zKCkge1xuICAgIGlmICh0aGlzLmljb25zKSB7XG4gICAgICB0aGlzLmljb25zLmZvckVhY2goaWNvbiA9PiB7XG4gICAgICAgIGNvbnN0IGljb25OYW1lID0gaWNvbi5wYXRoLnNwbGl0KCcuJylbMF07XG4gICAgICAgIGNvbnN0IGljb25QYXRoID0gdGhpcy5JQ09OU19CQVNFX1BBVEggKyBpY29uLnBhdGg7XG4gICAgICAgIGNvbnN0IGljb25FcnJvck1lc3NhZ2UgPSAnVGhlIGljb24gXCInICsgdGhpcy5JQ09OU19CQVNFX1BBVEggKyBpY29uLnBhdGggKyAnXCIgaXMgbm90IGZvdW5kJztcbiAgICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLmFkZEltYWdlKGljb25OYW1lLCBpY29uUGF0aCwgdGhpcy5tYXAsIGljb25FcnJvck1lc3NhZ2UsIHsgJ3NkZic6IGljb24ucmVjb2xvcmFibGUgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UuYWRkSW1hZ2UoJ3JvdGF0ZScsIHRoaXMuSUNPTlNfQkFTRV9QQVRIICsgJ3JvdGF0ZS8wMS5wbmcnLCB0aGlzLm1hcCwgJ1JvdGF0ZSBub3QgZm91bmQnKTtcbiAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UuYWRkSW1hZ2UoJ3Jlc2l6ZScsIHRoaXMuSUNPTlNfQkFTRV9QQVRIICsgJ3Jlc2l6ZS8wMS5wbmcnLCB0aGlzLm1hcCwgJ1Jlc2l6ZSBub3QgZm91bmQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gQ3JlYXRlcyB0aGUgbWFwIGluc3RhbmNlIGFuZCBhZGRzIHRoZSBiYXNlbWFwLCBhcmxhcyBkYXRhXG4gICAqIGFuZCBzdGFydHMgbGlzdGVuaW5nIHRvIGFybGFzIGRhdGEgY2hhbmdlcyBhbmQgbGF5ZXJzIHZpc2liaWxpdHkgdXBkYXRlcy5cbiAgICogSXQgYWxzbyBzdGFydHMgZW1pdGluZyBtYXAgbW92ZWVuZCBldmVudC5cbiAgICovXG4gIHB1YmxpYyBkZWNsYXJlTWFwKCkge1xuICAgIHRoaXMuaW5pdFRyYW5zZm9ybVJlcXVlc3QoKTtcbiAgICBjb25zdCBhcmxhc01hcE9wdGlvbjogQXJsYXNNYXBPcHRpb24gPSB7XG4gICAgICBjb250YWluZXI6IHRoaXMuaWQsXG4gICAgICBzdHlsZTogdGhpcy5iYXNlbWFwU2VydmljZS5nZXRJbml0U3R5bGUodGhpcy5iYXNlbWFwU2VydmljZS5iYXNlbWFwcy5nZXRTZWxlY3RlZCgpKSxcbiAgICAgIGNlbnRlcjogdGhpcy5pbml0Q2VudGVyLFxuICAgICAgem9vbTogdGhpcy5pbml0Wm9vbSxcbiAgICAgIG1heFpvb206IHRoaXMubWF4Wm9vbSxcbiAgICAgIG1pblpvb206IHRoaXMubWluWm9vbSxcbiAgICAgIHJlbmRlcldvcmxkQ29waWVzOiB0cnVlLFxuICAgICAgcHJlc2VydmVEcmF3aW5nQnVmZmVyOiB0aGlzLnByZXNlcnZlRHJhd2luZ0J1ZmZlcixcbiAgICAgIGxvY2FsZToge1xuICAgICAgICAnTmF2aWdhdGlvbkNvbnRyb2wuWm9vbUluJzogdGhpcy50cmFuc2xhdGUuaW5zdGFudChaT09NX0lOKSxcbiAgICAgICAgJ05hdmlnYXRpb25Db250cm9sLlpvb21PdXQnOiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KFpPT01fT1VUKSxcbiAgICAgICAgJ05hdmlnYXRpb25Db250cm9sLlJlc2V0QmVhcmluZyc6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoUkVTRVRfQkVBUklORylcbiAgICAgIH0sXG4gICAgICBwaXRjaFdpdGhSb3RhdGU6IGZhbHNlLFxuICAgICAgdHJhbnNmb3JtUmVxdWVzdDogdGhpcy50cmFuc2Zvcm1SZXF1ZXN0LFxuICAgICAgYXR0cmlidXRpb25Db250cm9sOiBmYWxzZSxcbiAgICB9O1xuICAgIGNvbnN0IG1hcFByb3ZpZGVyT3B0aW9ucyA9IHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5idWlsZE1hcFByb3ZpZGVyT3B0aW9uKGFybGFzTWFwT3B0aW9uKTtcbiAgICBjb25zdCBjb25maWc6IE1hcENvbmZpZzxNPiA9IHtcbiAgICAgIGRpc3BsYXlDdXJyZW50Q29vcmRpbmF0ZXM6IHRoaXMuZGlzcGxheUN1cnJlbnRDb29yZGluYXRlcyxcbiAgICAgIGZpdEJvdW5kc1BhZGRpbmc6IHRoaXMuZml0Qm91bmRzUGFkZGluZyxcbiAgICAgIG1hcmdlUGFuRm9yTG9hZDogdGhpcy5tYXJnZVBhbkZvckxvYWQsXG4gICAgICBtYXJnZVBhbkZvclRlc3Q6IHRoaXMubWFyZ2VQYW5Gb3JUZXN0LFxuICAgICAgb2Zmc2V0OiB0aGlzLm9mZnNldCxcbiAgICAgIHdyYXBMYXRMbmc6IHRoaXMud3JhcExhdExuZyxcbiAgICAgIG1heFdpZHRoU2NhbGU6IHRoaXMubWF4V2lkdGhTY2FsZSxcbiAgICAgIHVuaXRTY2FsZTogdGhpcy51bml0U2NhbGUsXG4gICAgICBtYXBQcm92aWRlck9wdGlvbnMsXG4gICAgICBjb250cm9sczoge1xuICAgICAgICBtYXBBdHRyaWJ1dGlvbjoge1xuICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgICAgICBwb3NpdGlvbjogdGhpcy5tYXBBdHRyaWJ1dGlvblBvc2l0aW9uLFxuICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgY29tcGFjdDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNjYWxlOiB7XG4gICAgICAgICAgZW5hYmxlOiB0aGlzLmRpc3BsYXlTY2FsZVxuICAgICAgICB9LFxuICAgICAgICBuYXZpZ2F0aW9uQ29udHJvbDoge1xuICAgICAgICAgIGVuYWJsZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBwaXRjaFRvZ2dsZToge1xuICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb25maWc6IHsgYmVhcmluZzogLTIwLCBwaXRjaDogNzAsIG1pbnBpdGNoem9vbTogMTEgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLm1hcCA9IHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5jcmVhdGVNYXAoY29uZmlnKTtcbiAgICBmcm9tRXZlbnQod2luZG93LCAnYmVmb3JldW5sb2FkJykuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMub25NYXBDbG9zZWQubmV4dCh0aGlzLm1hcC5nZXRNYXBFeHRlbmQoKSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLm1hcC5vbkN1c3RvbUV2ZW50KCdiZWZvcmVPbkxvYWRJbml0JywgKCkgPT4ge1xuICAgICAgdGhpcy5iYXNlbWFwU2VydmljZS5kZWNsYXJlUHJvdG9tYXBQcm90b2NvbCh0aGlzLm1hcCk7XG4gICAgICB0aGlzLmJhc2VtYXBTZXJ2aWNlLmFkZFByb3RvbWFwQmFzZW1hcCh0aGlzLm1hcCk7XG4gICAgICB0aGlzLmFkZEljb25zKCk7XG4gICAgICB0aGlzLm1hcFNlcnZpY2UuZGVjbGFyZUFybGFzRGF0YVNvdXJjZXModGhpcy5kYXRhU291cmNlcywgdGhpcy5lbXB0eURhdGEsIHRoaXMubWFwKTtcbiAgICAgIHRoaXMubWFwU2VydmljZS5kZWNsYXJlQmFzZW1hcFNvdXJjZXModGhpcy5tYXBTb3VyY2VzLCB0aGlzLm1hcCk7XG4gICAgICB0aGlzLm1hcFNlcnZpY2UuYWRkQXJsYXNEYXRhTGF5ZXJzKHRoaXMudmlzdWFsaXNhdGlvblNldHNDb25maWcsIHRoaXMubWFwTGF5ZXJzLCB0aGlzLm1hcCk7XG4gICAgICB0aGlzLmxpc3RlblRvTGF5ZXJzRXZlbnRzKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uub25NYXBFdmVudCgnbG9hZCcsIHRoaXMubWFwLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5tYXBMYXllcnMgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy52aXNpYmlsaXR5VXBkYXRlci5zdWJzY3JpYmUodmlzaWJpbGl0eVN0YXR1cyA9PiB7XG4gICAgICAgICAgdGhpcy5tYXBTZXJ2aWNlLnVwZGF0ZVZpc2liaWxpdHkodmlzaWJpbGl0eVN0YXR1cywgdGhpcy52aXN1YWxpc2F0aW9uU2V0c0NvbmZpZywgdGhpcy5tYXApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMub25NYXBMb2FkZWQubmV4dCh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRoaXMubWFwLm9uTW92ZUVuZCh0aGlzLm1hcFNlcnZpY2UudmlzdWFsaXNhdGlvbnNTZXRzKS5zdWJzY3JpYmUoKG1vdmVSZXN1bHQgPT4ge1xuICAgICAgdGhpcy5vbk1vdmUubmV4dChtb3ZlUmVzdWx0KTtcbiAgICB9KSk7XG5cbiAgICBpZiAodGhpcy5yZWRyYXdTb3VyY2UpIHtcbiAgICAgIHRoaXMucmVkcmF3U291cmNlLnBpcGUodGFrZVVudGlsKHRoaXMuX29uRGVzdHJveSQpKS5zdWJzY3JpYmUoc2QgPT4ge1xuICAgICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0RGF0YVRvR2VvanNvblNvdXJjZSh0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UuZ2V0U291cmNlKHNkLnNvdXJjZSwgdGhpcy5tYXApLCB7XG4gICAgICAgICAgJ3R5cGUnOiAnRmVhdHVyZUNvbGxlY3Rpb24nLFxuICAgICAgICAgICdmZWF0dXJlcyc6IHNkLmRhdGFcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIExpc3RlbnMgdG8gZXZlbnRzIG9uIG1hcExheWVycyBpbnB1dCAoY29uZmlndXJlZCBsYXllcnMpLlxuICAgKi9cbiAgcHVibGljIGxpc3RlblRvTGF5ZXJzRXZlbnRzKCkge1xuICAgIC8qKiBab29tcyBvbiB0aGUgY2xpY2tlZCBmZWF0dXJlIG9mIHRoZSBnaXZlbiBsYXllcnMuICovXG4gICAgdGhpcy5tYXBMYXllcnMuZXZlbnRzLnpvb21PbkNsaWNrLmZvckVhY2gobGF5ZXJJZCA9PiB7XG4gICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uub25MYXllckV2ZW50KCdjbGljaycsIHRoaXMubWFwLCBsYXllcklkLCAoZSkgPT4gdGhpcy56b29tT25DbGljayhlKSk7XG4gICAgfSk7XG4gICAgdGhpcy5tYXBMYXllcnMuZXZlbnRzLm9uSG92ZXIuZm9yRWFjaChsYXllcklkID0+IHtcbiAgICAgIC8qKiBFbWl0cyB0aGUgaG92ZXJlZCBmZWF0dXJlIG9uIG1vdXNlbW92ZS4gKi9cbiAgICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5vbkxheWVyRXZlbnQoJ21vdXNlbW92ZScsIHRoaXMubWFwLCBsYXllcklkLCAoZSkgPT5cbiAgICAgICAgdGhpcy5vbkZlYXR1cmVIb3Zlci5uZXh0KHsgZmVhdHVyZXM6IGUuZmVhdHVyZXMsIHBvaW50OiBbZS5sbmdMYXQubG5nLCBlLmxuZ0xhdC5sYXRdIH0pKTtcbiAgICAgIC8qKiBFbWl0cyBhbiBlbXB0eSBvYmplY3Qgb24gbW91c2UgbGVhdmluZyBhIGZlYXR1cmUuICovXG4gICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uub25MYXllckV2ZW50KCdtb3VzZWxlYXZlJywgdGhpcy5tYXAsIGxheWVySWQsIChlKSA9PlxuICAgICAgICB0aGlzLm9uRmVhdHVyZUhvdmVyLm5leHQoe30pKTtcbiAgICB9KTtcbiAgICAvKiogRW1pdHMgdGhlIGNsaWNrZWQgb24gZmVhdHVyZS4gKi9cbiAgICB0aGlzLm1hcExheWVycy5ldmVudHMuZW1pdE9uQ2xpY2suZm9yRWFjaChsYXllcklkID0+IHtcbiAgICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5vbkxheWVyRXZlbnQoJ2NsaWNrJywgdGhpcy5tYXAsIGxheWVySWQsIChlKSA9PlxuICAgICAgICB0aGlzLnF1ZXJ5UmVuZGVyKGUpKTtcbiAgICB9KTtcbiAgICBjb25zdCBkcmF3UG9seWdvbkxheWVycyA9IFtcbiAgICAgICdnbC1kcmF3LXBvbHlnb24tc3Ryb2tlLWluYWN0aXZlJyxcbiAgICAgICdnbC1kcmF3LXBvbHlnb24tc3Ryb2tlLWFjdGl2ZScsXG4gICAgICAnZ2wtZHJhdy1wb2x5Z29uLXN0cm9rZS1zdGF0aWMnXG4gICAgXS5tYXAobGF5ZXIgPT4gWycuY29sZCcsICcuaG90J11cbiAgICAgIC5tYXAoaWQgPT4gbGF5ZXIuY29uY2F0KGlkKSkpXG4gICAgICAucmVkdWNlKChwLCBhYykgPT4gYWMuY29uY2F0KHApLCBbXSk7XG4gICAgLyoqIFNldHMgbW91c2UgY3Vyc29yIG9uIGRyYXduIGZlYXR1cmVzICovXG4gICAgZHJhd1BvbHlnb25MYXllcnMuZm9yRWFjaChsYXllcklkID0+IHtcbiAgICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5vbkxheWVyRXZlbnQoJ21vdXNlbW92ZScsIHRoaXMubWFwLCBsYXllcklkLCAoZSkgPT5cbiAgICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLnNldE1hcEN1cnNvcih0aGlzLm1hcCwgJ3BvaW50ZXInKSk7XG4gICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uub25MYXllckV2ZW50KCdtb3VzZWxlYXZlJywgdGhpcy5tYXAsIGxheWVySWQsIChlKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmRyYXdTZXJ2aWNlLmlzRHJhd2luZygpKSB7XG4gICAgICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLnNldE1hcEN1cnNvcih0aGlzLm1hcCwgJ2Nyb3NzaGFpcicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubWFwRnJhbWV3b3JrU2VydmljZS5zZXRNYXBDdXJzb3IodGhpcy5tYXAsICcnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKiogU2V0cyB0aGUgbGF5ZXJzIG9yZGVyIGFjY29yZGluZyB0byB0aGUgY3VycmVudCBvcmRlciBvZiBgdmlzdWFsaXNhdGlvblNldHNDb25maWdgIGxpc3QqL1xuICBwdWJsaWMgcmVvcmRlckxheWVycygpIHtcbiAgICB0aGlzLm1hcFNlcnZpY2UucmVvcmRlckxheWVycyh0aGlzLnZpc3VhbGlzYXRpb25TZXRzQ29uZmlnLCB0aGlzLm1hcCk7XG4gIH1cblxuICAvKiogQGRlc2NyaXB0aW9uIERpc3BsYXkgdGhlIGJhc2VtYXBzd2l0Y2hlciAqL1xuICBwdWJsaWMgc2hvd0Jhc2VtYXBTd2l0Y2hlcigpIHtcbiAgICB0aGlzLnNob3dCYXNlbWFwTGlzdCA9IHRydWU7XG4gIH1cblxuICAvKiogQGRlc2NyaXB0aW9uIEVtaXRzIGV2ZW50IG5vdGlmaXlpbmcgdGhhdCB0aGUgYmFzZW1hcCBoYXMgYmVlbiBjaGFuZ2VkICovXG4gIHB1YmxpYyBvbkNoYW5nZUJhc2VtYXBTdHlsZSgpIHtcbiAgICB0aGlzLm9uQmFzZW1hcENoYW5nZWQubmV4dCh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSB2aXNpYmlsaXR5IHN0YXR1cyBvZiB0aGUgbGF5ZXIgYW5kIGVtaXRzIHRoYXQgdXBkYXRlLlxuICAgKiBAcGFyYW0gdmlzdWFsaXNhdGlvbiB2aXN1YWxpc2F0aW9uIHNldCBuYW1lXG4gICAqIEBwYXJhbSBsIGxheWVyIGlkXG4gICAqIEBwYXJhbSB2aXNpYmxlIHdoZXRoZXIgdGhlIGxheWVyIGlzIGVuYWJsZWQgYW5kIHZpc2libGUgaW4gdGhlIHZpc3VhbGlzYXRpb24gc2V0XG4gICAqL1xuICBwdWJsaWMgZW1pdExlZ2VuZFZpc2liaWxpdHkodmlzdWFsaXNhdGlvbjogc3RyaW5nLCBsOiBzdHJpbmcsIHZpc2libGU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAvLyBDb3B5IHRoZSBtYXAgc28gdGhlIHBpcGUgdXBkYXRlcyB0aGUgdmFsdWVzXG4gICAgdGhpcy52aXNpYmlsaXR5U3RhdHVzID0gbmV3IE1hcCh0aGlzLnZpc2liaWxpdHlTdGF0dXMpO1xuICAgIHRoaXMudmlzaWJpbGl0eVN0YXR1cy5zZXQodmlzdWFsaXNhdGlvbiArIEFSTEFTX1ZTRVQgKyBsLCB2aXNpYmxlKTtcbiAgICB0aGlzLmxlZ2VuZFZpc2liaWx0eVN0YXR1cy5uZXh0KHRoaXMudmlzaWJpbGl0eVN0YXR1cyk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIEVtaXRzIHRoZSB2aXNpYmxlIHZpc3VhbGlzYXRpb24gc2V0XG4gICAqIEBwYXJhbSB2aXN1YWxpc2F0aW9uTmFtZSBOYW1lIG9mIHRoZSB2aXN1YWxpc2F0aW9uLlxuICAgKi9cbiAgcHVibGljIGVtaXRWaXN1YWxpc2F0aW9ucyh2aXN1YWxpc2F0aW9uTmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgbGF5ZXJzID0gdGhpcy5tYXBTZXJ2aWNlLnVwZGF0ZUxheW91dFZpc2liaWxpdHkodmlzdWFsaXNhdGlvbk5hbWUsIHRoaXMudmlzdWFsaXNhdGlvblNldHNDb25maWcsIHRoaXMubWFwKTtcbiAgICB0aGlzLnZpc3VhbGlzYXRpb25zLmVtaXQobGF5ZXJzKTtcbiAgICB0aGlzLnJlb3JkZXJMYXllcnMoKTtcbiAgfVxuXG4gIHB1YmxpYyBkb3dubG9hZExheWVyU291cmNlKGRvd25hbG9hZDogeyBsYXllcjogYW55OyBkb3dubG9hZFR5cGU6IHN0cmluZzsgfSk6IHZvaWQge1xuICAgIGNvbnN0IGRvd25sb2RlZFNvdXJjZSA9IHtcbiAgICAgIGxheWVySWQ6IGRvd25hbG9hZC5sYXllci5pZCxcbiAgICAgIGxheWVyTmFtZTogZ2V0TGF5ZXJOYW1lKGRvd25hbG9hZC5sYXllci5pZCksXG4gICAgICBjb2xsZWN0aW9uOiBkb3duYWxvYWQubGF5ZXIubWV0YWRhdGEuY29sbGVjdGlvbixcbiAgICAgIHNvdXJjZU5hbWU6IGRvd25hbG9hZC5sYXllci5zb3VyY2UgYXMgc3RyaW5nLFxuICAgICAgZG93bmxvYWRUeXBlOiBkb3duYWxvYWQuZG93bmxvYWRUeXBlXG4gICAgfTtcbiAgICB0aGlzLmRvd25sb2FkU291cmNlRW1pdHRlci5uZXh0KGRvd25sb2RlZFNvdXJjZSk7XG4gIH1cblxuICAvKiogcHV0cyB0aGUgdmlzdWFsaXNhdGlvbiBzZXQgbGlzdCBpbiB0aGUgbmV3IG9yZGVyIGFmdGVyIGRyb3BwaW5nICovXG4gIHB1YmxpYyBkcm9wKGV2ZW50OiBDZGtEcmFnRHJvcDxzdHJpbmdbXT4pIHtcbiAgICBtb3ZlSXRlbUluQXJyYXkodGhpcy52aXN1YWxpc2F0aW9uU2V0c0NvbmZpZywgZXZlbnQucHJldmlvdXNJbmRleCwgZXZlbnQuY3VycmVudEluZGV4KTtcbiAgICB0aGlzLnJlb3JkZXJMYXllcnMoKTtcbiAgfVxuXG4gIC8qKiBwdXRzIHRoZSBsYXllcnMgbGlzdCBpbiB0aGUgbmV3IG9yZGVyIGFmdGVyIGRyb3BwaW5nICovXG4gIHB1YmxpYyBkcm9wTGF5ZXIoZXZlbnQ6IENka0RyYWdEcm9wPHN0cmluZ1tdPiwgdmlzdU5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGxheWVycyA9IEFycmF5LmZyb20odGhpcy5tYXBTZXJ2aWNlLmZpbmRWaXN1YWxpc2F0aW9uU2V0TGF5ZXIodmlzdU5hbWUsIHRoaXMudmlzdWFsaXNhdGlvblNldHNDb25maWcpKTtcbiAgICBtb3ZlSXRlbUluQXJyYXkobGF5ZXJzLCBldmVudC5wcmV2aW91c0luZGV4LCBldmVudC5jdXJyZW50SW5kZXgpO1xuICAgIHRoaXMubWFwU2VydmljZS5zZXRWaXN1YWxpc2F0aW9uU2V0TGF5ZXJzKHZpc3VOYW1lLCBsYXllcnMsIHRoaXMudmlzdWFsaXNhdGlvblNldHNDb25maWcpO1xuICAgIHRoaXMucmVvcmRlckxheWVycygpO1xuICB9XG4gIHB1YmxpYyBoaWRlQmFzZW1hcFN3aXRjaGVyKCkge1xuICAgIHRoaXMuc2hvd0Jhc2VtYXBMaXN0ID0gZmFsc2U7XG4gIH1cbiAgLyoqXG4gICAqIEZpdCB0byBnaXZlbiBib3VuZHMuIE9wdGlvbnMgYXJlIGZvciBwYWRkaW5nLlxuICAgKiBAcGFyYW0gYm91bmRzIEJvdW5kcyBvZiB0aGUgbWFwIHRvIGZpdCB0by5cbiAgICovXG4gIHB1YmxpYyBmaXRUb1BhZGRlZEJvdW5kcyhib3VuZHM6IEFybGFzTG5nTGF0Qm91bmRzKSB7XG4gICAgdGhpcy5tYXAuZml0VG9QYWRkZWRCb3VuZHMoYm91bmRzKTtcbiAgfVxuICAvKipcbiAgICogQ2VudGVycyB0aGUgbWFwIHRvIHRoZSBnaXZlbiBsYXRpdHVkZS9sb25naXR1ZGUgY29vcmRpbmF0ZXMuXG4gICAqIEBwYXJhbSBsbmdMYXQgTGF0aXR1ZGUvbG9uZ2l0dWRlIGNvb3JkaW5hdGVzLlxuICAgKi9cbiAgcHVibGljIG1vdmVUb0Nvb3JkaW5hdGVzKGxuZ0xhdDogW251bWJlciwgbnVtYmVyXSkge1xuICAgIHRoaXMubWFwLnNldENlbnRlcihsbmdMYXQpO1xuICB9XG4gIC8qKiBIaWdobGlnaHRzLCBpbiBhbGwgZGF0YSBzb3VyY2VzLHRoZSBmZWF0dXJlKHMpIGhhdmluZyB0aGUgZ2l2ZW4gZWxlbWVudElkZW50aWZpZXIgKi9cbiAgcHJpdmF0ZSBoaWdobGlnaHRGZWF0dXJlKGZlYXR1cmVUb0hpZ2h0TGlnaHQ6IHsgaXNsZWF2aW5nOiBib29sZWFuOyBlbGVtZW50aWRlbnRpZmllcjogRWxlbWVudElkZW50aWZpZXI7IH0pIHtcbiAgICB0aGlzLm1hcFNlcnZpY2UuaGlnaGxpZ2h0RmVhdHVyZSh0aGlzLm1hcExheWVycywgdGhpcy5tYXAsIGZlYXR1cmVUb0hpZ2h0TGlnaHQpO1xuICB9XG4gIC8qKiBTZWxlY3RzLCBpbiBhbGwgZGF0YSBzb3VyY2VzLHRoZSBmZWF0dXJlKHMpIGhhdmluZyB0aGUgZ2l2ZW4gZWxlbWVudElkZW50aWZpZXIgKi9cbiAgcHJpdmF0ZSBzZWxlY3RGZWF0dXJlcyhlbGVtZW50VG9TZWxlY3Q6IEFycmF5PEVsZW1lbnRJZGVudGlmaWVyPikge1xuICAgIHRoaXMubWFwU2VydmljZS5zZWxlY3RGZWF0dXJlcyh0aGlzLm1hcExheWVycywgdGhpcy5tYXAsIGVsZW1lbnRUb1NlbGVjdCk7XG4gIH1cbiAgLyoqIFNlbGVjdHMsIGluIGFsbCBkYXRhIHNvdXJjZXMsIGFsbCB0aGUgZmVhdHVyZXMgaGF2aW5nIHRoZSBnaXZlbiBlbGVtZW50SWRlbnRpZmllcnMgYW5kIHVuZGVyIHRoZSBnaXZlbiBjb2xsZWN0aW9uLlxuICAgKiBAcGFyYW0gZmVhdHVyZXMgbGlzdCBvZiBmZWF0dXJlcyBpZGVudGlmaWVycy5cbiAgICogQHBhcmFtIGNvbGxlY3Rpb24gZGF0YSBjb2xsZWN0aW9uIChtZXRhZGF0YSBvZiB0aGUgZGF0YSBzb3VyY2UpLlxuICAqL1xuICBwdWJsaWMgc2VsZWN0RmVhdHVyZXNCeUNvbGxlY3Rpb24oZmVhdHVyZXM6IEFycmF5PEVsZW1lbnRJZGVudGlmaWVyPiwgY29sbGVjdGlvbjogc3RyaW5nKSB7XG4gICAgdGhpcy5tYXBTZXJ2aWNlLnNlbGVjdEZlYXR1cmVzQnlDb2xsZWN0aW9uKHRoaXMubWFwTGF5ZXJzLCB0aGlzLm1hcCwgZmVhdHVyZXMsIGNvbGxlY3Rpb24pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRNYXBKc29uU2NoZW1hKCk6IE9iamVjdCB7XG4gICAgcmV0dXJuIG1hcEpzb25TY2hlbWE7XG4gIH1cbiAgLyoqIERlc3Ryb3lzIGFsbCB0aGUgY29tcG9uZW50cyBzdWJzY3JpcHRpb25zLiAqL1xuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubWFwKSB7XG4gICAgICB0aGlzLm1hcC51bnN1YnNjcmliZUV2ZW50cygpO1xuICAgIH1cbiAgICB0aGlzLl9vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgdGhpcy5fb25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqIEBkZXNjcmlwdGlvbiBFbmFibGVzIGJib3ggZHJhd2luZyBtb2RlLiovXG4gIHB1YmxpYyBhZGRHZW9Cb3goKSB7XG4gICAgdGhpcy5kcmF3Q29tcG9uZW50LmFkZEdlb0JveCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBSZW1vdmVzIGFsbCB0aGUgYW9pcyBpZiBub25lIG9mIHRoZW0gaXMgc2VsZWN0ZWQuIE90aGVyd2lzZSBpdCByZW1vdmVzIHRoZSBzZWxlY3RlZCBvbmUgb25seVxuICAgKi9cbiAgcHVibGljIHJlbW92ZUFvaXMoKSB7XG4gICAgdGhpcy5kcmF3Q29tcG9uZW50LnJlbW92ZUFvaXMoKTtcbiAgfVxuXG4gIC8qKiBAZGVzY3JpcHRpb24gRGVsZXRlcyB0aGUgc2VsZWN0ZWQgZHJhd24gZ2VvbWV0cnkuIElmIG5vIGRyYXduIGdlb21ldHJ5IGlzIHNlbGVjdGVkLCBhbGwgZ2VvbWV0cmllcyBhcmUgZGV0ZWxldGVkICovXG4gIHB1YmxpYyBkZWxldGVTZWxlY3RlZEl0ZW0oKSB7XG4gICAgdGhpcy5kcmF3Q29tcG9uZW50LmRlbGV0ZVNlbGVjdGVkSXRlbSgpO1xuICB9XG5cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIFN3aXRjaGVzIHRvIGEgZHJhd2luZyBtb2RlIG9mIGEgRFJBV19QT0xZR09OLCBEUkFXX0NJUkNMRSBvciBEUkFXX1JBRElVU19DSVJDTEUuXG4gICAqIEBwYXJhbSBtb2RlIERyYXcgbW9kZSAoRFJBV19QT0xZR09OLCBEUkFXX0NJUkNMRSBvciBEUkFXX1JBRElVU19DSVJDTEUpLiBEZWZhdWx0IHRvIERSQVdfUE9MWUdPTlxuICAgKiBAcGFyYW0gb3B0aW9uIE1hcGJveGRyYXcgb3B0aW9uLlxuICAgKi9cbiAgcHVibGljIHN3aXRjaFRvRHJhd01vZGUobW9kZT86IHN0cmluZywgb3B0aW9uPzogYW55KSB7XG4gICAgdGhpcy5kcmF3Q29tcG9uZW50LnN3aXRjaFRvRHJhd01vZGUobW9kZSwgb3B0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gU3dpdGNoZXMgdG8gZGlyZWN0X3NlbGVjdCBtb2RlLlxuICAgKiBAcGFyYW0gb3B0aW9uIE1hcGJveGRyYXcgb3B0aW9uLlxuICAgKi9cbiAgcHVibGljIHN3aXRjaFRvRGlyZWN0U2VsZWN0TW9kZShvcHRpb24/OiB7IGZlYXR1cmVJZHM6IEFycmF5PHN0cmluZz47IGFsbG93Q2lyY2xlUmVzaXplOiBib29sZWFuOyB9XG4gICAgfCB7IGZlYXR1cmVJZDogc3RyaW5nOyBhbGxvd0NpcmNsZVJlc2l6ZTogYm9vbGVhbjsgfSkge1xuICAgIHRoaXMuZHJhd0NvbXBvbmVudC5zd2l0Y2hUb0RpcmVjdFNlbGVjdE1vZGUob3B0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gU3dpdGNoZXMgdG8gc2ltcGxlX3NlbGVjdCBtb2RlLlxuICAgKiBAcGFyYW0gb3B0aW9uIE1hcGJveGRyYXcgb3B0aW9uLlxuICAgKi9cbiAgcHVibGljIHN3aXRjaFRvRWRpdE1vZGUoKSB7XG4gICAgdGhpcy5kcmF3Q29tcG9uZW50LnN3aXRjaFRvRWRpdE1vZGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gUmV0dXJucyBhbGwgdGhlIGRyYXduIHBvbHlnb25zIGFzIHdrdCBvciBnZW9qc29uLlxuICAgKiBAcGFyYW0gbW9kZSAnd2t0JyB8ICdnZW9qc29uJ1xuICAgKiBAcmV0dXJucyBXa3Qgc3RyaW5nIG9yIEdlb2pzb24gb2JqZWN0LlxuICAgKi9cbiAgcHVibGljIGdldEFsbFBvbHlnb24obW9kZTogJ3drdCcgfCAnZ2VvanNvbicpIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3Q29tcG9uZW50LmdldEFsbFBvbHlnb24obW9kZSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIHJldHVybnMgdGhlIHNlbGVjdGVkIHBvbHlnb24gZ2VvbWV0cnkgaW4gV0tUIG9yIEdlb0pzb24gZ2l2ZW4gdGhlIG1vZGVcbiAgICogQHBhcmFtIG1vZGUgOiAnd2t0JyB8ICdnZW9qc29uJ1xuICAgKiBAcmV0dXJucyBXa3Qgc3RyaW5nIG9yIEdlb2pzb24gb2JqZWN0LlxuICAgKi9cbiAgcHVibGljIGdldFNlbGVjdGVkUG9seWdvbihtb2RlOiAnd2t0JyB8ICdnZW9qc29uJykge1xuICAgIHJldHVybiB0aGlzLmRyYXdDb21wb25lbnQuZ2V0U2VsZWN0ZWRQb2x5Z29uKG1vZGUpO1xuICB9XG59XG4iLCI8ZGl2IGlkPVwie3tpZH19XCIgY2xhc3M9XCJtYXBfX2NvbnRhaW5lclwiPlxuICA8ZGl2IGNsYXNzPVwibWFwX192aXN1LWxpc3RcIiAqbmdJZj1cInZpc3VhbGlzYXRpb25TZXRzQ29uZmlnPy5sZW5ndGggPiAwXCI+XG4gICAgPGRpdiBjbGFzcz1cIm1hcF9fbGVnZW5kLWJ1dHRvblwiIFttYXRUb29sdGlwUG9zaXRpb25dPVwiJ2xlZnQnXCIgbWF0VG9vbHRpcD1cInt7J01hbmFnZSBsYXllcnMnIHwgdHJhbnNsYXRlfX1cIj5cbiAgICAgIDxtYXQtaWNvbiAoY2xpY2spPVwibGVnZW5kT3Blbj0hbGVnZW5kT3BlblwiIChrZXlEb3duKT1cImxlZ2VuZE9wZW49IWxlZ2VuZE9wZW5cIj5sYXllcnM8L21hdC1pY29uPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgW2hpZGRlbl09XCIhbGVnZW5kT3BlblwiIGNsYXNzPVwibWFwX192aXN1LWxpc3QtLWNvbnRhaW5lclwiIGNka0Ryb3BMaXN0XG4gICAgICAoY2RrRHJvcExpc3REcm9wcGVkKT1cImRyb3AoJGV2ZW50KVwiPlxuICAgICAgPGRpdiBjZGtEcmFnIGNsYXNzPVwibWFwX192aXN1LWl0ZW1cIiAqbmdGb3I9XCJsZXQgdmlzdSBvZiB2aXN1YWxpc2F0aW9uU2V0c0NvbmZpZ1wiPlxuICAgICAgICA8ZGl2IGNka0RyYWdIYW5kbGUgY2xhc3M9XCJtYXBfX3Zpc3UtdGl0bGVcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hcF9fdmlzdS10aXRsZS10ZXh0XCIgW2NsYXNzLm1hcF9fdmlzdS10aXRsZS10ZXh0LS1kaXNhYmxlZF09XCIhdmlzdS5lbmFibGVkXCI+XG4gICAgICAgICAgICB7e3Zpc3UubmFtZSB8IHRyYW5zbGF0ZX19PC9zcGFuPlxuICAgICAgICAgIDxtYXQtc2xpZGUtdG9nZ2xlIFtjaGVja2VkXT1cInZpc3UuZW5hYmxlZFwiIChjaGFuZ2UpPVwiZW1pdFZpc3VhbGlzYXRpb25zKHZpc3UubmFtZSlcIlxuICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiJ3Nob3dfbGF5ZXJzJyB8IHRyYW5zbGF0ZVwiIFtoaWRlSWNvbl09XCJ0cnVlXCI+PC9tYXQtc2xpZGUtdG9nZ2xlPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1hcF9fdmlzdS1jb250ZW50XCIgY2RrRHJvcExpc3QgKGNka0Ryb3BMaXN0RHJvcHBlZCk9XCJkcm9wTGF5ZXIoJGV2ZW50LCB2aXN1Lm5hbWUpXCI+XG4gICAgICAgICAgPGRpdiBjZGtEcmFnICpuZ0Zvcj1cImxldCBsIG9mIHZpc3UubGF5ZXJzXCIgY2xhc3M9XCJtYXBfX3Zpc3UtbGF5ZXJcIlxuICAgICAgICAgICAgW2NsYXNzLmNkay12aXN1YWxseS1oaWRkZW5dPVwiKCh2aXN1Lm5hbWUgKyAnOmFybGFzX3ZzZXQ6JyArIGwpIHwgZ2V0VmFsdWU6dmlzaWJpbGl0eVN0YXR1cykgIT09IHRydWVcIj5cbiAgICAgICAgICAgIDxkaXYgY2RrRHJhZ0hhbmRsZSBjbGFzcz1cIm1hcF9fdmlzdS1sYXllci1kcmFnXCI+XG4gICAgICAgICAgICAgIDxtYXQtaWNvbj5kcmFnX2luZGljYXRvcjwvbWF0LWljb24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxhcmxhcy1sZWdlbmQgW2NvbGxlY3Rpb25dPVwibCB8IGdldENvbGxlY3Rpb246IG1hcFNlcnZpY2UubGF5ZXJzTWFwIFwiIFtlbmFibGVkXT1cInZpc3UuZW5hYmxlZFwiXG4gICAgICAgICAgICAgIFtsYXllcl09XCJsIHwgZ2V0VmFsdWU6IG1hcFNlcnZpY2UubGF5ZXJzTWFwIFwiIFt6b29tXT1cIm1hcD8uem9vbVwiXG4gICAgICAgICAgICAgICh2aXNpYmlsaXR5U3RhdHVzKT1cImVtaXRMZWdlbmRWaXNpYmlsaXR5KHZpc3UubmFtZSwgbCwgJGV2ZW50KVwiIFtsZWdlbmRVcGRhdGVyXT1cImxlZ2VuZFVwZGF0ZXJcIlxuICAgICAgICAgICAgICBbdmlzaWJpbGl0eVVwZGF0ZXJdPVwidmlzaWJpbGl0eVVwZGF0ZXJcIlxuICAgICAgICAgICAgICAoZG93bmxvYWRTb3VyY2VFbWl0dGVyKT1cImRvd25sb2FkTGF5ZXJTb3VyY2UoJGV2ZW50KVwiPjwvYXJsYXMtbGVnZW5kPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48YXJsYXMtY29vcmRpbmF0ZXMgKm5nSWY9XCJkaXNwbGF5Q3VycmVudENvb3JkaW5hdGVzXCIgW2N1cnJlbnRMYXRdPVwibWFwPy5jdXJyZW50TGF0XCIgW2N1cnJlbnRMbmddPVwibWFwPy5jdXJyZW50TG5nXCJcbiAgKG1vdmVUb0Nvb3JkaW5hdGVzJCk9XCJtb3ZlVG9Db29yZGluYXRlcygkZXZlbnQpXCI+PC9hcmxhcy1jb29yZGluYXRlcz5cblxuPGFybGFzLWJhc2VtYXAgKm5nSWY9XCJzaG93QmFzZW1hcExpc3RcIiBbbWFwU291cmNlc109XCJtYXBTb3VyY2VzXCIgW21hcF09XCJtYXBcIiAobW91c2VsZWF2ZSk9XCJoaWRlQmFzZW1hcFN3aXRjaGVyKClcIlxuICAoYmFzZW1hcENoYW5nZWQpPVwib25DaGFuZ2VCYXNlbWFwU3R5bGUoKVwiPjwvYXJsYXMtYmFzZW1hcD5cblxuXG48YXJsYXMtZHJhdyAjZHJhd0NvbXBvbmVudCAqbmdJZj1cIm1hcFwiIFttYXBdPVwibWFwXCIgW2VtcHR5RGF0YV09XCJlbXB0eURhdGFcIiBbZHJhd0RhdGFdPVwiZHJhd0RhdGFcIlxuICBbZHJhd0J1dHRvbkVuYWJsZWRdPVwiZHJhd0J1dHRvbkVuYWJsZWRcIiBbZHJhd09wdGlvbl09XCJkcmF3T3B0aW9uXCJcbiAgW2RyYXdQb2x5Z29uVmVydGljZXNMaW1pdF09XCJkcmF3UG9seWdvblZlcnRpY2VzTGltaXRcIiBbcHJlc2VydmVEcmF3aW5nQnVmZmVyXT1cInByZXNlcnZlRHJhd2luZ0J1ZmZlclwiXG4gIChvbkFvaUNoYW5nZWQpPVwib25Bb2lDaGFuZ2VkLmVtaXQoJGV2ZW50KVwiXG4gIChvbkFvaUVkaXQpPVwib25Bb2lFZGl0LmVtaXQoJGV2ZW50KVwiPjwvYXJsYXMtZHJhdz4iXX0=