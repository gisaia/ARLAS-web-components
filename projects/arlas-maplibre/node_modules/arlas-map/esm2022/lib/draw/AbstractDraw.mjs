/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import MapboxDraw from '@mapbox/mapbox-gl-draw';
export class AbstractDraw {
    constructor(config, enabled, map) {
        const modes = MapboxDraw.modes;
        this.config = JSON.parse(JSON.stringify(config));
        this.config.modes = Object.assign(modes, config.modes);
        this.drawProvider = new MapboxDraw(this.config);
        this.arlasMap = map;
        this.enabled = enabled;
    }
    onAdd(map) {
        const controlContainer = this.drawProvider.onAdd(map);
        if (!this.enabled) {
            controlContainer.className += ' draw-control-disabled';
        }
        return controlContainer;
    }
    onRemove(map) {
        return this.drawProvider.onRemove(map);
    }
    setMode(drawModes, replaceMode) {
        this.drawProvider.modes[drawModes] = replaceMode;
    }
    getAllFeatures() {
        return this.getAll().features;
    }
    onDrawCreate(fn) {
        this.on('draw.create', (e) => {
            fn(e);
        });
    }
    onDrawDelete(fn) {
        this.on('draw.delete', (e) => {
            fn(e);
        });
    }
    onDrawEditSaveInitialFeature(fn) {
        this.on('draw.edit.saveInitialFeature', (e) => {
            fn(e);
        });
    }
    onDrawInvalidGeometry(fn) {
        this.on('draw.invalidGeometry', (e) => {
            fn(e);
        });
    }
    onDrawModeChange(fn) {
        this.on('draw.modechange', (e) => {
            fn(e);
        });
    }
    onDrawOnClick(fn) {
        this.on('draw.onClick', (e) => {
            fn(e);
        });
    }
    onDrawOnStart(fn) {
        this.on('draw.onStart', (e) => {
            fn(e);
        });
    }
    onDrawOnStop(fn) {
        this.on('draw.onStop', (e) => {
            fn(e);
        });
    }
    onDrawSelectionchange(fn) {
        this.on('draw.selectionchange', (e) => {
            fn(e);
        });
    }
    onDrawUpdate(fn) {
        this.on('draw.update', (e) => {
            fn(e);
        });
    }
    getMode(modes) {
        return this.drawProvider.modes[modes];
    }
    on(event, func) {
        this.arlasMap.on(event, func);
    }
    add(feature) {
        this.drawProvider.add(feature);
    }
    get(featureId) {
        return this.drawProvider.get(featureId);
    }
    delete(ids) {
        this.drawProvider.delete(ids);
        return this;
    }
    deleteAll() {
        this.drawProvider.deleteAll();
        return this;
    }
    set(featureCollection) {
        return this.drawProvider.set(featureCollection);
    }
    trash() {
        this.drawProvider.trash();
        return this;
    }
    combineFeatures() {
        this.drawProvider.combineFeatures();
        return this;
    }
    uncombineFeatures() {
        this.drawProvider.uncombineFeatures();
        return this;
    }
    getCurrentMode() {
        return this.drawProvider.getMode();
    }
    getFeatureIdsAt(point) {
        return this.drawProvider.getFeatureIdsAt(point);
    }
    getSelectedIds() {
        return this.drawProvider.getSelectedIds();
    }
    getSelected() {
        return this.drawProvider.getSelected();
    }
    getAll() {
        return this.drawProvider.getAll();
    }
    getSelectedFeatures() {
        return this.getSelected().features;
    }
    setFeatureProperty(featureId, property, value) {
        this.drawProvider.setFeatureProperty(featureId, property, value);
        return this;
    }
    changeMode(mode, opt) {
        this.drawProvider.changeMode(mode, opt);
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWJzdHJhY3REcmF3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtbWFwL3NyYy9saWIvZHJhdy9BYnN0cmFjdERyYXcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBRUgsT0FBTyxVQUFVLE1BQU0sd0JBQXdCLENBQUM7QUEwQmhELE1BQU0sT0FBTyxZQUFZO0lBS3ZCLFlBQW1CLE1BQVcsRUFBRSxPQUFnQixFQUFFLEdBQXVCO1FBQ3ZFLE1BQU0sS0FBSyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNqRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQUVNLEtBQUssQ0FBQyxHQUFHO1FBQ2QsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2xCLGdCQUFnQixDQUFDLFNBQVMsSUFBSSx3QkFBd0IsQ0FBQztRQUN6RCxDQUFDO1FBQ0QsT0FBTyxnQkFBZ0IsQ0FBQztJQUMxQixDQUFDO0lBRU0sUUFBUSxDQUFDLEdBQUc7UUFDakIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRU0sT0FBTyxDQUFDLFNBQW9CLEVBQUUsV0FBZ0I7UUFDbkQsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsV0FBVyxDQUFDO0lBQ25ELENBQUM7SUFFTSxjQUFjO1FBQ25CLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQztJQUNoQyxDQUFDO0lBRU0sWUFBWSxDQUFDLEVBQWU7UUFDakMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUMzQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDUixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTSxZQUFZLENBQUMsRUFBZTtRQUNqQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQzNCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLDRCQUE0QixDQUFDLEVBQWU7UUFDakQsSUFBSSxDQUFDLEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQzVDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLHFCQUFxQixDQUFDLEVBQWU7UUFDMUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3BDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLGdCQUFnQixDQUFDLEVBQWU7UUFDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQy9CLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLGFBQWEsQ0FBQyxFQUFlO1FBQ2xDLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDNUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sYUFBYSxDQUFDLEVBQWU7UUFDbEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDUixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTSxZQUFZLENBQUMsRUFBZTtRQUNqQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQzNCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLHFCQUFxQixDQUFDLEVBQWU7UUFDMUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3BDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLFlBQVksQ0FBQyxFQUFlO1FBQ2pDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDM0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sT0FBTyxDQUFDLEtBQWdCO1FBQzdCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVNLEVBQUUsQ0FBQyxLQUFpQixFQUFFLElBQWlCO1FBQzVDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRU0sR0FBRyxDQUFDLE9BQWdFO1FBQ3pFLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFTSxHQUFHLENBQUMsU0FBaUI7UUFDMUIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRU0sTUFBTSxDQUFDLEdBQTJCO1FBQ3ZDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNNLFNBQVM7UUFDZCxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzlCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVNLEdBQUcsQ0FBQyxpQkFBb0M7UUFDN0MsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFTSxLQUFLO1FBQ1YsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMxQixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTSxlQUFlO1FBQ3BCLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDcEMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ00saUJBQWlCO1FBQ3RCLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN0QyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTSxjQUFjO1FBQ25CLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0lBRU0sZUFBZSxDQUFDLEtBQWdDO1FBQ3JELE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVNLGNBQWM7UUFDbkIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzVDLENBQUM7SUFFTSxXQUFXO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN6QyxDQUFDO0lBRU0sTUFBTTtRQUNYLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNwQyxDQUFDO0lBRU0sbUJBQW1CO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQztJQUNyQyxDQUFDO0lBRU0sa0JBQWtCLENBQUMsU0FBaUIsRUFBRSxRQUFnQixFQUFFLEtBQVU7UUFDdkUsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2pFLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVNLFVBQVUsQ0FBQyxJQUFZLEVBQUUsR0FBUztRQUN2QyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDeEMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gR2lzYcOvYSB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvclxuICogbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRS50eHQgZmlsZSBkaXN0cmlidXRlZCB3aXRoXG4gKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodFxuICogb3duZXJzaGlwLiBHaXNhw69hIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byB5b3UgdW5kZXJcbiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXlcbiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IE1hcGJveERyYXcgZnJvbSAnQG1hcGJveC9tYXBib3gtZ2wtZHJhdyc7XG5pbXBvcnQgeyBBYnN0cmFjdEFybGFzTWFwR0wgfSBmcm9tICcuLi9tYXAvQWJzdHJhY3RBcmxhc01hcEdMJztcbmltcG9ydCB7IEZlYXR1cmUsIEZlYXR1cmVDb2xsZWN0aW9uLCBHZW9tZXRyeSB9IGZyb20gJ0B0dXJmL2hlbHBlcnMnO1xuXG5leHBvcnQgdHlwZSBEcmF3RXZlbnRzID0gJ2RyYXcuY3JlYXRlJyB8ICdkcmF3LmRlbGV0ZScgfCAnZHJhdy5jb21iaW5lJyB8ICdkcmF3LnVuY29tYmluZScgfFxuICAnZHJhdy51cGRhdGUnIHwgJ2RyYXcuc2VsZWN0aW9uY2hhbmdlJyB8ICdkcmF3Lm1vZGVjaGFuZ2UnIHwgJ2RyYXcucmVuZGVyJyB8ICdkcmF3LmFjdGlvbmFibGUnIHxcbiAgJ2RyYXcuZWRpdC5zYXZlSW5pdGlhbEZlYXR1cmUnIHwgJ2RyYXcub25DbGljaycgfCAnZHJhdy5vblN0YXJ0JyB8ICdkcmF3Lm9uU3RvcCdcbiAgfCAnZHJhdy5pbnZhbGlkR2VvbWV0cnknO1xuXG5leHBvcnQgdHlwZSBEcmF3TW9kZXMgPSAnU0lNUExFX1NFTEVDVCcgfCAnRFJBV19DSVJDTEUnIHwgJ0RJUkVDVF9TRUxFQ1QnIHxcbiAgJ0RSQVdfTElORV9TVFJJTkcnIHwgJ0RSQVdfUE9MWUdPTicgfCAnRFJBV19QT0lOVCcgfCAnRFJBV19SQURJVVNfQ0lSQ0xFJyB8XG4gICdEUkFXX1NUUklQJyB8ICdESVJFQ1RfU1RSSVAnfCAnRFJBV19SRUNUQU5HTEUnIHwgJ1NUQVRJQyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJhd0V2ZW50c0ludGVyZmFjZSB7XG4gIG9uRHJhd0NyZWF0ZTogKC4uLmFyZ3MpID0+IHZvaWQ7XG4gIG9uRHJhd1VwZGF0ZTogKC4uLmFyZ3MpID0+IHZvaWQ7XG4gIG9uRHJhd0RlbGV0ZTogKC4uLmFyZ3MpID0+IHZvaWQ7XG4gIG9uRHJhd09uQ2xpY2s6ICguLi5hcmdzKSA9PiB2b2lkO1xuICBvbkRyYXdPblN0YXJ0OiAoLi4uYXJncykgPT4gdm9pZDtcbiAgb25EcmF3T25TdG9wOiAoLi4uYXJncykgPT4gdm9pZDtcbiAgb25EcmF3SW52YWxpZEdlb21ldHJ5OiAoLi4uYXJncykgPT4gdm9pZDtcbiAgb25EcmF3RWRpdFNhdmVJbml0aWFsRmVhdHVyZTogKC4uLmFyZ3MpID0+IHZvaWQ7XG4gIG9uRHJhd1NlbGVjdGlvbmNoYW5nZTogKC4uLmFyZ3MpID0+IHZvaWQ7XG4gIG9uRHJhd01vZGVDaGFuZ2U6ICguLi5hcmdzKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgQWJzdHJhY3REcmF3IGltcGxlbWVudHMgRHJhd0V2ZW50c0ludGVyZmFjZSB7XG4gIHByb3RlY3RlZCBjb25maWc7XG4gIHB1YmxpYyBhcmxhc01hcDogQWJzdHJhY3RBcmxhc01hcEdMO1xuICBwdWJsaWMgZW5hYmxlZDogYm9vbGVhbjtcbiAgcHVibGljIGRyYXdQcm92aWRlcjogTWFwYm94RHJhdztcbiAgcHVibGljIGNvbnN0cnVjdG9yKGNvbmZpZzogYW55LCBlbmFibGVkOiBib29sZWFuLCBtYXA6IEFic3RyYWN0QXJsYXNNYXBHTCkge1xuICAgIGNvbnN0IG1vZGVzID0gTWFwYm94RHJhdy5tb2RlcztcbiAgICB0aGlzLmNvbmZpZyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uZmlnKSk7XG4gICAgdGhpcy5jb25maWcubW9kZXMgPSBPYmplY3QuYXNzaWduKG1vZGVzLCBjb25maWcubW9kZXMpO1xuICAgIHRoaXMuZHJhd1Byb3ZpZGVyID0gbmV3IE1hcGJveERyYXcodGhpcy5jb25maWcpO1xuICAgIHRoaXMuYXJsYXNNYXAgPSBtYXA7XG4gICAgdGhpcy5lbmFibGVkID0gZW5hYmxlZDtcbiAgfVxuXG4gIHB1YmxpYyBvbkFkZChtYXApIHtcbiAgICBjb25zdCBjb250cm9sQ29udGFpbmVyID0gdGhpcy5kcmF3UHJvdmlkZXIub25BZGQobWFwKTtcbiAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xuICAgICAgY29udHJvbENvbnRhaW5lci5jbGFzc05hbWUgKz0gJyBkcmF3LWNvbnRyb2wtZGlzYWJsZWQnO1xuICAgIH1cbiAgICByZXR1cm4gY29udHJvbENvbnRhaW5lcjtcbiAgfVxuXG4gIHB1YmxpYyBvblJlbW92ZShtYXApIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3UHJvdmlkZXIub25SZW1vdmUobWFwKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRNb2RlKGRyYXdNb2RlczogRHJhd01vZGVzLCByZXBsYWNlTW9kZTogYW55KSB7XG4gICAgdGhpcy5kcmF3UHJvdmlkZXIubW9kZXNbZHJhd01vZGVzXSA9IHJlcGxhY2VNb2RlO1xuICB9XG5cbiAgcHVibGljIGdldEFsbEZlYXR1cmVzKCkge1xuICAgIHJldHVybiB0aGlzLmdldEFsbCgpLmZlYXR1cmVzO1xuICB9XG5cbiAgcHVibGljIG9uRHJhd0NyZWF0ZShmbjogKGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uKCdkcmF3LmNyZWF0ZScsIChlKSA9PiB7XG4gICAgICBmbihlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkRyYXdEZWxldGUoZm46IChlKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vbignZHJhdy5kZWxldGUnLCAoZSkgPT4ge1xuICAgICAgZm4oZSk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25EcmF3RWRpdFNhdmVJbml0aWFsRmVhdHVyZShmbjogKGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uKCdkcmF3LmVkaXQuc2F2ZUluaXRpYWxGZWF0dXJlJywgKGUpID0+IHtcbiAgICAgIGZuKGUpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG9uRHJhd0ludmFsaWRHZW9tZXRyeShmbjogKGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uKCdkcmF3LmludmFsaWRHZW9tZXRyeScsIChlKSA9PiB7XG4gICAgICBmbihlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkRyYXdNb2RlQ2hhbmdlKGZuOiAoZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub24oJ2RyYXcubW9kZWNoYW5nZScsIChlKSA9PiB7XG4gICAgICBmbihlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkRyYXdPbkNsaWNrKGZuOiAoZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub24oJ2RyYXcub25DbGljaycsIChlKSA9PiB7XG4gICAgICBmbihlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkRyYXdPblN0YXJ0KGZuOiAoZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub24oJ2RyYXcub25TdGFydCcsIChlKSA9PiB7XG4gICAgICBmbihlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkRyYXdPblN0b3AoZm46IChlKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vbignZHJhdy5vblN0b3AnLCAoZSkgPT4ge1xuICAgICAgZm4oZSk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25EcmF3U2VsZWN0aW9uY2hhbmdlKGZuOiAoZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub24oJ2RyYXcuc2VsZWN0aW9uY2hhbmdlJywgKGUpID0+IHtcbiAgICAgIGZuKGUpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG9uRHJhd1VwZGF0ZShmbjogKGUpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uKCdkcmF3LnVwZGF0ZScsIChlKSA9PiB7XG4gICAgICBmbihlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNb2RlKG1vZGVzOiBEcmF3TW9kZXMpIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3UHJvdmlkZXIubW9kZXNbbW9kZXNdO1xuICB9XG5cbiAgcHVibGljIG9uKGV2ZW50OiBEcmF3RXZlbnRzLCBmdW5jOiAoZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMuYXJsYXNNYXAub24oZXZlbnQsIGZ1bmMpO1xuICB9XG5cbiAgcHVibGljIGFkZChmZWF0dXJlOiBGZWF0dXJlPEdlb21ldHJ5PiB8IEZlYXR1cmVDb2xsZWN0aW9uPEdlb0pTT04uR2VvbWV0cnk+KSB7XG4gICAgdGhpcy5kcmF3UHJvdmlkZXIuYWRkKGZlYXR1cmUpO1xuICB9XG5cbiAgcHVibGljIGdldChmZWF0dXJlSWQ6IHN0cmluZyk6IEZlYXR1cmUgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmRyYXdQcm92aWRlci5nZXQoZmVhdHVyZUlkKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGUoaWRzOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+KTogdGhpcyB7XG4gICAgdGhpcy5kcmF3UHJvdmlkZXIuZGVsZXRlKGlkcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcHVibGljIGRlbGV0ZUFsbCgpOiB0aGlzIHtcbiAgICB0aGlzLmRyYXdQcm92aWRlci5kZWxldGVBbGwoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyBzZXQoZmVhdHVyZUNvbGxlY3Rpb246IEZlYXR1cmVDb2xsZWN0aW9uKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMuZHJhd1Byb3ZpZGVyLnNldChmZWF0dXJlQ29sbGVjdGlvbik7XG4gIH1cblxuICBwdWJsaWMgdHJhc2goKTogdGhpcyB7XG4gICAgdGhpcy5kcmF3UHJvdmlkZXIudHJhc2goKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyBjb21iaW5lRmVhdHVyZXMoKTogdGhpcyB7XG4gICAgdGhpcy5kcmF3UHJvdmlkZXIuY29tYmluZUZlYXR1cmVzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcHVibGljIHVuY29tYmluZUZlYXR1cmVzKCk6IHRoaXMge1xuICAgIHRoaXMuZHJhd1Byb3ZpZGVyLnVuY29tYmluZUZlYXR1cmVzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q3VycmVudE1vZGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3UHJvdmlkZXIuZ2V0TW9kZSgpO1xuICB9XG5cbiAgcHVibGljIGdldEZlYXR1cmVJZHNBdChwb2ludDogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgfSk6IEFycmF5PHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmRyYXdQcm92aWRlci5nZXRGZWF0dXJlSWRzQXQocG9pbnQpO1xuICB9XG5cbiAgcHVibGljIGdldFNlbGVjdGVkSWRzKCk6IEFycmF5PHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmRyYXdQcm92aWRlci5nZXRTZWxlY3RlZElkcygpO1xuICB9XG5cbiAgcHVibGljIGdldFNlbGVjdGVkKCkge1xuICAgIHJldHVybiB0aGlzLmRyYXdQcm92aWRlci5nZXRTZWxlY3RlZCgpO1xuICB9XG5cbiAgcHVibGljIGdldEFsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5kcmF3UHJvdmlkZXIuZ2V0QWxsKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0U2VsZWN0ZWRGZWF0dXJlcygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTZWxlY3RlZCgpLmZlYXR1cmVzO1xuICB9XG5cbiAgcHVibGljIHNldEZlYXR1cmVQcm9wZXJ0eShmZWF0dXJlSWQ6IHN0cmluZywgcHJvcGVydHk6IHN0cmluZywgdmFsdWU6IGFueSk6IHRoaXMge1xuICAgIHRoaXMuZHJhd1Byb3ZpZGVyLnNldEZlYXR1cmVQcm9wZXJ0eShmZWF0dXJlSWQsIHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwdWJsaWMgY2hhbmdlTW9kZShtb2RlOiBzdHJpbmcsIG9wdD86IGFueSk6IHRoaXMge1xuICAgIHRoaXMuZHJhd1Byb3ZpZGVyLmNoYW5nZU1vZGUobW9kZSwgb3B0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIl19