/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import MapboxDraw from '@mapbox/mapbox-gl-draw';
import * as jsts from 'jsts/dist/jsts.min';
export const limitVertexDirectSelectMode = MapboxDraw.modes.direct_select;
const reader = new jsts.io.GeoJSONReader();
limitVertexDirectSelectMode.fireInvalidGeom = function (feature) {
    this.map.fire('draw.invalidGeometry', {
        action: 'error',
        features: [feature]
    });
};
limitVertexDirectSelectMode.fireInitialFeature = function (feature) {
    this.map.fire('draw.edit.saveInitialFeature', {
        feature: feature
    });
};
limitVertexDirectSelectMode.toDisplayFeatures = function (state, geojson, push) {
    if (state.featureId === geojson.properties.id) {
        geojson.properties.active = MapboxDraw.constants.activeStates.ACTIVE;
        push(geojson);
        MapboxDraw.lib.createSupplementaryPoints(geojson, {
            map: this.map,
            midpoints: geojson.geometry.coordinates[0].length >= state.maxVertexByPolygon + 1 ? false : true,
            selectedPaths: state.selectedCoordPaths
        }).forEach(push);
    }
    else {
        geojson.properties.active = MapboxDraw.constants.activeStates.INACTIVE;
        push(geojson);
    }
    this.fireActionable(state);
};
limitVertexDirectSelectMode.onTouchEnd = limitVertexDirectSelectMode.onMouseUp = function (state) {
    if (state.dragMoving) {
        const featureCoords = [...state.feature.coordinates[0]];
        if (featureCoords[0][0] !== featureCoords[featureCoords.length - 1][0] ||
            featureCoords[0][1] !== featureCoords[featureCoords.length - 1][1]) {
            featureCoords.push(featureCoords[0]);
        }
        const currentFeature = {
            'type': 'Feature',
            'geometry': {
                'type': 'Polygon',
                'coordinates': [featureCoords]
            }
        };
        const g = reader.read(currentFeature);
        if (!g.geometry.isValid()) {
            this.fireInvalidGeom(currentFeature);
        }
        else {
            this.fireUpdate();
        }
    }
    this.stopDragging(state);
};
limitVertexDirectSelectMode.onSetup = function (opts) {
    const featureId = opts.featureId;
    let maxVertexByPolygon = opts.maxVertexByPolygon;
    const feature = this.getFeature(featureId);
    this.fireInitialFeature(feature);
    if (!feature) {
        throw new Error('You must provide a featureId to enter direct_select mode');
    }
    if (!maxVertexByPolygon) {
        maxVertexByPolygon = 100;
    }
    if (feature.type === MapboxDraw.constants.geojsonTypes.POINT) {
        throw new TypeError('direct_select mode doesn\'t handle point features');
    }
    const state = {
        featureId,
        feature,
        dragMoveLocation: opts.startPos || null,
        dragMoving: false,
        canDragMove: false,
        selectedCoordPaths: opts.coordPath ? [opts.coordPath] : [],
        maxVertexByPolygon
    };
    this.setSelectedCoordinates(this.pathsToCoordinates(featureId, state.selectedCoordPaths));
    this.setSelected(featureId);
    MapboxDraw.lib.doubleClickZoom.disable(this);
    this.setActionableState({
        trash: true
    });
    return state;
};
export default limitVertexDirectSelectMode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGltaXRWZXJ0ZXhEaXJlY3RTZWxlY3RNb2RlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtbWFwL3NyYy9saWIvZHJhdy9tb2Rlcy9MaW1pdFZlcnRleERpcmVjdFNlbGVjdE1vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBRUgsT0FBTyxVQUFVLE1BQU0sd0JBQXdCLENBQUM7QUFDaEQsT0FBTyxLQUFLLElBQUksTUFBTSxvQkFBb0IsQ0FBQztBQUUzQyxNQUFNLENBQUMsTUFBTSwyQkFBMkIsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQztBQUMxRSxNQUFNLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7QUFFM0MsMkJBQTJCLENBQUMsZUFBZSxHQUFHLFVBQVUsT0FBTztJQUM3RCxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtRQUNwQyxNQUFNLEVBQUUsT0FBTztRQUNmLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQztLQUNwQixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFFRiwyQkFBMkIsQ0FBQyxrQkFBa0IsR0FBRyxVQUFVLE9BQU87SUFDaEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsOEJBQThCLEVBQUU7UUFDNUMsT0FBTyxFQUFFLE9BQU87S0FDakIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBRUYsMkJBQTJCLENBQUMsaUJBQWlCLEdBQUcsVUFBVSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUk7SUFDNUUsSUFBSSxLQUFLLENBQUMsU0FBUyxLQUFLLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDOUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FB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QUFJLEtBQUssVUFBVSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDN0QsTUFBTSxJQUFJLFNBQVMsQ0FBQyxtREFBbUQsQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRztRQUNaLFNBQVM7UUFDVCxPQUFPO1FBQ1AsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJO1FBQ3ZDLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQzFELGtCQUFrQjtLQUNuQixDQUFDO0lBRUYsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztJQUMxRixJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzVCLFVBQVUsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUU3QyxJQUFJLENBQUMsa0JBQWtCLENBQUM7UUFDdEIsS0FBSyxFQUFFLElBQUk7S0FDWixDQUFDLENBQUM7SUFFSCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMsQ0FBQztBQUVGLGVBQWUsMkJBQTJCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gR2lzYcOvYSB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvclxuICogbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRS50eHQgZmlsZSBkaXN0cmlidXRlZCB3aXRoXG4gKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodFxuICogb3duZXJzaGlwLiBHaXNhw69hIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byB5b3UgdW5kZXJcbiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXlcbiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IE1hcGJveERyYXcgZnJvbSAnQG1hcGJveC9tYXBib3gtZ2wtZHJhdyc7XG5pbXBvcnQgKiBhcyBqc3RzIGZyb20gJ2pzdHMvZGlzdC9qc3RzLm1pbic7XG5cbmV4cG9ydCBjb25zdCBsaW1pdFZlcnRleERpcmVjdFNlbGVjdE1vZGUgPSBNYXBib3hEcmF3Lm1vZGVzLmRpcmVjdF9zZWxlY3Q7XG5jb25zdCByZWFkZXIgPSBuZXcganN0cy5pby5HZW9KU09OUmVhZGVyKCk7XG5cbmxpbWl0VmVydGV4RGlyZWN0U2VsZWN0TW9kZS5maXJlSW52YWxpZEdlb20gPSBmdW5jdGlvbiAoZmVhdHVyZSkge1xuICB0aGlzLm1hcC5maXJlKCdkcmF3LmludmFsaWRHZW9tZXRyeScsIHtcbiAgICBhY3Rpb246ICdlcnJvcicsXG4gICAgZmVhdHVyZXM6IFtmZWF0dXJlXVxuICB9KTtcbn07XG5cbmxpbWl0VmVydGV4RGlyZWN0U2VsZWN0TW9kZS5maXJlSW5pdGlhbEZlYXR1cmUgPSBmdW5jdGlvbiAoZmVhdHVyZSkge1xuICB0aGlzLm1hcC5maXJlKCdkcmF3LmVkaXQuc2F2ZUluaXRpYWxGZWF0dXJlJywge1xuICAgIGZlYXR1cmU6IGZlYXR1cmVcbiAgfSk7XG59O1xuXG5saW1pdFZlcnRleERpcmVjdFNlbGVjdE1vZGUudG9EaXNwbGF5RmVhdHVyZXMgPSBmdW5jdGlvbiAoc3RhdGUsIGdlb2pzb24sIHB1c2gpIHtcbiAgaWYgKHN0YXRlLmZlYXR1cmVJZCA9PT0gZ2VvanNvbi5wcm9wZXJ0aWVzLmlkKSB7XG4gICAgZ2VvanNvbi5wcm9wZXJ0aWVzLmFjdGl2ZSA9IE1hcGJveERyYXcuY29uc3RhbnRzLmFjdGl2ZVN0YXRlcy5BQ1RJVkU7XG4gICAgcHVzaChnZW9qc29uKTtcbiAgICBNYXBib3hEcmF3LmxpYi5jcmVhdGVTdXBwbGVtZW50YXJ5UG9pbnRzKGdlb2pzb24sIHtcbiAgICAgIG1hcDogdGhpcy5tYXAsXG4gICAgICBtaWRwb2ludHM6IGdlb2pzb24uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0ubGVuZ3RoID49IHN0YXRlLm1heFZlcnRleEJ5UG9seWdvbiArIDEgPyBmYWxzZSA6IHRydWUsXG4gICAgICBzZWxlY3RlZFBhdGhzOiBzdGF0ZS5zZWxlY3RlZENvb3JkUGF0aHNcbiAgICB9KS5mb3JFYWNoKHB1c2gpO1xuICB9IGVsc2Uge1xuICAgIGdlb2pzb24ucHJvcGVydGllcy5hY3RpdmUgPSBNYXBib3hEcmF3LmNvbnN0YW50cy5hY3RpdmVTdGF0ZXMuSU5BQ1RJVkU7XG4gICAgcHVzaChnZW9qc29uKTtcbiAgfVxuICB0aGlzLmZpcmVBY3Rpb25hYmxlKHN0YXRlKTtcbn07XG5cbmxpbWl0VmVydGV4RGlyZWN0U2VsZWN0TW9kZS5vblRvdWNoRW5kID0gbGltaXRWZXJ0ZXhEaXJlY3RTZWxlY3RNb2RlLm9uTW91c2VVcCA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICBpZiAoc3RhdGUuZHJhZ01vdmluZykge1xuICAgIGNvbnN0IGZlYXR1cmVDb29yZHMgPSBbLi4uc3RhdGUuZmVhdHVyZS5jb29yZGluYXRlc1swXV07XG4gICAgaWYgKFxuICAgICAgZmVhdHVyZUNvb3Jkc1swXVswXSAhPT0gZmVhdHVyZUNvb3Jkc1tmZWF0dXJlQ29vcmRzLmxlbmd0aCAtIDFdWzBdIHx8XG4gICAgICBmZWF0dXJlQ29vcmRzWzBdWzFdICE9PSBmZWF0dXJlQ29vcmRzW2ZlYXR1cmVDb29yZHMubGVuZ3RoIC0gMV1bMV1cbiAgICApIHtcbiAgICAgIGZlYXR1cmVDb29yZHMucHVzaChmZWF0dXJlQ29vcmRzWzBdKTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudEZlYXR1cmUgPSB7XG4gICAgICAndHlwZSc6ICdGZWF0dXJlJyxcbiAgICAgICdnZW9tZXRyeSc6IHtcbiAgICAgICAgJ3R5cGUnOiAnUG9seWdvbicsXG4gICAgICAgICdjb29yZGluYXRlcyc6IFtmZWF0dXJlQ29vcmRzXVxuICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZyA9IHJlYWRlci5yZWFkKGN1cnJlbnRGZWF0dXJlKTtcbiAgICBpZiAoIWcuZ2VvbWV0cnkuaXNWYWxpZCgpKSB7XG4gICAgICB0aGlzLmZpcmVJbnZhbGlkR2VvbShjdXJyZW50RmVhdHVyZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmlyZVVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuICB0aGlzLnN0b3BEcmFnZ2luZyhzdGF0ZSk7XG59O1xuXG5cbmxpbWl0VmVydGV4RGlyZWN0U2VsZWN0TW9kZS5vblNldHVwID0gZnVuY3Rpb24gKG9wdHMpIHtcbiAgY29uc3QgZmVhdHVyZUlkID0gb3B0cy5mZWF0dXJlSWQ7XG4gIGxldCBtYXhWZXJ0ZXhCeVBvbHlnb24gPSBvcHRzLm1heFZlcnRleEJ5UG9seWdvbjtcbiAgY29uc3QgZmVhdHVyZSA9IHRoaXMuZ2V0RmVhdHVyZShmZWF0dXJlSWQpO1xuICB0aGlzLmZpcmVJbml0aWFsRmVhdHVyZShmZWF0dXJlKTtcbiAgaWYgKCFmZWF0dXJlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgbXVzdCBwcm92aWRlIGEgZmVhdHVyZUlkIHRvIGVudGVyIGRpcmVjdF9zZWxlY3QgbW9kZScpO1xuICB9XG5cbiAgaWYgKCFtYXhWZXJ0ZXhCeVBvbHlnb24pIHtcbiAgICBtYXhWZXJ0ZXhCeVBvbHlnb24gPSAxMDA7XG4gIH1cblxuICBpZiAoZmVhdHVyZS50eXBlID09PSBNYXBib3hEcmF3LmNvbnN0YW50cy5nZW9qc29uVHlwZXMuUE9JTlQpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdkaXJlY3Rfc2VsZWN0IG1vZGUgZG9lc25cXCd0IGhhbmRsZSBwb2ludCBmZWF0dXJlcycpO1xuICB9XG5cbiAgY29uc3Qgc3RhdGUgPSB7XG4gICAgZmVhdHVyZUlkLFxuICAgIGZlYXR1cmUsXG4gICAgZHJhZ01vdmVMb2NhdGlvbjogb3B0cy5zdGFydFBvcyB8fCBudWxsLFxuICAgIGRyYWdNb3Zpbmc6IGZhbHNlLFxuICAgIGNhbkRyYWdNb3ZlOiBmYWxzZSxcbiAgICBzZWxlY3RlZENvb3JkUGF0aHM6IG9wdHMuY29vcmRQYXRoID8gW29wdHMuY29vcmRQYXRoXSA6IFtdLFxuICAgIG1heFZlcnRleEJ5UG9seWdvblxuICB9O1xuXG4gIHRoaXMuc2V0U2VsZWN0ZWRDb29yZGluYXRlcyh0aGlzLnBhdGhzVG9Db29yZGluYXRlcyhmZWF0dXJlSWQsIHN0YXRlLnNlbGVjdGVkQ29vcmRQYXRocykpO1xuICB0aGlzLnNldFNlbGVjdGVkKGZlYXR1cmVJZCk7XG4gIE1hcGJveERyYXcubGliLmRvdWJsZUNsaWNrWm9vbS5kaXNhYmxlKHRoaXMpO1xuXG4gIHRoaXMuc2V0QWN0aW9uYWJsZVN0YXRlKHtcbiAgICB0cmFzaDogdHJ1ZVxuICB9KTtcblxuICByZXR1cm4gc3RhdGU7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBsaW1pdFZlcnRleERpcmVjdFNlbGVjdE1vZGU7XG4iXX0=