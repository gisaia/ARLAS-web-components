/*
 * Licensed to Gisaïa under one or more contributor
 * license agreements. See the NOTICE.txt file distributed with
 * this work for additional information regarding copyright
 * ownership. Gisaïa licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { ArlasMapFrameworkService } from '../arlas-map-framework.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../arlas-map-framework.service";
/** L: a layer class/interface.
 *  S: a source class/interface.
 *  M: a Map configuration class/interface.
 */
export class BasemapService {
    constructor(http, mapFrameworkService) {
        this.http = http;
        this.mapFrameworkService = mapFrameworkService;
        this.POWERED_BY_ARLAS = ' Powered by ARLAS.';
        this.LOCAL_STORAGE_BASEMAPS = 'arlas_last_base_map';
        this.basemapChangedSource = new Subject();
        this.basemapChanged$ = this.basemapChangedSource.asObservable();
        this.protomapBasemapAddedSource = new Subject();
        this.protomapBasemapAdded$ = this.protomapBasemapAddedSource.asObservable();
    }
    setBasemaps(basemaps) {
        this.basemaps = basemaps;
    }
    addPMtilesToSource(map, pmtilesSource) {
        /* eslint-disable max-len */
        pmtilesSource['attribution'] = '<a href="https://protomaps.com/" target="_blank">Protomaps</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap</a>';
        pmtilesSource['attribution'] = pmtilesSource['attribution'] + this.POWERED_BY_ARLAS;
        this.mapFrameworkService.setSource('arlas_protomaps_source', pmtilesSource, map);
    }
    addProtomapLayerToMap(map, styleFile) {
        styleFile.layers.forEach(l => {
            this.mapFrameworkService.removeLayer(map, l.id);
            this.mapFrameworkService.addLayer(map, l);
        });
    }
    notifyProtomapAddition() {
        this.protomapBasemapAddedSource.next(true);
    }
    cloneStyleFile(selected) {
        return { ...selected.styleFile };
    }
    buildInitStyle(clonedStyleFile) {
        clonedStyleFile.sources = {
            protomaps_attribution: {
                'type': 'vector',
                // eslint-disable-next-line max-len
                'attribution': '<a href="https://protomaps.com/" target="_blank">Protomaps</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap</a>' + this.POWERED_BY_ARLAS
            }
        };
        clonedStyleFile.layers = [{
                id: 'backgrounds',
                type: 'background',
                source: 'protomaps_attribution',
                paint: {
                    'background-color': 'rgba(0,0,0,0)'
                }
            }];
        return clonedStyleFile;
    }
    ;
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: BasemapService, deps: [{ token: i1.HttpClient }, { token: i2.ArlasMapFrameworkService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: BasemapService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: BasemapService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: () => [{ type: i1.HttpClient }, { type: i2.ArlasMapFrameworkService }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZW1hcC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJsYXMtbWFwL3NyYy9saWIvYmFzZW1hcHMvYmFzZW1hcC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUVILE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbEQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7Ozs7QUFLMUU7OztHQUdHO0FBQ0gsTUFBTSxPQUFnQixjQUFjO0lBYWxDLFlBQWdDLElBQWdCLEVBQVksbUJBQXNEO1FBQWxGLFNBQUksR0FBSixJQUFJLENBQVk7UUFBWSx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQW1DO1FBWHhHLHFCQUFnQixHQUFHLG9CQUFvQixDQUFDO1FBQ3hDLDJCQUFzQixHQUFHLHFCQUFxQixDQUFDO1FBRy9DLHlCQUFvQixHQUFrQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ3ZELG9CQUFlLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBR3hELCtCQUEwQixHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFDdkQsMEJBQXFCLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUFDLFlBQVksRUFBRSxDQUFDO0lBRXdDLENBQUM7SUFFaEgsV0FBVyxDQUFDLFFBQXVCO1FBQ3hDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzNCLENBQUM7SUFJUyxrQkFBa0IsQ0FBQyxHQUF1QixFQUFFLGFBQWtCO1FBQ3RFLDRCQUE0QjtRQUM1QixhQUFhLENBQUMsYUFBYSxDQUFDLEdBQUcsMkpBQTJKLENBQUM7UUFDM0wsYUFBYSxDQUFDLGFBQWEsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxhQUFhLENBQUMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7UUFDcEYsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyx3QkFBd0IsRUFBRSxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDbkYsQ0FBQztJQUVTLHFCQUFxQixDQUFDLEdBQXVCLEVBQUUsU0FBYztRQUNyRSxTQUFTLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUMzQixJQUFJLENBQUMsbUJBQW1CLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDaEQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sc0JBQXNCO1FBQzNCLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUtNLGNBQWMsQ0FBSSxRQUFhO1FBQ3BDLE9BQU8sRUFBRSxHQUFHLFFBQVEsQ0FBQyxTQUFjLEVBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRU0sY0FBYyxDQUF1QixlQUEwQjtRQUM5RCxlQUFnQixDQUFDLE9BQU8sR0FBRztZQUMvQixxQkFBcUIsRUFBRTtnQkFDckIsTUFBTSxFQUFFLFFBQVE7Z0JBQ2hCLG1DQUFtQztnQkFDbkMsYUFBYSxFQUFFLDJKQUEySixHQUFHLElBQUksQ0FBQyxnQkFBZ0I7YUFDbk07U0FDRixDQUFDO1FBQ0ksZUFBZ0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQztnQkFDL0IsRUFBRSxFQUFFLGFBQWE7Z0JBQ2pCLElBQUksRUFBRSxZQUFZO2dCQUNsQixNQUFNLEVBQUUsdUJBQXVCO2dCQUMvQixLQUFLLEVBQUU7b0JBQ0wsa0JBQWtCLEVBQUUsZUFBZTtpQkFDcEM7YUFDc0IsQ0FBQyxDQUFDO1FBQzNCLE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFBQSxDQUFDOytHQS9Ea0IsY0FBYzttSEFBZCxjQUFjLGNBTnRCLE1BQU07OzRGQU1FLGNBQWM7a0JBUG5DLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIEdpc2HDr2EgdW5kZXIgb25lIG9yIG1vcmUgY29udHJpYnV0b3JcbiAqIGxpY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UudHh0IGZpbGUgZGlzdHJpYnV0ZWQgd2l0aFxuICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHRcbiAqIG93bmVyc2hpcC4gR2lzYcOvYSBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyXG4gKiB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5XG4gKiBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFybGFzQmFzZW1hcHMgfSBmcm9tICcuL2Jhc2VtYXBzLm1vZGVsJztcbmltcG9ydCB7IEJhc2VtYXBTdHlsZSB9IGZyb20gJy4vYmFzZW1hcC5jb25maWcnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEFic3RyYWN0QXJsYXNNYXBHTCB9IGZyb20gJy4uL21hcC9BYnN0cmFjdEFybGFzTWFwR0wnO1xuaW1wb3J0IHsgQXJsYXNNYXBGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnLi4vYXJsYXMtbWFwLWZyYW1ld29yay5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG4vKiogTDogYSBsYXllciBjbGFzcy9pbnRlcmZhY2UuXG4gKiAgUzogYSBzb3VyY2UgY2xhc3MvaW50ZXJmYWNlLlxuICogIE06IGEgTWFwIGNvbmZpZ3VyYXRpb24gY2xhc3MvaW50ZXJmYWNlLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZW1hcFNlcnZpY2U8TCwgUywgTT4ge1xuXG4gIHByb3RlY3RlZCBQT1dFUkVEX0JZX0FSTEFTID0gJyBQb3dlcmVkIGJ5IEFSTEFTLic7XG4gIHByb3RlY3RlZCBMT0NBTF9TVE9SQUdFX0JBU0VNQVBTID0gJ2FybGFzX2xhc3RfYmFzZV9tYXAnO1xuXG5cbiAgcHJvdGVjdGVkIGJhc2VtYXBDaGFuZ2VkU291cmNlOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcbiAgcHVibGljIGJhc2VtYXBDaGFuZ2VkJCA9IHRoaXMuYmFzZW1hcENoYW5nZWRTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gIHB1YmxpYyBiYXNlbWFwczogQXJsYXNCYXNlbWFwcztcblxuICBwcm90ZWN0ZWQgcHJvdG9tYXBCYXNlbWFwQWRkZWRTb3VyY2UgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuICBwdWJsaWMgcHJvdG9tYXBCYXNlbWFwQWRkZWQkID0gdGhpcy5wcm90b21hcEJhc2VtYXBBZGRlZFNvdXJjZS5hc09ic2VydmFibGUoKTtcblxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IocHJvdGVjdGVkIGh0dHA6IEh0dHBDbGllbnQsIHByb3RlY3RlZCBtYXBGcmFtZXdvcmtTZXJ2aWNlOiBBcmxhc01hcEZyYW1ld29ya1NlcnZpY2U8TCwgUywgTT4pIHsgfVxuXG4gIHB1YmxpYyBzZXRCYXNlbWFwcyhiYXNlbWFwczogQXJsYXNCYXNlbWFwcykge1xuICAgIHRoaXMuYmFzZW1hcHMgPSBiYXNlbWFwcztcbiAgfVxuXG4gIHB1YmxpYyBhYnN0cmFjdCBhZGRQcm90b21hcEJhc2VtYXAobWFwOiBBYnN0cmFjdEFybGFzTWFwR0wpO1xuXG4gIHByb3RlY3RlZCBhZGRQTXRpbGVzVG9Tb3VyY2UobWFwOiBBYnN0cmFjdEFybGFzTWFwR0wsIHBtdGlsZXNTb3VyY2U6IGFueSkge1xuICAgIC8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cbiAgICBwbXRpbGVzU291cmNlWydhdHRyaWJ1dGlvbiddID0gJzxhIGhyZWY9XCJodHRwczovL3Byb3RvbWFwcy5jb20vXCIgdGFyZ2V0PVwiX2JsYW5rXCI+UHJvdG9tYXBzPC9hPiA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvY29weXJpZ2h0XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JmNvcHk7IE9wZW5TdHJlZXRNYXA8L2E+JztcbiAgICBwbXRpbGVzU291cmNlWydhdHRyaWJ1dGlvbiddID0gcG10aWxlc1NvdXJjZVsnYXR0cmlidXRpb24nXSArIHRoaXMuUE9XRVJFRF9CWV9BUkxBUztcbiAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2Uuc2V0U291cmNlKCdhcmxhc19wcm90b21hcHNfc291cmNlJywgcG10aWxlc1NvdXJjZSwgbWFwKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhZGRQcm90b21hcExheWVyVG9NYXAobWFwOiBBYnN0cmFjdEFybGFzTWFwR0wsIHN0eWxlRmlsZTogYW55KSB7XG4gICAgc3R5bGVGaWxlLmxheWVycy5mb3JFYWNoKGwgPT4ge1xuICAgICAgdGhpcy5tYXBGcmFtZXdvcmtTZXJ2aWNlLnJlbW92ZUxheWVyKG1hcCwgbC5pZCk7XG4gICAgICB0aGlzLm1hcEZyYW1ld29ya1NlcnZpY2UuYWRkTGF5ZXIobWFwLCBsKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBub3RpZnlQcm90b21hcEFkZGl0aW9uKCkge1xuICAgIHRoaXMucHJvdG9tYXBCYXNlbWFwQWRkZWRTb3VyY2UubmV4dCh0cnVlKTtcbiAgfVxuXG4gIHB1YmxpYyBhYnN0cmFjdCByZW1vdmVQcm90b21hcEJhc2VtYXAobWFwOiBBYnN0cmFjdEFybGFzTWFwR0wpO1xuXG4gIHB1YmxpYyBhYnN0cmFjdCBkZWNsYXJlUHJvdG9tYXBQcm90b2NvbChtYXA6IEFic3RyYWN0QXJsYXNNYXBHTCk6IHZvaWQ7XG4gIHB1YmxpYyBjbG9uZVN0eWxlRmlsZTxUPihzZWxlY3RlZDogYW55KSB7XG4gICAgcmV0dXJuIHsgLi4uc2VsZWN0ZWQuc3R5bGVGaWxlIGFzIFR9O1xuICB9XG5cbiAgcHVibGljIGJ1aWxkSW5pdFN0eWxlPFN0eWxlVHlwZSwgTGF5ZXJTcGVjPihjbG9uZWRTdHlsZUZpbGU6IFN0eWxlVHlwZSkge1xuICAgICg8YW55PmNsb25lZFN0eWxlRmlsZSkuc291cmNlcyA9IHtcbiAgICAgIHByb3RvbWFwc19hdHRyaWJ1dGlvbjoge1xuICAgICAgICAndHlwZSc6ICd2ZWN0b3InLFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgICAgICAnYXR0cmlidXRpb24nOiAnPGEgaHJlZj1cImh0dHBzOi8vcHJvdG9tYXBzLmNvbS9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5Qcm90b21hcHM8L2E+IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9jb3B5cmlnaHRcIiB0YXJnZXQ9XCJfYmxhbmtcIj4mY29weTsgT3BlblN0cmVldE1hcDwvYT4nICsgdGhpcy5QT1dFUkVEX0JZX0FSTEFTXG4gICAgICB9XG4gICAgfTtcbiAgICAoPGFueT5jbG9uZWRTdHlsZUZpbGUpLmxheWVycyA9IFt7XG4gICAgICBpZDogJ2JhY2tncm91bmRzJyxcbiAgICAgIHR5cGU6ICdiYWNrZ3JvdW5kJyxcbiAgICAgIHNvdXJjZTogJ3Byb3RvbWFwc19hdHRyaWJ1dGlvbicsXG4gICAgICBwYWludDoge1xuICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6ICdyZ2JhKDAsMCwwLDApJ1xuICAgICAgfVxuICAgIH0gYXMgdW5rbm93biBhcyBMYXllclNwZWNdO1xuICAgIHJldHVybiBjbG9uZWRTdHlsZUZpbGU7XG4gIH07XG4gIHB1YmxpYyBhYnN0cmFjdCBnZXRJbml0U3R5bGUoc2VsZWN0ZWQ6IEJhc2VtYXBTdHlsZSk6IGFueTtcbiAgcHVibGljIGFic3RyYWN0IGZldGNoU291cmNlcyQoKTogT2JzZXJ2YWJsZTxyZWFkb25seSBhbnlbXT47XG4gIHByb3RlY3RlZCBhYnN0cmFjdCBnZXRTdHlsZUZpbGUoYjogQmFzZW1hcFN0eWxlKTogT2JzZXJ2YWJsZTxhbnk+O1xuICBwdWJsaWMgYWJzdHJhY3Qgc2V0QmFzZW1hcChzOiBhbnksIG5ld0Jhc2VtYXA6IEJhc2VtYXBTdHlsZSwgbWFwOiBBYnN0cmFjdEFybGFzTWFwR0wsIG9wdGlvbnM/OiBhbnkpO1xufVxuIl19